!function(e){var t={};function r(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(s,i,function(t){return e[t]}.bind(null,i));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=49)}([function(e,t){e.exports=THREE},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(6),i=r(50);t.types=i.types;const n=r(104),o=r(52),a=r(105),c=r(8);t.Node=c.default;class l extends s.default{constructor(e,t){super({knownEvents:!1}),this.ins=new n.default(this),this.outs=new n.default(this),this.changed=!0,this.updated=!1,this._name="",this._trackers=[],this.node=e,this.id=t}static getTypeName(e){return"function"==typeof e?e.typeName:"object"==typeof e?e.constructor.typeName:e||l.typeName}create(){this.node._addComponent(this),this.graph.isActive&&this.activate&&this.activate()}dispose(){this.graph.isActive&&this.deactivate&&this.deactivate(),this.emit({type:"dispose",component:this}),this.ins.dispose(),this.outs.dispose(),this._trackers.forEach(e=>e.dispose()),this.node&&(this.node._removeComponent(this),this.node=null)}get isNodeSingleton(){return this.constructor.isNodeSingleton}get isGraphSingleton(){return this.constructor.isGraphSingleton}get isSystemSingleton(){return this.constructor.isSystemSingleton}get typeName(){return this.constructor.typeName}get displayTypeName(){const e=this.typeName;return"Component"===e?e:e.substr(1)}get text(){return this.constructor.text}get icon(){return this.constructor.icon}get name(){return this._name}get displayName(){return this._name||this.text||this.displayTypeName}set name(e){this._name=e,this.emit({type:"change",component:this,what:"name"})}get graph(){return this.node.graph}get system(){return this.node.system}get components(){return this.node.components}get isActive(){return this.graph.isActive}getComponent(e,t=!1){return this.node.components.get(e,t)}getComponents(e){return this.node.components.getArray(e)}createComponent(e){return this.node.createComponent(e)}getOrCreateComponent(e){return this.node.components.get(e,!0)||this.node.createComponent(e)}hasComponent(e){return this.node.components.has(e)}getGraphComponent(e,t=!1){return this.node.graph.components.get(e,t)}getGraphComponents(e){return this.node.graph.components.getArray(e)}hasGraphComponent(e){return this.node.graph.components.has(e)}getMainComponent(e,t=!1){return this.node.system.graph.components.get(e,t)}getMainComponents(e){return this.node.system.graph.components.getArray(e)}hasMainComponent(e){return this.node.system.graph.components.has(e)}getSystemComponent(e,t=!1){return this.node.system.components.get(e,t)}getSystemComponents(e){return this.node.system.components.getArray(e)}hasSystemComponent(e){return this.node.system.components.has(e)}getComponentById(e){return this.node.system.components.getById(e)}getNode(e,t=!1){return this.node.graph.nodes.get(e,t)}getNodes(e){return this.node.graph.nodes.getArray(e)}hasNode(e){return this.node.graph.nodes.has(e)}getMainNode(e,t=!1){return this.node.system.graph.nodes.get(e,t)}getMainNodes(e){return this.node.system.graph.nodes.getArray(e)}hasMainNode(e){return this.node.system.graph.nodes.has(e)}getSystemNode(e,t=!1){return this.node.system.nodes.get(e,t)}getSystemNodes(e){return this.node.system.nodes.getArray(e)}hasSystemNode(e){return this.node.system.nodes.has(e)}getNodeById(e){return this.node.system.nodes.getById(e)}activate(){}update(e){throw new Error("this should never be called")}tick(e){throw new Error("this should never be called")}tock(e){throw new Error("this should never be called")}deactivate(){}requestSort(){this.graph.requestSort()}is(e){const t=l.getTypeName(e);let r=this;do{if((r=Object.getPrototypeOf(r)).constructor.typeName===t)return!0}while(r.constructor.typeName!==l.typeName);return!1}unlinkAllProperties(){this.ins.unlinkAllProperties(),this.outs.unlinkAllProperties()}resetChanged(){this.changed=!1;const e=this.ins.properties;for(let t=0,r=e.length;t<r;++t)e[t].changed=!1;const t=this.outs.properties;for(let e=0,r=t.length;e<r;++e)t[e].changed=!1}trackComponent(e,t,r){const s=new o.default(this.node.components,e,t,r);return this._trackers.push(s),s}referenceComponent(e){return new a.default(this.system,e)}toString(){return`${this.typeName}${this.name?" ("+this.name+")":""}`}dump(e=""){console.log(e+`%cComponent '${this.typeName}' (${this.displayName})`,"color: green"),this.ins.properties.forEach(t=>t.dump(e+"  IN  ")),this.outs.properties.forEach(t=>t.dump(e+"  OUT "))}toJSON(){let e={};const t=this.ins.toJSON();t&&(e.ins=t);const r=this.outs.toJSON();return r&&(e.outs=r),e}fromJSON(e){e.ins&&this.ins.fromJSON(e.ins),e.outs&&this.outs.fromJSON(e.outs)}referencesFromJSON(e){const t=this.system.components.getDictionary();e.ins&&this.ins.linksFromJSON(e.ins,t),e.outs&&this.outs.linksFromJSON(e.outs,t)}addCustomInput(e,t,r){return this.changed=!0,this.ins.createCustomProperty(e,t,r)}allowCustomInput(e){return!1}addCustomOutput(e,t,r){return this.outs.createCustomProperty(e,t,r)}allowCustomOutput(e){return!1}addInputs(e,t){return this.ins.createProperties(e,t)}addOutputs(e,t){return this.outs.createProperties(e,t)}}l.typeName="Component",l.text="",l.icon="",l.isNodeSingleton=!0,l.isGraphSingleton=!1,l.isSystemSingleton=!1,t.default=l,l.prototype.activate=null,l.prototype.update=null,l.prototype.tick=null,l.prototype.tock=null,l.prototype.deactivate=null},function(e,t,r){"use strict";r.d(t,"f",function(){return s}),r.d(t,"g",function(){return i}),r.d(t,"b",function(){return o}),r.d(t,"a",function(){return a}),r.d(t,"d",function(){return c}),r.d(t,"c",function(){return l}),r.d(t,"e",function(){return u});
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const s=`{{lit-${String(Math.random()).slice(2)}}}`,i=`\x3c!--${s}--\x3e`,n=new RegExp(`${s}|${i}`),o="$lit$";class a{constructor(e,t){this.parts=[],this.element=t;let r=-1,i=0;const a=[],c=t=>{const d=t.content,h=document.createTreeWalker(d,133,null,!1);let p=0;for(;h.nextNode();){r++;const t=h.currentNode;if(1===t.nodeType){if(t.hasAttributes()){const a=t.attributes;let c=0;for(let e=0;e<a.length;e++)a[e].value.indexOf(s)>=0&&c++;for(;c-- >0;){const s=e.strings[i],a=u.exec(s)[2],c=a.toLowerCase()+o,l=t.getAttribute(c).split(n);this.parts.push({type:"attribute",index:r,name:a,strings:l}),t.removeAttribute(c),i+=l.length-1}}"TEMPLATE"===t.tagName&&c(t)}else if(3===t.nodeType){const e=t.data;if(e.indexOf(s)>=0){const s=t.parentNode,o=e.split(n),c=o.length-1;for(let e=0;e<c;e++)s.insertBefore(""===o[e]?l():document.createTextNode(o[e]),t),this.parts.push({type:"node",index:++r});""===o[c]?(s.insertBefore(l(),t),a.push(t)):t.data=o[c],i+=c}}else if(8===t.nodeType)if(t.data===s){const e=t.parentNode;null!==t.previousSibling&&r!==p||(r++,e.insertBefore(l(),t)),p=r,this.parts.push({type:"node",index:r}),null===t.nextSibling?t.data="":(a.push(t),r--),i++}else{let e=-1;for(;-1!==(e=t.data.indexOf(s,e+1));)this.parts.push({type:"node",index:-1})}}};c(t);for(const e of a)e.parentNode.removeChild(e)}}const c=e=>-1!==e.index,l=()=>document.createComment(""),u=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F \x09\x0a\x0c\x0d"'>=\/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/},function(e,t,r){"use strict";r.r(t);var s=r(4);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class i{handleAttributeExpressions(e,t,r,i){const n=t[0];if("."===n){return new s.f(e,t.slice(1),r).parts}return"@"===n?[new s.d(e,t.slice(1),i.eventContext)]:"?"===n?[new s.c(e,t.slice(1),r)]:new s.a(e,t,r).parts}handleTextExpression(e){return new s.e(e)}}const n=new i;var o=r(10),a=r(14),c=r(7),l=r(5),u=r(15),d=r(13),h=r(18),p=r(2);r.d(t,"html",function(){return m}),r.d(t,"svg",function(){return f}),r.d(t,"DefaultTemplateProcessor",function(){return i}),r.d(t,"defaultTemplateProcessor",function(){return n}),r.d(t,"directive",function(){return a.a}),r.d(t,"isDirective",function(){return a.b}),r.d(t,"removeNodes",function(){return c.b}),r.d(t,"reparentNodes",function(){return c.c}),r.d(t,"noChange",function(){return l.a}),r.d(t,"nothing",function(){return l.b}),r.d(t,"AttributeCommitter",function(){return s.a}),r.d(t,"AttributePart",function(){return s.b}),r.d(t,"BooleanAttributePart",function(){return s.c}),r.d(t,"EventPart",function(){return s.d}),r.d(t,"isPrimitive",function(){return s.h}),r.d(t,"NodePart",function(){return s.e}),r.d(t,"PropertyCommitter",function(){return s.f}),r.d(t,"PropertyPart",function(){return s.g}),r.d(t,"parts",function(){return u.a}),r.d(t,"render",function(){return u.b}),r.d(t,"templateCaches",function(){return d.a}),r.d(t,"templateFactory",function(){return d.b}),r.d(t,"TemplateInstance",function(){return h.a}),r.d(t,"SVGTemplateResult",function(){return o.a}),r.d(t,"TemplateResult",function(){return o.b}),r.d(t,"createMarker",function(){return p.c}),r.d(t,"isTemplatePartActive",function(){return p.d}),r.d(t,"Template",function(){return p.a}),
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.0.0");const m=(e,...t)=>new o.b(e,t,"html",n),f=(e,...t)=>new o.a(e,t,"svg",n)},function(e,t,r){"use strict";r.d(t,"h",function(){return l}),r.d(t,"a",function(){return u}),r.d(t,"b",function(){return d}),r.d(t,"e",function(){return h}),r.d(t,"c",function(){return p}),r.d(t,"f",function(){return m}),r.d(t,"g",function(){return f}),r.d(t,"d",function(){return g});var s=r(14),i=r(7),n=r(5),o=r(18),a=r(10),c=r(2);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const l=e=>null===e||!("object"==typeof e||"function"==typeof e);class u{constructor(e,t,r){this.dirty=!0,this.element=e,this.name=t,this.strings=r,this.parts=[];for(let e=0;e<r.length-1;e++)this.parts[e]=this._createPart()}_createPart(){return new d(this)}_getValue(){const e=this.strings,t=e.length-1;let r="";for(let s=0;s<t;s++){r+=e[s];const t=this.parts[s];if(void 0!==t){const e=t.value;if(null!=e&&(Array.isArray(e)||"string"!=typeof e&&e[Symbol.iterator]))for(const t of e)r+="string"==typeof t?t:String(t);else r+="string"==typeof e?e:String(e)}}return r+=e[t]}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class d{constructor(e){this.value=void 0,this.committer=e}setValue(e){e===n.a||l(e)&&e===this.value||(this.value=e,Object(s.b)(e)||(this.committer.dirty=!0))}commit(){for(;Object(s.b)(this.value);){const e=this.value;this.value=n.a,e(this)}this.value!==n.a&&this.committer.commit()}}class h{constructor(e){this.value=void 0,this._pendingValue=void 0,this.options=e}appendInto(e){this.startNode=e.appendChild(Object(c.c)()),this.endNode=e.appendChild(Object(c.c)())}insertAfterNode(e){this.startNode=e,this.endNode=e.nextSibling}appendIntoPart(e){e._insert(this.startNode=Object(c.c)()),e._insert(this.endNode=Object(c.c)())}insertAfterPart(e){e._insert(this.startNode=Object(c.c)()),this.endNode=e.endNode,e.endNode=this.startNode}setValue(e){this._pendingValue=e}commit(){for(;Object(s.b)(this._pendingValue);){const e=this._pendingValue;this._pendingValue=n.a,e(this)}const e=this._pendingValue;e!==n.a&&(l(e)?e!==this.value&&this._commitText(e):e instanceof a.b?this._commitTemplateResult(e):e instanceof Node?this._commitNode(e):Array.isArray(e)||e[Symbol.iterator]?this._commitIterable(e):e===n.b?(this.value=n.b,this.clear()):this._commitText(e))}_insert(e){this.endNode.parentNode.insertBefore(e,this.endNode)}_commitNode(e){this.value!==e&&(this.clear(),this._insert(e),this.value=e)}_commitText(e){const t=this.startNode.nextSibling;e=null==e?"":e,t===this.endNode.previousSibling&&3===t.nodeType?t.data=e:this._commitNode(document.createTextNode("string"==typeof e?e:String(e))),this.value=e}_commitTemplateResult(e){const t=this.options.templateFactory(e);if(this.value instanceof o.a&&this.value.template===t)this.value.update(e.values);else{const r=new o.a(t,e.processor,this.options),s=r._clone();r.update(e.values),this._commitNode(s),this.value=r}}_commitIterable(e){Array.isArray(this.value)||(this.value=[],this.clear());const t=this.value;let r,s=0;for(const i of e)void 0===(r=t[s])&&(r=new h(this.options),t.push(r),0===s?r.appendIntoPart(this):r.insertAfterPart(t[s-1])),r.setValue(i),r.commit(),s++;s<t.length&&(t.length=s,this.clear(r&&r.endNode))}clear(e=this.startNode){Object(i.b)(this.startNode.parentNode,e.nextSibling,this.endNode)}}class p{constructor(e,t,r){if(this.value=void 0,this._pendingValue=void 0,2!==r.length||""!==r[0]||""!==r[1])throw new Error("Boolean attributes can only contain a single expression");this.element=e,this.name=t,this.strings=r}setValue(e){this._pendingValue=e}commit(){for(;Object(s.b)(this._pendingValue);){const e=this._pendingValue;this._pendingValue=n.a,e(this)}if(this._pendingValue===n.a)return;const e=!!this._pendingValue;this.value!==e&&(e?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name)),this.value=e,this._pendingValue=n.a}}class m extends u{constructor(e,t,r){super(e,t,r),this.single=2===r.length&&""===r[0]&&""===r[1]}_createPart(){return new f(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class f extends d{}let v=!1;try{const e={get capture(){return v=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}class g{constructor(e,t,r){this.value=void 0,this._pendingValue=void 0,this.element=e,this.eventName=t,this.eventContext=r,this._boundHandleEvent=(e=>this.handleEvent(e))}setValue(e){this._pendingValue=e}commit(){for(;Object(s.b)(this._pendingValue);){const e=this._pendingValue;this._pendingValue=n.a,e(this)}if(this._pendingValue===n.a)return;const e=this._pendingValue,t=this.value,r=null==e||null!=t&&(e.capture!==t.capture||e.once!==t.once||e.passive!==t.passive),i=null!=e&&(null==t||r);r&&this.element.removeEventListener(this.eventName,this._boundHandleEvent,this._options),i&&(this._options=y(e),this.element.addEventListener(this.eventName,this._boundHandleEvent,this._options)),this.value=e,this._pendingValue=n.a}handleEvent(e){"function"==typeof this.value?this.value.call(this.eventContext||this.element,e):this.value.handleEvent(e)}}const y=e=>e&&(v?{capture:e.capture,passive:e.passive,once:e.once}:e.capture)},function(e,t,r){"use strict";r.d(t,"a",function(){return s}),r.d(t,"b",function(){return i});
/**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const s={},i={}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=Symbol("Publisher private data"),i=Symbol("Publisher strict option");t.default=class{constructor(e){const t=!e||e.knownEvents;this[s]={[i]:t}}on(e,t,r){if(Array.isArray(e))return void e.forEach(e=>{this.on(e,t,r)});if(!t)throw new Error("missing callback function");let n=this[s][e];if(!n){if(this[s][i])throw new Error(`can't subscribe; unknown event: '${e}'`);n=this[s][e]=[]}let o={callback:t,context:r};n.push(o)}addEventListener(e,t,r){this.on(e,t,r)}once(e,t,r){if(Array.isArray(e))return void e.forEach(e=>{this.once(e,t,r)});const s=i=>{this.off(e,s,r),t.call(r,i)};s.cb=t,this.on(e,s,r)}off(e,t,r){if("object"==typeof e){if(Array.isArray(e))e.forEach(e=>{this.off(e,t,r)});else{const t=this[s];for(let r=0,s=Object.keys(t).length;r<s;++r){const r=t[e],s=[];for(let t=0,i=r.length;t<i;++t){const i=r[t];e&&i.context!==e&&s.push(i)}t[e]=s}}return}const i=this[s][e];if(!i)throw new Error(`can't unsubscribe; unknown event type: '${e}'`);const n=[];for(let e=0,s=i.length;e<s;++e){const s=i[e];(t&&t!==s.callback&&t!==s.callback.cb||r&&r!==s.context)&&n.push(s)}this[s][e]=n}removeEventListener(e,t,r){this.off(e,t,r)}emit(e,t){let r,n;if("string"==typeof e?(r=e,n=t):(r=e.type,n=e),!r)throw new Error(`empty or invalid event type: '${r}'`);const o=this[s],a=o[r];if(a)for(let e=0,t=a.length;e<t;++e){const t=a[e];t.context?t.callback.call(t.context,n):t.callback(n)}else if(o[i])throw new Error(`can't emit; unknown event type: '${r}'`)}addEvent(e){this[s][e]||(this[s][e]=[])}addEvents(...e){e.forEach(e=>{this[s][e]||(this[s][e]=[])})}hasEvent(e){return!!this[s][e]}listEvents(){return Object.getOwnPropertyNames(this[s])}}},function(e,t,r){"use strict";r.d(t,"a",function(){return s}),r.d(t,"c",function(){return i}),r.d(t,"b",function(){return n});
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const s=void 0!==window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,i=(e,t,r=null,s=null)=>{let i=t;for(;i!==r;){const t=i.nextSibling;e.insertBefore(i,s),i=t}},n=(e,t,r=null)=>{let s=t;for(;s!==r;){const t=s.nextSibling;e.removeChild(s),s=t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(23),i=r(6),n=r(28),o=r(1);class a extends i.default{constructor(e,t){super({knownEvents:!1}),this.graph=null,this.components=new n.default(o.default),this._name="",this._isLocked=void 0,this.graph=e,this.id=t}static getTypeName(e){return"function"==typeof e?e.typeName:"object"==typeof e?e.constructor.typeName:e||a.typeName}get typeName(){return this.constructor.typeName}get displayTypeName(){const e=this.typeName;return"Node"===e?e:e.substr(1)}get isLocked(){return this._isLocked}get text(){return this.constructor.text}get icon(){return this.constructor.icon}get name(){return this._name}get displayName(){return this._name||this.text||this.displayTypeName}set name(e){this._name=e,this.emit({type:"change",what:"name",node:this})}get system(){return this.graph.system}getComponent(e,t=!1){return this.components.get(e,t)}getComponents(e){return this.components.getArray(e)}getOrCreateComponent(e){return this.components.get(e,!0)||this.createComponent(e)}hasComponent(e){return this.components.has(e)}getGraphComponent(e,t=!1){return this.graph.components.get(e,t)}getGraphComponents(e){return this.graph.components.getArray(e)}hasGraphComponent(e){return this.graph.components.has(e)}getMainComponent(e,t=!1){return this.graph.system.graph.components.get(e,t)}getMainComponents(e){return this.graph.system.graph.components.getArray(e)}hasMainComponent(e){return this.graph.system.graph.components.has(e)}getSystemComponent(e,t=!1){return this.graph.system.components.get(e,t)}getSystemComponents(e){return this.graph.system.components.getArray(e)}hasSystemComponent(e){return this.graph.system.components.has(e)}getComponentById(e){return this.graph.system.components.getById(e)}getNode(e,t=!1){return this.graph.nodes.get(e,t)}getNodes(e){return this.graph.nodes.getArray(e)}hasNode(e){return this.graph.nodes.has(e)}getMainNode(e,t=!1){return this.graph.system.graph.nodes.get(e,t)}getMainNodes(e){return this.graph.system.graph.nodes.getArray(e)}hasMainNode(e){return this.graph.system.graph.nodes.has(e)}getSystemNode(e,t=!1){return this.graph.system.nodes.get(e,t)}getSystemNodes(e){return this.graph.system.nodes.getArray(e)}hasSystemNode(e){return this.graph.system.nodes.has(e)}getNodeById(e){return this.graph.system.nodes.getById(e)}lock(){if(!1===this._isLocked)throw new Error("can't lock an unlocked node again");this._isLocked=!0}unlock(){this._isLocked=!1}create(){this.graph._addNode(this)}createComponents(){}clear(){this.components.getArray().slice().forEach(e=>e.dispose())}dispose(){this.components.cloneArray().reverse().forEach(e=>e.dispose()),this.emit({type:"dispose",node:this}),this.graph&&(this.graph._removeNode(this),this.graph=null)}createComponent(e,t,r){if(!0===this._isLocked)throw new Error("node is locked, can't create component");const i=this.system.registry.getType(e);if(!i)throw new Error(`component type '${o.default.getTypeName(e)}' not registered`);const n=new i(this,r||s.default(12,this.system.components.getDictionary()));return n.create(),t&&(n.name=t),n}is(e){const t=a.getTypeName(e);let r=this;do{if((r=Object.getPrototypeOf(r)).constructor.typeName===t)return!0}while(r.constructor.typeName!==a.typeName);return!1}toString(e=!1){const t=this.components.getArray(),r=`Node '${this.name}' - ${t.length} components`;return e?r+"\n"+t.map(e=>"  "+e.toString()).join("\n"):r}dump(e=""){console.log(e+`%cNode '${this.typeName}' (${this.displayName})`,"color: blue"),this.components.getArray().forEach(t=>t.dump(e+"  "))}toJSON(){const e={},t=[];this._isLocked&&(e.locked=!0);const r=this.components.getArray();for(let e=0,s=r.length;e<s;++e){const s=r[e],i=this.componentToJSON(s);i&&(i.type=s.typeName,i.id=s.id,s.name&&(i.name=s.name),t.push(i))}return t.length>0&&(e.components=t),e}fromJSON(e){this._isLocked=!!e.locked,e.components&&e.components.forEach(e=>this.componentFromJSON(e))}componentFromJSON(e){this.createComponent(e.type,e.name,e.id).fromJSON(e)}referencesFromJSON(e){e.components&&e.components.forEach(e=>{this.components.getById(e.id).referencesFromJSON(e)})}componentToJSON(e){return e.toJSON()}_addComponent(e){if(e.isNodeSingleton&&this.components.has(e))throw new Error(`only one component of type '${e.typeName}' allowed per node`);this.components.add(e),this.graph._addComponent(e)}_removeComponent(e){this.graph._removeComponent(e),this.components.remove(e)}}a.typeName="Node",a.text="",a.icon="",t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(1);t.Node=i.Node,t.types=i.types;const n=r(60),o=r(25),a=r(17);t.ERotationOrder=a.ERotationOrder;const c=new s.Vector3;class l extends i.default{constructor(e,t){super(e,t),this.ins=this.addInputs(l.object3DIns),this.outs=this.addOutputs(l.object3DOuts),this._object3D=null,this._isPickable=!1,this.addEvent("object"),this.node.components.on(this.parentComponentClass,this._onParent,this)}get parentComponentClass(){return this.constructor.parentComponentClass}get parentComponent(){return this.node.components.get(this.parentComponentClass,!0)}get transform(){return this.node.components.get(a.default,!0)}get scene(){const e=this.transform;return e?e.getParentComponent(o.default,!0):void 0}get object3D(){return this._object3D}set object3D(e){const t=this._object3D,r=this.parentComponent;t&&(t.userData.component=null,this.unregisterPickableObject3D(t,!0),t.parent&&t.parent.remove(t)),this.emit({type:"object",current:t,next:e}),this._object3D=e,e&&(e.userData.component=this,e.matrixAutoUpdate=!1,e.visible=this.ins.visible.value,this.registerPickableObject3D(e,!0),r&&r.object3D.add(e))}update(e){const{visible:t,pickable:r}=this.ins;return t.changed&&this._object3D&&(this._object3D.visible=t.value),r.changed&&r.value!==this._isPickable&&(this._isPickable=r.value,r.value?this.enablePointerEvents():this.disablePointerEvents()),!0}dispose(){this.object3D=null,this.ins.pickable.value&&this.disablePointerEvents(),this.node.components.off(this.parentComponentClass,this._onParent,this),super.dispose()}preRender(e){}postRender(e){}toString(){return super.toString()+(this._object3D?` - type: ${this._object3D.type}`:" - (null)")}onPointer(e){const t=this.outs;"pointer-down"===e.type?(t.pointerDown.set(),t.pointerActive.setValue(!0)):"pointer-up"===e.type&&(t.pointerUp.set(),t.pointerActive.setValue(!1)),e.stopPropagation=!0}enablePointerEvents(){this.on("pointer-down",this.onPointer,this),this.on("pointer-up",this.onPointer,this)}disablePointerEvents(){this.off("pointer-down",this.onPointer,this),this.off("pointer-up",this.onPointer,this);const e=this.outs;e.pointerActive.value&&(e.pointerUp.set(),e.pointerActive.setValue(!1))}updateTransform(){const e=this._object3D;if(!e)return;const{position:t,rotation:r,order:i,scale:n}=this.ins;if(t.changed||r.changed||i.changed||n.changed){e.position.fromArray(t.value),c.fromArray(r.value).multiplyScalar(s.Math.DEG2RAD);const o=i.getOptionText();e.rotation.setFromVector3(c,o),e.scale.fromArray(n.value),e.updateMatrix()}return!0}addObject3D(e){this._object3D.add(e),this.registerPickableObject3D(e,!0)}removeObject3D(e){this._object3D.remove(e),this.unregisterPickableObject3D(e,!0)}registerPickableObject3D(e,t){n.default.add(e,t)}unregisterPickableObject3D(e,t){n.default.remove(e,t)}_onParent(e){this._object3D&&!this._object3D.parent&&e.add&&e.object.object3D.add(this._object3D)}}l.typeName="CObject3D",l.parentComponentClass=a.default,l.object3DIns={visible:i.types.Boolean("Object.Visible",!0),pickable:i.types.Boolean("Object.Pickable")},l.object3DOuts={pointerDown:i.types.Event("Pointer.Down"),pointerUp:i.types.Event("Pointer.Up"),pointerActive:i.types.Boolean("Pointer.Active")},l.transformIns=a.default.transformIns,t.default=l,l.prototype.preRender=null,l.prototype.postRender=null},function(e,t,r){"use strict";r.d(t,"b",function(){return n}),r.d(t,"a",function(){return o});var s=r(7),i=r(2);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class n{constructor(e,t,r,s){this.strings=e,this.values=t,this.type=r,this.processor=s}getHTML(){const e=this.strings.length-1;let t="";for(let r=0;r<e;r++){const e=this.strings[r],s=i.e.exec(e);t+=s?e.substr(0,s.index)+s[1]+s[2]+i.b+s[3]+i.f:e+i.g}return t+this.strings[e]}getTemplateElement(){const e=document.createElement("template");return e.innerHTML=this.getHTML(),e}}class o extends n{getHTML(){return`<svg>${super.getHTML()}</svg>`}getTemplateElement(){const e=super.getTemplateElement(),t=e.content,r=t.firstChild;return t.removeChild(r),Object(s.c)(t,r.firstChild),e}}},function(e,t,r){"use strict";var s,i=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const n=r(97);var o=r(97);t.property=o.property;var a=r(3);t.html=a.html,t.svg=a.svg,t.render=a.render,t.TemplateResult=a.TemplateResult;var c=r(98);t.repeat=c.repeat;let l=s=class extends n.LitElement{constructor(){super(...arguments),this._isFirstConnected=!1}static setStyle(e,t){Object.assign(e.style,t)}static setAttribs(e,t){for(let r in t)e.setAttribute(r,t[r])}get shady(){return this.constructor.shady}appendTo(e){return e.appendChild(this),this}removeChildren(){for(;this.firstChild;)this.removeChild(this.firstChild)}getChildrenArray(){return Array.from(this.children)}appendElement(e,t){return this.createElement(e,t,this)}createElement(e,t,r){let s;return s="string"==typeof e?document.createElement(e):e instanceof HTMLElement?e:new e,t&&Object.assign(s.style,t),r&&r.appendChild(s),s}setStyle(e){return s.setStyle(this,e),this}setAttribute(e,t){return super.setAttribute(e,t),this}setAttributes(e){return s.setAttribs(this,e),this}addClass(...e){return e.forEach(e=>this.classList.add(e)),this}removeClass(...e){return e.forEach(e=>this.classList.remove(e)),this}setClass(e,t){return t?this.classList.add(e):this.classList.remove(e),this}hasFocus(){return document.activeElement===this}on(e,t,r){return this.addEventListener(e,t,r),this}off(e,t,r){return this.removeEventListener(e,t,r),this}connectedCallback(){this._isFirstConnected||(this._isFirstConnected=!0,this.firstConnected()),this.connected(),super.connectedCallback()}disconnectedCallback(){super.disconnectedCallback(),this.disconnected()}createRenderRoot(){return this.shady?super.createRenderRoot():this}firstConnected(){}connected(){}disconnected(){}onUpdate(){this.requestUpdate()}};function u(e){return t=>(t.tagName=e,customElements.define(t.tagName,t),t)}l.tagName="ff-custom-element",l.shady=!1,l=s=i([u("ff-custom-element")],l),t.default=l,t.customElement=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(1),n=r(9),o=r(41),a=r(46),c=r(187),l=r(37),u=r(188),d=r(47),h=r(16),p=new s.Vector3,m=new s.Vector3,f=(new s.Vector3,new s.Quaternion),v=new s.Box3;class g extends n.default{constructor(e,t){super(e,t),this.ins=this.addInputs(g.ins),this.outs=this.addOutputs(g.outs),this._derivatives=new u.default,this._activeDerivative=null,this._boxFrame=null,this.object3D=new s.Group,this._boundingBox=(new s.Box3).makeEmpty()}get derivatives(){return this._derivatives}get boundingBox(){return this._boundingBox}get activeDerivative(){return this._activeDerivative}get assetReader(){return this.system.getMainComponent(h.default)}create(){super.create(),this.node.createComponent(d.default).ins.unitScale.linkFrom(this.outs.unitScale)}update(){const e=this.ins;if(!this.activeDerivative&&e.autoLoad.changed&&e.autoLoad.value)this.autoLoad(e.quality.value);else if(e.quality.changed){const t=this.derivatives.select(a.EDerivativeUsage.Web3D,e.quality.value);t&&t!==this.activeDerivative&&this.loadDerivative(t).catch(e=>{console.warn("Model.update - failed to load derivative"),console.warn(e)})}if(e.visible.changed&&(this.object3D.visible=e.visible.value),(e.localUnits.changed||e.globalUnits.changed)&&(this.updateUnitScale(),this.emit("bounding-box")),e.shader.changed){const t=e.shader.getValidatedValue();this.object3D.traverse(e=>{const r=e.material;r&&r.isUberPBRMaterial&&r.setShaderMode(t)})}return e.center.changed&&this.center(),(e.position.changed||e.rotation.changed)&&this.updateMatrixFromProps(),e.dumpDerivatives.changed&&console.log(this.derivatives.toString(!0)),!0}dispose(){this.derivatives.clear(),this._activeDerivative=null,super.dispose()}center(){const e=this.object3D,t=this.ins.position;e.matrix.decompose(p,f,m),e.matrix.makeRotationFromQuaternion(f),v.makeEmpty(),o.computeLocalBoundingBox(e,v,e.parent),v.getCenter(p),p.multiplyScalar(-1).toArray(t.value),t.set()}setFromMatrix(e){const t=this.ins;e.decompose(p,f,m),p.multiplyScalar(1/this.outs.unitScale.value).toArray(t.position.value),t.position.set(),o.quaternionToDegrees(f,g.rotationOrder,t.rotation.value),t.rotation.set()}fromDocument(e,t){const r=this.ins;if(!isFinite(t.model))throw new Error("model property missing in node");const i=e.models[t.model];return r.localUnits.setValue(a.EUnitType[i.units||"cm"]||a.EUnitType.cm),r.position.reset(),r.rotation.reset(),i.translation&&r.position.copyValue(i.translation),i.rotation&&(f.fromArray(i.rotation),o.quaternionToDegrees(f,g.rotationOrder,r.rotation.value),r.rotation.set()),i.boundingBox&&(this._boundingBox.min.fromArray(i.boundingBox.min),this._boundingBox.max.fromArray(i.boundingBox.max),this._boxFrame=new s.Box3Helper(this._boundingBox,"#ffffff"),this.addObject3D(this._boxFrame),this.emit("bounding-box")),i.derivatives&&this.derivatives.fromJSON(i.derivatives),i.material,i.annotations&&this.getComponent(d.default).fromData(i.annotations),this.ins.autoLoad.set(),t.model}toDocument(e,t){const r={units:a.EUnitType[this.ins.localUnits.getValidatedValue()]},s=this.ins,i=s.position.value;0===i[0]&&0===i[1]&&0===i[2]||(r.translation=s.position.value);const n=s.rotation.value;0===n[0]&&0===n[1]&&0===n[2]||(o.degreesToQuaternion(n,g.rotationOrder,f),r.rotation=f.toArray()),r.boundingBox={min:this._boundingBox.min.toArray(),max:this._boundingBox.max.toArray()},r.derivatives=this.derivatives.toJSON();const c=this.getComponent(d.default).toData();c&&c.length>0&&(r.annotations=c),e.models=e.models||[];const l=e.models.length;return e.models.push(r),l}updateUnitScale(){const e=this.ins.localUnits.getValidatedValue(),t=this.ins.globalUnits.getValidatedValue();this.outs.unitScale.setValue(c.default(e,t)),this.updateMatrixFromProps()}updateMatrixFromProps(){const e=this.ins,t=this.outs.unitScale.value,r=this.object3D;p.fromArray(e.position.value).multiplyScalar(t),o.degreesToQuaternion(e.rotation.value,g.rotationOrder,f),m.setScalar(t),r.matrix.compose(p,f,m),r.matrixWorldNeedsUpdate=!0}autoLoad(e){const t=[],r=this.derivatives.select(a.EDerivativeUsage.Web3D,a.EDerivativeQuality.Thumb);r&&t.push(r);const s=this.derivatives.select(a.EDerivativeUsage.Web3D,e);return s&&s!==r&&t.push(s),0===t.length?Promise.resolve():t.reduce((e,t)=>e.then(()=>this.loadDerivative(t)),Promise.resolve())}loadDerivative(e){return e.load(this.assetReader).then(()=>{e.model&&(this._boxFrame&&(this.removeObject3D(this._boxFrame),this._boxFrame.geometry.dispose(),this._boxFrame=null),this._activeDerivative&&(this.removeObject3D(this._activeDerivative.model),this._activeDerivative.unload()),this._activeDerivative=e,this.addObject3D(e.model),o.computeLocalBoundingBox(e.model,this._boundingBox),this.emit("bounding-box"))})}}g.typeName="CVModel2",g.rotationOrder="ZYX",g.ins={globalUnits:i.types.Enum("Model.GlobalUnits",a.EUnitType,a.EUnitType.cm),localUnits:i.types.Enum("Model.LocalUnits",a.EUnitType,a.EUnitType.cm),shader:i.types.Enum("Model.Shader",l.EShaderMode,l.EShaderMode.Default),quality:i.types.Enum("Model.Quality",a.EDerivativeQuality,a.EDerivativeQuality.High),autoLoad:i.types.Boolean("Model.AutoLoad",!0),position:i.types.Vector3("Model.Position"),rotation:i.types.Vector3("Model.Rotation"),center:i.types.Event("Model.Center"),dumpDerivatives:i.types.Event("Derivatives.Dump")},g.outs={unitScale:i.types.Number("UnitScale",{preset:1,precision:5})},t.default=g},function(e,t,r){"use strict";r.d(t,"b",function(){return i}),r.d(t,"a",function(){return n});var s=r(2);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function i(e){let t=n.get(e.type);void 0===t&&(t={stringsArray:new WeakMap,keyString:new Map},n.set(e.type,t));let r=t.stringsArray.get(e.strings);if(void 0!==r)return r;const i=e.strings.join(s.f);return void 0===(r=t.keyString.get(i))&&(r=new s.a(e,e.getTemplateElement()),t.keyString.set(i,r)),t.stringsArray.set(e.strings,r),r}const n=new Map},function(e,t,r){"use strict";r.d(t,"a",function(){return i}),r.d(t,"b",function(){return n});
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const s=new WeakMap,i=e=>(...t)=>{const r=e(...t);return s.set(r,!0),r},n=e=>"function"==typeof e&&s.has(e)},function(e,t,r){"use strict";r.d(t,"a",function(){return o}),r.d(t,"b",function(){return a});var s=r(7),i=r(4),n=r(13);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const o=new WeakMap,a=(e,t,r)=>{let a=o.get(t);void 0===a&&(Object(s.b)(t,t.firstChild),o.set(t,a=new i.e(Object.assign({templateFactory:n.b},r))),a.appendInto(t)),a.setValue(e),a.commit()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(100),n=r(1),o=r(106),a=r(107),c=r(113),l=r(116),u=!0;class d extends n.default{constructor(e,t){super(e,t),this.ins=this.addInputs(d.ins),this.outs=this.addOutputs(d.outs),this._isBusy=!1;const r=this._loadingManager=new h(this);this.jsonLoader=new o.default(r),this.modelLoader=new a.default(r),this.geometryLoader=new c.default(r),this.textureLoader=new l.default(r),this.rootUrl=window.location.href}get rootUrl(){return this._rootUrl}set rootUrl(e){const t=new URL(".",new URL(e,window.location).href);this._rootUrl=t.href,this._rootPath=t.pathname,console.log("CVAssetReader - rootUrl: %s, rootPath: %s",this._rootUrl,this._rootPath)}update(e){const t=this.ins;return t.setBusy.changed&&this.outs.busy.setValue(t.setBusy.value||this._isBusy),!0}setBusy(e){const t=this.outs;this._isBusy=e,t.busy.setValue(this.ins.setBusy.value||this._isBusy),e||t.completed.set()}getAssetName(e){return e.split("/").pop()}getAssetPath(e){const t=e.indexOf(this._rootPath);return t>=0?e.substr(t+this._rootPath.length):e}getAssetURL(e){return new URL(e,this._rootUrl).href}getJSON(e){const t=this.getAssetURL(e);return this.jsonLoader.get(t)}getText(e){const t=this.getAssetURL(e);return i.default.text(t,"GET")}getModel(e){const t=this.getAssetURL(e);return this.modelLoader.get(t)}getGeometry(e){const t=this.getAssetURL(e);return this.geometryLoader.get(t)}getTexture(e){const t=this.getAssetURL(e);return this.textureLoader.get(t)}}d.typeName="CVAssetReader",d.ins={setBusy:n.types.Boolean("Reader.SetBusy")},d.outs={busy:n.types.Boolean("Reader.IsBusy"),completed:n.types.Event("Reader.Completed")},t.default=d;class h extends s.LoadingManager{constructor(e){super(),this.assetService=e,this.onStart=this.onLoadingStart.bind(this),this.onProgress=this.onLoadingProgress.bind(this),this.onLoad=this.onLoadingCompleted.bind(this),this.onError=this.onLoadingError.bind(this)}onLoadingStart(){u&&console.log("Loading files..."),this.assetService.setBusy(!0)}onLoadingProgress(e,t,r){u&&console.log(`Loaded ${t} of ${r} files: ${e}`)}onLoadingCompleted(){u&&console.log("Loading completed"),this.assetService.setBusy(!1)}onLoadingError(){u&&console.error("Loading error"),this.assetService.setBusy(!1)}}t.AssetLoadingManager=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(19),n=r(1);t.types=n.types;const o=r(57),a=new s.Vector3,c=new s.Vector3,l=new s.Quaternion,u=new s.Euler;var d;!function(e){e[e.XYZ=0]="XYZ",e[e.YZX=1]="YZX",e[e.ZXY=2]="ZXY",e[e.XZY=3]="XZY",e[e.YXZ=4]="YXZ",e[e.ZYX=5]="ZYX"}(d=t.ERotationOrder||(t.ERotationOrder={}));class h extends o.default{constructor(e,t){super(e,t),this.ins=this.addInputs(h.transformIns),this.outs=this.addOutputs(h.transformOuts),this._object3D=this.createObject3D(),this._object3D.matrixAutoUpdate=!1}get transform(){return this}get object3D(){return this._object3D}get children(){return this._children||[]}get matrix(){return this._object3D.matrix}update(e){const t=this._object3D,{position:r,rotation:s,order:n,scale:o}=this.ins,{matrix:c}=this.outs;t.position.fromArray(r.value),a.fromArray(s.value).multiplyScalar(i.default.DEG2RAD);const l=n.getOptionText();return t.rotation.setFromVector3(a,l),t.scale.fromArray(o.value),t.updateMatrix(),t.matrix.toArray(c.value),c.set(),!0}dispose(){this._object3D&&(this._object3D.children.slice().forEach(e=>this._object3D.remove(e)),this._object3D.parent&&this._object3D.parent.remove(this._object3D)),super.dispose()}setPropertiesFromMatrix(e){const t=!e;e=e||this._object3D.matrix;const{position:r,rotation:s,order:n,scale:o}=this.ins;e.decompose(a,l,c),a.toArray(r.value);const d=n.getOptionText();u.setFromQuaternion(l,d),u.toVector3(a),a.multiplyScalar(i.default.RAD2DEG).toArray(s.value),c.toArray(o.value),r.set(t),s.set(t),o.set(t)}addChild(e){super.addChild(e),this._object3D.add(e._object3D)}removeChild(e){this._object3D.remove(e._object3D),super.removeChild(e)}createObject3D(){return new s.Object3D}}h.typeName="CTransform",h.transformIns={position:n.types.Vector3("Transform.Position"),rotation:n.types.Vector3("Transform.Rotation"),order:n.types.Enum("Transform.Order",d),scale:n.types.Scale3("Transform.Scale")},h.transformOuts={matrix:n.types.Matrix4("Transform.Matrix")},t.default=h},function(e,t,r){"use strict";r.d(t,"a",function(){return n});var s=r(7),i=r(2);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class n{constructor(e,t,r){this._parts=[],this.template=e,this.processor=t,this.options=r}update(e){let t=0;for(const r of this._parts)void 0!==r&&r.setValue(e[t]),t++;for(const e of this._parts)void 0!==e&&e.commit()}_clone(){const e=s.a?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),t=this.template.parts;let r=0,n=0;const o=e=>{const s=document.createTreeWalker(e,133,null,!1);let a=s.nextNode();for(;r<t.length&&null!==a;){const e=t[r];if(Object(i.d)(e))if(n===e.index){if("node"===e.type){const e=this.processor.handleTextExpression(this.options);e.insertAfterNode(a.previousSibling),this._parts.push(e)}else this._parts.push(...this.processor.handleAttributeExpressions(a,e.name,e.strings,this.options));r++}else n++,"TEMPLATE"===a.nodeName&&o(a.content),a=s.nextNode();else this._parts.push(void 0),r++}};return o(e),s.a&&(document.adoptNode(e),customElements.upgrade(e)),e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s={PI:3.141592653589793,DOUBLE_PI:6.283185307179586,HALF_PI:1.5707963267948966,QUARTER_PI:.7853981633974483,DEG2RAD:.017453292519943295,RAD2DEG:57.29577951308232,limit:(e,t,r)=>e<t?t:e>r?r:e,limitInt:function(e,t,r){return(e=Math.trunc(e))<t?t:e>r?r:e},normalize:(e,t,r)=>(e-t)/(r-t),normalizeLimit:(e,t,r)=>(e=(e-t)/(r-t))<0?0:e>1?1:e,denormalize:(e,t,r)=>(t+e)*(r-t),scale:(e,t,r,s,i)=>s+(e-t)/(r-t)*(i-s),scaleLimit:(e,t,r,s,i)=>s+((e=e<t?t:e>r?r:e)-t)/(r-t)*(i-s),deg2rad:function(e){return.017453292519943295*e},rad2deg:function(e){return 57.29577951308232*e},deltaRadians:function(e,t){return e=(e%=s.DOUBLE_PI)<0?e+s.DOUBLE_PI:e,(t=(t%=s.DOUBLE_PI)<0?t+s.DOUBLE_PI:t)-e>s.PI&&(e+=s.DOUBLE_PI),t-e},deltaDegrees:function(e,t){return e=(e%=s.DOUBLE_PI)<0?e+s.DOUBLE_PI:e,(t=(t%=s.DOUBLE_PI)<0?t+s.DOUBLE_PI:t)-e>s.PI&&(e+=s.DOUBLE_PI),t-e},curves:{linear:e=>e,easeIn:e=>Math.sin(e*s.HALF_PI),easeOut:e=>Math.cos(e*s.HALF_PI-s.PI)+1,ease:e=>.5*Math.cos(e*s.PI-s.PI)+.5,easeInQuad:e=>e*e,easeOutQuad:e=>e*(2-e),easeQuad:e=>e<.5?2*e*e:(4-2*e)*e-1,easeInCubic:e=>e*e*e,easeOutCubic:e=>--e*e*e+1,easeCubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1- --e*e*e*e,easeQuart:e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e}};t.default=s},function(e,t,r){"use strict";function s(e,t,r){var s=r?" !== ":" === ",i=r?" || ":" && ",n=r?"!":"",o=r?"":"!";switch(e){case"null":return t+s+"null";case"array":return n+"Array.isArray("+t+")";case"object":return"("+n+t+i+"typeof "+t+s+'"object"'+i+o+"Array.isArray("+t+"))";case"integer":return"(typeof "+t+s+'"number"'+i+o+"("+t+" % 1)"+i+t+s+t+")";default:return"typeof "+t+s+'"'+e+'"'}}e.exports={copy:function(e,t){for(var r in t=t||{},e)t[r]=e[r];return t},checkDataType:s,checkDataTypes:function(e,t){switch(e.length){case 1:return s(e[0],t,!0);default:var r="",i=n(e);for(var o in i.array&&i.object&&(r=i.null?"(":"(!"+t+" || ",r+="typeof "+t+' !== "object")',delete i.null,delete i.array,delete i.object),i.number&&delete i.integer,i)r+=(r?" && ":"")+s(o,t,!0);return r}},coerceToTypes:function(e,t){if(Array.isArray(t)){for(var r=[],s=0;s<t.length;s++){var n=t[s];i[n]?r[r.length]=n:"array"===e&&"array"===n&&(r[r.length]=n)}if(r.length)return r}else{if(i[t])return[t];if("array"===e&&"array"===t)return["array"]}},toHash:n,getProperty:c,escapeQuotes:l,equal:r(43),ucs2length:r(145),varOccurences:function(e,t){t+="[^0-9]";var r=e.match(new RegExp(t,"g"));return r?r.length:0},varReplace:function(e,t,r){return t+="([^0-9])",r=r.replace(/\$/g,"$$$$"),e.replace(new RegExp(t,"g"),r+"$1")},cleanUpCode:function(e){return e.replace(u,"").replace(d,"").replace(h,"if (!($1))")},finalCleanUpCode:function(e,t){var r=e.match(p);r&&2==r.length&&(e=t?e.replace(f,"").replace(y,b):e.replace(m,"").replace(v,g));return(r=e.match(E))&&3===r.length?e.replace(_,""):e},schemaHasRules:function(e,t){if("boolean"==typeof e)return!e;for(var r in e)if(t[r])return!0},schemaHasRulesExcept:function(e,t,r){if("boolean"==typeof e)return!e&&"not"!=r;for(var s in e)if(s!=r&&t[s])return!0},schemaUnknownRules:function(e,t){if("boolean"==typeof e)return;for(var r in e)if(!t[r])return r},toQuotedString:w,getPathExpr:function(e,t,r,s){return x(e,r?"'/' + "+t+(s?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):s?"'[' + "+t+" + ']'":"'[\\'' + "+t+" + '\\']'")},getPath:function(e,t,r){var s=w(r?"/"+C(t):c(t));return x(e,s)},getData:function(e,t,r){var s,i,n,o;if(""===e)return"rootData";if("/"==e[0]){if(!S.test(e))throw new Error("Invalid JSON-pointer: "+e);i=e,n="rootData"}else{if(!(o=e.match(P)))throw new Error("Invalid JSON-pointer: "+e);if(s=+o[1],"#"==(i=o[2])){if(s>=t)throw new Error("Cannot access property/index "+s+" levels up, current level is "+t);return r[t-s]}if(s>t)throw new Error("Cannot access data "+s+" levels up, current level is "+t);if(n="data"+(t-s||""),!i)return n}for(var a=n,l=i.split("/"),u=0;u<l.length;u++){var d=l[u];d&&(n+=c(T(d)),a+=" && "+n)}return a},unescapeFragment:function(e){return T(decodeURIComponent(e))},unescapeJsonPointer:T,escapeFragment:function(e){return encodeURIComponent(C(e))},escapeJsonPointer:C};var i=n(["string","number","integer","boolean","null"]);function n(e){for(var t={},r=0;r<e.length;r++)t[e[r]]=!0;return t}var o=/^[a-z$_][a-z$_0-9]*$/i,a=/'|\\/g;function c(e){return"number"==typeof e?"["+e+"]":o.test(e)?"."+e:"['"+l(e)+"']"}function l(e){return e.replace(a,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}var u=/else\s*{\s*}/g,d=/if\s*\([^)]+\)\s*\{\s*\}(?!\s*else)/g,h=/if\s*\(([^)]+)\)\s*\{\s*\}\s*else(?!\s*if)/g;var p=/[^v.]errors/g,m=/var errors = 0;|var vErrors = null;|validate.errors = vErrors;/g,f=/var errors = 0;|var vErrors = null;/g,v="return errors === 0;",g="validate.errors = null; return true;",y=/if \(errors === 0\) return data;\s*else throw new ValidationError\(vErrors\);/,b="return data;",E=/[^A-Za-z_$]rootData[^A-Za-z0-9_$]/g,_=/if \(rootData === undefined\) rootData = data;/;function w(e){return"'"+l(e)+"'"}var S=/^\/(?:[^~]|~0|~1)*$/,P=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function x(e,t){return'""'==e?t:(e+" + "+t).replace(/' \+ '/g,"")}function C(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}function T(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(36),i=r(9);var n;!function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(n=t.EShadowMapResolution||(t.EShadowMapResolution={}));const o={[n.Low]:512,[n.Medium]:1024,[n.High]:2048};class a extends i.default{constructor(){super(...arguments),this.ins=this.addInputs(a.lightIns)}get light(){return this.object3D}update(e){super.update(e);const t=this.light,r=this.ins;if((r.color.changed||r.intensity.changed)&&(t.color.fromArray(r.color.value),t.intensity=r.intensity.value),r.shadowEnabled.changed||r.shadowEnabled.value&&(r.shadowMap.changed||r.shadowBlur.changed)){t.castShadow=r.shadowEnabled.value;const e=o[r.shadowMap.getValidatedValue()];t.shadow.mapSize.set(e,e),t.shadow.radius=r.shadowBlur.value}return!0}}a.typeName="CLight",a.lightIns={color:s.types.ColorRGB("Light.Color"),intensity:s.types.Number("Light.Intensity",1),shadowEnabled:s.types.Boolean("Shadow.Enabled"),shadowMap:s.types.Enum("Shadow.Resolution",n),shadowBlur:s.types.Number("Shadow.Blur",1)},t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(1),n=r(33),o=r(45),a=r(12);class c extends o.default{constructor(){super(...arguments),this.ins=this.addInputs(c.ins),this._modelBoundingBox=new s.Box3}get modelBoundingBox(){return this._modelBoundingBox}get models(){return this.getGraphComponents(a.default)}create(){super.create(),this.graph.components.on(a.default,this.onModelComponent,this),this.models.forEach(e=>e.ins.globalUnits.linkFrom(this.ins.units))}update(e){return this.ins.units.changed&&this.updateModelBoundingBox(),!0}dispose(){this.graph.components.off(a.default,this.onModelComponent,this),super.dispose()}fromDocument(e,t){this.ins.units.setValue(n.EUnitType[t.units]||0)}toDocument(e,t){t.units=n.EUnitType[this.ins.units.getValidatedValue()]}onModelComponent(e){const t=e.object;e.add&&(t.on("bounding-box",this.updateModelBoundingBox,this),t.ins.globalUnits.linkFrom(this.ins.units)),e.remove&&t.off("bounding-box",this.updateModelBoundingBox,this),this.updateModelBoundingBox()}updateModelBoundingBox(){const e=this._modelBoundingBox;e.makeEmpty(),this.models.forEach(t=>e.expandByObject(t.object3D)),this.emit("bounding-box")}}c.typeName="CVScene",c.ins={units:i.types.Enum("Scene.Units",n.EUnitType,n.EUnitType.cm)},t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";t.default=function(e,t){let r;e&&"number"==typeof e||(e=12);do{r="";for(let t=0;t<e;++t)r+=s[62*Math.random()|0]}while(t&&t[r]);return r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(19),n=.5*Math.PI,o=new s.Box3,a=new s.Vector3,c=new s.Vector3,l=new s.Vector3,u=new s.Matrix4,d=(new s.Matrix4,[new s.Vector3(0,-n,0),new s.Vector3(0,n,0),new s.Vector3(-n,0,0),new s.Vector3(n,0,0),new s.Vector3(0,0,0),new s.Vector3(0,Math.PI,0)]);var h,p;!function(e){e[e.Perspective=0]="Perspective",e[e.Orthographic=1]="Orthographic"}(h=t.EProjection||(t.EProjection={})),function(e){e[e.None=-1]="None",e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Top=2]="Top",e[e.Bottom=3]="Bottom",e[e.Front=4]="Front",e[e.Back=5]="Back"}(p=t.EViewPreset||(t.EViewPreset={}));t.default=class extends s.Camera{constructor(e){super(),this.isUniversalCamera=!0,this.fov=50,this.size=20,this.aspect=1,this.distance=20,this.zoom=1,this.near=.1,this.far=2e3,this.focus=10,this.filmGauge=35,this.filmOffset=0,this.view=null,this.setProjection(e)}setProjection(e){e===h.Orthographic?(this.type="OrthographicCamera",this.isPerspectiveCamera=!1,this.isOrthographicCamera=!0):(this.type="PerspectiveCamera",this.isPerspectiveCamera=!0,this.isOrthographicCamera=!1),this.updateProjectionMatrix()}getProjection(){return this.isOrthographicCamera?h.Orthographic:h.Perspective}setPreset(e){e!==p.None?(this.rotation.setFromVector3(d[e],"XYZ"),this.position.set(0,0,this.distance).applyQuaternion(this.quaternion)):(this.rotation.set(0,0,0),this.position.set(0,0,0)),this.updateMatrix()}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*s.Math.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*s.Math.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*s.Math.RAD2DEG*Math.atan(Math.tan(.5*s.Math.DEG2RAD*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,r,i,n,o){this.isPerspectiveCamera?s.PerspectiveCamera.prototype.setViewOffset.call(this,e,t,r,i,n,o):s.OrthographicCamera.prototype.setViewOffset.call(this,e,t,r,i,n,o)}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}zoomToView(){}moveToView(e){this.updateMatrixWorld(!1),o.copy(e),u.extractRotation(this.matrixWorldInverse),o.applyMatrix4(u),o.getSize(a),o.getCenter(c);const t=Math.max(a.x/this.aspect,a.y);l.set(-c.x,-c.y,0),this.isPerspectiveCamera?l.z=a.z/(2*Math.tan(this.fov*i.default.DEG2RAD*.5)):(this.size=.5*t,l.z=2*a.z,this.far=Math.max(this.far,2*l.z)),u.extractRotation(this.matrixWorld),l.applyMatrix4(u),this.matrix.decompose(this.position,this.quaternion,this.scale),this.position.copy(l),this.updateMatrix()}updateProjectionMatrix(){const e=this.near,t=this.far,r=this.aspect,i=this.zoom,n=this.view;if(this.isOrthographicCamera){const s=this.size,o=s/(2*i),a=o*r;let c=-a,l=a,u=o,d=-o;if(n&&n.enabled){const e=i/(n.width/n.fullWidth),t=i/(n.height/n.fullHeight),o=s*r/n.width,a=s/n.height;l=(c+=o*(n.offsetX/e))+o*(n.width/e),d=(u-=a*(n.offsetY/t))-a*(n.height/t)}this.projectionMatrix.makeOrthographic(c,l,u,d,e,t)}else{let a=e*Math.tan(.5*s.Math.DEG2RAD*this.fov)/i,c=2*a,l=r*c,u=-.5*l;n&&n.enabled&&(u+=n.offsetX*l/n.fullWidth,a-=n.offsetY*c/n.fullHeight,l*=n.width/n.fullWidth,c*=n.height/n.fullHeight);var o=this.filmOffset;0!==o&&(u+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(u,u+l,a,a-c,e,t)}this.projectionMatrixInverse.getInverse(this.projectionMatrix)}copy(e,t){return super.copy(e,t),this.type=e.type,this.isOrthographicCamera=e.isOrthographicCamera,this.isPerspectiveCamera=e.isPerspectiveCamera,this.fov=e.fov,this.size=e.size,this.aspect=e.aspect,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.view=e.view?Object.assign({},e.view):null,this}clone(){return(new this.constructor).copy(this)}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.size=this.size,t.object.aspect=this.aspect,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(1),n=r(31),o=r(17),a={view:null,viewport:null,renderer:null,scene:null,camera:null},c={type:"before-render",component:null,context:a},l={type:"after-render",component:null,context:a},u={activate:i.types.Event("Scene.Activate")};class d extends o.default{constructor(e,t){super(e,t),this._activeCameraComponent=null,this._preRenderList=[],this._postRenderList=[],this._renderListsNeedUpdate=!0,this.ins=this.addInputs(u,0),this.addEvents("before-render","after-render","active-camera")}get scene(){return this.object3D}get activeCameraComponent(){return this._activeCameraComponent}set activeCameraComponent(e){if(e!==this._activeCameraComponent){const t=this._activeCameraComponent;this._activeCameraComponent=e;const r={type:"active-camera",previous:t,next:e};this.emit(r)}}get activeCamera(){return this._activeCameraComponent?this._activeCameraComponent.camera:null}get renderer(){return this.getMainComponent(n.default)}create(){super.create(),this.on("hierarchy",this.shouldUpdateRenderLists,this),this.on("child",this.shouldUpdateRenderLists,this);const e=this.renderer;e&&!e.activeSceneComponent&&(e.activeSceneComponent=this)}update(e){if(super.update(e),this.ins.activate.changed){const e=this.renderer;e&&(e.activeSceneComponent=this)}return!0}tick(e){return this._renderListsNeedUpdate&&(this.updateRenderLists(),this._renderListsNeedUpdate=!1),!1}dispose(){const e=this.renderer;e&&e.activeSceneComponent===this&&(e.activeSceneComponent=null),this.off("hierarchy",this.shouldUpdateRenderLists,this),this.off("child",this.shouldUpdateRenderLists,this),super.dispose()}preRender(e){const t=this._preRenderList;for(let r=0,s=t.length;r<s;++r)t[r].preRender(e)}postRender(e){const t=this._postRenderList;for(let r=0,s=t.length;r<s;++r)t[r].postRender(e)}createObject3D(){const e=new s.Scene;return e.onBeforeRender=this._onBeforeRender.bind(this),e.onAfterRender=this._onAfterRender.bind(this),e}shouldUpdateRenderLists(){this._renderListsNeedUpdate=!0}updateRenderLists(){this._preRenderList=[],this._postRenderList=[],this.traverseDown(!1,!0,!0,e=>(e.preRender&&this._preRenderList.push(e),e.postRender&&this._postRenderList.push(e),!1)),this.changed=!0}_onBeforeRender(e,t,r){a.view=e.__view,a.viewport=e.__viewport,a.renderer=e,a.scene=t,a.camera=r,this.preRender(a),c.component=this,this.emit(c)}_onAfterRender(e,t,r){a.view=e.__view,a.viewport=e.__viewport,a.renderer=e,a.scene=t,a.camera=r,this.postRender(a),l.component=this,this.emit(l)}}d.typeName="CScene",d.isGraphSingleton=!0,t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(8),i=r(45),n=r(74),o=r(181),a=r(75),c=r(76),l=r(77),u=r(27),d=r(12),h=r(22);class p extends s.default{get transform(){return this.components.get(i.default)}get meta(){return this.components.get(u.default,!0)}get model(){return this.components.get(d.default,!0)}get camera(){return this.components.get(n.default,!0)}get light(){return this.components.get(o.CLight,!0)}get scene(){return this.components.get(h.default,!0)}createComponents(){this.name="Node",this.createComponent(i.default)}createModel(){this.name="Model",this.createComponent(u.default),this.createComponent(d.default)}fromDocument(e,t,r){const s=e.nodes[t];this.transform.fromData(s);let i="Node";if(isFinite(s.meta)&&(this.createComponent(u.default).fromDocument(e,s),r.set(`meta/${s.meta}`,this.meta),i="Meta"),isFinite(s.model)&&(this.createComponent(d.default).fromDocument(e,s),r.set(`model/${s.model}`,this.model),i="Model"),isFinite(s.camera)&&(this.createComponent(n.default).fromDocument(e,s),r.set(`camera/${s.camera}`,this.camera),i="Camera"),isFinite(s.light)){const t=e.lights[s.light].type;switch(t){case"directional":this.createComponent(a.default).fromDocument(e,s),i="Directional Light";break;case"point":this.createComponent(c.default).fromDocument(e,s),i="Point Light";break;case"spot":this.createComponent(l.default).fromDocument(e,s),i="Spot Light";break;default:throw new Error(`unknown light type: '${t}'`)}r.set(`light/${s.light}`,this.light)}this.name=s.name||i;const o=s.children;o&&o.forEach(t=>{const s=this.graph.createCustomNode(p);this.transform.addChild(s.transform),s.fromDocument(e,t,r)})}toDocument(e,t,r){r=r||{meta:!0,setup:!0,model:!0,camera:!0,light:!0},e.nodes=e.nodes||[];const s=e.nodes.length,i=this.transform.toData();return e.nodes.push(i),this.name&&(i.name=this.name),this.model&&r.model&&(i.model=this.model.toDocument(e,i),t.set(this.model,`model/${i.model}`)),this.camera&&r.camera&&(i.camera=this.camera.toDocument(e,i),t.set(this.camera,`camera/${i.camera}`)),this.light&&r.light&&(i.light=this.light.toDocument(e,i),t.set(this.light,`light/${i.light}`)),this.meta&&r.meta&&(i.meta=this.meta.toDocument(e,i),t.set(this.meta,`info/${i.meta}`)),this.transform.children.map(e=>e.node).filter(e=>e.is(p)).forEach(s=>{if(s.hasNodeComponents(r)){const n=s.toDocument(e,t,r);i.children=i.children||[],i.children.push(n)}}),s}hasNodeComponents(e){if(!e)return!0;const t=this.transform,r=this.components;return!(!e.model||!r.has(d.default)&&!t.hasChildComponents(d.default,!0))||(!(!e.camera||!r.has(n.default)&&!t.hasChildComponents(n.default,!0))||!(!e.light||!r.has(o.CLight)&&!t.hasChildComponents(o.CLight,!0)))}}p.typeName="NVNode",t.default=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(185),i=r(186),n=r(1),o=r(78);class a extends n.default{constructor(){super(...arguments),this.collection=new i.default,this.process=new i.default,this.images=new i.default,this.articles=new s.default,this.leadArticle=null,this.notes=[]}fromDocument(e,t){if(!isFinite(t.meta))throw new Error("info property missing in node");const r=e.metas[t.meta];if(r.collection&&(this.collection.dictionary=r.collection),r.process&&(this.process.dictionary=r.process),r.images){const e={};r.images.forEach(t=>e[t.quality]=t),this.images.dictionary=e}return r.articles&&(this.articles.items=r.articles.map(e=>o.default.fromJSON(e)),void 0!==r.leadArticle&&(this.leadArticle=this.articles.getAt(r.leadArticle))),t.meta}toDocument(e,t){let r=null;if(this.collection.length>0&&(r={collection:this.collection.dictionary}),this.process.length>0&&((r=r||{}).process=this.process.dictionary),this.images.length>0&&((r=r||{}).images=this.images.items),this.articles.length>0){r=r||{};const e=this.articles.items;r.articles=e.map(e=>e.toJSON()),this.leadArticle&&(r.leadArticle=e.indexOf(this.leadArticle))}if(r){e.metas=e.metas||[];const t=e.metas.length;return e.metas.push(r),t}}}a.typeName="CVMeta",t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(6),i=[];t.default=class extends s.default{constructor(e){super({knownEvents:!1});const t=e.typeName;if(!t)throw new Error("root type must have a 'typeName' member");this._rootTypeName=t,this._objLists={[this._rootTypeName]:[]},this._objDict={}}static getTypeName(e){return"function"==typeof e?e.typeName:"object"==typeof e?e.constructor.typeName:e}add(e){const t=e.id;if("string"==typeof t){if(void 0!==this._objDict[t])throw new Error("object already registered");this._objDict[t]=e}let r,s=e;const i=this._rootTypeName,n={type:"",add:!0,remove:!1,object:e};do{(r=(s=Object.getPrototypeOf(s)).constructor.typeName)&&((this._objLists[r]||(this._objLists[r]=[])).push(e),n.type=r,this.emit(n))}while(r!==i)}remove(e){const t=e.id;if("string"==typeof t){if(this._objDict[t]!==e)throw new Error("object not registered");delete this._objDict[t]}let r,s=e;const i=this._rootTypeName,n={type:"",add:!1,remove:!0,object:e};do{if(r=(s=Object.getPrototypeOf(s)).constructor.typeName){n.type=r,this.emit(n);const t=this._objLists[r];t.splice(t.indexOf(e),1)}}while(r!==i)}clear(){this.cloneArray().forEach(e=>this.remove(e))}get length(){return this._objLists[this._rootTypeName].length}count(e){const t=this._objLists[this.getTypeName(e)];return t?t.length:0}has(e){if("function"==typeof e){const t=this._objLists[e.typeName];return!!t&&t.length>0}if("string"==typeof e){const t=this._objLists[e];return!!t&&t.length>0}const t=this._objLists[e.constructor.typeName];return t&&t.indexOf(e)>=0}contains(e){const t=e.id;if("string"==typeof t)return!!this._objDict[t];const r=this._objLists[e.constructor.typeName];return r&&r.indexOf(e)>=0}get(e,t=!1){const r=this.getTypeName(e),s=this._objLists[r],i=s?s[0]:void 0;if(!t&&!i)throw new Error(`no instances of class '${r}' in object registry`);return i}getArray(e){return this._objLists[this.getTypeName(e)]||i}cloneArray(e){return this.getArray(e).slice()}getById(e){return this._objDict[e]}getDictionary(){return this._objDict}on(e,t,r){super.on(this.getTypeName(e),t,r)}once(e,t,r){super.once(this.getTypeName(e),t,r)}off(e,t,r){super.off(this.getTypeName(e),t,r)}getTypeName(e){return"function"==typeof e?e.typeName:"object"==typeof e?e.constructor.typeName:e||this._rootTypeName}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Default=0]="Default",e[e.Clay=1]="Clay",e[e.XRay=2]="XRay",e[e.Normals=3]="Normals",e[e.Wireframe=4]="Wireframe"}(t.EShaderMode||(t.EShaderMode={})),function(e){e[e.Solid=0]="Solid",e[e.LinearGradient=1]="LinearGradient",e[e.RadialGradient=2]="RadialGradient"}(t.EBackgroundStyle||(t.EBackgroundStyle={})),function(e){e[e.Orbit=0]="Orbit",e[e.Walk=1]="Walk"}(t.ENavigationType||(t.ENavigationType={})),function(e){e[e.Overlay=0]="Overlay",e[e.Left=1]="Left",e[e.Right=2]="Right"}(t.EReaderPosition||(t.EReaderPosition={})),function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(t.ESliceAxis||(t.ESliceAxis={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1);t.types=s.types;const i=r(56),n=r(8);t.Node=n.default;class o extends s.default{constructor(e,t){super(e,t),this.ins=this.addInputs(o.graphIns),this._innerGraph=null,this._innerRoot=null,this._innerGraph=new i.default(this.system,this)}get innerGraph(){return this._innerGraph}get innerNodes(){return this._innerGraph.nodes}get innerComponents(){return this._innerGraph.components}get innerRoots(){return this._innerGraph.roots}getInnerComponent(e,t=!1){return this._innerGraph.components.get(e,t)}getInnerComponents(e){return this._innerGraph.components.getArray(e)}hasInnerComponent(e){return this._innerGraph.components.has(e)}getInnerNode(e,t=!1){return this._innerGraph.nodes.get(e,t)}getInnerNodes(e){return this._innerGraph.nodes.getArray(e)}hasInnerNode(e){return this._innerGraph.nodes.has(e)}isEmpty(){return 0===this._innerGraph.nodes.count()}update(e){const t=this.ins;if(t.active.changed){const e=t.active.value;e!==this._innerGraph.isActive&&(e?this.activateInnerGraph():this.deactivateInnerGraph())}return!0}tick(e){return this._innerGraph.tick(e)}tock(e){return this._innerGraph.tock(e)}dispose(){this._innerGraph.clear(),this._innerGraph=null,this._innerRoot=null,super.dispose()}clearInnerGraph(){this._innerGraph.clear()}fromJSON(e){super.fromJSON(e),this._innerGraph.clear(),this._innerGraph.fromJSON(e.graph)}toJSON(){const e=super.toJSON();return e.graph=this._innerGraph.toJSON(),e}dump(e=""){super.dump(e),this.innerGraph.dump(e+"  ")}onAddInnerRoot(e){}onRemoveInnerRoot(e){}activateInnerGraph(){this._innerGraph.activate()}deactivateInnerGraph(){this._innerGraph.deactivate()}}o.typeName="CGraph",o.graphIns={active:s.types.Boolean("Graph.Active",!0)},t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1),i=r(38),n={shadowsEnabled:s.types.Boolean("Shadows.Enabled",!0)},o={maxTextureSize:s.types.Integer("Caps.MaxTextureSize"),maxCubemapSize:s.types.Integer("Caps.MaxCubemapSize")};class a extends s.default{constructor(e,t){super(e,t),this.ins=this.addInputs(n),this.outs=this.addOutputs(o),this.views=[],this._activeSceneComponent=null,this._forceRender=!1,this.addEvents("active-scene","active-camera")}get activeSceneComponent(){return this._activeSceneComponent}set activeSceneComponent(e){if(e!==this._activeSceneComponent){const t=this._activeSceneComponent,r=this.activeCameraComponent;t&&t.off("active-camera",this.onActiveCamera,this),e&&e.on("active-camera",this.onActiveCamera,this),this._activeSceneComponent=e;const s=this.activeCameraComponent,i={type:"active-scene",previous:t,next:e};this.emit(i);const n={type:"active-camera",previous:r,next:s};this.emit(n)}}get activeSceneGraph(){return this._activeSceneComponent?this._activeSceneComponent.graph:null}get activeScene(){return this._activeSceneComponent?this._activeSceneComponent.scene:null}get activeCameraComponent(){return this._activeSceneComponent?this._activeSceneComponent.activeCameraComponent:null}get activeCamera(){const e=this._activeSceneComponent?this._activeSceneComponent.activeCameraComponent:null;return e?e.camera:null}forceRender(){this._forceRender=!0}create(){super.create(),this.trackComponent(i.default,e=>{e.on("pulse",this.onPulse,this)},e=>{e.off("pulse",this.onPulse,this)})}update(){const e=this.ins;return e.shadowsEnabled.changed&&this.views.forEach(t=>t.renderer.shadowMap.enabled=e.shadowsEnabled.value),!0}attachView(e){if(!this.views.length){const t=e.renderer;this.outs.maxTextureSize.setValue(t.capabilities.maxTextureSize),this.outs.maxCubemapSize.setValue(t.capabilities.maxCubemapSize)}this.views.push(e)}detachView(e){const t=this.views.indexOf(e);if(t<0)throw new Error("render view not registered");this.views.splice(t,1)}onPulse(e){(e.systemUpdated||this._forceRender)&&(this.views.forEach(e=>{e.render()}),this._forceRender=!1)}onActiveCamera(e){this.emit(e)}}a.typeName="CRenderer",a.isSystemSingleton=!0,t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(6),i=r(23);t.default=class extends s.default{constructor(e){super(),this.addEvents("update","dispose"),e?this.fromJSON(e):this._data=this.init()}get id(){return this._data.id}get data(){return this._data}set(e,t){this._data[e]=t,this.update()}get(e){return this._data[e]}update(){this.emit({type:"update",document:this})}dispose(){this.emit({type:"dispose",document:this}),this._data=null}fromJSON(e){return this._data={},this.inflate(e,this._data),this.update(),this}toJSON(e){return e=e||{},this.deflate(this._data,e),e}init(){return{}}inflate(e,t){Object.assign(t,e)}deflate(e,t){t=t||{},Object.assign(t,this._data)}generateId(){return i.default()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.mm=0]="mm",e[e.cm=1]="cm",e[e.m=2]="m",e[e.km=3]="km",e[e.in=4]="in",e[e.ft=5]="ft",e[e.yd=6]="yd",e[e.mi=7]="mi"}(t.EUnitType||(t.EUnitType={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1),i=r(17),n=r(84),o=r(85),a=r(48),c=r(86),l=r(87),u=r(88),d=r(89),h=r(90),p=r(91),m=r(92),f=r(93);class v extends s.default{get featureMap(){return this.constructor.featureMap}get transform(){return this.getComponent(i.default)}create(){super.create();const e=this.node,t=v.featureMap;for(const r in t)this[r]=e.createComponent(t[r]);this.snapshots=e.createComponent(f.default)}fromDocument(e,t,r){const s=e.scenes[t];if(!isFinite(s.setup))throw new Error("setup property missing in node");const i=e.setups[s.setup],n=v.featureMap;for(const e in n){r.set(`scenes/${t}/setup/${e}`,this[e]);const s=i[e];s&&this[e].fromData(s)}i.snapshots&&this.snapshots.fromData(i.snapshots,r)}toDocument(e,t,r){let s=null;const i=v.featureMap;for(const e in i){r.set(this[e],`scenes/${t}/setup/${e}`);const i=this[e].toData();i&&((s=s||{})[e]=i)}const n=this.snapshots.toData(r);if(n&&((s=s||{}).snapshots=n),s){e.setups=e.setups||[];const r=e.setups.length;e.setups.push(s),e.scenes[t].setup=r}}}v.typeName="CVSetup",v.featureMap={interface:n.default,reader:a.default,viewer:o.default,navigation:c.default,background:l.default,floor:u.default,grid:d.default,tape:h.default,slicer:p.default,tours:m.default},t.default=v},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1),i=r(61),n=r(65);class o extends i.default{constructor(e,t){super(e,t),this.outs=this.addOutputs(o.outs),this.scope=i.EComponentScope.Node}createDocument(e,t){const r=this.node.createComponent(n.default);return this.activeComponent=r,e&&r.openDocument(e,t),r}amendDocument(e,t,r){const s=this.activeComponent;if(!s)throw new Error("no active document, can't amend");return s.openDocument(e,t,r),s}appendModel(e,t){const r=this.activeComponent;if(!r)throw new Error("no active document, can't append model");return r.appendModel(e,t),r}appendGeometry(e,t,r,s,i){const n=this.activeComponent;if(!n)throw new Error("no active document, can't append geometry");return n.appendGeometry(e,t,r,s,i),n}removeActiveDocument(){const e=this.activeComponent;e&&e.dispose()}activateComponent(e){e.ins.visible.setValue(!0),e.ins.active.setValue(!0)}deactivateComponent(e){e.ins.visible.setValue(!1),e.ins.active.setValue(!1)}onActiveComponent(e,t){this.outs.activeDocument.setValue(t)}onScopedComponents(){this.outs.changedDocuments.set()}}o.typeName="CVDocumentProvider",o.componentType=n.default,o.outs={activeDocument:s.types.Object("Documents.Active",n.default),changedDocuments:s.types.Event("Documents.Changed")},t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(103);t.labels={xyzw:["X","Y","Z","W"],rgba:["R","G","B","A"]};const i=function(e){return void 0===e||"object"==typeof e&&!Array.isArray(e)?e:{preset:e}};t.makeType=function(e,t,r){return{path:t,schema:(r=i(r))?Object.assign({},e,r):e}},t.makeEnumType=function(e,t,r){r=i(r);const n={enum:e,options:s.enumToArray(e),preset:0};return{path:t,schema:r?Object.assign({},n,r):n}},t.makeOptionType=function(e,t,r){const s={options:e,preset:0};return{path:t,schema:(r=i(r))?Object.assign({},s,r):s}},t.makeObjectType=function(e,t,r){const s={preset:null,objectType:e};return{path:t,schema:(r=i(r))?Object.assign({},s,r):s}},t.schemas={Number:{preset:0},Integer:{preset:0,step:1,speed:.34,precision:0},Natural:{preset:0,step:1,speed:.34,precision:0,min:0},Unit:{preset:0,min:0,max:1,bar:!0},Percent:{preset:0,min:0,max:1,bar:!0,percent:!0},Vector2:{preset:[0,0]},Vector3:{preset:[0,0,0]},Vector4:{preset:[0,0,0,0]},Matrix2:{preset:[1,0,0,1]},Matrix3:{preset:[1,0,0,0,1,0,0,0,1]},Matrix4:{preset:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},Scale:{preset:1},Scale2:{preset:[1,1]},Scale3:{preset:[1,1,1]},IntVec2:{preset:[0,0],step:1,speed:.34,precision:0},IntVec3:{preset:[0,0,0],step:1,speed:.34,precision:0},ColorRGB:{preset:[1,1,1],semantic:"color",labels:t.labels.rgba,min:0,max:1,bar:!0},ColorRGBA:{preset:[1,1,1,1],semantic:"color",labels:t.labels.rgba,min:0,max:1,bar:!0},Boolean:{preset:!1},String:{preset:""},AssetPath:{preset:"",semantic:"asset-path"},Object:{preset:null,objectType:Object},Event:{preset:0,event:!0}},t.types={Property:(e,r)=>t.makeType(void 0,e,r),Number:(e,r)=>t.makeType(t.schemas.Number,e,r),Integer:(e,r)=>t.makeType(t.schemas.Integer,e,r),Natural:(e,r)=>t.makeType(t.schemas.Natural,e,r),Unit:(e,r)=>t.makeType(t.schemas.Unit,e,r),Percent:(e,r)=>t.makeType(t.schemas.Percent,e,r),Vector2:(e,r)=>t.makeType(t.schemas.Vector2,e,r),Vector3:(e,r)=>t.makeType(t.schemas.Vector3,e,r),Vector4:(e,r)=>t.makeType(t.schemas.Vector4,e,r),IntVec2:(e,r)=>t.makeType(t.schemas.IntVec2,e,r),IntVec3:(e,r)=>t.makeType(t.schemas.IntVec3,e,r),Matrix2:(e,r)=>t.makeType(t.schemas.Matrix2,e,r),Matrix3:(e,r)=>t.makeType(t.schemas.Matrix3,e,r),Matrix4:(e,r)=>t.makeType(t.schemas.Matrix4,e,r),Scale:(e,r)=>t.makeType(t.schemas.Scale,e,r),Scale2:(e,r)=>t.makeType(t.schemas.Scale2,e,r),Scale3:(e,r)=>t.makeType(t.schemas.Scale3,e,r),ColorRGB:(e,r)=>t.makeType(t.schemas.ColorRGB,e,r),ColorRGBA:(e,r)=>t.makeType(t.schemas.ColorRGBA,e,r),Boolean:(e,r)=>t.makeType(t.schemas.Boolean,e,r),String:(e,r)=>t.makeType(t.schemas.String,e,r),AssetPath:(e,r)=>t.makeType(t.schemas.AssetPath,e,r),Enum:(e,r,s)=>t.makeEnumType(r,e,s),Option:(e,r,s)=>t.makeOptionType(r,e,s),Object:(e,r,s)=>t.makeObjectType(r,e,s),Event:(e,r)=>t.makeType(t.schemas.Event,e,r)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(111),n=r(112),o=r(29);t.EShaderMode=o.EShaderMode;t.default=class extends s.MeshStandardMaterial{constructor(e){super(),this._clayColor=new s.Color("#a67a6c"),this._paramCopy={},this._sideCopy=s.FrontSide,this.type="UberPBRMaterial",this.isUberPBRMaterial=!0,this.isMeshStandardMaterial=!0,this.isMeshPhysicalMaterial=!1,this.defines={STANDARD:!0,PHYSICAL:!1,OBJECTSPACE_NORMALMAP:!1,MODE_NORMALS:!1,MODE_XRAY:!1,CUT_PLANE:!1},this.uniforms=s.UniformsUtils.merge([s.ShaderLib.standard.uniforms,{aoMapMix:{value:new s.Vector3(.25,.25,.25)},cutPlaneDirection:{value:new s.Vector4(0,0,-1,0)},cutPlaneColor:{value:new s.Vector3(1,0,0)}}]),this._aoMapMix=this.uniforms.aoMapMix.value,this._cutPlaneDirection=this.uniforms.cutPlaneDirection.value,this._cutPlaneColor=this.uniforms.cutPlaneColor.value,this.vertexShader=n,this.fragmentShader=i,this.color=new s.Color(16777215),this.roughness=.7,this.metalness=0,e&&this.setValues(e)}set cutPlaneDirection(e){this._cutPlaneDirection.copy(e)}get cutPlaneDirection(){return this._cutPlaneDirection}set cutPlaneColor(e){this._cutPlaneColor.copy(e)}get cutPlaneColor(){return this._cutPlaneColor}set aoMapMix(e){this._aoMapMix.copy(e)}get aoMapMix(){return this._aoMapMix}setShaderMode(e){switch(Object.assign(this,this._paramCopy),this.defines.MODE_NORMALS=!1,this.defines.MODE_XRAY=!1,this.needsUpdate=!0,e){case o.EShaderMode.Clay:this._paramCopy={color:this.color,map:this.map,roughness:this.roughness,metalness:this.metalness,aoMapIntensity:this.aoMapIntensity,blending:this.blending,transparent:this.transparent,depthWrite:this.depthWrite},this.color=this._clayColor,this.map=null,this.roughness=1,this.metalness=0,this.aoMapIntensity*=1,this.blending=s.NoBlending,this.transparent=!1,this.depthWrite=!0;break;case o.EShaderMode.Normals:this._paramCopy={blending:this.blending,transparent:this.transparent,depthWrite:this.depthWrite},this.defines.MODE_NORMALS=!0,this.blending=s.NoBlending,this.transparent=!1,this.depthWrite=!0;break;case o.EShaderMode.XRay:this._paramCopy={side:this.side,blending:this.blending,transparent:this.transparent,depthWrite:this.depthWrite},this.defines.MODE_XRAY=!0,this.side=s.DoubleSide,this.blending=s.AdditiveBlending,this.transparent=!0,this.depthWrite=!1;break;case o.EShaderMode.Wireframe:this._paramCopy={wireframe:this.wireframe},this.wireframe=!0}}enableCutPlane(e){this.defines.CUT_PLANE=e,e?(this._sideCopy=this.side,this.side=s.DoubleSide):this.side=this._sideCopy}enableObjectSpaceNormalMap(e){this.defines.OBJECTSPACE_NORMALMAP!==e&&(this.needsUpdate=!0),this.defines.OBJECTSPACE_NORMALMAP=e}copyStandardMaterial(e){return this.color=e.color,this.roughness=e.roughness,this.roughnessMap=e.roughnessMap,this.metalness=e.metalness,this.metalnessMap=e.metalnessMap,this.map=e.map,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.normalMap=e.normalMap,this}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1);class i extends s.default{constructor(e,t){super(e,t),this.outs=this.addOutputs(i.pulseOuts),this.addEvent("pulse"),this.onAnimationFrame=this.onAnimationFrame.bind(this),this.context={time:new Date,secondsElapsed:0,secondsDelta:0,frameNumber:0},this._secondsStarted=.001*Date.now(),this._secondsStopped=this._secondsStarted,this._animHandler=0,this._pulseEvent={type:"pulse",context:this.context,systemUpdated:!1}}start(){0===this._animHandler&&(this._secondsStopped>0&&(this._secondsStarted+=.001*Date.now()-this._secondsStopped,this._secondsStopped=0),this._animHandler=window.requestAnimationFrame(this.onAnimationFrame))}stop(){0!==this._animHandler&&(0===this._secondsStopped&&(this._secondsStopped=.001*Date.now()),window.cancelAnimationFrame(this._animHandler),this._animHandler=0)}pulse(e){const t=this.context,r=this.outs;t.time.setTime(e);const s=.001*e-this._secondsStarted;t.secondsDelta=s-t.secondsElapsed,t.secondsElapsed=s,t.frameNumber++,r.time.setValue(t.secondsElapsed),r.frame.setValue(t.frameNumber),this._pulseEvent.systemUpdated=this.system.graph.tick(this.context),this.emit(this._pulseEvent),this.system.graph.tock(this.context)}onAnimationFrame(){this.pulse(Date.now()),this._animHandler=window.requestAnimationFrame(this.onAnimationFrame)}}i.typeName="CPulse",i.isSystemSingleton=!0,i.pulseOuts={time:s.types.Number("Pulse.Time"),frame:s.types.Integer("Pulse.Frame")},t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(28),i=r(36),n=r(1),o=r(8),a=r(30),c=r(133);class l extends c.default{constructor(e,t){super(e,t),this.outs=this.addOutputs(l.selOuts),this.multiSelect=!1,this.exclusiveSelect=!0,this.selectedNodes=new s.default(o.default),this.selectedComponents=new s.default(n.default),this._activeGraph=null,this.addEvents("select-node","select-component","active-graph","update"),this.selectedNodes.on(o.default,e=>this.onSelectNode(e.object,e.add)),this.selectedComponents.on(n.default,e=>this.onSelectComponent(e.object,e.add)),this._activeGraph=this.system.graph}getSelectedNode(e){return this.selectedNodes.get(e,!0)}getSelectedNodes(e){return this.selectedNodes.getArray(e)}getSelectedComponent(e){return this.selectedComponents.get(e,!0)}getSelectedComponents(e){return this.selectedComponents.getArray(e)}get activeGraph(){return this._activeGraph}set activeGraph(e){if(e!==this.activeGraph){this.clearSelection();const t=this._activeGraph;this._activeGraph=e,this.onActiveGraph(e),this.emit({type:"active-graph",previous:t,next:e})}}hasParentGraph(){return this._activeGraph&&this._activeGraph.parent}activateParentGraph(){this._activeGraph&&this._activeGraph.parent.graph&&(this.activeGraph=this._activeGraph.parent.graph)}hasChildGraph(){return this.selectedComponents.has(a.default)}activateChildGraph(){const e=this.selectedComponents.get(a.default,!0);e&&(this.activeGraph=e.innerGraph)}create(){super.create(),this.system.nodes.on(o.default,this.onSystemNode,this),this.system.components.on(n.default,this.onSystemComponent,this)}dispose(){this.system.nodes.off(o.default,this.onSystemNode,this),this.system.components.off(n.default,this.onSystemComponent,this),super.dispose()}createActions(e){return{selectNode:e.register({name:"Select Node",do:this.selectNode,target:this}),selectComponent:e.register({name:"Select Component",do:this.selectComponent,target:this}),clearSelection:e.register({name:"Clear Selection",do:this.clearSelection,target:this})}}nodeContainsSelectedComponent(e){const t=e.components.getArray();for(let e=0,r=t.length;e<r;++e)if(this.selectedComponents.contains(t[e]))return!0;return!1}selectNode(e,t=!1){this.activeGraph=e.graph;const r=this.selectedNodes,s=this.multiSelect&&t;e&&r.contains(e)?s&&r.remove(e):(this.exclusiveSelect&&this.selectedComponents.clear(),s||r.clear(),e&&r.add(e)),this.updateStats()}selectComponent(e,t=!1){this.activeGraph=e.graph;const r=this.selectedComponents,s=this.multiSelect&&t;e&&r.contains(e)?s&&r.remove(e):(this.exclusiveSelect&&this.selectedNodes.clear(),s||r.clear(),e&&r.add(e)),this.updateStats()}clearSelection(){this.selectedNodes.clear(),this.selectedComponents.clear(),this.updateStats()}onSelectNode(e,t){}onSelectComponent(e,t){}onActiveGraph(e){}onSystemNode(e){e.remove&&this.selectedNodes.contains(e.object)&&(this.selectedNodes.remove(e.object),this.updateStats())}onSystemComponent(e){e.remove&&this.selectedComponents.contains(e.object)&&(this.selectedComponents.remove(e.object),this.updateStats())}updateStats(){const e=this.outs;e.selNodeCount.setValue(this.selectedNodes.length),e.selComponentCount.setValue(this.selectedComponents.length)}}l.typeName="CSelection",l.selOuts={selNodeCount:i.types.Integer("Selection.Nodes"),selComponentCount:i.types.Integer("Selection.Components")},t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(137);t.EEasingCurve=s.EEasingCurve;const i=r(1),n=r(23);class o extends i.default{constructor(){super(...arguments),this.ins=this.addInputs(o.ins),this.outs=this.addOutputs(o.outs),this.targets=[],this.states={},this._currentValues=null,this._targetState=null,this._startTime=0,this._easingFunction=null}getState(e){return this.states[e]}setState(e){return e.id=e.id||n.default(6),this.states[e.id]=e,e.id}deleteState(e){delete this.states[e]}clear(){this.targets.forEach(e=>e.property.off("dispose",this.onPropertyDispose,this)),this.targets.length=0,this.states={},this._currentValues=null,this._targetState=null,this._startTime=0,this._easingFunction=null}dispose(){this.clear(),super.dispose()}update(e){const t=this.ins,r=this.outs,i=this.states,n=t.id.value,o=i[n];if(o){if((t.tween.changed||t.recall.changed)&&(t.curve.setValue(o.curve),t.duration.setValue(o.duration),t.threshold.setValue(o.threshold)),t.tween.changed)return this._targetState=o,this._currentValues=this.getCurrentValues(),this._startTime=e.secondsElapsed,this._easingFunction=s.getEasingFunction(o.curve),r.switched.setValue(!1),r.tweening.setValue(!0),r.start.set(),!0;if(t.recall.changed)return this.setValues(o.values),!0;(t.curve.changed||t.duration.changed||t.threshold.changed)&&(o.curve=t.curve.value,o.duration=t.duration.value,o.threshold=t.threshold.value),t.store.changed&&(o.values=this.getCurrentValues()),t.delete.changed&&delete i[n]}else if(n&&t.store.changed){const e={id:this.ins.id.value,curve:this.ins.curve.getValidatedValue(),duration:this.ins.duration.value,threshold:this.ins.threshold.value,values:this.getCurrentValues()};i[e.id]=e}return!0}tick(e){const t=this._targetState;if(!t)return!1;const r=this.outs,s=this._currentValues,i=this._startTime,n=e.secondsElapsed-i,o=n/t.duration;if(o<1){const e=this._easingFunction(o),i=o>=t.threshold&&!r.switched.value;this.setValues(s,t.values,e,i),r.time.setValue(n),r.completed.setValue(o),i&&(r.switched.setValue(!0),r.switch.set())}else this.setValues(s,t.values,1,!r.switched.value),r.tweening.setValue(!1),r.time.setValue(t.duration),r.completed.setValue(1),r.end.set(),r.switched.value||r.switched.setValue(!0),this._currentValues=null,this._targetState=null,this._startTime=0,this._easingFunction=null;return!0}addTargetProperty(e){if("object"===e.type||e.schema.event)throw new Error("can't add object or event properties");if(this.getTarget(e))throw new Error("can't add, target already exists");e.on("dispose",this.onPropertyDispose,this);const t="number"===e.type,r=e.isArray();this.targets.push({property:e,isNumber:t,isArray:r});const s=this.states,i=Object.keys(s);for(let t=0,r=i.length;t<r;++t)s[i[t]].values.push(e.cloneValue());this._currentValues&&this._currentValues.push(e.cloneValue()),console.log("CTweenMachine.addTargetProperty - component: %s, property: %s",e.group.linkable.displayName,e.path)}removeTargetProperty(e){const t=this.getTarget(e);if(!t)throw new Error("can't remove, target doesn't exist");this.removeTarget(t),console.log("CTweenMachine.removeTargetProperty - component: %s, property: %s",e.group.linkable.displayName,e.path)}hasTargetProperty(e){return!!this.getTarget(e)}fromJSON(e){super.fromJSON(e),e.state&&this.stateFromJSON(e.state)}stateFromJSON(e){e.targets&&(this.targets=e.targets.map(e=>{const t=this.getProperty(e.id,e.key);return{property:t,isNumber:!!t&&"number"===t.type,isArray:!!t&&t.isArray()}})),e.states&&e.states.forEach(e=>this.states[e.id]=e),this._startTime=0}toJSON(){const e=super.toJSON(),t=this.stateToJSON();return t&&(e.state=t),e}stateToJSON(){const e={},t=this.targets;t.length>0&&(e.targets=t.map(e=>({id:e.property.group.linkable.id,key:e.property.key})));const r=Object.keys(this.states);return r.length>0&&(e.states=r.map(e=>this.states[e])),e}getTargetProperties(){return this.targets.map(e=>e.property)}onPropertyDispose(e){e.property.off("dispose",this.onPropertyDispose,this);const t=this.getTarget(e.property);this.removeTarget(t)}removeTarget(e){const t=this.targets.indexOf(e);this.targets.splice(t,1),this.removeChannel(t)}removeChannel(e){const t=this.states,r=Object.keys(t);for(let s=0,i=r.length;s<i;++s)t[r[s]].values.splice(e,1);this._currentValues&&this._currentValues.splice(e,1)}getTarget(e){return this.targets.find(t=>t.property===e)}getProperty(e,t){const r=this.system.components.getById(e);return r?r.ins[t]:null}setValues(e,t,r,s){const i=this.targets;for(let n=0,o=i.length;n<o;++n){const o=i[n],a=o.property;if(o.isNumber&&t){const s=e[n],i=t[n];if(o.isArray){let e=!1;for(let t=0,n=s.length;t<n;++t){const n=s[t]+r*(i[t]-s[t]);e=a.value[t]!==n||e,a.value[t]=n}e&&a.set()}else{const e=s+r*(i-s);e!==a.value&&a.setValue(e)}}else if(!t||s){const r=t?t[n]:e[n];if(o.isArray){let e=!1;for(let t=0,s=r.length;t<s;++t)e=a.value[t]!==r[t]||e,a.value[t]=r[t];e&&a.set()}else r!==a.value&&a.setValue(r)}}}getCurrentValues(){const e=[],t=this.targets;for(let r=0,s=t.length;r<s;++r)e.push(t[r].property.cloneValue());return e}}o.typeName="CTweenMachine",o.ins={id:i.types.String("Snapshot.Id"),curve:i.types.Enum("Tween.Curve",s.EEasingCurve),duration:i.types.Number("Tween.Duration",2),threshold:i.types.Percent("Tween.Threshold",.5),tween:i.types.Event("Control.Tween"),recall:i.types.Event("Control.Recall"),store:i.types.Event("Control.Store"),delete:i.types.Event("Control.Delete"),clear:i.types.Event("Control.Clear")},o.outs={count:i.types.Integer("Snapshots.Count"),tweening:i.types.Boolean("Tween.IsTweening"),time:i.types.Number("Tween.Time"),completed:i.types.Percent("Tween.Completed"),switched:i.types.Boolean("Tween.Switched"),start:i.types.Event("Tween.Start"),switch:i.types.Event("Tween.Switch"),end:i.types.Event("Tween.End")},t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=new s.Vector3,n=new s.Matrix4,o=new s.Euler;new s.Quaternion;t.degreesToQuaternion=function(e,t,r){const n=r||new s.Quaternion;return i.fromArray(e).multiplyScalar(s.Math.DEG2RAD),o.setFromVector3(i,t),n.setFromEuler(o,!1),n},t.quaternionToDegrees=function(e,t,r){const n=r||[0,0,0];return o.setFromQuaternion(e,t,!1),o.toVector3(i),i.multiplyScalar(s.Math.RAD2DEG).toArray(n),n},t.disposeObject=function(e){const t=new Map,r=new Map,s=new Map;e.traverse(e=>{const i=e;if(i.isMesh){const e=i.geometry;e&&t.set(e.uuid,e);const n=i.material;if(n){r.set(n.uuid,n);for(let e in n){const t=n[e];t&&t.isTexture&&s.set(t.uuid,t)}}}});for(let e of s)e[1].dispose();for(let e of r)e[1].dispose();for(let e of t)e[1].dispose()},t.computeLocalBoundingBox=function e(t,r,s){s||(s=t);const o=t.geometry;if(o&&t.visible){let e=t;for(n.identity();e&&e!==s;)n.premultiply(e.matrix),e=e.parent;if(o.isGeometry){const e=o.vertices;for(let t=0,s=e.length;t<s;++t)i.copy(e[t]).applyMatrix4(n),r.expandByPoint(i)}else if(o.isBufferGeometry){const e=o.attributes.position;if(void 0!==e)for(let t=0,s=e.count;t<s;++t)i.fromBufferAttribute(e,t).applyMatrix4(n),r.expandByPoint(i)}}const a=t.children;for(let t=0,i=a.length;t<i;++t)e(a[t],r,s)}},function(e,t,r){"use strict";var s=r(144),i=r(43),n=r(20),o=r(66),a=r(146);function c(e,t,r){var s=this._refs[r];if("string"==typeof s){if(!this._refs[s])return c.call(this,e,t,s);s=this._refs[s]}if((s=s||this._schemas[r])instanceof o)return p(s.schema,this._opts.inlineRefs)?s.schema:s.validate||this._compile(s);var i,n,a,u=l.call(this,t,r);return u&&(i=u.schema,t=u.root,a=u.baseId),i instanceof o?n=i.validate||e.call(this,i.schema,t,void 0,a):void 0!==i&&(n=p(i,this._opts.inlineRefs)?i:e.call(this,i,t,void 0,a)),n}function l(e,t){var r=s.parse(t),i=f(r),n=m(this._getId(e.schema));if(0===Object.keys(e.schema).length||i!==n){var a=g(i),c=this._refs[a];if("string"==typeof c)return function(e,t,r){var s=l.call(this,e,t);if(s){var i=s.schema,n=s.baseId;e=s.root;var o=this._getId(i);return o&&(n=y(n,o)),d.call(this,r,n,i,e)}}.call(this,e,c,r);if(c instanceof o)c.validate||this._compile(c),e=c;else{if(!((c=this._schemas[a])instanceof o))return;if(c.validate||this._compile(c),a==g(t))return{schema:c,root:e,baseId:n};e=c}if(!e.schema)return;n=m(this._getId(e.schema))}return d.call(this,r,n,e.schema,e)}e.exports=c,c.normalizeId=g,c.fullPath=m,c.url=y,c.ids=function(e){var t=g(this._getId(e)),r={"":t},o={"":m(t,!1)},c={},l=this;return a(e,{allKeys:!0},function(e,t,a,u,d,h,p){if(""!==t){var m=l._getId(e),f=r[u],v=o[u]+"/"+d;if(void 0!==p&&(v+="/"+("number"==typeof p?p:n.escapeFragment(p))),"string"==typeof m){m=f=g(f?s.resolve(f,m):m);var y=l._refs[m];if("string"==typeof y&&(y=l._refs[y]),y&&y.schema){if(!i(e,y.schema))throw new Error('id "'+m+'" resolves to more than one schema')}else if(m!=g(v))if("#"==m[0]){if(c[m]&&!i(e,c[m]))throw new Error('id "'+m+'" resolves to more than one schema');c[m]=e}else l._refs[m]=v}r[t]=f,o[t]=v}}),c},c.inlineRef=p,c.schema=l;var u=n.toHash(["properties","patternProperties","enum","dependencies","definitions"]);function d(e,t,r,s){if(e.fragment=e.fragment||"","/"==e.fragment.slice(0,1)){for(var i=e.fragment.split("/"),o=1;o<i.length;o++){var a=i[o];if(a){if(void 0===(r=r[a=n.unescapeFragment(a)]))break;var c;if(!u[a]&&((c=this._getId(r))&&(t=y(t,c)),r.$ref)){var d=y(t,r.$ref),h=l.call(this,s,d);h&&(r=h.schema,s=h.root,t=h.baseId)}}}return void 0!==r&&r!==s.schema?{schema:r,root:s,baseId:t}:void 0}}var h=n.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]);function p(e,t){return!1!==t&&(void 0===t||!0===t?function e(t){var r;if(Array.isArray(t)){for(var s=0;s<t.length;s++)if("object"==typeof(r=t[s])&&!e(r))return!1}else for(var i in t){if("$ref"==i)return!1;if("object"==typeof(r=t[i])&&!e(r))return!1}return!0}(e):t?function e(t){var r,s=0;if(Array.isArray(t)){for(var i=0;i<t.length;i++)if("object"==typeof(r=t[i])&&(s+=e(r)),s==1/0)return 1/0}else for(var n in t){if("$ref"==n)return 1/0;if(h[n])s++;else if("object"==typeof(r=t[n])&&(s+=e(r)+1),s==1/0)return 1/0}return s}(e)<=t:void 0)}function m(e,t){return!1!==t&&(e=g(e)),f(s.parse(e))}function f(e){return s.serialize(e).split("#")[0]+"#"}var v=/#\/?$/;function g(e){return e?e.replace(v,""):""}function y(e,t){return t=g(t),s.resolve(e,t)}},function(e,t,r){"use strict";var s=Array.isArray,i=Object.keys,n=Object.prototype.hasOwnProperty;e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){var o,a,c,l=s(t),u=s(r);if(l&&u){if((a=t.length)!=r.length)return!1;for(o=a;0!=o--;)if(!e(t[o],r[o]))return!1;return!0}if(l!=u)return!1;var d=t instanceof Date,h=r instanceof Date;if(d!=h)return!1;if(d&&h)return t.getTime()==r.getTime();var p=t instanceof RegExp,m=r instanceof RegExp;if(p!=m)return!1;if(p&&m)return t.toString()==r.toString();var f=i(t);if((a=f.length)!==i(r).length)return!1;for(o=a;0!=o--;)if(!n.call(r,f[o]))return!1;for(o=a;0!=o--;)if(!e(t[c=f[o]],r[c]))return!1;return!0}return t!=t&&r!=r}},function(e,t,r){"use strict";var s=r(42);function i(e,t,r){this.message=r||i.message(e,t),this.missingRef=s.url(e,t),this.missingSchema=s.normalizeId(s.fullPath(this.missingRef))}function n(e){return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}e.exports={Validation:n(function(e){this.message="validation failed",this.errors=e,this.ajv=this.validation=!0}),MissingRef:n(i)},i.message=function(e,t){return"can't resolve reference "+t+" from id "+e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(17),n=new s.Vector3,o=new s.Vector3,a=new s.Matrix4,c=new s.Quaternion,l=new s.Euler;class u extends i.default{get snapshotKeys(){return["position","rotation","scale"]}fromData(e){const{position:t,rotation:r,order:i,scale:u}=this.ins;i.setValue(0),e.matrix?(a.fromArray(e.matrix),a.decompose(n,c,o),n.toArray(t.value),l.setFromQuaternion(c,"XYZ"),l.toVector3(n).multiplyScalar(s.Math.RAD2DEG).toArray(r.value),o.toArray(u.value),t.set(),r.set(),u.set()):(e.translation&&t.setValue(e.translation.slice()),e.rotation&&(c.fromArray(e.rotation),l.setFromQuaternion(c,"XYZ"),l.toVector3(n).multiplyScalar(s.Math.RAD2DEG).toArray(r.value),r.set()),e.scale&&u.setValue(e.scale.slice()),this.transform.changed=!0)}toData(){this.object3D.matrix.decompose(n,c,o);const e={};return 0===n.x&&0===n.y&&0===n.z||(e.translation=n.toArray()),0===c.x&&0===c.y&&0===c.z&&1===c.w||(e.rotation=c.toArray()),1===o.x&&1===o.y&&1===o.z||(e.scale=o.toArray()),e}}u.typeName="CVNode",t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(33);t.EUnitType=s.EUnitType,function(e){e[e.Image2D=0]="Image2D",e[e.Web3D=1]="Web3D",e[e.Print3D=2]="Print3D",e[e.Editorial3D=3]="Editorial3D"}(t.EDerivativeUsage||(t.EDerivativeUsage={})),function(e){e[e.Thumb=0]="Thumb",e[e.Low=1]="Low",e[e.Medium=2]="Medium",e[e.High=3]="High",e[e.Highest=4]="Highest",e[e.LOD=5]="LOD",e[e.Stream=6]="Stream"}(t.EDerivativeQuality||(t.EDerivativeQuality={})),function(e){e[e.Model=0]="Model",e[e.Geometry=1]="Geometry",e[e.Image=2]="Image",e[e.Texture=3]="Texture",e[e.Points=4]="Points",e[e.Volume=5]="Volume"}(t.EAssetType||(t.EAssetType={})),function(e){e[e.Color=0]="Color",e[e.Emissive=1]="Emissive",e[e.Occlusion=2]="Occlusion",e[e.Normal=3]="Normal",e[e.MetallicRoughness=4]="MetallicRoughness",e[e.Zone=5]="Zone"}(t.EMapType||(t.EMapType={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1),i=r(190),n=r(9),o=r(12),a=r(81);t.Annotation=a.default;const c=r(191),l=r(192),u=r(27),d=r(48),h={unitScale:s.types.Number("Transform.UnitScale",{preset:1,precision:5}),title:s.types.String("Annotation.Title"),lead:s.types.String("Annotation.Lead"),style:s.types.Enum("Annotation.Style",a.EAnnotationStyle,a.EAnnotationStyle.Default),scale:s.types.Scale("Annotation.Scale",1),offset:s.types.Number("Annotation.Offset"),article:s.types.Option("Annotation.Article",[]),image:s.types.String("Annotation.Image"),tilt:s.types.Number("Annotation.Tilt"),azimuth:s.types.Number("Annotation.Azimuth")};class p extends n.default{constructor(e,t){super(e,t),this.ins=this.addInputs(h),this._activeAnnotation=null,this._annotations={},this._viewports=new Set,this._sprites={},this.addEvents("active-annotation","group"),this.onSpriteClick=this.onSpriteClick.bind(this),this.onSpriteLink=this.onSpriteLink.bind(this),this.on("pointer-up",this.onPointerUp,this),this.system.on("pointer-up",this.onPointerUp,this),this.object3D=new i.default}get model(){return this.getComponent(o.default)}get meta(){return this.getComponent(u.default,!0)}get reader(){return this.getGraphComponent(d.default)}get articles(){const e=this.meta;return e?e.articles:null}get activeAnnotation(){return this._activeAnnotation}set activeAnnotation(e){if(e!==this._activeAnnotation){const t=this._activeAnnotation;t&&(t.set("expanded",!1),this.updateSprite(t)),this._activeAnnotation=e,e&&(e.set("expanded",!0),this.updateSprite(e));const r=this.ins;r.title.setValue(e?e.data.title:"",!0),r.lead.setValue(e?e.data.lead:"",!0),r.style.setValue(e?e.data.style:a.EAnnotationStyle.Default,!0),r.scale.setValue(e?e.data.scale:1,!0),r.offset.setValue(e?e.data.offset:0,!0),r.tilt.setValue(e?e.data.tilt:0,!0),r.azimuth.setValue(e?e.data.azimuth:0,!0);const s=this.articles;if(s){const t=s.items.map(e=>e.data.title);t.unshift("(none)"),r.article.setOptions(t);const i=e?s.getById(e.data.articleId):null;r.article.setValue(i?s.getIndexOf(i)+1:0,!0)}else r.article.setOptions(["(none)"]),r.article.setValue(0);r.image.setValue(e?e.data.imageUri:"",!0),this.emit({type:"update",annotation:e})}}update(e){super.update(e);const t=this.ins,r=this.object3D,s=this.activeAnnotation;if(t.unitScale.changed&&(r.scale.setScalar(t.unitScale.value),r.updateMatrix()),s){if(t.title.changed&&s.set("title",t.title.value),t.lead.changed&&s.set("lead",t.lead.value),t.style.changed&&(s.set("style",t.style.getValidatedValue()),this.createSprite(s)),t.scale.changed&&s.set("scale",t.scale.value),t.offset.changed&&s.set("offset",t.offset.value),t.tilt.changed&&s.set("tilt",t.tilt.value),t.azimuth.changed&&s.set("azimuth",t.azimuth.value),t.image.changed&&s.set("imageUri",t.image.value),t.article.changed){const e=this.articles,r=e&&e.getAt(t.article.getValidatedValue()-1);s.set("articleId",r?r.id:"")}this.updateSprite(s),this.emit({type:"update",annotation:s})}return!0}postRender(e){const t=e.viewport;this._viewports.has(t)||(t.on("dispose",this.onViewportDispose,this),this._viewports.add(t)),this.object3D.render(t.overlay,e.camera)}dispose(){this.object3D.dispose(),this.off("pointer-up",this.onPointerUp,this),this.system.off("pointer-up",this.onPointerUp,this),this._viewports.forEach(e=>e.off("dispose",this.onViewportDispose,this)),this._viewports.clear(),super.dispose()}getAnnotations(){return Object.keys(this._annotations).map(e=>this._annotations[e])}getAnnotationById(e){return this._annotations[e]}addAnnotation(e){this._annotations[e.id]=e,this.createSprite(e),this.changed=!0}removeAnnotation(e){const t=Object.keys(this._annotations);if(delete this._annotations[e.id],this.removeSprite(e),e===this.activeAnnotation){const r=Math.min(t.indexOf(e.id)+1,t.length-1);this.activeAnnotation=r<0?null:this._annotations[t[r]]}this.changed=!0}updateAnnotation(e){this.changed=!0}toJSON(){const e=super.toJSON(),t=this.toData();return t&&(e.data=t),e}fromJSON(e){e.data&&this.fromData(e.data)}toData(){const e=Object.keys(this._annotations);return 0===e.length?null:e.map(e=>this._annotations[e].toJSON())}fromData(e){e.forEach(e=>this.addAnnotation(new a.default(e)))}onPointerUp(e){if(e.isDragging)return;let t=e.object3D;for(;t&&!t.isHTMLSprite;)t=t.parent;this.activeAnnotation=t&&t.annotation}onViewportDispose(e){this.object3D.disposeHTMLContainer(e.viewport.overlay)}onSpriteClick(e){this.activeAnnotation=e.annotation}onSpriteLink(e){this.reader.ins.articleId.setValue(e.annotation.data.articleId),this.reader.ins.enabled.setValue(!0)}createSprite(e){let t;switch(this.removeSprite(e),e.data.style){case a.EAnnotationStyle.Balloon:t=new c.default(e);break;case a.EAnnotationStyle.Line:default:t=new l.default(e)}t.addEventListener("click",this.onSpriteClick),t.addEventListener("link",this.onSpriteLink),this._sprites[e.id]=t,this.object3D.add(t),this.registerPickableObject3D(t,!0)}removeSprite(e){const t=this._sprites[e.id];t&&(t.removeEventListener("click",this.onSpriteClick),t.removeEventListener("link",this.onSpriteLink),t.dispose(),this._sprites[e.id]=void 0,this.object3D.remove(t),this.unregisterPickableObject3D(t,!0))}updateSprite(e){const t=this._sprites[e.id];t&&t.update()}}p.typeName="CVAnnotationView",t.default=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1),i=r(29);t.EReaderPosition=i.EReaderPosition;const n=r(78);t.Article=n.default;const o=r(27),a=r(26),c=r(16);class l extends s.default{constructor(){super(...arguments),this.ins=this.addInputs(l.ins),this.outs=this.addOutputs(l.outs)}get snapshotKeys(){return["enabled","articleId"]}get articles(){return Object.keys(this._articles).map(e=>this._articles[e])}get activeArticle(){return this.outs.article.value}get assetReader(){return this.getMainComponent(c.default)}create(){super.create(),this.graph.components.on(o.default,this.onMetaComponent,this),this.updateArticles()}dispose(){this.graph.components.off(o.default,this.onMetaComponent,this),super.dispose()}update(e){const t=this.ins,r=this.outs;if(t.articleId.changed){const e=this._articles[t.articleId.value]||null,s=e&&e.article;r.node.setValue(e&&e.node),r.article.setValue(s),r.content.setValue(""),s&&this.readArticle(s)}return!0}readArticle(e){const t=this.outs,r=e.data.uri;if(r)return this.assetReader.getText(r).then(e=>t.content.setValue(e.replace(/[\n\r]/g,""))).catch(e=>t.content.setValue(`<h2>Article not found at ${r}</h2>`));t.content.setValue("<h2>Can't display article: no URI.</h2>")}onMetaComponent(e){e.add&&e.object.articles.on("update",this.updateArticles,this),e.remove&&e.object.articles.off("update",this.updateArticles,this),this.updateArticles()}updateArticles(){const e=this.getGraphComponents(o.default),t=this._articles={};e.forEach(e=>{const r=e.articles,s=e.node;r.items.forEach(e=>{t[e.id]={article:e,node:s}})});const r=e[0];r&&r.leadArticle?this.ins.articleId.setValue(r.leadArticle.id):this.ins.articleId.setValue("")}fromData(e){e=e||{},this.ins.setValues({enabled:!!e.enabled,position:i.EReaderPosition[e.position]||i.EReaderPosition.Overlay,articleId:e.articleId||""})}toData(){const e=this.ins,t={enabled:e.enabled.value,position:i.EReaderPosition[e.position.value]||"Overlay"};return e.articleId.value&&(t.articleId=e.articleId.value),t}}l.typeName="CVReader",l.ins={enabled:s.types.Boolean("Reader.Enabled"),position:s.types.Enum("Reader.Position",i.EReaderPosition),articleId:s.types.String("Article.ID")},l.outs={article:s.types.Object("Article.Active",n.default),content:s.types.String("Article.Content"),node:s.types.Object("Article.Node",a.default)},t.default=l},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(11),n=r(99),o=r(130);r(206);let a=class extends i.default{constructor(e){if(super(),e)this.application=e;else{const e={document:this.getAttribute("document"),model:this.getAttribute("model"),geometry:this.getAttribute("geometry"),texture:this.getAttribute("texture")};this.application=new o.default(null,e)}window.voyagerMini=this.application}firstConnected(){super.firstConnected();const e=this.application.system;new n.default(e).appendTo(this)}};a=s([i.customElement("voyager-mini")],a),t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(101),i=r(6),n=r(51),o=r(102),a=r(36);t.schemas=a.schemas,t.types=a.types;t.default=class extends i.default{constructor(e,t,r){if(super(),this.addEvents("value","link","change","dispose"),!t||void 0===t.preset)throw new Error("missing schema/preset");const s=t.preset,i=Array.isArray(s);this.type=typeof(i?s[0]:s),this.schema=t,this.custom=r||!1,this.elementCount=i?s.length:1,this.inLinks=[],this.outLinks=[],this._group=null,this._key="",this._path=e,this.value=null,this.reset(),this.changed=!t.event}get group(){return this._group}get key(){return this._key}get path(){return this._path}set path(e){this._path=e,this.emit({type:"change",what:"path",property:this})}get name(){return this._path.split(".").pop()}dispose(){this.unlink(),this._group&&this._group.removeProperty(this),this.emit({type:"dispose",property:this})}setValue(e,t){this.value=e,t||(this.changed=!0,this.isInput()&&(this._group.linkable.changed=!0)),this.emit("value",e);const r=this.outLinks;for(let e=0,t=r.length;e<t;++e)r[e].push()}copyValue(e,t){Array.isArray(e)&&(e=e.slice()),this.setValue(e,t)}set(e){e||(this.changed=!0,this.isInput()&&(this._group.linkable.changed=!0)),this.emit("value",this.value);const t=this.outLinks;for(let e=0,r=t.length;e<r;++e)t[e].push()}cloneValue(){const e=this.value;return Array.isArray(e)?e.slice():e}getValidatedValue(e){const t=this.value;if(this.isArray()){e=e||[];for(let r=0,s=t.length;r<s;++r)e[r]=this.validateValue(t[r]);return e}return this.validateValue(t)}linkTo(e,t,r){e.linkFrom(this,t,r)}linkFrom(e,t,r){if(!this.canLinkFrom(e,t,r))throw new Error(`can't link from '${e.path}' to '${this.path}'`);const s=new o.default(e,this,t,r);e.addOutLink(s),this.addInLink(s)}unlinkTo(e,t,r){e.unlinkFrom(this,t,r)}unlinkFrom(e,t,r){const s=this.inLinks.find(s=>s.source===e&&s.sourceIndex===t&&s.destinationIndex===r);return!!s&&(e.removeOutLink(s),this.removeInLink(s),!0)}unlink(){if(this.inLinks.slice().forEach(e=>{e.source.removeOutLink(e),this.removeInLink(e)}),this.outLinks.slice().forEach(e=>{this.removeOutLink(e),e.destination.removeInLink(e)}),0!==this.inLinks.length||0!==this.outLinks.length)throw new Error("fatal: leftover links")}addInLink(e){if(e.destination!==this)throw new Error("input link's destination must equal this");this.inLinks.push(e),this.requestSort(),this.emit({type:"link",add:!0,remove:!1,link:e})}addOutLink(e){if(e.source!==this)throw new Error("output link's source must equal this");this.outLinks.push(e),this.requestSort(),e.push()}removeInLink(e){const t=this.inLinks.indexOf(e);if(t<0)throw new Error("input link not found");this.inLinks.splice(t,1),this.requestSort(),0===this.inLinks.length&&"object"===this.type&&this.reset(),this.emit({type:"link",add:!1,remove:!0,link:e})}removeOutLink(e){const t=this.outLinks.indexOf(e);if(t<0)throw new Error("output link not found");this.outLinks.splice(t,1),this.requestSort()}canLinkTo(e,t,r){return e.canLinkFrom(this,t,r)}canLinkFrom(e,t,r){if(this.isOutput())return!1;const i=t>=0,o=r>=0;if(!e.isArray()&&i)throw new Error("non-array source property; can't link to element");if(!this.isArray()&&o)throw new Error("non-array destination property; can't link to element");const a=e.isArray()&&!i;return a===(this.isArray()&&!o)&&(!a||e.elementCount===this.elementCount)&&!("object"===e.type&&"object"===this.type&&!s.default(e.schema.objectType,this.schema.objectType))&&n.canConvert(e.type,this.type)}reset(){let e;if(this.isMulti()){let t=this.value;t?t.length=1:e=t=[],t[0]=this.clonePreset()}else e=this.clonePreset();this.setValue(e)}setMultiChannelCount(e){if(!this.isMulti())throw new Error("can't set multi channel count on non-multi property");const t=this.value,r=t.length;t.length=e;for(let s=r;s<e;++s)t[s]=this.clonePreset();this.changed=!0}requestSort(){this._group&&this._group.linkable&&this._group.linkable.requestSort()}setOptions(e){if(!this.schema.options)throw new Error(`property type mismatch, can't set options on '${this.path}'`);this.schema.options=e.slice(),this.emit({type:"change",what:"options",property:this})}getOptionText(){const e=this.schema.options;if("number"===this.type&&e){const t=Math.trunc(this.value);return e[t<0?0:t>=e.length?0:t]||""}}isInput(){return this._group&&this._group===this._group.linkable.ins}isOutput(){return this._group&&this._group===this._group.linkable.outs}isArray(){return Array.isArray(this.schema.preset)}isMulti(){return!!this.schema.multi}isDefault(){const e=this.schema.multi?this.value[0]:this.value,t=this.schema.preset,r=Array.isArray(e)?e.length:-1;if(r!==(Array.isArray(t)?t.length:-1))return!1;if(r>=0){for(let s=0;s<r;++s)if(e[s]!==t[s])return!1;return!0}return e===t}hasLinks(){return this.inLinks.length>0||this.outLinks.length>0}hasInLinks(e){const t=this.inLinks;if(!(e>=0))return t.length>0;for(let r=0,s=t.length;r<s;++r)if(t[r].destinationIndex===e)return!0;return!1}hasMainInLinks(){const e=this.inLinks;for(let t=0,r=e.length;t<r;++t)if(!(e[t].destinationIndex>=0))return!0;return!1}hasOutLinks(e){const t=this.outLinks;if(!(e>=0))return t.length>0;for(let r=0,s=t.length;r<s;++r)if(t[r].sourceIndex===e)return!0;return!1}inLinkCount(){return this.inLinks.length}outLinkCount(){return this.outLinks.length}toJSON(){let e=this.custom?{path:this.path,schema:Object.assign({},this.schema)}:null;return this.isOutput()||this.hasMainInLinks()||this.isDefault()||"object"===this.type||((e=e||{}).value=this.value),this.outLinks.length>0&&((e=e||{}).links=this.outLinks.map(e=>{const t={id:e.destination._group.linkable.id,key:e.destination.key};return e.sourceIndex>=0&&(t.srcIndex=e.sourceIndex),e.destinationIndex>=0&&(t.dstIndex=e.destinationIndex),t})),e}fromJSON(e,t){void 0!==e.value&&(this.value=e.value),void 0!==e.links&&e.links.forEach(e=>{t[e.id].ins[e.key].linkFrom(this,e.srcIndex,e.dstIndex)})}toString(){const e=this.schema,t=e.event?"event":e.options?"enum":this.type;return`${this.path} [${t}]`}dump(e=""){console.log(e+`Property '${this.path}', key: ${this.key}, value: ${this.value}`)}validateValue(e){const t=this.schema;if(t.enum){const r=Math.trunc(e);return t.enum[r]?r:0}if(t.options){const r=Math.trunc(e);return r<0?0:r>=t.options.length?0:r}return"number"===this.type?(e=t.min?Math.max(t.min,e):e,e=t.max?Math.min(t.max,e):e):e}clonePreset(){const e=this.schema.preset;return Array.isArray(e)?e.slice():e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=[function(e){return e},function(e,t){for(let r=0,s=t.length;r<s;++r)t[r]=e[r];return t}],i=[function(e){return!!e},function(e,t){for(let r=0,s=t.length;r<s;++r)t[r]=!!e[r];return t}],n=[function(e){return String(e)},function(e,t){for(let r=0,s=t.length;r<s;++r)t[r]=String(e[r]);return t}],o=[function(e,t){throw new Error(`illegal value conversion from ${typeof e} to ${typeof t}`)},function(e,t,r){throw new Error(`illegal array conversion from ${typeof e[0]} to ${typeof t[0]}`)}],a={number:{number:s,boolean:i,string:n,object:o},boolean:{number:[function(e){return e?1:0},function(e,t){for(let r=0,s=t.length;r<s;++r)t[r]=e[r]?1:0;return t}],boolean:s,string:n,object:o},string:{number:[function(e){return parseFloat(e)||0},function(e,t){for(let r=0,s=t.length;r<s;++r)t[r]=parseFloat(e[r])||0;return t}],boolean:i,string:s,object:o},object:{number:o,boolean:i,string:n,object:s}},c={number:{number:!0,boolean:!0,string:!0,object:!1},boolean:{number:!0,boolean:!0,string:!0,object:!1},string:{number:!0,boolean:!0,string:!0,object:!1},object:{number:!1,boolean:!0,string:!0,object:!0}},l=[[function(e,t,r){return r(e,t)},function(e,t,r){return t[0]=r(e),t},function(e,t,r){return t[1]=r(e),t},function(e,t,r){return t[2]=r(e),t},function(e,t,r){return t[3]=r(e),t}],[function(e,t,r){return r(e[0])},function(e,t,r){return t[0]=r(e[0]),t},function(e,t,r){return t[1]=r(e[0]),t},function(e,t,r){return t[2]=r(e[0]),t},function(e,t,r){return t[3]=r(e[0]),t}],[function(e,t,r){return r(e[1])},function(e,t,r){return t[0]=r(e[1]),t},function(e,t,r){return t[1]=r(e[1]),t},function(e,t,r){return t[2]=r(e[1]),t},function(e,t,r){return t[3]=r(e[1]),t}],[function(e,t,r){return r(e[2])},function(e,t,r){return t[0]=r(e[2]),t},function(e,t,r){return t[1]=r(e[2]),t},function(e,t,r){return t[2]=r(e[2]),t},function(e,t,r){return t[3]=r(e[2]),t}],[function(e,t,r){return r(e[3])},function(e,t,r){return t[0]=r(e[3]),t},function(e,t,r){return t[1]=r(e[3]),t},function(e,t,r){return t[2]=r(e[3]),t},function(e,t,r){return t[3]=r(e[3]),t}]];t.getConversionFunction=function(e,t,r){const s=r?1:0;return a[e][t][s]},t.canConvert=function(e,t){return c[e][t]},t.getElementCopyFunction=function(e,t,r){return-1===e&&-1===t?r:e<=3&&t<=3?l[e+1][t+1]:function(r,s,i){return s[t]=i(r[e]),s}},t.getMultiCopyFunction=function(e,t,r){return!1===e?!1===t?r:function(e,t,s){for(let s=0,i=t.length;s<i;++s)t[s]=r(e,t[s]);return t}:!1===t?function(e,t,s){return e.length>0&&(t=r(e[0],t)),t}:function(e,t,s){for(let s=0,i=e.length,n=t.length;s<n;++s)t[s]=r(e[s%i],t[s]);return t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1);t.default=class{constructor(e,t,r,i){this.typeName=s.default.getTypeName(t),this.didAdd=r,this.willRemove=i,this._registry=e,e.on(this.typeName,this.onComponent,this),this.component=e.get(t,!0),this.component&&r&&r(this.component)}dispose(){this._registry.off(this.typeName,this.onComponent,this),this.component=null,this.didAdd=null,this.willRemove=null}onComponent(e){e.add?(this.component=e.object,this.didAdd&&this.didAdd(e.object)):e.remove&&(this.willRemove&&this.willRemove(e.object),this.component=null)}}},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(54);t.System=i.default;const n=r(11);t.customElement=n.customElement,t.property=n.property,t.html=n.html,t.TemplateResult=n.TemplateResult;class o extends n.default{constructor(e){super(),this.system=e}}s([n.property({attribute:!1})],o.prototype,"system",void 0),t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(6),i=r(28),n=r(55),o=r(1),a=r(8),c=r(56);t.default=class extends s.default{constructor(e){super({knownEvents:!1}),this.nodes=new i.default(a.default),this.components=new i.default(o.default),this.registry=e||new n.default,this.graph=new c.default(this,null),this.graph.activate()}getComponent(e,t=!1){return this.components.get(e,t)}getComponents(e){return this.components.getArray(e)}hasComponents(e){return this.components.has(e)}getMainComponent(e,t=!1){return this.graph.components.get(e,t)}getMainComponents(e){return this.graph.components.getArray(e)}hasMainComponents(e){return this.graph.components.has(e)}getNode(e,t=!1){return this.nodes.get(e,t)}getNodes(e){return this.nodes.getArray(e)}hasNodes(e){return this.nodes.has(e)}getMainNode(e,t=!1){return this.graph.nodes.get(e,t)}getMainNodes(e){return this.graph.nodes.getArray(e)}hasMainNodes(e){return this.graph.nodes.has(e)}findNodeByName(e,t){const r=this.nodes.getArray(t);for(let t=0,s=r.length;t<s;++t)if(r[t].name===e)return r[t]}toJSON(){return this.graph.toJSON()}fromJSON(e){this.graph.clear(),this.graph.fromJSON(e)}toString(e=!1){const t=this.nodes.getArray(),r=this.components.count(),s=`System - ${t.length} nodes, ${r} components.`;return e?s+"\n"+t.map(e=>e.toString(!0)).join("\n"):s}_addNode(e){this.nodes.add(e)}_removeNode(e){this.nodes.remove(e)}_addComponent(e){if(e.isSystemSingleton&&this.components.has(e))throw new Error(`only one component of type '${e.typeName}' allowed per system`);this.components.add(e)}_removeComponent(e){this.components.remove(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(6);t.default=class extends s.default{constructor(){super(),this._dict={},this.addEvent("type")}add(e){if(Array.isArray(e))return void e.forEach(e=>this.add(e));const t=e.typeName;if(!t)throw new Error("type must have a 'typeName' member");if(this._dict[t])throw new Error(`type '${t}' already registered`);this._dict[t]=e,this.emit({type:"type",add:!0,remove:!1,classType:e})}remove(e){if(Array.isArray(e))return void e.forEach(e=>this.remove(e));const t=e.typeName;if(!t)throw new Error("type must have a 'typeName' member");if(!this._dict[t])throw new Error(`type '${t}' not registered`);delete this._dict[t],this.emit({type:"type",add:!1,remove:!0,classType:e})}getType(e){let t=e;return"function"==typeof e?t=e.typeName:"object"==typeof e&&(t=e.constructor.typeName),this._dict[t]}createInstance(e,...t){const r=this.getType(e);if(!r)throw new Error(`type '${e}' not registered`);return new r(...t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(23),i=r(6),n=r(117),o=r(1),a=r(8),c=r(28);t.default=class extends i.default{constructor(e,t){super({knownEvents:!1}),this.nodes=new c.default(a.default),this.components=new c.default(o.default),this.roots=[],this._sorter=new n.default,this._sortRequested=!0,this._sortedList=null,this._tockList=[],this._isActive=!1,this.system=e,this.parent=t}get isActive(){return this._isActive}getComponent(e,t=!1){return this.components.get(e,t)}getComponents(e){return this.components.getArray(e)}hasComponent(e){return this.components.has(e)}getMainComponent(e,t=!1){return this.system.graph.components.get(e,t)}getMainComponents(e){return this.system.graph.components.getArray(e)}hasMainComponent(e){return this.system.graph.components.has(e)}getSystemComponent(e,t=!1){return this.system.components.get(e,t)}getSystemComponents(e){return this.system.components.getArray(e)}hasSystemComponent(e){return this.system.components.has(e)}getComponentById(e){return this.system.components.getById(e)}getNode(e,t=!1){return this.nodes.get(e,t)}getNodes(e){return this.nodes.getArray(e)}hasNode(e){return this.nodes.has(e)}getMainNode(e,t=!1){return this.system.graph.nodes.get(e,t)}getMainNodes(e){return this.system.graph.nodes.getArray(e)}hasMainNode(e){return this.system.graph.nodes.has(e)}getSystemNode(e,t=!1){return this.system.nodes.get(e,t)}getSystemNodes(e){return this.system.nodes.getArray(e)}hasSystemNode(e){return this.system.nodes.has(e)}getNodeById(e){return this.system.nodes.getById(e)}activate(){if(this._isActive)return;this._isActive=!0,this._sortRequested&&(this._sortRequested=!1,this.sort());const e=this._sortedList;for(let t=0,r=e.length;t<r;++t){const r=e[t];r.activate&&r.activate()}}deactivate(){if(!this._isActive)return;this._isActive=!1;const e=this._sortedList;for(let t=0,r=e.length;t<r;++t){const r=e[t];r.deactivate&&r.deactivate()}}tick(e){if(!this._isActive)return;this._sortRequested&&(this._sortRequested=!1,this.sort());const t=this._sortedList;let r=!1;for(let s=0,i=t.length;s<i;++s){const i=t[s];i.updated=!1,i.changed?(i.update&&i.update(e)&&(i.updated=!0),i.tick&&i.tick(e)&&(i.updated=!0),i.resetChanged()):i.tick&&i.tick(e)&&(i.updated=!0),i.updated&&(r=!0,i.emit("update"))}return r}tock(e){if(!this._isActive)return;const t=this._tockList;for(let r=0,s=t.length;r<s;++r)t[r].tock(e)}clear(){const e=this.nodes.cloneArray().reverse();for(let t=0,r=e.length;t<r;++t)e[t].dispose();if(this.nodes.length>0)throw new Error("graph not empty")}requestSort(){this._sortRequested=!0}sort(){this._sortedList=this._sorter.sort(this.components.getArray());const e=this.parent?this.parent.name||this.parent.typeName:"System";console.log("Graph.sort - %s: sorted %s components",e,this._sortedList.length)}createCustomNode(e,t,r){const i=this.system.registry.getType(e);if(!i)throw new Error(`node type '${a.default.getTypeName(e)}' not registered`);const n=new i(this,r||s.default(12,this.system.nodes.getDictionary()));return n.create(),t&&(n.name=t),r||(n.createComponents(),n.unlock()),n}createNode(e,t){const r=new a.default(this,t||s.default(12,this.system.nodes.getDictionary()));return r.create(),e&&(r.name=e),r.unlock(),r}findNodeByName(e,t){const r=this.nodes.getArray(t);for(let t=0,s=r.length;t<s;++t)if(r[t].name===e)return r[t]}findRootNodes(e){const t=this.nodes.getArray(e),r=[];for(let e=0,s=t.length;e<s;++e){const s=t[e].components.get("CHierarchy",!0);s&&s.parent||r.push(t[e])}return r}toString(e=!1){const t=this.nodes.getArray(),r=this.components.count(),s=`Graph - ${t.length} nodes, ${r} components.`;return e?s+"\n"+t.map(e=>e.toString(!0)).join("\n"):s}dump(e=""){console.log(e+"%cGraph","color: red"),this.findRootNodes().forEach(t=>t.dump(e+"  "))}toJSON(){const e={},t=[],r=this.nodes.getArray();for(let e=0,s=r.length;e<s;++e){const s=r[e],i=this.nodeToJSON(s);i.type=s.typeName,i.id=s.id,s.name&&(i.name=s.name),t.push(i)}return t.length>0&&(e.nodes=t),e}fromJSON(e){e.nodes&&(e.nodes.forEach(e=>{this.createCustomNode(e.type,e.name,e.id).fromJSON(e)}),e.nodes.forEach(e=>{this.nodes.getById(e.id).referencesFromJSON(e)}))}nodeToJSON(e){return e.toJSON()}_addNode(e){this.nodes.add(e),this.system._addNode(e)}_removeNode(e){this.system._removeNode(e),this.nodes.remove(e)}_addComponent(e){if(e.isGraphSingleton&&this.components.has(e))throw new Error(`only one component of type '${e.typeName}' allowed per graph`);this.components.add(e),this.system._addComponent(e),e.tock&&this._tockList.push(e),this._sortRequested=!0}_removeComponent(e){this.system._removeComponent(e),this.components.remove(e),e.tock&&this._tockList.splice(this._tockList.indexOf(e),1),this._sortRequested=!0}_addRoot(e){this.roots.push(e),this.parent&&this.parent.onAddInnerRoot(e)}_removeRoot(e){this.parent&&this.parent.onRemoveInnerRoot(e),this.roots.splice(this.roots.indexOf(e),1)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1),i=r(8);t.Node=i.default;const n=r(30),o=(e,t,r)=>{let s;const i=e.children;for(let e=0,r=i.length;e<r;++e)if(s=i[e].components.has(t))return!0;if(r)for(let e=0,r=i.length;e<r;++e)if(s=o(i[e],t,!0))return!0;return!1},a=(e,t,r)=>{let s;const i=e.children;for(let e=0,r=i.length;e<r;++e)if(s=i[e].components.get(t))return s;if(r)for(let e=0,r=i.length;e<r;++e)if(s=a(i[e],t,!0))return s;return null},c=(e,t,r)=>{let s=[];const i=e.children;for(let e=0,r=i.length;e<r;++e)s=s.concat(i[e].components.getArray(t));if(r)for(let e=0,r=i.length;e<r;++e)s=s.concat(c(i[e],t,!0));return s};class l extends s.default{constructor(){super(...arguments),this._parent=null,this._children=[]}get parent(){return this._parent}get children(){return this._children||[]}create(){super.create(),this.graph._addRoot(this),this.node.components.on(s.default,this.onComponent,this)}dispose(){this.node.components.off(s.default,this.onComponent,this),this._children.slice().forEach(e=>e.node.dispose()),this._parent&&this._parent.removeChild(this),this.graph._removeRoot(this),super.dispose()}getRootComponent(e){let t=this;for(;t._parent;)t=t._parent;return t?t.node.components.get(e):null}getParentComponent(e,t){let r=this;for(;;){if(!(r=r._parent)){const e=this.graph.parent;r=e?e.components.get(l):void 0}if(!r)return;const s=r.node.components.get(e,!0);if(s)return s;if(!t)return}}getParentNode(e,t){let r=this;for(;;){if(!(r=r._parent)){const e=this.graph.parent;r=e?e.components.get(l):void 0}if(!r)return;const s=r.node;if(s.is(e))return s;if(!t)return}}getSiblingNode(e){return this.getSiblingNodes(e)[0]}getSiblingNodes(e){const t=this._parent;return this.graph.nodes.getArray(e).filter(e=>{const r=e.components.get(l);return(r?r._parent:null)==t})}hasChildComponents(e,t){return o(this,e,t)}getChildComponent(e,t){return a(this,e,t)}getChildComponents(e,t){return c(this,e,t)}traverseUp(e,t,r,s){if(e)if(t){const e=this.node.components.getArray();for(let t=0,r=e.length;t<r;++t)if(s(e[t]))return}else if(s(this))return;let i=this._parent;if(!i&&r){const e=this.node.graph.parent;i=e?e.getComponent(l,!0):null}i&&i.traverseUp(!0,t,r,s)}traverseDown(e,t,r,s){if(e)if(t){const e=this.node.components.getArray();for(let t=0,r=e.length;t<r;++t)if(s(e[t]))return}else if(s(this))return;if(r){const e=this.node.components.getArray(n.default);for(let i=0,n=e.length;i<n;++i){const n=e[i].innerRoots;for(let e=0,i=n.length;e<i;++e)n[e].traverseDown(!0,t,r,s)}}const i=this._children;for(let e=0,n=i.length;e<n;++e)i[e].traverseDown(!0,t,r,s)}propagateUp(e,t,r){this.traverseUp(!0,e,t,e=>(e.emit(r),r.stopPropagation))}propagateDown(e,t,r){this.traverseDown(!0,e,t,e=>(e.emit(r),r.stopPropagation))}addChild(e){if(e===this)throw new Error("can't add self as child");if(e._parent)throw new Error("can't add child, component has a parent");if(e.graph!==this.graph)throw new Error("can't add child, component in different graph");e._parent=this,this._children.push(e),this.graph._removeRoot(e);const t={type:"hierarchy",add:!0,remove:!1,parent:this,child:e};this.traverseUp(!0,!1,!0,e=>e.emit(t)),this.traverseDown(!1,!1,!0,e=>e.emit(t)),this.system.emit(t)}removeChild(e){if(e._parent!==this)throw new Error("component not a child of this");const t={type:"hierarchy",add:!1,remove:!0,parent:this,child:e};this.traverseUp(!0,!1,!0,e=>e.emit(t)),this.traverseDown(!1,!1,!0,e=>e.emit(t)),this.system.emit(t);const r=this._children.indexOf(e);this._children.splice(r,1),e._parent=null,this.graph._addRoot(e)}onComponent(e){if(e.object===this)return;const t={type:"child",add:e.add,remove:e.remove,component:e.object};this.traverseUp(!0,!1,!0,e=>e.emit(t))}toJSON(){const e=super.toJSON();return this._children.length>0&&(e.children=this._children.map(e=>e.id)),e}referencesFromJSON(e){super.referencesFromJSON(e);const t=this.system.components.getDictionary();e.children&&e.children.forEach(e=>{const r=t[e];this.addChild(r)})}toString(){return super.toString()+` - children: ${this.children.length}`}dump(e){super.dump(e),this.children.length>0&&(console.log(e+"%cChildren","color: purple"),this.children.forEach(t=>t.node.dump(e+"  ")))}}l.typeName="CHierarchy",t.default=l},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(11);var n;!function(e){e[e.TopLeft=0]="TopLeft",e[e.TopCenter=1]="TopCenter",e[e.TopRight=2]="TopRight",e[e.BottomLeft=3]="BottomLeft",e[e.BottomCenter=4]="BottomCenter",e[e.BottomRight=5]="BottomRight"}(n=t.ELocation||(t.ELocation={}));let o=class extends i.default{constructor(){super(),this.labels=[],this.labels.push({},{},{},{},{},{})}setLabel(e,t,r,s){this.labels[e][t]={text:r,className:s},this.performUpdate()}unsetLabel(e,t){delete this.labels[e][t],this.performUpdate()}firstConnected(){this.classList.add("ff-container","ff-viewport-overlay")}render(){const e=this.labels;return i.html`<div class="ff-row">
            <div class="ff-labels ff-top-left">${Object.keys(e[n.TopLeft]).map(t=>{const r=e[n.TopLeft][t];return i.html`<div class=${"ff-label "+r.className||!1}>${r.text}</div>`})}</div>
            <div class="ff-labels ff-top-center">${Object.keys(e[n.TopCenter]).map(t=>{const r=e[n.TopCenter][t];return i.html`<div class=${"ff-label "+r.className||!1}>${r.text}</div>`})}</div>
            <div class="ff-labels ff-top-right">${Object.keys(e[n.TopRight]).map(t=>{const r=e[n.TopRight][t];return i.html`<div class=${"ff-label "+r.className||!1}>${r.text}</div>`})}</div>
        </div><div class="ff-row">
            <div class="ff-labels ff-bottom-left">${Object.keys(e[n.BottomLeft]).map(t=>{const r=e[n.BottomLeft][t];return i.html`<div class=${"ff-label "+r.className||!1}>${r.text}</div>`})}</div>
            <div class="ff-labels ff-bottom-center">${Object.keys(e[n.BottomCenter]).map(t=>{const r=e[n.BottomCenter][t];return i.html`<div class=${"ff-label "+r.className||!1}>${r.text}</div>`})}</div>
            <div class="ff-labels ff-bottom-right">${Object.keys(e[n.BottomRight]).map(t=>{const r=e[n.BottomRight][t];return i.html`<div class=${"ff-label "+r.className||!1}>${r.text}</div>`})}</div>
        </div>`}};o=s([i.customElement("ff-viewport-overlay")],o),t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(19),n=r(123),o=new s.Matrix4,a=new s.Box3,c=new s.Vector3,l=new s.Vector3;var u,d,h;!function(e){e[e.Orbit=0]="Orbit",e[e.FirstPerson=1]="FirstPerson"}(u||(u={})),function(e){e[e.Off=0]="Off",e[e.Pan=1]="Pan",e[e.Orbit=2]="Orbit",e[e.Dolly=3]="Dolly",e[e.Zoom=4]="Zoom",e[e.PanDolly=5]="PanDolly",e[e.Roll=6]="Roll"}(d||(d={})),function(e){e[e.Off=0]="Off",e[e.Active=1]="Active",e[e.Release=2]="Release"}(h||(h={}));t.default=class{constructor(e){this.orbit=new s.Vector3(0,0,0),this.offset=new s.Vector3(0,0,50),this.minOrbit=new s.Vector3(-90,-1/0,-1/0),this.maxOrbit=new s.Vector3(90,1/0,1/0),this.minOffset=new s.Vector3(-1/0,-1/0,.1),this.maxOffset=new s.Vector3(1/0,1/0,1e3),this.orientationEnabled=!0,this.offsetEnabled=!0,this.mode=d.Off,this.phase=h.Off,this.prevPinchDist=0,this.deltaX=0,this.deltaY=0,this.deltaPinch=0,this.deltaWheel=0,this.viewportWidth=100,this.viewportHeight=100,this.camera=e}onPointer(e){if(e.isPrimary)if("pointer-down"===e.type)this.phase=h.Active;else if("pointer-up"===e.type)return this.phase=h.Release,!0;if("pointer-down"===e.type&&(this.mode=this.getModeFromEvent(e)),this.deltaX+=1*e.movementX,this.deltaY+=1*e.movementY,2===e.pointerCount){const t=e.activePositions,r=t[1].clientX-t[0].clientX,s=t[1].clientY-t[0].clientY,i=Math.sqrt(r*r+s*s),n=this.prevPinchDist||i;this.deltaPinch*=n>0?i/n:1,this.prevPinchDist=i}else this.deltaPinch=1,this.prevPinchDist=0;return!0}onTrigger(e){return"wheel"===e.type&&(this.deltaWheel+=i.default.limit(e.wheel,-1,1),!0)}setViewportSize(e,t){this.viewportWidth=e,this.viewportHeight=t}updateController(e,t){const r=this.camera;e=e||r;const s=this.orbit,i=this.offset;n.default.decomposeOrbitMatrix(e.matrix,s,i),this.orbit.multiplyScalar(n.default.RAD2DEG),t&&(this.minOffset.min(i),this.maxOffset.max(i))}zoomExtents(e){const t=this.camera,r=this.offset;if(!t)return void console.warn("CameraController.zoomExtents - camera not set");c.copy(this.orbit).multiplyScalar(i.default.DEG2RAD),l.setScalar(0),n.default.composeOrbitMatrix(c,l,o),a.copy(e).applyMatrix4(o.transpose()),a.getSize(c),a.getCenter(l),r.x=l.x,r.y=l.y;const s=Math.max(c.x/t.aspect,c.y);if(t.isOrthographicCamera)r.z=1.1*s;else{const e=1/(2*Math.tan(t.fov*i.default.DEG2RAD*.5));r.z=1.1*(s*e+l.z+.5*c.z)}this.maxOffset.z=Math.max(this.maxOffset.z,r.z+4*c.z)}updateCamera(e,t){const r=this.camera;return e=e||r,!(!this.update()&&!t||(c.copy(this.orbit).multiplyScalar(i.default.DEG2RAD),l.copy(this.offset),r.isOrthographicCamera&&(l.z=this.maxOffset.z),n.default.composeOrbitMatrix(c,l,e.matrix),e.matrixWorldNeedsUpdate=!0,r.isOrthographicCamera&&(r.size=this.offset.z,r.updateProjectionMatrix()),0))}update(){return(this.phase!==h.Off||0!==this.deltaWheel)&&(0!==this.deltaWheel?(this.updatePose(0,0,.07*this.deltaWheel+1,0,0,0),this.deltaWheel=0,!0):this.phase===h.Active?(0!==this.deltaX||0!==this.deltaY||1!==this.deltaPinch)&&(this.updateByMode(),this.deltaX=0,this.deltaY=0,this.deltaPinch=1,!0):this.phase===h.Release&&(this.deltaX*=.85,this.deltaY*=.85,this.deltaPinch=1,this.updateByMode(),Math.abs(this.deltaX)+Math.abs(this.deltaY)<.1&&(this.mode=d.Off,this.phase=h.Off),!0))}updateByMode(){switch(this.mode){case d.Orbit:this.updatePose(0,0,1,this.deltaY,this.deltaX,0);break;case d.Pan:this.updatePose(this.deltaX,this.deltaY,1,0,0,0);break;case d.Roll:this.updatePose(0,0,1,0,0,this.deltaX);break;case d.Dolly:this.updatePose(0,0,.0075*this.deltaY+1,0,0,0);break;case d.PanDolly:const e=.5*(this.deltaPinch-1)+1;this.updatePose(this.deltaX,this.deltaY,1/e,0,0,0)}}updatePose(e,t,r,s,n,o){const{orbit:a,minOrbit:c,maxOrbit:l,offset:u,minOffset:d,maxOffset:h}=this;if(this.orientationEnabled&&(a.x+=-1*s*300/this.viewportHeight,a.y+=-1*n*300/this.viewportHeight,a.z+=-1*o*300/this.viewportHeight,a.x=i.default.limit(a.x,c.x,l.x),a.y=i.default.limit(a.y,c.y,l.y),a.z=i.default.limit(a.z,c.z,l.z)),this.offsetEnabled){const s=u.z=r*u.z;u.x+=e*s*-1/this.viewportHeight,u.y-=t*s*-1/this.viewportHeight,u.x=i.default.limit(u.x,d.x,h.x),u.y=i.default.limit(u.y,d.y,h.y),u.z=i.default.limit(u.z,d.z,h.z)}}getModeFromEvent(e){if("mouse"===e.source){const t=e.originalEvent.button;if(0===t)return e.ctrlKey?d.Pan:e.altKey?d.Dolly:d.Orbit;if(2===t)return e.altKey?d.Roll:d.Pan;if(1===t)return d.Dolly}else if("touch"===e.source){const t=e.pointerCount;return 1===t?d.Orbit:2===t?d.PanDolly:d.Pan}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(124),n=r(125),o=r(126),a=new s.Vector3,c=new s.Box3(new s.Vector3(-1e5,-1e5,-1e5),new s.Vector3(1e5,1e5,1e5));t.default=class{static add(e,t){const r=e=>{e.material&&(e.onBeforeRender=function(t,r,s,i,n){n.isIndexShader&&n.setIndex(e.id)})};t?e.traverse(e=>r(e)):r(e)}static remove(e,t){const r=e=>{e.material&&(e.onBeforeRender=null)};t?e.traverse(e=>r(e)):r(e)}constructor(e){this.renderer=e,this.pickTextures=[];for(let e=0;e<3;++e)this.pickTextures[e]=new s.WebGLRenderTarget(1,1,{stencilBuffer:!1});this.pickBuffer=new Uint8Array(4),this.indexShader=new i.default,this.positionShader=new n.default,this.normalShader=new o.default}pickObject(e,t,r){const s=this.pickIndex(e,t,r);if(s>0)return e.getObjectById(s)}pickIndex(e,t,r){const s=r.viewport;t=s.updateCamera(t);const i=e.overrideMaterial;e.overrideMaterial=this.indexShader;const n=this.renderer,o=this.pickTextures[0],a=n.getClearColor().clone();s.applyPickViewport(o,r),n.setRenderTarget(o),n.setClearColor(0),n.clear(),n.render(e,t),n.setRenderTarget(null),n.setClearColor(a),e.overrideMaterial=i;const c=this.pickBuffer;return n.readRenderTargetPixels(o,0,0,1,1,c),c[0]+256*c[1]+65536*c[2]}pickPosition(e,t,r,i,n){i=i||c,n=n||new s.Vector3;const o=r.viewport;t=o.updateCamera(t);const l=e.overrideMaterial,u=e.overrideMaterial=this.positionShader,d=this.renderer,h=this.pickTextures,p=d.getClearColor().clone();d.setClearColor(0);for(let s=0;s<3;++s)u.uniforms.index.value=s,u.uniforms.range.value[0]=i.min.getComponent(s),u.uniforms.range.value[1]=i.max.getComponent(s),o.applyPickViewport(h[s],r),d.setRenderTarget(h[s]),d.clear(),d.render(e,t);d.setRenderTarget(null),d.setClearColor(p),e.overrideMaterial=l;const m=this.pickBuffer;for(let e=0;e<3;++e)d.readRenderTargetPixels(h[e],0,0,1,1,m),n.setComponent(e,m[0]/255+m[1]/255/256+m[2]/255/65536+m[3]/255/16777216);return i.getSize(a),n.multiply(a).add(i.min)}pickNormal(e,t,r,i){i=i||new s.Vector3;const n=r.viewport;t=n.updateCamera(t);const o=e.overrideMaterial;e.overrideMaterial=this.normalShader;const a=this.renderer,c=this.pickTextures[0],l=a.getClearColor().clone();n.applyPickViewport(c,r),a.setRenderTarget(c),a.setClearColor(0),a.clear(),a.render(e,t),a.setRenderTarget(null),a.setClearColor(l),e.overrideMaterial=o;const u=this.pickBuffer;return a.readRenderTargetPixels(c,0,0,1,1,u),i.set(u[0]/255*2-1,u[1]/255*2-1,u[2]/255*2-1).normalize()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1),i=r(8),n=r(39);var o;!function(e){e[e.Node=0]="Node",e[e.Graph=1]="Graph",e[e.Main=2]="Main",e[e.System=3]="System"}(o=t.EComponentScope||(t.EComponentScope={}));class a extends s.default{constructor(){super(...arguments),this._scope=o.Node,this._scopedNode=null,this._scopedGraph=null,this._activeComponent=null}get componentType(){return this.constructor.componentType}get followComponentSelection(){return this.constructor.followComponentSelection}get followNodeSelection(){return this.constructor.followNodeSelection}get retainSelection(){return this.constructor.retainSelection}get scope(){return this._scope}set scope(e){this._scope=e,this._activeComponent&&!this.isComponentInScope(this._activeComponent)&&(this.activeComponent=null)}get scopedNode(){return this._scopedNode}set scopedNode(e){e!==this._scopedNode&&(this._scopedNode=e,this._activeComponent&&!this.isComponentInScope(this._activeComponent)&&(this.activeComponent=null),this.onScopedComponents(),this.emit({type:"scoped-components"}))}get scopedGraph(){return this._scopedGraph}set scopedGraph(e){e!==this._scopedGraph&&(this._scopedGraph=e,this._activeComponent&&!this.isComponentInScope(this._activeComponent)&&(this.activeComponent=null),this.onScopedComponents(),this.emit({type:"scoped-components"}))}get scopedComponents(){switch(this._scope){case o.Node:return(this._scopedNode||this.node).getComponents(this.componentType);case o.Graph:return(this._scopedGraph?this._scopedGraph.innerGraph:this.graph).getComponents(this.componentType);case o.Main:return this.getMainComponents(this.componentType);case o.System:return this.getSystemComponents(this.componentType)}}get activeComponent(){return this._activeComponent}set activeComponent(e){const t=this.activeComponent;if(e!==t){if(t&&this.deactivateComponent(t),e){if(!this.isComponentInScope(e))throw new Error("can't activate, component out of scope");this.activateComponent(e)}this._activeComponent=e,this.onActiveComponent(t,e),this.emit({type:"active-component",previous:t,next:e})}}get selection(){return this.getSystemComponent(n.default)}create(){super.create(),this.system.components.on(s.default,this.onComponent,this),this.followComponentSelection&&this.selection.selectedComponents.on(this.componentType,this.onSelectComponent,this),this.followNodeSelection&&this.selection.selectedNodes.on(i.default,this.onSelectNode,this)}dispose(){this.activeComponent&&(this.activeComponent=null),this.system.components.off(s.default,this.onComponent,this),this.followComponentSelection&&this.selection.selectedComponents.off(this.componentType,this.onSelectComponent,this),this.followNodeSelection&&this.selection.selectedNodes.off(i.default,this.onSelectNode,this),super.dispose()}activateComponent(e){}deactivateComponent(e){}onActiveComponent(e,t){}onScopedComponents(){}onComponent(e){e.remove&&e.object===this.activeComponent&&(this.activeComponent=null),this.isComponentInScope(e.object)&&(this.onScopedComponents(),this.emit({type:"scoped-components"}))}onSelectComponent(e){const t=e.object;this.isComponentInScope(t)&&(e.add?this.activeComponent=t:e.remove&&!this.retainSelection&&t===this.activeComponent&&(this.activeComponent=null))}onSelectNode(e){const t=e.object;if(this.isNodeInScope(t)){const r=t.getComponent(this.componentType);r&&this.onSelectComponent({type:r.typeName,object:r,add:e.add,remove:e.remove})}}isComponentInScope(e){if(!e.is(this.componentType))return!1;switch(this._scope){case o.Node:const t=this._scopedNode||this.node;return e.node===t;case o.Graph:const r=this._scopedGraph?this._scopedGraph.innerGraph:this.graph;return e.graph===r;case o.Main:return e.graph===this.system.graph;case o.System:return!0}return!1}isNodeInScope(e){switch(this._scope){case o.Node:return e===(this._scopedNode||this.node);case o.Graph:const t=this._scopedGraph?this._scopedGraph.innerGraph:this.graph;return e.graph===t;case o.Main:return e.graph===this.system.graph;case o.System:return!0}}}a.typeName="CComponentProvider",a.componentType=s.default,a.followComponentSelection=!0,a.followNodeSelection=!1,a.retainSelection=!0,t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1),i=r(8),n=r(39);var o;!function(e){e[e.Graph=0]="Graph",e[e.Main=1]="Main",e[e.System=2]="System"}(o=t.ENodeScope||(t.ENodeScope={}));class a extends s.default{constructor(){super(...arguments),this._scope=o.Graph,this._scopedGraph=null,this._activeNode=null}get nodeType(){return this.constructor.nodeType}get followNodeSelection(){return this.constructor.followNodeSelection}get followComponentSelection(){return this.constructor.followComponentSelection}get retainSelection(){return this.constructor.retainSelection}get scope(){return this._scope}set scope(e){this._scope=e,this._activeNode&&!this.isNodeInScope(this._activeNode)&&(this.activeNode=null)}get scopedGraph(){return this._scopedGraph}set scopedGraph(e){e!==this._scopedGraph&&(this._scopedGraph=e,this._activeNode&&!this.isNodeInScope(this._activeNode)&&(this.activeNode=null),this.onScopedNodes(),this.emit({type:"scoped-nodes"}))}get scopedNodes(){switch(this._scope){case o.Graph:return(this._scopedGraph?this._scopedGraph.innerGraph:this.graph).getNodes(this.nodeType);case o.Main:return this.getMainNodes(this.nodeType);case o.System:return this.getSystemNodes(this.nodeType)}}get activeNode(){return this._activeNode}set activeNode(e){const t=this.activeNode;if(e!==t){if(t&&this.deactivateNode(t),e){if(!this.isNodeInScope(e))throw new Error("can't activate, node out of scope");this.activateNode(e)}this._activeNode=e,this.onActiveNode(t,e),this.emit({type:"active-node",previous:t,next:e})}}get selection(){return this.getSystemComponent(n.default)}create(){super.create(),this.system.nodes.on(i.default,this.onNode,this),this.followNodeSelection&&this.selection.selectedNodes.on(this.nodeType,this.onSelectNode,this),this.followComponentSelection&&this.selection.selectedComponents.on(s.default,this.onSelectComponent,this)}dispose(){this.activeNode&&(this.activeNode=null),this.system.nodes.off(i.default,this.onNode,this),this.followNodeSelection&&this.selection.selectedNodes.off(this.nodeType,this.onSelectNode,this),this.followComponentSelection&&this.selection.selectedComponents.off(s.default,this.onSelectComponent,this),super.dispose()}activateNode(e){}deactivateNode(e){}onActiveNode(e,t){}onScopedNodes(){}onNode(e){e.remove&&e.object===this.activeNode&&(this.activeNode=null),this.isNodeInScope(e.object)&&(this.onScopedNodes(),this.emit({type:"scoped-nodes"}))}onSelectNode(e){const t=e.object;this.isNodeInScope(t)&&(e.add?this.activeNode=t:e.remove&&!this.retainSelection&&t===this.activeNode&&(this.activeNode=null))}onSelectComponent(e){const t=e.object.node;t.is(this.nodeType)&&this.onSelectNode({type:t.typeName,object:t,add:e.add,remove:e.remove})}isNodeInScope(e){if(!e.is(this.nodeType))return!1;switch(this._scope){case o.Graph:const t=this._scopedGraph?this._scopedGraph.innerGraph:this.graph;return e.graph===t;case o.Main:return e.graph===this.system.graph;case o.System:return!0}return!1}}a.typeName="CNodeProvider",a.nodeType=i.default,a.followNodeSelection=!0,a.followComponentSelection=!1,a.retainSelection=!0,t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1);class i extends s.default{constructor(e,t){super(e,t),this.ins=this.addInputs(i.ins),this.outs=this.addOutputs(i.outs),this._fullscreenElement=null,this.onFullscreenChange=this.onFullscreenChange.bind(this);const r=document.documentElement,s=r.requestFullscreen||r.mozRequestFullScreen||r.webkitRequestFullscreen;this.outs.fullscreenAvailable.setValue(!!s),this.ins.toggle.on("value",this.toggle,this)}get fullscreenElement(){return this._fullscreenElement}set fullscreenElement(e){e!==this._fullscreenElement&&(this._fullscreenElement&&this._fullscreenElement.removeEventListener("fullscreenchange",this.onFullscreenChange),this._fullscreenElement=e,e&&e.addEventListener("fullscreenchange",this.onFullscreenChange))}update(e){return!0}toggle(){const e=this.outs,t=this._fullscreenElement;if(t){const r=e.fullscreenActive.value;if(!r&&e.fullscreenAvailable.value)t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);else if(r){const e=document;e.exitFullscreen?e.exitFullscreen():e.cancelFullScreen?e.cancelFullScreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitCancelFullScreen&&e.webkitCancelFullScreen()}}}onFullscreenChange(e){const t=document,r=t.fullscreenElement||t.mozFullScreenElement||t.webkitFullscreenElement;this.outs.fullscreenActive.setValue(!!r)}}i.typeName="CFullscreen",i.ins={toggle:s.types.Event("Fullscreen.Toggle")},i.outs={fullscreenAvailable:s.types.Boolean("Fullscreen.Available",!1),fullscreenActive:s.types.Boolean("Fullscreen.Active",!1)},t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1),i=r(52),n=r(39),o=r(138),a=r(9),c=r(17),l=r(25),u={viewportPicking:s.types.Boolean("Viewport.Picking",!0),viewportBrackets:s.types.Boolean("Viewport.Brackets",!0)};class d extends n.default{constructor(){super(...arguments),this.ins=this.addInputs(u),this._brackets=new Map,this._sceneTracker=null}create(){super.create(),this.system.on("pointer-up",this.onPointerUp,this),this._sceneTracker=new i.default(this.system.components,l.default,e=>{e.on("after-render",this.onSceneAfterRender,this)},e=>{e.off("after-render",this.onSceneAfterRender,this)})}dispose(){this._sceneTracker.dispose(),this.system.off("pointer-up",this.onPointerUp,this),this._sceneTracker.dispose(),super.dispose()}update(){return!0}onSelectNode(e,t){super.onSelectNode(e,t);const r=e.getComponent(c.default,!0);r&&this.updateBracket(r,t)}onSelectComponent(e,t){super.onSelectComponent(e,t),(e instanceof a.default||e instanceof c.default)&&this.updateBracket(e,t)}onPointerUp(e){this.ins.viewportPicking.value&&e.isPrimary&&!e.isDragging&&(e.component?this.selectComponent(e.component,e.ctrlKey):e.ctrlKey||this.clearSelection())}onSceneAfterRender(e){if(!this.ins.viewportBrackets.value)return;const t=e.context.renderer,r=e.context.camera;for(let e of this._brackets)t.render(e[1],r)}updateBracket(e,t){if(e){if(t){if(e.object3D){const t=new o.default(e.object3D);this._brackets.set(e,t)}}else{const t=this._brackets.get(e);t&&(this._brackets.delete(e),t.dispose())}this.changed=!0}}}d.typeName="CPickSelection",t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(139),i=r(1),n=r(140),o=r(141),a=r(26),c=r(83),l=r(34),u=r(16);class d extends n.default{constructor(e,t){super(e,t),this.ins=this.addInputs(d.ins),this.outs=this.addOutputs(d.outs),this.innerGraph.createCustomNode(c.default),this.ins.active.setValue(!1),this.ins.visible.setValue(!1)}get root(){return this.innerNodes.get(c.default)}get setup(){return this.innerComponents.get(l.default)}get assetPath(){return this.outs.assetPath.value}get assetBaseName(){let e=this.assetPath;const t=e.indexOf("document.json");return t>=0&&(e=e.substr(0,t)),e}update(e){super.update(e);const{ins:t,outs:r}=this;if(t.dumpJson.changed){const e=this.deflateDocument();console.log("-------------------- VOYAGER DOCUMENT --------------------"),console.log(JSON.stringify(e,(e,t)=>"number"==typeof t?parseFloat(t.toFixed(5)):t,2))}if(t.dumpTree.changed&&(console.log("-------------------- VOYAGER DOCUMENT --------------------"),this.dump()),t.download.changed){const e=r.assetPath.value.split("/").pop()||"voyager-document.json";s.default.json(this.deflateDocument(),e)}return!0}clearNodeTree(){this.root.transform.children.slice().forEach(e=>e.node.dispose())}openDocument(e,t,r){if(console.log("CVDocument.openDocument - assetPath: %s, mergeParent: %s",t,r),!d.validator.validate(e))throw new Error("document schema validation failed");r||this.clearNodeTree();let s="object"==typeof r?r:this.root;if(s.graph!==this.innerGraph)throw new Error("invalid parent node");const i=new Map;if(s instanceof c.default)s.fromDocument(e,e.scene,i);else{e.scenes[e.scene].nodes.forEach(t=>{const r=this.innerGraph.createCustomNode(a.default);s.transform.addChild(r.transform),r.fromDocument(e,t,i)})}t&&(this.outs.assetPath.setValue(t),this.name=this.getMainComponent(u.default).getAssetName(t))}appendModel(e,t,r){if(r&&r.graph!==this.innerGraph)throw new Error("invalid parent node");if(this.isEmpty())throw new Error("empty document, can't append model");r=r||this.root;const s=this.innerGraph.createCustomNode(a.default);r.transform.addChild(s.transform),s.createModel(),s.model.derivatives.createModelAsset(e,t)}appendGeometry(e,t,r,s,i,n){if(n&&n.graph!==this.innerGraph)throw new Error("invalid parent node");if(this.isEmpty())throw new Error("empty document, can't append geometry");n=n||this.root;const o=this.innerGraph.createCustomNode(a.default);n.transform.addChild(o.transform),o.createModel(),o.model.derivatives.createMeshAsset(e,t,r,s,i)}deflateDocument(e){if(this.isEmpty())throw new Error("empty document, can't serialize");const t={asset:{type:d.mimeType,version:d.version,generator:"Voyager",copyright:"(c) Smithsonian Institution. All rights reserved."},scene:0,scenes:[]},r=new Map;return t.scene=this.root.toDocument(t,r,e),t}}d.typeName="CVDocument",d.mimeType="application/si-dpo-3d.document+json",d.version="1.0",d.validator=new o.default,d.ins={dumpJson:i.types.Event("Document.DumpJSON"),dumpTree:i.types.Event("Document.DumpTree"),download:i.types.Event("Document.Download")},d.outs={assetPath:i.types.AssetPath("Asset.Path")},t.default=d},function(e,t,r){"use strict";var s=r(20);e.exports=function(e){s.copy(e,this)}},function(e,t,r){"use strict";e.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var r,s="boolean"==typeof t.cycles&&t.cycles,i=t.cmp&&(r=t.cmp,function(e){return function(t,s){var i={key:t,value:e[t]},n={key:s,value:e[s]};return r(i,n)}}),n=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var r,o;if(Array.isArray(t)){for(o="[",r=0;r<t.length;r++)r&&(o+=","),o+=e(t[r])||"null";return o+"]"}if(null===t)return"null";if(-1!==n.indexOf(t)){if(s)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=n.push(t)-1,c=Object.keys(t).sort(i&&i(t));for(o="",r=0;r<c.length;r++){var l=c[r],u=e(t[l]);u&&(o&&(o+=","),o+=JSON.stringify(l)+":"+u)}return n.splice(a,1),"{"+o+"}"}}(e)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s="",i=!0===e.schema.$async,n=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),o=e.self._getId(e.schema);if(e.opts.strictKeywords){var a=e.util.schemaUnknownRules(e.schema,e.RULES.keywords);if(a){var c="unknown keyword: "+a;if("log"!==e.opts.strictKeywords)throw new Error(c);e.logger.warn(c)}}if(e.isTop&&(s+=" var validate = ",i&&(e.async=!0,s+="async "),s+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",o&&(e.opts.sourceCode||e.opts.processCode)&&(s+=" /*# sourceURL="+o+" */ ")),"boolean"==typeof e.schema||!n&&!e.schema.$ref){var l=e.level,u=e.dataLevel,d=e.schema["false schema"],h=e.schemaPath+e.util.getProperty("false schema"),p=e.errSchemaPath+"/false schema",m=!e.opts.allErrors,f="data"+(u||""),v="valid"+l;if(!1===e.schema){e.isTop?m=!0:s+=" var "+v+" = false; ",(Y=Y||[]).push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'false schema' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: {} ",!1!==e.opts.messages&&(s+=" , message: 'boolean schema is false' "),e.opts.verbose&&(s+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),s+=" } "):s+=" {} ";var g=s;s=Y.pop(),!e.compositeRule&&m?e.async?s+=" throw new ValidationError(["+g+"]); ":s+=" validate.errors = ["+g+"]; return false; ":s+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else e.isTop?s+=i?" return data; ":" validate.errors = null; return true; ":s+=" var "+v+" = true; ";return e.isTop&&(s+=" }; return validate; "),s}if(e.isTop){var y=e.isTop;l=e.level=0,u=e.dataLevel=0,f="data";if(e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[void 0],void 0!==e.schema.default&&e.opts.useDefaults&&e.opts.strictDefaults){var b="default is ignored in the schema root";if("log"!==e.opts.strictDefaults)throw new Error(b);e.logger.warn(b)}s+=" var vErrors = null; ",s+=" var errors = 0;     ",s+=" if (rootData === undefined) rootData = data; "}else{l=e.level,f="data"+((u=e.dataLevel)||"");if(o&&(e.baseId=e.resolve.url(e.baseId,o)),i&&!e.async)throw new Error("async schema in sync schema");s+=" var errs_"+l+" = errors;"}v="valid"+l,m=!e.opts.allErrors;var E="",_="",w=e.schema.type,S=Array.isArray(w);if(w&&e.opts.nullable&&!0===e.schema.nullable&&(S?-1==w.indexOf("null")&&(w=w.concat("null")):"null"!=w&&(w=[w,"null"],S=!0)),S&&1==w.length&&(w=w[0],S=!1),e.schema.$ref&&n){if("fail"==e.opts.extendRefs)throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'" (see option extendRefs)');!0!==e.opts.extendRefs&&(n=!1,e.logger.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(e.schema.$comment&&e.opts.$comment&&(s+=" "+e.RULES.all.$comment.code(e,"$comment")),w){if(e.opts.coerceTypes)var P=e.util.coerceToTypes(e.opts.coerceTypes,w);var x=e.RULES.types[w];if(P||S||!0===x||x&&!W(x)){h=e.schemaPath+".type",p=e.errSchemaPath+"/type",h=e.schemaPath+".type",p=e.errSchemaPath+"/type";var C=S?"checkDataTypes":"checkDataType";if(s+=" if ("+e.util[C](w,f,!0)+") { ",P){var T="dataType"+l,A="coerced"+l;s+=" var "+T+" = typeof "+f+"; ","array"==e.opts.coerceTypes&&(s+=" if ("+T+" == 'object' && Array.isArray("+f+")) "+T+" = 'array'; "),s+=" var "+A+" = undefined; ";var M="",R=P;if(R)for(var O,D=-1,j=R.length-1;D<j;)O=R[D+=1],D&&(s+=" if ("+A+" === undefined) { ",M+="}"),"array"==e.opts.coerceTypes&&"array"!=O&&(s+=" if ("+T+" == 'array' && "+f+".length == 1) { "+A+" = "+f+" = "+f+"[0]; "+T+" = typeof "+f+";  } "),"string"==O?s+=" if ("+T+" == 'number' || "+T+" == 'boolean') "+A+" = '' + "+f+"; else if ("+f+" === null) "+A+" = ''; ":"number"==O||"integer"==O?(s+=" if ("+T+" == 'boolean' || "+f+" === null || ("+T+" == 'string' && "+f+" && "+f+" == +"+f+" ","integer"==O&&(s+=" && !("+f+" % 1)"),s+=")) "+A+" = +"+f+"; "):"boolean"==O?s+=" if ("+f+" === 'false' || "+f+" === 0 || "+f+" === null) "+A+" = false; else if ("+f+" === 'true' || "+f+" === 1) "+A+" = true; ":"null"==O?s+=" if ("+f+" === '' || "+f+" === 0 || "+f+" === false) "+A+" = null; ":"array"==e.opts.coerceTypes&&"array"==O&&(s+=" if ("+T+" == 'string' || "+T+" == 'number' || "+T+" == 'boolean' || "+f+" == null) "+A+" = ["+f+"]; ");s+=" "+M+" if ("+A+" === undefined) {   ",(Y=Y||[]).push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: { type: '",s+=S?""+w.join(","):""+w,s+="' } ",!1!==e.opts.messages&&(s+=" , message: 'should be ",s+=S?""+w.join(","):""+w,s+="' "),e.opts.verbose&&(s+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),s+=" } "):s+=" {} ";g=s;s=Y.pop(),!e.compositeRule&&m?e.async?s+=" throw new ValidationError(["+g+"]); ":s+=" validate.errors = ["+g+"]; return false; ":s+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" } else {  ";var L=u?"data"+(u-1||""):"parentData";s+=" "+f+" = "+A+"; ",u||(s+="if ("+L+" !== undefined)"),s+=" "+L+"["+(u?e.dataPathArr[u]:"parentDataProperty")+"] = "+A+"; } "}else{(Y=Y||[]).push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: { type: '",s+=S?""+w.join(","):""+w,s+="' } ",!1!==e.opts.messages&&(s+=" , message: 'should be ",s+=S?""+w.join(","):""+w,s+="' "),e.opts.verbose&&(s+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),s+=" } "):s+=" {} ";g=s;s=Y.pop(),!e.compositeRule&&m?e.async?s+=" throw new ValidationError(["+g+"]); ":s+=" validate.errors = ["+g+"]; return false; ":s+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}s+=" } "}}if(e.schema.$ref&&!n)s+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",m&&(s+=" } if (errors === ",s+=y?"0":"errs_"+l,s+=") { ",_+="}");else{var N=e.RULES;if(N)for(var I=-1,k=N.length-1;I<k;)if(W(x=N[I+=1])){if(x.type&&(s+=" if ("+e.util.checkDataType(x.type,f)+") { "),e.opts.useDefaults)if("object"==x.type&&e.schema.properties){d=e.schema.properties;var V=Object.keys(d);if(V)for(var F,U=-1,H=V.length-1;U<H;){if(void 0!==(z=d[F=V[U+=1]]).default){var B=f+e.util.getProperty(F);if(e.compositeRule){if(e.opts.strictDefaults){b="default is ignored for: "+B;if("log"!==e.opts.strictDefaults)throw new Error(b);e.logger.warn(b)}}else s+=" if ("+B+" === undefined ","empty"==e.opts.useDefaults&&(s+=" || "+B+" === null || "+B+" === '' "),s+=" ) "+B+" = ","shared"==e.opts.useDefaults?s+=" "+e.useDefault(z.default)+" ":s+=" "+JSON.stringify(z.default)+" ",s+="; "}}}else if("array"==x.type&&Array.isArray(e.schema.items)){var $=e.schema.items;if($){D=-1;for(var z,G=$.length-1;D<G;)if(void 0!==(z=$[D+=1]).default){B=f+"["+D+"]";if(e.compositeRule){if(e.opts.strictDefaults){b="default is ignored for: "+B;if("log"!==e.opts.strictDefaults)throw new Error(b);e.logger.warn(b)}}else s+=" if ("+B+" === undefined ","empty"==e.opts.useDefaults&&(s+=" || "+B+" === null || "+B+" === '' "),s+=" ) "+B+" = ","shared"==e.opts.useDefaults?s+=" "+e.useDefault(z.default)+" ":s+=" "+JSON.stringify(z.default)+" ",s+="; "}}}var q=x.rules;if(q)for(var Q,J=-1,K=q.length-1;J<K;)if(Z(Q=q[J+=1])){var X=Q.code(e,Q.keyword,x.type);X&&(s+=" "+X+" ",m&&(E+="}"))}if(m&&(s+=" "+E+" ",E=""),x.type&&(s+=" } ",w&&w===x.type&&!P)){s+=" else { ";var Y;h=e.schemaPath+".type",p=e.errSchemaPath+"/type";(Y=Y||[]).push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: { type: '",s+=S?""+w.join(","):""+w,s+="' } ",!1!==e.opts.messages&&(s+=" , message: 'should be ",s+=S?""+w.join(","):""+w,s+="' "),e.opts.verbose&&(s+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),s+=" } "):s+=" {} ";g=s;s=Y.pop(),!e.compositeRule&&m?e.async?s+=" throw new ValidationError(["+g+"]); ":s+=" validate.errors = ["+g+"]; return false; ":s+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" } "}m&&(s+=" if (errors === ",s+=y?"0":"errs_"+l,s+=") { ",_+="}")}}function W(e){for(var t=e.rules,r=0;r<t.length;r++)if(Z(t[r]))return!0}function Z(t){return void 0!==e.schema[t.keyword]||t.implements&&function(t){for(var r=t.implements,s=0;s<r.length;s++)if(void 0!==e.schema[r[s]])return!0}(t)}return m&&(s+=" "+_+" "),y?(i?(s+=" if (errors === 0) return data;           ",s+=" else throw new ValidationError(vErrors); "):(s+=" validate.errors = vErrors; ",s+=" return errors === 0;       "),s+=" }; return validate;"):s+=" var "+v+" = errors === errs_"+l+";",s=e.util.cleanUpCode(s),y&&(s=e.util.finalCleanUpCode(s,i)),s}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s,i=" ",n=e.level,o=e.dataLevel,a=e.schema[t],c=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,d="data"+(o||""),h=e.opts.$data&&a&&a.$data;h?(i+=" var schema"+n+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; ",s="schema"+n):s=a;var p="maximum"==t,m=p?"exclusiveMaximum":"exclusiveMinimum",f=e.schema[m],v=e.opts.$data&&f&&f.$data,g=p?"<":">",y=p?">":"<",b=void 0;if(v){var E=e.util.getData(f.$data,o,e.dataPathArr),_="exclusive"+n,w="exclType"+n,S="exclIsNumber"+n,P="' + "+(T="op"+n)+" + '";i+=" var schemaExcl"+n+" = "+E+"; ",i+=" var "+_+"; var "+w+" = typeof "+(E="schemaExcl"+n)+"; if ("+w+" != 'boolean' && "+w+" != 'undefined' && "+w+" != 'number') { ";var x;b=m;(x=x||[]).push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(b||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(i+=" , message: '"+m+" should be boolean' "),e.opts.verbose&&(i+=" , schema: validate.schema"+c+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var C=i;i=x.pop(),!e.compositeRule&&u?e.async?i+=" throw new ValidationError(["+C+"]); ":i+=" validate.errors = ["+C+"]; return false; ":i+=" var err = "+C+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else if ( ",h&&(i+=" ("+s+" !== undefined && typeof "+s+" != 'number') || "),i+=" "+w+" == 'number' ? ( ("+_+" = "+s+" === undefined || "+E+" "+g+"= "+s+") ? "+d+" "+y+"= "+E+" : "+d+" "+y+" "+s+" ) : ( ("+_+" = "+E+" === true) ? "+d+" "+y+"= "+s+" : "+d+" "+y+" "+s+" ) || "+d+" !== "+d+") { var op"+n+" = "+_+" ? '"+g+"' : '"+g+"='; ",void 0===a&&(b=m,l=e.errSchemaPath+"/"+m,s=E,h=v)}else{P=g;if((S="number"==typeof f)&&h){var T="'"+P+"'";i+=" if ( ",h&&(i+=" ("+s+" !== undefined && typeof "+s+" != 'number') || "),i+=" ( "+s+" === undefined || "+f+" "+g+"= "+s+" ? "+d+" "+y+"= "+f+" : "+d+" "+y+" "+s+" ) || "+d+" !== "+d+") { "}else{S&&void 0===a?(_=!0,b=m,l=e.errSchemaPath+"/"+m,s=f,y+="="):(S&&(s=Math[p?"min":"max"](f,a)),f===(!S||s)?(_=!0,b=m,l=e.errSchemaPath+"/"+m,y+="="):(_=!1,P+="="));T="'"+P+"'";i+=" if ( ",h&&(i+=" ("+s+" !== undefined && typeof "+s+" != 'number') || "),i+=" "+d+" "+y+" "+s+" || "+d+" !== "+d+") { "}}b=b||t,(x=x||[]).push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(b||"_limit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { comparison: "+T+", limit: "+s+", exclusive: "+_+" } ",!1!==e.opts.messages&&(i+=" , message: 'should be "+P+" ",i+=h?"' + "+s:s+"'"),e.opts.verbose&&(i+=" , schema:  ",i+=h?"validate.schema"+c:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";C=i;return i=x.pop(),!e.compositeRule&&u?e.async?i+=" throw new ValidationError(["+C+"]); ":i+=" validate.errors = ["+C+"]; return false; ":i+=" var err = "+C+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",u&&(i+=" else { "),i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s,i=" ",n=e.level,o=e.dataLevel,a=e.schema[t],c=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,d="data"+(o||""),h=e.opts.$data&&a&&a.$data;h?(i+=" var schema"+n+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; ",s="schema"+n):s=a,i+="if ( ",h&&(i+=" ("+s+" !== undefined && typeof "+s+" != 'number') || "),i+=" "+d+".length "+("maxItems"==t?">":"<")+" "+s+") { ";var p=t,m=m||[];m.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(p||"_limitItems")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+s+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have ",i+="maxItems"==t?"more":"fewer",i+=" than ",i+=h?"' + "+s+" + '":""+a,i+=" items' "),e.opts.verbose&&(i+=" , schema:  ",i+=h?"validate.schema"+c:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var f=i;return i=m.pop(),!e.compositeRule&&u?e.async?i+=" throw new ValidationError(["+f+"]); ":i+=" validate.errors = ["+f+"]; return false; ":i+=" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",u&&(i+=" else { "),i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s,i=" ",n=e.level,o=e.dataLevel,a=e.schema[t],c=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,d="data"+(o||""),h=e.opts.$data&&a&&a.$data;h?(i+=" var schema"+n+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; ",s="schema"+n):s=a;var p="maxLength"==t?">":"<";i+="if ( ",h&&(i+=" ("+s+" !== undefined && typeof "+s+" != 'number') || "),!1===e.opts.unicode?i+=" "+d+".length ":i+=" ucs2length("+d+") ",i+=" "+p+" "+s+") { ";var m=t,f=f||[];f.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(m||"_limitLength")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+s+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT be ",i+="maxLength"==t?"longer":"shorter",i+=" than ",i+=h?"' + "+s+" + '":""+a,i+=" characters' "),e.opts.verbose&&(i+=" , schema:  ",i+=h?"validate.schema"+c:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var v=i;return i=f.pop(),!e.compositeRule&&u?e.async?i+=" throw new ValidationError(["+v+"]); ":i+=" validate.errors = ["+v+"]; return false; ":i+=" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",u&&(i+=" else { "),i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s,i=" ",n=e.level,o=e.dataLevel,a=e.schema[t],c=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,d="data"+(o||""),h=e.opts.$data&&a&&a.$data;h?(i+=" var schema"+n+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; ",s="schema"+n):s=a,i+="if ( ",h&&(i+=" ("+s+" !== undefined && typeof "+s+" != 'number') || "),i+=" Object.keys("+d+").length "+("maxProperties"==t?">":"<")+" "+s+") { ";var p=t,m=m||[];m.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(p||"_limitProperties")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+s+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have ",i+="maxProperties"==t?"more":"fewer",i+=" than ",i+=h?"' + "+s+" + '":""+a,i+=" properties' "),e.opts.verbose&&(i+=" , schema:  ",i+=h?"validate.schema"+c:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var f=i;return i=m.pop(),!e.compositeRule&&u?e.async?i+=" throw new ValidationError(["+f+"]); ":i+=" validate.errors = ["+f+"]; return false; ":i+=" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",u&&(i+=" else { "),i}},function(e){e.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(180);class i extends s.default{fromDocument(e,t){if(!isFinite(t.camera))throw new Error("camera property missing in node");const r=e.cameras[t.camera];return"perspective"===r.type?this.ins.copyValues({projection:s.EProjection.Perspective,fov:r.perspective.yfov,near:r.perspective.znear,far:r.perspective.zfar}):this.ins.copyValues({projection:s.EProjection.Orthographic,size:r.orthographic.ymag,near:r.orthographic.znear,far:r.orthographic.zfar}),t.camera}toDocument(e,t){const r=this.ins,i={};r.projection.getValidatedValue()===s.EProjection.Perspective?(i.type="perspective",i.perspective={yfov:r.fov.value,znear:r.near.value,zfar:r.far.value}):(i.type="orthographic",i.orthographic={ymag:r.size.value,znear:r.near.value,zfar:r.far.value}),e.cameras=e.cameras||[];const n=e.cameras.length;return e.cameras.push(i),n}}i.typeName="CVCamera",t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(182);class i extends s.default{get snapshotKeys(){return["color","intensity"]}fromDocument(e,t){if(!isFinite(t.light))throw new Error("light property missing in node");const r=e.lights[t.light];if("directional"!==r.type)throw new Error("light type mismatch: not a directional light");return this.ins.copyValues({color:void 0!==r.color?r.color:[1,1,1],intensity:void 0!==r.intensity?r.intensity:1,position:[0,0,0],target:[0,0,0]}),t.light}toDocument(e,t){const r=this.ins,s={color:r.color.cloneValue(),intensity:r.intensity.value,type:"directional"};e.lights=e.lights||[];const i=e.lights.length;return e.lights.push(s),i}}i.typeName="CVDirectionalLight",t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(183);class i extends s.default{get snapshotKeys(){return["color","intensity"]}fromDocument(e,t){if(!isFinite(t.light))throw new Error("light property missing in node");const r=e.lights[t.light];if("point"!==r.type)throw new Error("light type mismatch: not a point light");return this.ins.copyValues({color:void 0!==r.color?r.color:[1,1,1],intensity:void 0!==r.intensity?r.intensity:1,distance:r.point.distance||0,decay:void 0!==r.point.decay?r.point.decay:1}),t.light}toDocument(e,t){const r=this.ins,s={color:r.color.cloneValue(),intensity:r.intensity.value,point:{distance:r.distance.value,decay:r.decay.value},type:"point"};e.lights=e.lights||[];const i=e.lights.length;return e.lights.push(s),i}}i.typeName="CVPointLight",t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(184);class i extends s.default{get snapshotKeys(){return["color","intensity"]}fromDocument(e,t){if(!isFinite(t.light))throw new Error("light property missing in node");const r=e.lights[t.light];if("point"!==r.type)throw new Error("light type mismatch: not a point light");return this.ins.copyValues({color:void 0!==r.color?r.color:[1,1,1],intensity:void 0!==r.intensity?r.intensity:1,distance:r.spot.distance||0,decay:void 0!==r.spot.decay?r.spot.decay:1,angle:void 0!==r.spot.angle?r.spot.angle:Math.PI/4,penumbra:r.spot.penumbra||0}),t.light}toDocument(e,t){const r=this.ins,s={color:r.color.cloneValue(),intensity:r.intensity.value,spot:{distance:r.distance.value,decay:r.decay.value,angle:r.angle.value,penumbra:r.penumbra.value},type:"spot"};e.lights=e.lights||[];const i=e.lights.length;return e.lights.push(s),i}}i.typeName="CVSpotLight",t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(32);class i extends s.default{static fromJSON(e){return new i(e)}toString(){return this.data.title}init(){return{id:this.generateId(),title:"New Article",lead:"",tags:[],uri:"",mimeType:"",thumbnailUri:""}}deflate(e,t){t.id=e.id,t.uri=e.uri,e.title&&(t.title=e.title),e.lead&&(t.lead=e.lead),e.tags.length>0&&(t.tags=e.tags.slice()),e.mimeType&&(t.mimeType=e.mimeType),e.thumbnailUri&&(t.thumbnailUri=e.thumbnailUri)}inflate(e,t){t.id=e.id,t.uri=e.uri,t.title=e.title||"",t.lead=e.lead||"",t.tags=e.tags||[],t.mimeType=e.mimeType||"",t.thumbnailUri=e.thumbnailUri||""}}t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(32),i=r(46);t.EAssetType=i.EAssetType,t.EMapType=i.EMapType;class n extends s.default{setModel(e){this.data.uri=e,this.data.type=i.EAssetType.Model,this.data.mimeType=this.guessAssetMimeType()}setGeometry(e){this.data.uri=e,this.data.type=i.EAssetType.Geometry,this.data.mimeType=this.guessAssetMimeType()}setTexture(e,t){this.data.uri=e,this.data.type=i.EAssetType.Image,this.data.mimeType=this.guessAssetMimeType(),this.data.mapType=t}isValid(){return!!this.data.uri&&void 0!==this.data.type}toString(){const e=this.data;return`Asset - type: '${i.EAssetType[e.type]}', uri: '${e.uri}', mime type: '${e.mimeType||"(not set)"}'`}init(){return{uri:"",mimeType:"",type:void 0,mapType:void 0,byteSize:0,numFaces:0,numVertices:0,imageSize:0}}deflate(e,t){t.uri=e.uri,t.type=i.EAssetType[e.type],e.mimeType&&(t.mimeType=e.mimeType),void 0!==e.mapType&&(t.mapType=i.EMapType[e.mapType]),e.byteSize>0&&(t.byteSize=e.byteSize),e.type!==i.EAssetType.Model&&e.type!==i.EAssetType.Geometry||e.numFaces>0&&(t.numFaces=e.numFaces),e.type!==i.EAssetType.Model&&e.type!==i.EAssetType.Image&&e.type!==i.EAssetType.Texture||e.imageSize>0&&(t.imageSize=e.imageSize)}inflate(e,t){t.uri=e.uri,t.mimeType=e.mimeType||"",t.type=i.EAssetType[e.type],t.mapType=i.EMapType[e.mapType],t.byteSize=e.byteSize||0,t.numFaces=e.numFaces||0,t.imageSize=e.imageSize||0,void 0===t.type&&(t.type=this.guessAssetType(),void 0===t.type&&console.warn(`failed to determine asset type from asset: ${t.uri}`))}guessAssetType(){const e=this.data;if(void 0!==e.type&&i.EAssetType[e.type])return e.type;if(e.mimeType){if(e.mimeType===n.mimeType.gltfJson||e.mimeType===n.mimeType.gltfBinary)return i.EAssetType.Model;if(e.mimeType===n.mimeType.imageJpeg||e.mimeType===n.mimeType.imagePng)return i.EAssetType.Image}const t=e.uri.split(".").pop().toLowerCase();return"gltf"===t||"glb"===t?i.EAssetType.Model:"obj"===t||"ply"===t?i.EAssetType.Geometry:"jpg"===t||"png"===t?i.EAssetType.Image:void 0}guessAssetMimeType(){const e=this.data;if(e.mimeType)return e.mimeType;const t=e.uri.split(".").pop().toLowerCase();return"gltf"===t?n.mimeType.gltfJson:"glb"===t?n.mimeType.gltfBinary:"jpg"===t?n.mimeType.imageJpeg:"png"===t?n.mimeType.imagePng:""}}n.mimeType={gltfJson:"model/gltf+json",gltfBinary:"model/gltf-binary",imageJpeg:"image/jpeg",imagePng:"image/png"},t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=new s.Vector3,n=new s.Vector3,o=new s.Vector3,a=new s.Vector3,c=new s.Vector2,l=new s.Vector2;var u;!function(e){e[e.TopRight=0]="TopRight",e[e.TopLeft=1]="TopLeft",e[e.BottomLeft=2]="BottomLeft",e[e.BottomRight=3]="BottomRight"}(u=t.EQuadrant||(t.EQuadrant={}));t.default=class extends s.Object3D{constructor(){super(),this.isHTMLSprite=!0,this.viewAngle=0,this.orientationAngle=0,this.orientationQuadrant=u.TopLeft,this._elements=new Map,this._visible=!0,this.frustumCulled=!1}get visible(){return this._visible}set visible(e){e!==this._visible&&this._elements&&(this._visible=e,this._elements.forEach(t=>{t&&this.setHTMLElementVisible(t,e)}))}dispose(){this._elements.forEach((e,t)=>{e&&t.removeChild(e)}),this._elements.clear()}disposeHTMLElement(e){const t=this._elements.get(e);t&&(this._elements.delete(e),e.removeChild(t))}update(){this._elements.forEach(e=>{e&&this.updateHTMLElement(e)})}renderHTMLElement(e,t,r){r=r||this;let s=this._elements.get(e);if(s||(s=this.createHTMLElement())&&(e.appendChild(s),this._elements.set(e,s)),!s)return null;i.set(0,0,0),i.applyMatrix4(r.modelViewMatrix),n.set(0,1,0),n.applyMatrix4(r.modelViewMatrix),o.copy(n).sub(i).normalize(),a.set(0,0,1),this.viewAngle=o.angleTo(a),i.applyMatrix4(t.projectionMatrix),n.applyMatrix4(t.projectionMatrix),l.set(n.x,n.y),c.set(i.x,i.y),l.sub(c);const u=.5*(n.x+1)*e.clientWidth,d=.5*(1-n.y)*e.clientHeight;s.style.left=u.toString()+"px",s.style.top=d.toString()+"px";const h=this.orientationAngle=l.angle();return this.orientationQuadrant=Math.floor(2*h/Math.PI),s}createHTMLElement(){return null}updateHTMLElement(e){}setHTMLElementVisible(e,t){e.style.display=t?"block":"none"}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(32);var i;!function(e){e[e.Default=0]="Default",e[e.Line=1]="Line",e[e.Balloon=2]="Balloon"}(i=t.EAnnotationStyle||(t.EAnnotationStyle={}));class n extends s.default{static fromJSON(e){return new n(e)}init(){return{id:this.generateId(),title:"New Annotation",lead:"",tags:[],articleId:"",imageUri:"",style:i.Default,visible:!0,expanded:!1,position:null,direction:null,scale:1,offset:0,tilt:0,azimuth:0,zoneIndex:-1}}deflate(e,t){return t.id=e.id,e.title&&(t.title=e.title),e.lead&&(t.lead=e.lead),e.tags.length>0&&(t.tags=e.tags),e.articleId&&(t.articleId=e.articleId),e.imageUri&&(t.imageUri=e.imageUri),e.style!==i.Default&&(t.style=i[e.style]),!1===e.visible&&(t.visible=e.visible),e.position&&(t.position=e.position.slice()),e.direction&&(t.direction=e.direction.slice()),1!==e.scale&&(t.scale=e.scale),0!==e.offset&&(t.offset=e.offset),0!==e.tilt&&(t.tilt=e.tilt),0!==e.azimuth&&(t.azimuth=e.azimuth),e.zoneIndex>-1&&(t.zoneIndex=e.zoneIndex),e}inflate(e,t){t.id=e.id,t.title=e.title||"",t.lead=e.lead||"",t.tags=e.tags||[],t.articleId=e.articleId||"",t.imageUri=e.imageUri||"",t.style=i[e.style]||i.Default,t.visible=void 0===e.visible||e.visible,t.expanded=e.expanded||!1,t.position=e.position.slice(),t.direction=e.direction.slice(),t.scale=void 0!==e.scale?e.scale:1,t.offset=e.offset||0,t.tilt=e.tilt||0,t.azimuth=e.azimuth||0,t.zoneIndex=void 0!==e.zoneIndex?e.zoneIndex:-1}}t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(11),n=r(80),o=r(81);t.Annotation=o.default;const a=new s.Vector3(0,1,0),c=new s.Vector3;t.default=class extends n.default{constructor(e){super(),this.annotation=e,this.matrixAutoUpdate=!1}update(){super.update();const e=this.annotation;this.position.fromArray(e.data.position),c.fromArray(e.data.direction).normalize(),this.quaternion.setFromUnitVectors(a,c),this.updateMatrix()}updateHTMLElement(e){e.performUpdate()}emitClickEvent(){const e={type:"click",annotation:this.annotation,sprite:this};this.dispatchEvent(e)}emitLinkEvent(e){const t={type:"link",annotation:this.annotation,sprite:this,link:e};this.dispatchEvent(t)}};t.AnnotationElement=class extends i.default{constructor(e){super(),this.sprite=e,this.onClick=this.onClick.bind(this),this.onEvent=this.onEvent.bind(this),this.addEventListener("pointerdown",this.onEvent),this.addEventListener("pointermove",this.onEvent),this.addEventListener("pointerup",this.onEvent),this.addEventListener("pointercancel",this.onEvent),this.addEventListener("click",this.onClick)}performUpdate(){super.performUpdate()}firstConnected(){super.firstConnected(),this.classList.add("sv-annotation")}onClick(e){e.stopPropagation(),this.sprite.emitClickEvent()}onEvent(e){e.stopPropagation()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(26),i=r(22),n=r(34),o=r(27),a=r(21);class c extends s.default{get setup(){return this.components.get(n.default,!0)}createComponents(){this.createComponent(i.default),this.createComponent(n.default),this.createComponent(o.default)}fromDocument(e,t,r){const i=e.scenes[t];i.name&&(this.name=i.name),this.scene.fromDocument(e,i);const n=i.nodes;n&&n.forEach(t=>{const i=this.graph.createCustomNode(s.default);this.transform.addChild(i.transform),i.fromDocument(e,t,r)}),isFinite(i.meta)&&(this.meta.fromDocument(e,i),r.set(`meta/${i.meta}`,this.meta)),isFinite(i.setup)&&this.setup.fromDocument(e,t,r);const o=this.getGraphComponents(a.default),c=o[0],l=o[1];c&&(c.ins.shadowEnabled.setValue(!0),c.ins.shadowSize.setValue(1e3)),l&&(l.ins.shadowEnabled.setValue(!0),l.ins.shadowSize.setValue(1e3))}toDocument(e,t,r){e.scenes=e.scenes||[];const i=e.scenes.length,n={units:"cm"};return e.scenes.push(n),this.name&&(n.name=this.name),this.scene.toDocument(e,n),this.transform.children.map(e=>e.node).filter(e=>e.is(s.default)).forEach(s=>{if(s.hasNodeComponents(r)){const i=s.toDocument(e,t,r);n.nodes=n.nodes||[],n.nodes.push(i)}}),r&&!r.setup||(this.meta&&(n.meta=this.meta.toDocument(e,n),t.set(this.meta,`meta/${n.meta}`)),this.setup&&this.setup.toDocument(e,i,t)),i}}c.typeName="NVScene",t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1);class i extends s.default{constructor(){super(...arguments),this.ins=this.addInputs(i.ins),this.outs=this.addOutputs(i.outs)}update(e){return!0}fromData(e){e=e||{},this.ins.setValues({visible:void 0===e.visible||e.visible,logo:void 0===e.logo||e.logo,menu:void 0===e.menu||e.menu,tools:void 0===e.tools||e.tools})}toData(){const e=this.ins;return{visible:e.visible.value,logo:e.logo.value,menu:e.menu.value,tools:e.tools.value}}}i.typeName="CVInterface",i.ins={visible:s.types.Boolean("Interface.Visible",!0),logo:s.types.Boolean("Interface.Logo",!0),menu:s.types.Boolean("Interface.Menu",!0),tools:s.types.Boolean("Interface.Tools",!0)},i.outs={documentTitle:s.types.String("Document.Title")},t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(193),i=r(29),n=r(12),o=r(47);class a extends s.default{constructor(){super(...arguments),this.ins=this.addInputs(a.ins)}get snapshotKeys(){return["shader","exposure","annotationsVisible"]}create(){super.create(),this.graph.components.on(o.default,this.onAnnotationsComponent,this)}dispose(){this.graph.components.off(o.default,this.onAnnotationsComponent,this),super.dispose()}update(e){const t=this.ins;if(t.shader.changed){const e=t.shader.getValidatedValue();this.getGraphComponents(n.default).forEach(t=>t.ins.shader.setValue(e))}if(t.annotationsVisible.changed){const e=t.annotationsVisible.value;this.getGraphComponents(o.default).forEach(t=>t.ins.visible.setValue(e))}return!0}preRender(e){this.updated&&(e.renderer.toneMappingExposure=this.ins.exposure.value)}fromData(e){this.ins.copyValues({shader:i.EShaderMode[e.shader]||i.EShaderMode.Default,exposure:void 0!==e.exposure?e.exposure:1,gamma:void 0!==e.gamma?e.gamma:1,annotationsVisible:!!e.annotationsVisible})}toData(){const e=this.ins;return{shader:i.EShaderMode[e.shader.value],exposure:e.exposure.value,gamma:e.gamma.value,annotationsVisible:e.annotationsVisible.value}}onAnnotationsComponent(e){e.add&&e.object.ins.visible.setValue(this.ins.annotationsVisible.value)}}a.typeName="CVViewer",a.ins={shader:s.types.Enum("Renderer.Shader",i.EShaderMode),exposure:s.types.Number("Renderer.Exposure",1),gamma:s.types.Number("Renderer.Gamma",1),annotationsVisible:s.types.Boolean("Annotations.Visible")},t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(1),n=r(59),o=r(17),a=r(22),c=r(194),l=(new s.Vector3,[]);l[c.EViewPreset.Left]=[0,-90,0],l[c.EViewPreset.Right]=[0,90,0],l[c.EViewPreset.Front]=[0,0,0],l[c.EViewPreset.Back]=[0,180,0],l[c.EViewPreset.Top]=[-90,0,0],l[c.EViewPreset.Bottom]=[90,0,0];const u=function(e,t){for(let r=0,s=e.length;r<s;++r)e[r]=null===e[r]?t:e[r];return e};class d extends c.default{constructor(e,t){super(e,t),this.ins=this.addInputs(d.ins),this._controller=new n.default,this._scene=null,this._modelBoundingBox=null,this._scene=this.scene}get snapshotKeys(){return["orbit","offset"]}update(){const e=this.ins,t=this._controller,r=this._scene.activeCameraComponent,s=r?r.camera:null,{projection:i,preset:n,orbit:o,offset:u}=e;if(r&&i.changed&&(s.setProjection(i.getValidatedValue()),r.ins.projection.setValue(i.value,!0)),n.changed&&n.value!==c.EViewPreset.None&&o.setValue(l[n.getValidatedValue()].slice()),s&&e.zoomExtents.changed&&(this._modelBoundingBox=this.getComponent(a.default).modelBoundingBox,t.zoomExtents(this._modelBoundingBox)),e.includeLights.changed){const e=this.getLightTransform();e&&e.ins.rotation.reset()}const{minOrbit:d,minOffset:h,maxOrbit:p,maxOffset:m}=e;return(o.changed||u.changed)&&(t.orbit.fromArray(o.value),t.offset.fromArray(u.value)),(d.changed||h.changed||p.changed||m.changed)&&(t.minOrbit.fromArray(d.value),t.minOffset.fromArray(h.value),t.maxOrbit.fromArray(p.value),t.maxOffset.fromArray(m.value)),!0}tick(){const e=this.ins,t=this._scene.activeCameraComponent;if(!e.enabled.value||!t)return;const r=this._controller;r.camera=t.camera;const s=t.transform,i=this.changed;if(r.updateCamera(s.object3D,i)){if(r.orbit.toArray(e.orbit.value),e.orbit.set(!0),r.offset.toArray(e.offset.value),e.offset.set(!0),e.preset.value===c.EViewPreset.None||e.preset.changed||e.preset.setValue(c.EViewPreset.None,!0),s?s.setPropertiesFromMatrix():t.setPropertiesFromMatrix(),e.includeLights.value){const e=this.getLightTransform();if(e){e.ins.order.setValue(o.ERotationOrder.YXZ);const t=e.ins.rotation;t.value[1]=r.orbit.y,t.set()}}return!0}return!1}preRender(e){this._modelBoundingBox&&e.viewport.zoomExtents(this._modelBoundingBox)}tock(){this._modelBoundingBox=null}fromData(e){e=e||{},super.fromData(e);const t=e.orbit||{orbit:[-25,-25,0],offset:[0,0,100],minOrbit:[-90,-1/0,-1/0],minOffset:[-1/0,-1/0,.1],maxOrbit:[90,1/0,1/0],maxOffset:[1/0,1/0,1/0]};this.ins.copyValues({orbit:t.orbit,offset:t.offset,minOrbit:u(t.minOrbit,-1/0),maxOrbit:u(t.maxOrbit,1/0),minOffset:u(t.minOffset,-1/0),maxOffset:u(t.maxOffset,1/0)})}toData(){const e=this.ins,t=super.toData();return t.type="Orbit",t.orbit={orbit:e.orbit.cloneValue(),offset:e.offset.cloneValue(),minOrbit:e.minOrbit.cloneValue(),maxOrbit:e.maxOrbit.cloneValue(),minOffset:e.minOffset.cloneValue(),maxOffset:e.maxOffset.cloneValue()},t}getLightTransform(){const e=this.graph.findNodeByName("Lights");return e&&e.getComponent(o.default,!0)}onPointer(e){const t=e.viewport;t.camera||this.ins.enabled.value&&this._scene.activeCameraComponent&&(this._controller.setViewportSize(t.width,t.height),this._controller.onPointer(e),e.stopPropagation=!0)}onTrigger(e){const t=e.viewport;t.camera||this.ins.enabled.value&&this._scene.activeCameraComponent&&(this._controller.setViewportSize(t.width,t.height),this._controller.onTrigger(e),e.stopPropagation=!0)}}d.typeName="CVOrbitNavigation",d.ins={orbit:i.types.Vector3("Manip.Orbit",[-25,-25,0]),offset:i.types.Vector3("Manip.Offset",[0,0,100]),minOrbit:i.types.Vector3("Manip.Min.Orbit",[-90,-1/0,-1/0]),minOffset:i.types.Vector3("Manip.Min.Offset",[-1/0,-1/0,.1]),maxOrbit:i.types.Vector3("Manip.Max.Orbit",[90,1/0,1/0]),maxOffset:i.types.Vector3("Manip.Max.Offset",[1/0,1/0,1/0])},t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(195);class i extends s.default{get snapshotKeys(){return["color0","color1"]}fromData(e){this.ins.copyValues({style:s.EBackgroundStyle[e.style]||s.EBackgroundStyle.Solid,color0:e.color0||[.2,.25,.3],color1:e.color1||[.01,.03,.05]})}toData(){const e=this.ins;return{style:s.EBackgroundStyle[e.style.value],color0:e.color0.cloneValue(),color1:e.color1.cloneValue()}}}i.typeName="CVBackground",t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(197);class i extends s.default{constructor(e,t){super(e,t),this.ins.visible.setValue(!1),this.ins.receiveShadow.setValue(!0)}get snapshotKeys(){return["opacity"]}fromData(e){e=e||{},this.ins.copyValues({visible:!!e.visible,position:e.position||[0,-25,0],radius:void 0!==e.size?e.size:50,color:e.color||[.6,.75,.8],opacity:void 0!==e.opacity?e.opacity:.5,receiveShadow:!!e.receiveShadow})}toData(){const e=this.ins;return{visible:e.visible.value,position:e.position.cloneValue(),size:e.radius.value,color:e.color.cloneValue(),opacity:e.opacity.value,receiveShadow:e.receiveShadow.value}}}i.typeName="CVFloor",t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(201),n=r(1),o=r(9),a=r(33),c=r(22),l=new s.Vector3,u=(new s.Matrix4).makeRotationX(.5*Math.PI),d=new s.Matrix4;class h extends o.default{constructor(){super(...arguments),this.ins=this.addInputs(h.gridIns),this.outs=this.addOutputs(h.gridOuts),this._lastViewport=null,this._gridProps={size:20,mainDivisions:2,subDivisions:10,mainColor:new s.Color(.5,.7,.8),subColor:new s.Color(.25,.35,.4)}}get snapshotKeys(){return["opacity"]}get grid(){return this.object3D}get rootScene(){return this.getGraphComponent(c.default)}create(){this.ins.pickable.setValue(!1),this.ins.visible.setValue(!1),super.create()}activate(){this.rootScene.on("bounding-box",this.onModelBoundingBox,this)}deactivate(){this.rootScene.off("bounding-box",this.onModelBoundingBox,this)}update(){const e=this.ins;if(e.color.changed||e.update.changed){const t=this._gridProps;if(e.color.changed){const r=t.mainColor,s=t.subColor;r.fromArray(e.color.value),s.r=.5*r.r,s.g=.5*r.g,s.b=.5*r.b}if(e.update.changed){const e=this.rootScene.modelBoundingBox,r=this.rootScene.ins.units.value;e.getSize(l);let s=Math.max(l.x,l.y,l.z);for(s=2*Math.ceil(s),t.size=s,this.outs.size.setValue(s),this.outs.units.setValue(r);s>100;)s*=.1;t.mainDivisions=s,t.subDivisions=10}this.object3D?this.grid.update(t):this.object3D=new i.default(t)}return e.visible.changed&&(this.grid.visible=e.visible.value),!0}preRender(e){const t=e.viewport,r=this.object3D;if(t!==this._lastViewport){this._lastViewport=t;const s=e.viewport.camera;s?r.matrix.extractRotation(s.matrixWorld).multiply(u):r.matrix.extractRotation(d),r.updateMatrixWorld(!0)}}postRender(e){this.object3D.matrix.extractRotation(d)}fromData(e){e=e||{},this.ins.copyValues({visible:!!e.visible,color:e.color||[.5,.7,.8]})}toData(){const e=this.ins;return{visible:e.visible.cloneValue(),color:e.color.cloneValue()}}onModelBoundingBox(){this.ins.update.set()}}h.typeName="CVGrid",h.gridIns={color:n.types.ColorRGB("Grid.Color",[.5,.7,.8]),opacity:n.types.Percent("Grid.Opacity",1),update:n.types.Event("Grid.Update")},h.gridOuts={size:n.types.Number("Size"),units:n.types.Enum("Units",a.EUnitType)},t.default=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(9),n=r(202),o=r(12),a=new s.Matrix3,c=new s.Vector3,l=new s.Vector3,u=new s.Vector3(0,1,0);var d;!function(e){e[e.SetStart=0]="SetStart",e[e.SetEnd=1]="SetEnd"}(d=t.ETapeState||(t.ETapeState={}));class h extends i.default{constructor(e,t){super(e,t),this.ins=this.addInputs(h.tapeIns),this.outs=this.addOutputs(h.tapeOuts),this.startPin=null,this.endPin=null,this.line=null,this.object3D=new s.Group,this.startPin=new n.default,this.startPin.visible=!1,this.endPin=new n.default,this.endPin.visible=!1;const r=new s.Geometry;r.vertices.push(new s.Vector3(0,0,0),new s.Vector3(0,0,0));const i=new s.LineBasicMaterial;i.depthTest=!1,i.transparent=!0,this.line=new s.Line(r,i),this.line.visible=!1,this.object3D.add(this.startPin,this.endPin,this.line)}get snapshotKeys(){return["startPosition","startDirection","endPosition","endDirection"]}update(e){super.update(e);const t=this.ins,r=this.line.geometry;if(t.visible.changed&&(t.visible.value?this.system.on("pointer-up",this.onPointerUp,this):this.system.off("pointer-up",this.onPointerUp,this)),t.startPosition.changed||t.startDirection.changed){const e=this.startPin;e.position.fromArray(t.startPosition.value),c.fromArray(t.startDirection.value),e.quaternion.setFromUnitVectors(u,c),e.updateMatrix(),r.vertices[0].copy(e.position),r.verticesNeedUpdate=!0}if(t.endPosition.changed||t.endDirection.changed){const e=this.endPin;e.position.fromArray(t.endPosition.value),c.fromArray(t.endDirection.value),e.quaternion.setFromUnitVectors(u,c),e.updateMatrix(),r.vertices[1].copy(e.position),r.verticesNeedUpdate=!0}return c.fromArray(t.startPosition.value),l.fromArray(t.endPosition.value),this.outs.distance.setValue(c.distanceTo(l)),!0}fromData(e){this.ins.copyValues({visible:e.enabled,startPosition:e.startPosition,startDirection:e.startDirection,endPosition:e.endPosition,endDirection:e.endDirection})}toData(){const e=this.ins;return{enabled:e.visible.cloneValue(),startPosition:e.startPosition.cloneValue(),startDirection:e.startDirection.cloneValue(),endPosition:e.endPosition.cloneValue(),endDirection:e.endDirection.cloneValue()}}onPointerUp(e){if(e.isDragging||!e.component||!e.component.is(o.default))return;const t=e.component.object3D.matrixWorld;a.getNormalMatrix(t);const r=e.view.pickPosition(e).applyMatrix4(t),s=e.view.pickNormal(e).applyMatrix3(a).normalize(),{startPin:i,endPin:n,line:c,ins:l,outs:u}=this;u.state.value===d.SetStart?(r.toArray(l.startPosition.value),s.toArray(l.startDirection.value),l.startPosition.set(),l.startDirection.set(),i.visible=!0,n.visible=!1,c.visible=!1,u.state.setValue(d.SetEnd)):(r.toArray(l.endPosition.value),s.toArray(l.endDirection.value),l.endPosition.set(),l.endDirection.set(),i.visible=!0,n.visible=!0,c.visible=!0,u.state.setValue(d.SetStart))}}h.typeName="CVTape",h.tapeIns={startPosition:i.types.Vector3("Start.Position"),startDirection:i.types.Vector3("Start.Direction"),endPosition:i.types.Vector3("End.Position"),endDirection:i.types.Vector3("End.Direction")},h.tapeOuts={state:i.types.Enum("Tape.State",d),distance:i.types.Number("Tape.Distance")},t.default=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1),i=r(29),n=r(22),o=r(12),a=[[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[1,0,0,0],[0,1,0,0],[0,0,1,0]];class c extends s.default{constructor(){super(...arguments),this.ins=this.addInputs(c.ins),this.plane=null,this.axisIndex=-1}get snapshotKeys(){return["enabled","axis","position","inverted"]}update(e){const t=this.ins;if(t.axis.changed){const e=t.axis.getValidatedValue();e===this.axisIndex?t.inverted.setValue(!t.inverted.value):(t.inverted.setValue(!1),this.axisIndex=e)}if(!t.enabled.value&&!t.enabled.changed)return!1;const r=t.axis.getValidatedValue(),s=t.inverted.value,i=r+(s?3:0),c=this.getComponent(n.default).modelBoundingBox;if(!c)return!0;this.plane=a[i];const l=c.min.getComponent(r),u=c.max.getComponent(r),d=1-t.position.value;return this.plane[3]=s?d*(u-l)-u:u-d*(u-l),this.getGraphComponents(o.default).forEach(e=>{e.object3D.traverse(e=>{if(e.isMesh){const t=e.material;t.isUberPBRMaterial&&this.updateMaterial(t)}})}),!0}fromData(e){e=e||{},this.ins.setValues({enabled:e.enabled||!1,axis:i.ESliceAxis[e.axis]||i.ESliceAxis.X,position:e.position||0,inverted:e.inverted||!1})}toData(){const e=this.ins;return{enabled:e.enabled.value,axis:i.ESliceAxis[e.axis.getValidatedValue()],position:e.position.value,inverted:e.inverted.value}}updateMaterial(e){const t=this.ins;t.enabled.changed&&(e.enableCutPlane(t.enabled.value),e.needsUpdate=!0),e.cutPlaneDirection.fromArray(this.plane),e.cutPlaneColor.fromArray(t.color.value)}}c.typeName="CVSlicer",c.ins={enabled:s.types.Boolean("Slice.Enabled"),axis:s.types.Enum("Slice.Axis",i.ESliceAxis),position:s.types.Number("Slice.Position",{min:0,max:1,preset:.5}),inverted:s.types.Boolean("Slice.Inverted"),color:s.types.ColorRGB("Slice.Color",[0,.61,.87])},t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1),i=r(40);class n extends s.default{constructor(){super(...arguments),this.ins=this.addInputs(n.ins),this.outs=this.addOutputs(n.outs),this._tours=[]}get tours(){return this._tours}get activeSteps(){const e=this.activeTour;return e?e.steps:null}get activeTour(){return this._tours[this.outs.tourIndex.value]}get activeStep(){const e=this.activeTour;return e?e.steps[this.outs.stepIndex.value]:null}get tweenMachine(){return this.getComponent(i.default)}dispose(){super.dispose()}update(){const{ins:e,outs:t}=this,r=this._tours;if(!e.enabled.value)return e.enabled.changed&&t.tourIndex.set(),!1;const s=this.tweenMachine,i=Math.min(r.length-1,Math.max(-1,e.tourIndex.value)),n=r[i],o=n?n.steps.length:0;let a=-1;if((e.tourIndex.changed||e.enabled.changed)&&(i!==t.tourIndex.value&&(a=0),t.tourIndex.setValue(i),t.tourTitle.setValue(n?n.title:""),t.tourLead.setValue(n?n.lead:"")),0===o)return t.stepIndex.setValue(-1),t.stepTitle.setValue(""),!0;let c=!0;if(e.stepIndex.changed&&(a=Math.min(n.steps.length-1,Math.max(0,e.stepIndex.value)),c=!1),e.first.changed&&(a=0),e.next.changed&&(a=(t.stepIndex.value+1)%o),e.previous.changed&&(a=(t.stepIndex.value-1)%o),a>=0){const e=n.steps[a];t.stepIndex.setValue(a),t.stepCount.setValue(o),t.stepTitle.setValue(e.title),s.ins.id.setValue(e.id),c?s.ins.tween.set():s.ins.recall.set()}return!0}fromData(e){this._tours=e.map(e=>({title:e.title,steps:e.steps,lead:e.lead||"",tags:e.tags||[]})),this.ins.tourIndex.setValue(-1)}toData(){return 0===this._tours.length?null:this._tours.map(e=>{const t={title:e.title,steps:e.steps};return e.lead&&(t.lead=e.lead),e.tags.length>0&&(t.tags=e.tags),t})}}n.typeName="CVTours",n.ins={enabled:s.types.Boolean("Tours.Enabled"),tourIndex:s.types.Integer("Tours.Index",-1),stepIndex:s.types.Integer("Step.Index"),next:s.types.Event("Step.Next"),previous:s.types.Event("Step.Previous"),first:s.types.Event("Step.First")},n.outs={tourIndex:s.types.Integer("Tour.Index",-1),tourTitle:s.types.String("Tour.Title"),tourLead:s.types.String("Tour.Lead"),stepCount:s.types.Integer("Tour.Steps"),stepIndex:s.types.Integer("Step.Index"),stepTitle:s.types.String("Step.Title")},t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(40),i=r(21),n=r(34),o=r(12);class a extends s.default{constructor(){super(...arguments),this.targetFeatures={}}create(){super.create();const e=this.getGraphComponent(n.default);Object.keys(e.featureMap).forEach(e=>{this.targetFeatures[e]=!1}),this.targetFeatures.models=!1,this.targetFeatures.lights=!1,this.initializeTargetFeatures()}initializeTargetFeatures(){const e=this.targetFeatures;Object.keys(e).forEach(t=>e[t]=!1),e.navigation=!0,e.reader=!0,this.updateTargets()}updateTargets(){const e=this.targetFeatures,t=this.getGraphComponent(n.default);Object.keys(e).forEach(r=>{const s=t[r],i=e[r];s&&this.updateComponentTarget(s,i)}),this.getGraphComponents(o.default).forEach(t=>this.updateComponentTarget(t.transform,!!e.models)),this.getGraphComponents(i.default).forEach(t=>this.updateComponentTarget(t,!!e.lights)),this.targets.forEach((e,t)=>{const r=e.property.group.linkable;console.log("CVSnapshot.updateTargets - target #%s, component: %s, property: %s",t,r.displayName,e.property.path)})}updateComponentTarget(e,t){const r=e.snapshotKeys;r&&r.forEach(r=>{const s=e.ins[r];if(!s)throw new Error(`property '${r}' not found in component '${e.displayName}'`);if(!s.schema.event&&"object"!==s.type){const e=this.hasTargetProperty(s);t&&!e?this.addTargetProperty(s):!t&&e&&this.removeTargetProperty(s)}})}fromData(e,t){this.clear();const r=this.targetFeatures,i=Object.keys(r);e.features?i.forEach(t=>r[t]=e.features.indexOf(t)>=0):this.initializeTargetFeatures();const n=new Set;e.targets.forEach((e,r)=>{const s=e.lastIndexOf("/"),i=e.substr(0,s),o=e.substr(s+1),a=t.get(i),c=a?a.ins[o]:null;c?this.addTargetProperty(c):(console.warn(`missing snapshot target property for '${e}'`),n.add(r))}),e.states.forEach(e=>{this.setState({id:e.id,curve:void 0!==e.curve?s.EEasingCurve[e.curve]:s.EEasingCurve.EaseQuad,duration:void 0!==e.duration?e.duration:2,threshold:void 0!==e.threshold?e.threshold:.5,values:e.values.filter((e,t)=>!n.has(t))})})}toData(e){const t=this.targetFeatures,r={features:Object.keys(t).filter(e=>t[e]),targets:this.targets.map(t=>{const r=t.property.group.linkable,s=t.property.key;return e.get(r)+"/"+s}),states:Object.keys(this.states).map(e=>{const t=this.states[e],r={id:t.id,values:t.values};return t.curve!==s.EEasingCurve.EaseQuad&&(r.curve=s.EEasingCurve[t.curve]),2!==t.duration&&(r.duration=t.duration),.5!==t.threshold&&(r.threshold=t.threshold),r})};return r.targets.length>0&&r.states.length>0?r:null}}a.typeName="CVSnapshots",t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(8),i=r(38),n=r(31),o=r(64),a=r(63),c=r(16);class l extends s.default{get pulse(){return this.components.get(i.default)}get renderer(){return this.components.get(n.default)}get fullscreen(){return this.components.get(a.default)}get selection(){return this.components.get(o.default)}get assetReader(){return this.components.get(c.default)}createComponents(){this.createComponent(i.default),this.createComponent(n.default),this.createComponent(a.default),this.createComponent(c.default),this.createComponent(o.default).ins.viewportBrackets.setValue(!1)}}l.typeName="NVEngine",t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(8),i=r(25),n=r(35),o=r(96);class a extends s.default{get scene(){return this.components.get(i.default)}get documentProvider(){return this.components.get(n.default)}get nodeProvider(){return this.components.get(o.default)}createComponents(){this.createComponent(i.default,"Master Scene"),this.createComponent(n.default),this.createComponent(o.default)}}a.typeName="NVDocuments",t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1),i=r(62),n=r(26),o=r(35);class a extends i.default{constructor(e,t){super(e,t),this.outs=this.addOutputs(a.outs),this.scope=i.ENodeScope.Graph}get documentProvider(){return this.getComponent(o.default)}create(){super.create(),this.documentProvider.on("active-component",this.onActiveDocument,this)}dispose(){this.documentProvider.off("active-component",this.onActiveDocument,this),super.dispose()}onActiveDocument(e){this.scopedGraph=e.next}onActiveNode(e,t){this.outs.activeNode.setValue(t);const r=this.selection;t?r.nodeContainsSelectedComponent(t)||r.selectNode(t):e&&r.clearSelection()}onScopedNodes(){this.outs.changedNodes.set()}}a.typeName="CVNodeProvider",a.nodeType=n.default,a.followComponentSelection=!0,a.outs={activeNode:s.types.Object("Nodes.Active",n.default),changedNodes:s.types.Event("Nodes.Changed")},t.default=a},function(e,t,r){"use strict";r.r(t);var s=r(3),i=r(7),n=r(2);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const o=133;function a(e,t){const{element:{content:r},parts:s}=e,i=document.createTreeWalker(r,o,null,!1);let n=l(s),a=s[n],c=-1,u=0;const d=[];let h=null;for(;i.nextNode();){c++;const e=i.currentNode;for(e.previousSibling===h&&(h=null),t.has(e)&&(d.push(e),null===h&&(h=e)),null!==h&&u++;void 0!==a&&a.index===c;)a.index=null!==h?-1:a.index-u,a=s[n=l(s,n)]}d.forEach(e=>e.parentNode.removeChild(e))}const c=e=>{let t=11===e.nodeType?0:1;const r=document.createTreeWalker(e,o,null,!1);for(;r.nextNode();)t++;return t},l=(e,t=-1)=>{for(let r=t+1;r<e.length;r++){const t=e[r];if(Object(n.d)(t))return r}return-1};var u=r(15),d=r(13),h=r(18),p=r(10);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const m=(e,t)=>`${e}--${t}`;let f=!0;void 0===window.ShadyCSS?f=!1:void 0===window.ShadyCSS.prepareTemplateDom&&(console.warn("Incompatible ShadyCSS version detected.Please update to at least @webcomponents/webcomponentsjs@2.0.2 and@webcomponents/shadycss@1.3.1."),f=!1);const v=e=>t=>{const r=m(t.type,e);let s=d.a.get(r);void 0===s&&(s={stringsArray:new WeakMap,keyString:new Map},d.a.set(r,s));let i=s.stringsArray.get(t.strings);if(void 0!==i)return i;const o=t.strings.join(n.f);if(void 0===(i=s.keyString.get(o))){const r=t.getTemplateElement();f&&window.ShadyCSS.prepareTemplateDom(r,e),i=new n.a(t,r),s.keyString.set(o,i)}return s.stringsArray.set(t.strings,i),i},g=["html","svg"],y=new Set,b=(e,t,r)=>{y.add(r);const s=e.querySelectorAll("style");if(0===s.length)return void window.ShadyCSS.prepareTemplateStyles(t.element,r);const i=document.createElement("style");for(let e=0;e<s.length;e++){const t=s[e];t.parentNode.removeChild(t),i.textContent+=t.textContent}if((e=>{g.forEach(t=>{const r=d.a.get(m(t,e));void 0!==r&&r.keyString.forEach(e=>{const{element:{content:t}}=e,r=new Set;Array.from(t.querySelectorAll("style")).forEach(e=>{r.add(e)}),a(e,r)})})})(r),function(e,t,r=null){const{element:{content:s},parts:i}=e;if(null==r)return void s.appendChild(t);const n=document.createTreeWalker(s,o,null,!1);let a=l(i),u=0,d=-1;for(;n.nextNode();)for(d++,n.currentNode===r&&(u=c(t),r.parentNode.insertBefore(t,r));-1!==a&&i[a].index===d;){if(u>0){for(;-1!==a;)i[a].index+=u,a=l(i,a);return}a=l(i,a)}}(t,i,t.element.content.firstChild),window.ShadyCSS.prepareTemplateStyles(t.element,r),window.ShadyCSS.nativeShadow){const r=t.element.content.querySelector("style");e.insertBefore(r.cloneNode(!0),e.firstChild)}else{t.element.content.insertBefore(i,t.element.content.firstChild);const e=new Set;e.add(i),a(t,e)}};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
window.JSCompiler_renameProperty=((e,t)=>e);const E={toAttribute(e,t){switch(t){case Boolean:return e?"":null;case Object:case Array:return null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){switch(t){case Boolean:return null!==e;case Number:return null===e?null:Number(e);case Object:case Array:return JSON.parse(e)}return e}},_=(e,t)=>t!==e&&(t==t||e==e),w={attribute:!0,type:String,converter:E,reflect:!1,hasChanged:_},S=Promise.resolve(!0),P=1,x=4,C=8,T=16,A=32;class M extends HTMLElement{constructor(){super(),this._updateState=0,this._instanceProperties=void 0,this._updatePromise=S,this._hasConnectedResolver=void 0,this._changedProperties=new Map,this._reflectingProperties=void 0,this.initialize()}static get observedAttributes(){this.finalize();const e=[];return this._classProperties.forEach((t,r)=>{const s=this._attributeNameForProperty(r,t);void 0!==s&&(this._attributeToPropertyMap.set(s,r),e.push(s))}),e}static _ensureClassProperties(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_classProperties",this))){this._classProperties=new Map;const e=Object.getPrototypeOf(this)._classProperties;void 0!==e&&e.forEach((e,t)=>this._classProperties.set(t,e))}}static createProperty(e,t=w){if(this._ensureClassProperties(),this._classProperties.set(e,t),t.noAccessor||this.prototype.hasOwnProperty(e))return;const r="symbol"==typeof e?Symbol():`__${e}`;Object.defineProperty(this.prototype,e,{get(){return this[r]},set(t){const s=this[e];this[r]=t,this._requestUpdate(e,s)},configurable:!0,enumerable:!0})}static finalize(){if(this.hasOwnProperty(JSCompiler_renameProperty("finalized",this))&&this.finalized)return;const e=Object.getPrototypeOf(this);if("function"==typeof e.finalize&&e.finalize(),this.finalized=!0,this._ensureClassProperties(),this._attributeToPropertyMap=new Map,this.hasOwnProperty(JSCompiler_renameProperty("properties",this))){const e=this.properties,t=[...Object.getOwnPropertyNames(e),..."function"==typeof Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e):[]];for(const r of t)this.createProperty(r,e[r])}}static _attributeNameForProperty(e,t){const r=t.attribute;return!1===r?void 0:"string"==typeof r?r:"string"==typeof e?e.toLowerCase():void 0}static _valueHasChanged(e,t,r=_){return r(e,t)}static _propertyValueFromAttribute(e,t){const r=t.type,s=t.converter||E,i="function"==typeof s?s:s.fromAttribute;return i?i(e,r):e}static _propertyValueToAttribute(e,t){if(void 0===t.reflect)return;const r=t.type,s=t.converter;return(s&&s.toAttribute||E.toAttribute)(e,r)}initialize(){this._saveInstanceProperties(),this._requestUpdate()}_saveInstanceProperties(){this.constructor._classProperties.forEach((e,t)=>{if(this.hasOwnProperty(t)){const e=this[t];delete this[t],this._instanceProperties||(this._instanceProperties=new Map),this._instanceProperties.set(t,e)}})}_applyInstanceProperties(){this._instanceProperties.forEach((e,t)=>this[t]=e),this._instanceProperties=void 0}connectedCallback(){this._updateState=this._updateState|A,this._hasConnectedResolver&&(this._hasConnectedResolver(),this._hasConnectedResolver=void 0)}disconnectedCallback(){}attributeChangedCallback(e,t,r){t!==r&&this._attributeToProperty(e,r)}_propertyToAttribute(e,t,r=w){const s=this.constructor,i=s._attributeNameForProperty(e,r);if(void 0!==i){const e=s._propertyValueToAttribute(t,r);if(void 0===e)return;this._updateState=this._updateState|C,null==e?this.removeAttribute(i):this.setAttribute(i,e),this._updateState=this._updateState&~C}}_attributeToProperty(e,t){if(this._updateState&C)return;const r=this.constructor,s=r._attributeToPropertyMap.get(e);if(void 0!==s){const e=r._classProperties.get(s)||w;this._updateState=this._updateState|T,this[s]=r._propertyValueFromAttribute(t,e),this._updateState=this._updateState&~T}}_requestUpdate(e,t){let r=!0;if(void 0!==e){const s=this.constructor,i=s._classProperties.get(e)||w;s._valueHasChanged(this[e],t,i.hasChanged)?(this._changedProperties.has(e)||this._changedProperties.set(e,t),!0!==i.reflect||this._updateState&T||(void 0===this._reflectingProperties&&(this._reflectingProperties=new Map),this._reflectingProperties.set(e,i))):r=!1}!this._hasRequestedUpdate&&r&&this._enqueueUpdate()}requestUpdate(e,t){return this._requestUpdate(e,t),this.updateComplete}async _enqueueUpdate(){let e,t;this._updateState=this._updateState|x;const r=this._updatePromise;this._updatePromise=new Promise((r,s)=>{e=r,t=s});try{await r}catch(e){}this._hasConnected||await new Promise(e=>this._hasConnectedResolver=e);try{const e=this.performUpdate();null!=e&&await e}catch(e){t(e)}e(!this._hasRequestedUpdate)}get _hasConnected(){return this._updateState&A}get _hasRequestedUpdate(){return this._updateState&x}get hasUpdated(){return this._updateState&P}performUpdate(){this._instanceProperties&&this._applyInstanceProperties();let e=!1;const t=this._changedProperties;try{(e=this.shouldUpdate(t))&&this.update(t)}catch(t){throw e=!1,t}finally{this._markUpdated()}e&&(this._updateState&P||(this._updateState=this._updateState|P,this.firstUpdated(t)),this.updated(t))}_markUpdated(){this._changedProperties=new Map,this._updateState=this._updateState&~x}get updateComplete(){return this._updatePromise}shouldUpdate(e){return!0}update(e){void 0!==this._reflectingProperties&&this._reflectingProperties.size>0&&(this._reflectingProperties.forEach((e,t)=>this._propertyToAttribute(t,this[t],e)),this._reflectingProperties=void 0)}updated(e){}firstUpdated(e){}}M.finalized=!0;
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const R=e=>t=>"function"==typeof t?((e,t)=>(window.customElements.define(e,t),t))(e,t):((e,t)=>{const{kind:r,elements:s}=t;return{kind:r,elements:s,finisher(t){window.customElements.define(e,t)}}})(e,t),O=(e,t)=>"method"!==t.kind||!t.descriptor||"value"in t.descriptor?{kind:"field",key:Symbol(),placement:"own",descriptor:{},initializer(){"function"==typeof t.initializer&&(this[t.key]=t.initializer.call(this))},finisher(r){r.createProperty(t.key,e)}}:Object.assign({},t,{finisher(r){r.createProperty(t.key,e)}}),D=(e,t,r)=>{t.constructor.createProperty(r,e)};function j(e){return(t,r)=>void 0!==r?D(e,t,r):O(e,t)}function L(e){return(t,r)=>{const s={get(){return this.renderRoot.querySelector(e)},enumerable:!0,configurable:!0};return void 0!==r?I(s,t,r):k(s,t)}}function N(e){return(t,r)=>{const s={get(){return this.renderRoot.querySelectorAll(e)},enumerable:!0,configurable:!0};return void 0!==r?I(s,t,r):k(s,t)}}const I=(e,t,r)=>{Object.defineProperty(t,r,e)},k=(e,t)=>({kind:"method",placement:"prototype",key:t.key,descriptor:e}),V=e=>(t,r)=>void 0!==r?((e,t,r)=>{Object.assign(t[r],e)})(e,t,r):((e,t)=>Object.assign({},t,{finisher(r){Object.assign(r.prototype[t.key],e)}}))(e,t),F="adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,U=Symbol();class H{constructor(e,t){if(t!==U)throw new Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e}get styleSheet(){return void 0===this._styleSheet&&(F?(this._styleSheet=new CSSStyleSheet,this._styleSheet.replaceSync(this.cssText)):this._styleSheet=null),this._styleSheet}toString(){return this.cssText}}const B=e=>new H(String(e),U),$=(e,...t)=>{const r=t.reduce((t,r,s)=>t+(e=>{if(e instanceof H)return e.cssText;throw new Error(`Value passed to 'css' function must be a 'css' function result: ${e}. Use 'unsafeCSS' to pass non-literal values, but\n            take care to ensure page security.`)})(r)+e[s+1],e[0]);return new H(r,U)};r.d(t,"LitElement",function(){return G}),r.d(t,"defaultConverter",function(){return E}),r.d(t,"notEqual",function(){return _}),r.d(t,"UpdatingElement",function(){return M}),r.d(t,"customElement",function(){return R}),r.d(t,"property",function(){return j}),r.d(t,"query",function(){return L}),r.d(t,"queryAll",function(){return N}),r.d(t,"eventOptions",function(){return V}),r.d(t,"html",function(){return s.html}),r.d(t,"svg",function(){return s.svg}),r.d(t,"TemplateResult",function(){return s.TemplateResult}),r.d(t,"SVGTemplateResult",function(){return s.SVGTemplateResult}),r.d(t,"supportsAdoptingStyleSheets",function(){return F}),r.d(t,"CSSResult",function(){return H}),r.d(t,"unsafeCSS",function(){return B}),r.d(t,"css",function(){return $}),
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
(window.litElementVersions||(window.litElementVersions=[])).push("2.0.1");const z=e=>e.flat?e.flat(1/0):function e(t,r=[]){for(let s=0,i=t.length;s<i;s++){const i=t[s];Array.isArray(i)?e(i,r):r.push(i)}return r}(e);class G extends M{static finalize(){super.finalize(),this._styles=this.hasOwnProperty(JSCompiler_renameProperty("styles",this))?this._getUniqueStyles():this._styles||[]}static _getUniqueStyles(){const e=this.styles,t=[];if(Array.isArray(e)){z(e).reduceRight((e,t)=>(e.add(t),e),new Set).forEach(e=>t.unshift(e))}else e&&t.push(e);return t}initialize(){super.initialize(),this.renderRoot=this.createRenderRoot(),window.ShadowRoot&&this.renderRoot instanceof window.ShadowRoot&&this.adoptStyles()}createRenderRoot(){return this.attachShadow({mode:"open"})}adoptStyles(){const e=this.constructor._styles;0!==e.length&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow?F?this.renderRoot.adoptedStyleSheets=e.map(e=>e.styleSheet):this._needsShimAdoptedStyleSheets=!0:window.ShadyCSS.ScopingShim.prepareAdoptedCssText(e.map(e=>e.cssText),this.localName))}connectedCallback(){super.connectedCallback(),this.hasUpdated&&void 0!==window.ShadyCSS&&window.ShadyCSS.styleElement(this)}update(e){super.update(e);const t=this.render();t instanceof s.TemplateResult&&this.constructor.render(t,this.renderRoot,{scopeName:this.localName,eventContext:this}),this._needsShimAdoptedStyleSheets&&(this._needsShimAdoptedStyleSheets=!1,this.constructor._styles.forEach(e=>{const t=document.createElement("style");t.textContent=e.cssText,this.renderRoot.appendChild(t)}))}render(){}}G.finalized=!0,G.render=((e,t,r)=>{const s=r.scopeName,n=u.a.has(t),o=t instanceof ShadowRoot&&f&&e instanceof p.b,a=o&&!y.has(s),c=a?document.createDocumentFragment():t;if(Object(u.b)(e,c,Object.assign({templateFactory:v(s)},r)),a){const e=u.a.get(c);u.a.delete(c),e.value instanceof h.a&&b(c,e.value.template,s),Object(i.b)(t,t.firstChild),t.appendChild(c),u.a.set(t,e)}!n&&o&&window.ShadyCSS.styleElement(t.host)})},function(e,t,r){"use strict";r.r(t),r.d(t,"repeat",function(){return d});var s=r(3);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const i=(e,t)=>{const r=e.startNode.parentNode,i=void 0===t?e.endNode:t.startNode,n=r.insertBefore(Object(s.createMarker)(),i);r.insertBefore(Object(s.createMarker)(),i);const o=new s.NodePart(e.options);return o.insertAfterNode(n),o},n=(e,t)=>(e.setValue(t),e.commit(),e),o=(e,t,r)=>{const i=e.startNode.parentNode,n=r?r.startNode:e.endNode,o=t.endNode.nextSibling;o!==n&&Object(s.reparentNodes)(i,t.startNode,o,n)},a=e=>{Object(s.removeNodes)(e.startNode.parentNode,e.startNode,e.endNode.nextSibling)},c=(e,t,r)=>{const s=new Map;for(let i=t;i<=r;i++)s.set(e[i],i);return s},l=new WeakMap,u=new WeakMap,d=Object(s.directive)((e,t,r)=>{let d;return void 0===r?r=t:void 0!==t&&(d=t),t=>{if(!(t instanceof s.NodePart))throw new Error("repeat can only be used in text bindings");const h=l.get(t)||[],p=u.get(t)||[],m=[],f=[],v=[];let g,y,b=0;for(const t of e)v[b]=d?d(t,b):b,f[b]=r(t,b),b++;let E=0,_=h.length-1,w=0,S=f.length-1;for(;E<=_&&w<=S;)if(null===h[E])E++;else if(null===h[_])_--;else if(p[E]===v[w])m[w]=n(h[E],f[w]),E++,w++;else if(p[_]===v[S])m[S]=n(h[_],f[S]),_--,S--;else if(p[E]===v[S])m[S]=n(h[E],f[S]),o(t,h[E],m[S+1]),E++,S--;else if(p[_]===v[w])m[w]=n(h[_],f[w]),o(t,h[_],h[E]),_--,w++;else if(void 0===g&&(g=c(v,w,S),y=c(p,E,_)),g.has(p[E]))if(g.has(p[_])){const e=y.get(v[w]),r=void 0!==e?h[e]:null;if(null===r){const e=i(t,h[E]);n(e,f[w]),m[w]=e}else m[w]=n(r,f[w]),o(t,r,h[E]),h[e]=null;w++}else a(h[_]),_--;else a(h[E]),E++;for(;w<=S;){const e=i(t,m[S+1]);n(e,f[w]),m[w++]=e}for(;E<=_;){const e=h[E++];null!==e&&a(e)}l.set(t,m),u.set(t,v)}})},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(16),n=r(53),o=r(118);r(129);let a=class extends n.default{constructor(){super(...arguments),this.sceneView=null}get assetReader(){return this.system.getMainComponent(i.default)}firstConnected(){this.classList.add("sv-content-view"),this.sceneView=new o.default(this.system)}connected(){this.assetReader.outs.busy.on("value",this.performUpdate,this)}disconnected(){this.assetReader.outs.busy.off("value",this.performUpdate,this)}render(){const e=this.assetReader.outs.busy.value;return n.html`${this.sceneView}
            <sv-spinner ?visible=${e}></sv-spinner>`}};a=s([n.customElement("sv-content-view")],a),t.default=a},function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(o,a)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.default={json:function(e,t,r){return s(this,void 0,void 0,function*(){return r&&"string"!=typeof r&&(r=JSON.stringify(r)),fetch(e,{headers:{Accept:"application/json","Content-Type":"application/json"},method:t,credentials:"same-origin",body:r}).then(r=>{if(!r.ok){const s=`fetch.json (${t} at '${e}'), error: ${r.status} - ${r.statusText}`;throw console.warn(s),new Error(s)}return r.json()}).catch(r=>{throw console.warn(`fetch.json (${t} at '${e}'), error: ${r.message}`),r})})},text:function(e,t,r){return s(this,void 0,void 0,function*(){return fetch(e,{headers:{Accept:"text/plain","Content-Type":"text/plain"},method:t,credentials:"include",body:r}).then(e=>{if(!e.ok)throw new Error(`status: ${e.status}`);return e.text()}).catch(r=>{throw console.warn(`fetch.text (${t} at '${e}'), error: ${r.message}`),r})})},file:function(e,t,r,i=!0){return s(this,void 0,void 0,function*(){const s={method:t,credentials:"include",body:r};return i||(s.headers={"Content-Type":"application/octet-stream"}),fetch(e,s).then(e=>{if(!e.ok)throw new Error(`status: ${e.status}`);return e}).catch(r=>{throw console.warn(`fetch.file (${t} at '${e}'), error: ${r.message}`),r})})},buffer:function(e,t,r){return s(this,void 0,void 0,function*(){return fetch(e,{headers:{Accept:"application/octet-stream","Content-Type":"application/octet-stream"},method:t,credentials:"include",body:r}).then(e=>{if(!e.ok)throw new Error(`status: ${e.status}`);return e.arrayBuffer()}).catch(r=>{throw console.warn(`fetch.buffer (${t} at '${e}'), error: ${r.message}`),r})})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!e||!t)return!1;let r=e.prototype;for(;r;){if(r===t.prototype)return!0;r=r.prototype}return!1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(51);t.default=class{constructor(e,t,r,i){if(1===e.elementCount&&r>=0)throw new Error("non-array source property; can't link to element");if(1===t.elementCount&&i>=0)throw new Error("non-array destination property; can't link to element");this.source=e,this.destination=t,this.sourceIndex=r,this.destinationIndex=i;const n=void 0===r?-1:r,o=void 0===i?-1:i,a=e.elementCount>1&&n<0&&o<0;this.fnConvert=s.getConversionFunction(e.type,t.type,a);const c=s.getElementCopyFunction(n,o,this.fnConvert);this.fnCopy=s.getMultiCopyFunction(e.isMulti(),t.isMulti(),c)}push(){this.destination.setValue(this.fnCopy(this.source.value,this.destination.value,this.fnConvert))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enumToArray=function(e){return Object.keys(e).filter(e=>isNaN(Number(e)))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(6),i=r(50),n=r(23);t.default=class extends s.default{constructor(e){super(),this.addEvent("property"),this.linkable=e,this.properties=[]}get customProperties(){return this.properties.filter(e=>e.custom)}dispose(){this.unlinkAllProperties()}isInputGroup(){return this===this.linkable.ins}isOutputGroup(){return this===this.linkable.outs}createProperties(e,t){return Object.keys(e).forEach((r,s)=>{const i=void 0===t?void 0:t+s,n=e[r];this.createProperty(n.path,n.schema,r,i)}),this}createProperty(e,t,r,s){const n=new i.default(e,t);return this.addProperty(n,r,s),n}createCustomProperty(e,t,r){const s=new i.default(e,t,!0);return this.addCustomProperty(s,r),s}addCustomProperty(e,t){const r=n.default(5);this.addProperty(e,r,t)}addProperty(e,t,r){if(e.group)throw new Error("can't add, property already part of a group");if(this[t])throw new Error(`key '${t}' already exists in group`);e._group=this,e._key=t,void 0===r?this.properties.push(e):this.properties.splice(r,0,e),this[t]=e,this.emit({type:"property",add:!0,remove:!1,property:e})}removeProperty(e){if(e.group!==this)throw new Error("can't remove, property not in this group");if(e.hasLinks())throw new Error("can't remove, property has links");if(this[e.key]!==e)throw new Error(`property key '${e.key}' not found in group`);this.properties.slice(this.properties.indexOf(e),1),delete this[e.key],e._group=null,e._key="",this.emit({type:"property",add:!1,remove:!0,property:e})}getProperty(e){const t=this[e];if(!t)throw new Error(`no property found with key '${e}'`);return t}getKeys(e=!1){const t=[];return this.properties.forEach(r=>{(e||"object"!==r.type)&&t.push(r.key)}),t}getValues(e=!1){const t=[];return this.properties.map(r=>{(e||"object"!==r.type)&&t.push(r.value)}),t}cloneValues(e=!1){const t=[];return this.properties.map(r=>{(e||"object"!==r.type)&&t.push(r.cloneValue())}),t}setValues(e){Object.keys(e).forEach(t=>this.getProperty(t).value=e[t])}copyValues(e){Object.keys(e).forEach(t=>this.getProperty(t).copyValue(e[t]))}unlinkAllProperties(){this.properties.forEach(e=>e.unlink())}toJSON(){let e=null;return this.properties.forEach(t=>{const r=t.toJSON();r&&((e=e||{})[t.key]=r)}),e}fromJSON(e){Object.keys(e).forEach(t=>{const r=e[t];if(r.schema){const e=new i.default(r.path,r.schema,!0);this.addProperty(e,t)}})}linksFromJSON(e,t){Object.keys(e).forEach(r=>{this[r].fromJSON(e[r],t)})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1);t.default=class{constructor(e,t){this._typeName=t?s.default.getTypeName(t):null,this._id=t instanceof s.default?t.id:void 0,this._system=e}get component(){return this._id&&this._system.components.getById(this._id)||null}set component(e){if(e&&this._typeName&&!(e instanceof this._system.registry.getType(this._typeName)))throw new Error(`can't assign component of class '${e.constructor.name||"unknown"}' to link of class '${this._typeName}'`);this._id=e?e.id:void 0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this._loadingManager=e}get(e){return this._loadingManager.itemStart(e),fetch(e,{headers:{Accept:"application/json"}}).then(t=>{if(!t.ok)throw this._loadingManager.itemError(e),new Error(`failed to fetch from '${e}', status: ${t.status} ${t.statusText}`);return this._loadingManager.itemEnd(e),t.json()})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(108),i=r(0);r(109),r(110);const n=i.GLTFLoader,o=i.DRACOLoader,a=s.default("js/draco/",window.location.origin+window.location.pathname);o.setDecoderPath(a),console.log("DRACOLoader.setDracoPath - %s",a);const c=r(37);class l{constructor(e){this.loadingManager=e,this.gltfLoader=new n(e),this.gltfLoader.setDRACOLoader(new o)}isValid(e){const t=e.split(".").pop().toLowerCase();return l.extensions.indexOf(t)>=0}isValidMimeType(e){return l.mimeTypes.indexOf(e)>=0}get(e){return new Promise((t,r)=>{this.gltfLoader.load(e,e=>{t(this.createModelGroup(e))},null,t=>{console.error(`failed to load '${e}': ${t}`),r(new Error(t))})})}createModelGroup(e){const t=e.scene;if("Scene"!==t.type)throw new Error("not a valid gltf scene");const r=new i.Group;return t.children.forEach(e=>r.add(e)),r.traverse(e=>{if("Mesh"===e.type){const t=e;t.castShadow=!0;const r=t.material;r.map&&(r.map.encoding=i.LinearEncoding),t.geometry.computeBoundingBox();const s=new c.default;"MeshStandardMaterial"===r.type&&s.copyStandardMaterial(r),s.color.set("#ffffff"),s.roughness=.8,s.metalness=.1,s.enableObjectSpaceNormalMap(!1),s.map||s.color.set("#c0c0c0"),t.material=s}}),r}}l.extensions=["gltf","glb"],l.mimeTypes=["model/gltf+json","model/gltf-binary"],t.default=l},function(e,t,r){"use strict";function s(e){return"/"===e.charAt(0)}function i(e,t){for(var r=t,s=r+1,i=e.length;s<i;r+=1,s+=1)e[r]=e[s];e.pop()}r.r(t),t.default=function(e,t){void 0===t&&(t="");var r,n=e&&e.split("/")||[],o=t&&t.split("/")||[],a=e&&s(e),c=t&&s(t),l=a||c;if(e&&s(e)?o=n:n.length&&(o.pop(),o=o.concat(n)),!o.length)return"/";if(o.length){var u=o[o.length-1];r="."===u||".."===u||""===u}else r=!1;for(var d=0,h=o.length;h>=0;h--){var p=o[h];"."===p?i(o,h):".."===p?(i(o,h),d++):d&&(i(o,h),d--)}if(!l)for(;d--;d)o.unshift("..");!l||""===o[0]||o[0]&&s(o[0])||o.unshift("");var m=o.join("/");return r&&"/"!==m.substr(-1)&&(m+="/"),m}},function(e,t){THREE.GLTFLoader=function(){function e(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.dracoLoader=null}function t(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype={constructor:e,crossOrigin:"anonymous",load:function(e,t,r,s){var i,n=this;i=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),n.manager.itemStart(e);var o=function(t){s?s(t):console.error(t),n.manager.itemError(e),n.manager.itemEnd(e)},a=new THREE.FileLoader(n.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.load(e,function(r){try{n.parse(r,i,function(r){t(r),n.manager.itemEnd(e)},o)}catch(e){o(e)}},r,o)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setDRACOLoader:function(e){return this.dracoLoader=e,this},parse:function(e,t,a,c){var p,m={};if("string"==typeof e)p=e;else if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===o){try{m[r.KHR_BINARY_GLTF]=new l(e)}catch(e){return void(c&&c(e))}p=m[r.KHR_BINARY_GLTF].content}else p=THREE.LoaderUtils.decodeText(new Uint8Array(e));var f=JSON.parse(p);if(void 0===f.asset||f.asset.version[0]<2)c&&c(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(f.extensionsUsed)for(var v=0;v<f.extensionsUsed.length;++v){var g=f.extensionsUsed[v],y=f.extensionsRequired||[];switch(g){case r.KHR_LIGHTS_PUNCTUAL:m[g]=new i(f);break;case r.KHR_MATERIALS_UNLIT:m[g]=new n(f);break;case r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:m[g]=new h(f);break;case r.KHR_DRACO_MESH_COMPRESSION:m[g]=new u(f,this.dracoLoader);break;case r.MSFT_TEXTURE_DDS:m[r.MSFT_TEXTURE_DDS]=new s;break;case r.KHR_TEXTURE_TRANSFORM:m[r.KHR_TEXTURE_TRANSFORM]=new d(f);break;default:y.indexOf(g)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+g+'".')}}new F(f,m,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(a,c)}}};var r={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function s(){if(!THREE.DDSLoader)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=r.MSFT_TEXTURE_DDS,this.ddsLoader=new THREE.DDSLoader}function i(e){this.name=r.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[r.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function n(e){this.name=r.KHR_MATERIALS_UNLIT}i.prototype.loadLight=function(e){var t,r=this.lightDefs[e],s=new THREE.Color(16777215);void 0!==r.color&&s.fromArray(r.color);var i=void 0!==r.range?r.range:0;switch(r.type){case"directional":(t=new THREE.DirectionalLight(s)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new THREE.PointLight(s)).distance=i;break;case"spot":(t=new THREE.SpotLight(s)).distance=i,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,t.angle=r.spot.outerConeAngle,t.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+r.type+'".')}return t.position.set(0,0,0),t.decay=2,void 0!==r.intensity&&(t.intensity=r.intensity),t.name=r.name||"light_"+e,Promise.resolve(t)},n.prototype.getMaterialType=function(e){return THREE.MeshBasicMaterial},n.prototype.extendParams=function(e,t,r){var s=[];e.color=new THREE.Color(1,1,1),e.opacity=1;var i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var n=i.baseColorFactor;e.color.fromArray(n),e.opacity=n[3]}void 0!==i.baseColorTexture&&s.push(r.assignTexture(e,"map",i.baseColorTexture))}return Promise.all(s)};var o="glTF",a=12,c={JSON:1313821514,BIN:5130562};function l(e){this.name=r.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,a);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==o)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var s=new DataView(e,a),i=0;i<s.byteLength;){var n=s.getUint32(i,!0);i+=4;var l=s.getUint32(i,!0);if(i+=4,l===c.JSON){var u=new Uint8Array(e,a+i,n);this.content=THREE.LoaderUtils.decodeText(u)}else if(l===c.BIN){var d=a+i;this.body=e.slice(d,d+n)}i+=n}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function u(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=r.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t}function d(e){this.name=r.KHR_TEXTURE_TRANSFORM}function h(){return{name:r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(e,t,r){var s=t.extensions[this.name],i=THREE.ShaderLib.standard,n=THREE.UniformsUtils.clone(i.uniforms),o=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),a=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),c=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),l=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),u=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),d=i.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",o).replace("#include <metalnessmap_pars_fragment>",a).replace("#include <roughnessmap_fragment>",c).replace("#include <metalnessmap_fragment>",l).replace("#include <lights_physical_fragment>",u);delete n.roughness,delete n.metalness,delete n.roughnessMap,delete n.metalnessMap,n.specular={value:(new THREE.Color).setHex(1118481)},n.glossiness={value:.5},n.specularMap={value:null},n.glossinessMap={value:null},e.vertexShader=i.vertexShader,e.fragmentShader=d,e.uniforms=n,e.defines={STANDARD:""},e.color=new THREE.Color(1,1,1),e.opacity=1;var h=[];if(Array.isArray(s.diffuseFactor)){var p=s.diffuseFactor;e.color.fromArray(p),e.opacity=p[3]}if(void 0!==s.diffuseTexture&&h.push(r.assignTexture(e,"map",s.diffuseTexture)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==s.glossinessFactor?s.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(s.specularFactor)&&e.specular.fromArray(s.specularFactor),void 0!==s.specularGlossinessTexture){var m=s.specularGlossinessTexture;h.push(r.assignTexture(e,"glossinessMap",m)),h.push(r.assignTexture(e,"specularMap",m))}return Promise.all(h)},createMaterial:function(e){var t=new THREE.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return t.isGLTFSpecularGlossinessMaterial=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t.extensions.derivatives=!0,t},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var r=this.specularGlossinessParams,s=0,i=r.length;s<i;s++)t[r[s]]=e[r[s]];return t},refreshUniforms:function(e,t,r,s,i,n){if(!0===i.isGLTFSpecularGlossinessMaterial){var o,a=i.uniforms,c=i.defines;a.opacity.value=i.opacity,a.diffuse.value.copy(i.color),a.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),a.map.value=i.map,a.specularMap.value=i.specularMap,a.alphaMap.value=i.alphaMap,a.lightMap.value=i.lightMap,a.lightMapIntensity.value=i.lightMapIntensity,a.aoMap.value=i.aoMap,a.aoMapIntensity.value=i.aoMapIntensity,i.map?o=i.map:i.specularMap?o=i.specularMap:i.displacementMap?o=i.displacementMap:i.normalMap?o=i.normalMap:i.bumpMap?o=i.bumpMap:i.glossinessMap?o=i.glossinessMap:i.alphaMap?o=i.alphaMap:i.emissiveMap&&(o=i.emissiveMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),a.uvTransform.value.copy(o.matrix)),i.envMap&&(a.envMap.value=i.envMap,a.envMapIntensity.value=i.envMapIntensity,a.flipEnvMap.value=i.envMap.isCubeTexture?-1:1,a.reflectivity.value=i.reflectivity,a.refractionRatio.value=i.refractionRatio,a.maxMipLevel.value=e.properties.get(i.envMap).__maxMipLevel),a.specular.value.copy(i.specular),a.glossiness.value=i.glossiness,a.glossinessMap.value=i.glossinessMap,a.emissiveMap.value=i.emissiveMap,a.bumpMap.value=i.bumpMap,a.normalMap.value=i.normalMap,a.displacementMap.value=i.displacementMap,a.displacementScale.value=i.displacementScale,a.displacementBias.value=i.displacementBias,null!==a.glossinessMap.value&&void 0===c.USE_GLOSSINESSMAP&&(c.USE_GLOSSINESSMAP="",c.USE_ROUGHNESSMAP=""),null===a.glossinessMap.value&&void 0!==c.USE_GLOSSINESSMAP&&(delete c.USE_GLOSSINESSMAP,delete c.USE_ROUGHNESSMAP)}}}}function p(e,t,r,s){THREE.Interpolant.call(this,e,t,r,s)}u.prototype.decodePrimitive=function(e,t){var r=this.json,s=this.dracoLoader,i=e.extensions[this.name].bufferView,n=e.extensions[this.name].attributes,o={},a={},c={};for(var l in n){var u=C[l]||l.toLowerCase();o[u]=n[l]}for(l in e.attributes){u=C[l]||l.toLowerCase();if(void 0!==n[l]){var d=r.accessors[e.attributes[l]],h=w[d.componentType];c[u]=h,a[u]=!0===d.normalized}}return t.getDependency("bufferView",i).then(function(e){return new Promise(function(t){s.decodeDracoFile(e,function(e){for(var r in e.attributes){var s=e.attributes[r],i=a[r];void 0!==i&&(s.normalized=i)}t(e)},o,c)})})},d.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},p.prototype=Object.create(THREE.Interpolant.prototype),p.prototype.constructor=p,p.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,s=this.valueSize,i=e*s*3+s,n=0;n!==s;n++)t[n]=r[i+n];return t},p.prototype.beforeStart_=p.prototype.copySampleValue_,p.prototype.afterEnd_=p.prototype.copySampleValue_,p.prototype.interpolate_=function(e,t,r,s){for(var i=this.resultBuffer,n=this.sampleValues,o=this.valueSize,a=2*o,c=3*o,l=s-t,u=(r-t)/l,d=u*u,h=d*u,p=e*c,m=p-c,f=-2*h+3*d,v=h-d,g=1-f,y=v-d+u,b=0;b!==o;b++){var E=n[m+b+o],_=n[m+b+a]*l,w=n[p+b+o],S=n[p+b]*l;i[b]=g*E+y*_+f*w+v*S}return i};var m,f=0,v=1,g=2,y=3,b=4,E=5,_=6,w=(Number,THREE.Matrix3,THREE.Matrix4,THREE.Vector2,THREE.Vector3,THREE.Vector4,THREE.Texture,{5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}),S={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},P={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},x=(THREE.BackSide,THREE.FrontSide,THREE.NeverDepth,THREE.LessDepth,THREE.EqualDepth,THREE.LessEqualDepth,THREE.GreaterEqualDepth,THREE.NotEqualDepth,THREE.GreaterEqualDepth,THREE.AlwaysDepth,THREE.AddEquation,THREE.SubtractEquation,THREE.ReverseSubtractEquation,THREE.ZeroFactor,THREE.OneFactor,THREE.SrcColorFactor,THREE.OneMinusSrcColorFactor,THREE.SrcAlphaFactor,THREE.OneMinusSrcAlphaFactor,THREE.DstAlphaFactor,THREE.OneMinusDstAlphaFactor,THREE.DstColorFactor,THREE.OneMinusDstColorFactor,THREE.SrcAlphaSaturateFactor,{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),C={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},T={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},A={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},M="OPAQUE",R="MASK",O="BLEND",D={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat};function j(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function L(e,t,r){for(var s in r.extensions)void 0===e[s]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[s]=r.extensions[s])}function N(e,t){void 0!==t.extras&&("object"==typeof t.extras?e.userData=t.extras:console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function I(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var r=0,s=t.weights.length;r<s;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){var i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(r=0,s=i.length;r<s;r++)e.morphTargetDictionary[i[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function k(e){for(var t="",r=Object.keys(e).sort(),s=0,i=r.length;s<i;s++)t+=r[s]+":"+e[r[s]]+";";return t}function V(e){if(e.isInterleavedBufferAttribute){for(var t=e.count,r=e.itemSize,s=e.array.slice(0,t*r),i=0,n=0;i<t;++i)s[n++]=e.getX(i),r>=2&&(s[n++]=e.getY(i)),r>=3&&(s[n++]=e.getZ(i)),r>=4&&(s[n++]=e.getW(i));return new THREE.BufferAttribute(s,r,e.normalized)}return e.clone()}function F(e,r,s){this.json=e||{},this.extensions=r||{},this.options=s||{},this.cache=new t,this.primitiveCache={},this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function U(e,t,r){var s=t.attributes,i=[];function n(t,s){return r.getDependency("accessor",t).then(function(t){e.addAttribute(s,t)})}for(var o in s){var a=C[o]||o.toLowerCase();a in e.attributes||i.push(n(s[o],a))}if(void 0!==t.indices&&!e.index){var c=r.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});i.push(c)}return N(e,t),Promise.all(i).then(function(){return void 0!==t.targets?function(e,t,r){for(var s=!1,i=!1,n=0,o=t.length;n<o&&(void 0!==(l=t[n]).POSITION&&(s=!0),void 0!==l.NORMAL&&(i=!0),!s||!i);n++);if(!s&&!i)return Promise.resolve(e);var a=[],c=[];for(n=0,o=t.length;n<o;n++){var l=t[n];if(s){var u=void 0!==l.POSITION?r.getDependency("accessor",l.POSITION):e.attributes.position;a.push(u)}i&&(u=void 0!==l.NORMAL?r.getDependency("accessor",l.NORMAL):e.attributes.normal,c.push(u))}return Promise.all([Promise.all(a),Promise.all(c)]).then(function(r){for(var n=r[0],o=r[1],a=0,c=n.length;a<c;a++)e.attributes.position!==n[a]&&(n[a]=V(n[a]));for(a=0,c=o.length;a<c;a++)e.attributes.normal!==o[a]&&(o[a]=V(o[a]));for(a=0,c=t.length;a<c;a++){var l=t[a],u="morphTarget"+a;if(s&&void 0!==l.POSITION){var d=n[a];d.name=u;for(var h=e.attributes.position,p=0,m=d.count;p<m;p++)d.setXYZ(p,d.getX(p)+h.getX(p),d.getY(p)+h.getY(p),d.getZ(p)+h.getZ(p))}if(i&&void 0!==l.NORMAL){var f=o[a];f.name=u;var v=e.attributes.normal;for(p=0,m=f.count;p<m;p++)f.setXYZ(p,f.getX(p)+v.getX(p),f.getY(p)+v.getY(p),f.getZ(p)+v.getZ(p))}}return s&&(e.morphAttributes.position=n),i&&(e.morphAttributes.normal=o),e})}(e,t.targets,r):e})}return F.prototype.parse=function(e,t){var r=this,s=this.json,i=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(t){var n={scene:t[0][s.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:s.asset,parser:r,userData:{}};L(i,n,s),e(n)}).catch(t)},F.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],s={},i={},n=0,o=t.length;n<o;n++)for(var a=t[n].joints,c=0,l=a.length;c<l;c++)e[a[c]].isBone=!0;for(var u=0,d=e.length;u<d;u++){var h=e[u];void 0!==h.mesh&&(void 0===s[h.mesh]&&(s[h.mesh]=i[h.mesh]=0),s[h.mesh]++,void 0!==h.skin&&(r[h.mesh].isSkinnedMesh=!0))}this.json.meshReferences=s,this.json.meshUses=i},F.prototype.getDependency=function(e,t){var s=e+":"+t,i=this.cache.get(s);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this.loadMesh(t);break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this.loadBufferView(t);break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this.loadMaterial(t);break;case"texture":i=this.loadTexture(t);break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;case"light":i=this.extensions[r.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,i)}return i},F.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,s=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(s.map(function(t,s){return r.getDependency(e,s)})),this.cache.add(e,t)}return t},F.prototype.loadBuffer=function(e){var t=this.json.buffers[e],s=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[r.KHR_BINARY_GLTF].body);var i=this.options;return new Promise(function(e,r){s.load(j(t.uri,i.path),e,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},F.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var r=t.byteLength||0,s=t.byteOffset||0;return e.slice(s,s+r)})},F.prototype.loadAccessor=function(e){var t=this,r=this.json,s=this.json.accessors[e];if(void 0===s.bufferView&&void 0===s.sparse)return Promise.resolve(null);var i=[];return void 0!==s.bufferView?i.push(this.getDependency("bufferView",s.bufferView)):i.push(null),void 0!==s.sparse&&(i.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(i).then(function(e){var i,n,o=e[0],a=x[s.type],c=w[s.componentType],l=c.BYTES_PER_ELEMENT,u=l*a,d=s.byteOffset||0,h=void 0!==s.bufferView?r.bufferViews[s.bufferView].byteStride:void 0,p=!0===s.normalized;if(h&&h!==u){var m="InterleavedBuffer:"+s.bufferView+":"+s.componentType,f=t.cache.get(m);f||(i=new c(o),f=new THREE.InterleavedBuffer(i,h/l),t.cache.add(m,f)),n=new THREE.InterleavedBufferAttribute(f,a,d/l,p)}else i=null===o?new c(s.count*a):new c(o,d,s.count*a),n=new THREE.BufferAttribute(i,a,p);if(void 0!==s.sparse){var v=x.SCALAR,g=w[s.sparse.indices.componentType],y=s.sparse.indices.byteOffset||0,b=s.sparse.values.byteOffset||0,E=new g(e[1],y,s.sparse.count*v),_=new c(e[2],b,s.sparse.count*a);null!==o&&n.setArray(n.array.slice());for(var S=0,P=E.length;S<P;S++){var C=E[S];if(n.setX(C,_[S*a]),a>=2&&n.setY(C,_[S*a+1]),a>=3&&n.setZ(C,_[S*a+2]),a>=4&&n.setW(C,_[S*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return n})},F.prototype.loadTexture=function(e){var t,s=this,i=this.json,n=this.options,o=this.textureLoader,a=window.URL||window.webkitURL,c=i.textures[e],l=c.extensions||{},u=(t=l[r.MSFT_TEXTURE_DDS]?i.images[l[r.MSFT_TEXTURE_DDS].source]:i.images[c.source]).uri,d=!1;return void 0!==t.bufferView&&(u=s.getDependency("bufferView",t.bufferView).then(function(e){d=!0;var r=new Blob([e],{type:t.mimeType});return u=a.createObjectURL(r)})),Promise.resolve(u).then(function(e){var t=THREE.Loader.Handlers.get(e);return t||(t=l[r.MSFT_TEXTURE_DDS]?s.extensions[r.MSFT_TEXTURE_DDS].ddsLoader:o),new Promise(function(r,s){t.load(j(e,n.path),r,void 0,s)})}).then(function(e){!0===d&&a.revokeObjectURL(u),e.flipY=!1,void 0!==c.name&&(e.name=c.name),t.mimeType in D&&(e.format=D[t.mimeType]);var r=(i.samplers||{})[c.sampler]||{};return e.magFilter=S[r.magFilter]||THREE.LinearFilter,e.minFilter=S[r.minFilter]||THREE.LinearMipMapLinearFilter,e.wrapS=P[r.wrapS]||THREE.RepeatWrapping,e.wrapT=P[r.wrapT]||THREE.RepeatWrapping,e})},F.prototype.assignTexture=function(e,t,s){var i=this;return this.getDependency("texture",s.index).then(function(n){switch(t){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":n.format=THREE.RGBFormat}if(i.extensions[r.KHR_TEXTURE_TRANSFORM]){var o=void 0!==s.extensions?s.extensions[r.KHR_TEXTURE_TRANSFORM]:void 0;o&&(n=i.extensions[r.KHR_TEXTURE_TRANSFORM].extendTexture(n,o))}e[t]=n})},F.prototype.assignFinalMaterial=function(e){var t=e.geometry,s=e.material,i=this.extensions,n=void 0!==t.attributes.tangent,o=void 0!==t.attributes.color,a=void 0===t.attributes.normal,c=!0===e.isSkinnedMesh,l=Object.keys(t.morphAttributes).length>0,u=l&&void 0!==t.morphAttributes.normal;if(e.isPoints){var d="PointsMaterial:"+s.uuid,h=this.cache.get(d);h||(h=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(h,s),h.color.copy(s.color),h.map=s.map,h.lights=!1,this.cache.add(d,h)),s=h}else if(e.isLine){d="LineBasicMaterial:"+s.uuid;var p=this.cache.get(d);p||(p=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(p,s),p.color.copy(s.color),p.lights=!1,this.cache.add(d,p)),s=p}if(n||o||a||c||l){d="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&(d+="specular-glossiness:"),c&&(d+="skinning:"),n&&(d+="vertex-tangents:"),o&&(d+="vertex-colors:"),a&&(d+="flat-shading:"),l&&(d+="morph-targets:"),u&&(d+="morph-normals:");var m=this.cache.get(d);m||(m=s.isGLTFSpecularGlossinessMaterial?i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(s):s.clone(),c&&(m.skinning=!0),n&&(m.vertexTangents=!0),o&&(m.vertexColors=THREE.VertexColors),a&&(m.flatShading=!0),l&&(m.morphTargets=!0),u&&(m.morphNormals=!0),this.cache.add(d,m)),s=m}s.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),t.addAttribute("uv2",new THREE.BufferAttribute(t.attributes.uv.array,2))),s.isGLTFSpecularGlossinessMaterial&&(e.onBeforeRender=i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms),e.material=s},F.prototype.loadMaterial=function(e){var t,s=this.json,i=this.extensions,n=s.materials[e],o={},a=n.extensions||{},c=[];if(a[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var l=i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=l.getMaterialType(n),c.push(l.extendParams(o,n,this))}else if(a[r.KHR_MATERIALS_UNLIT]){var u=i[r.KHR_MATERIALS_UNLIT];t=u.getMaterialType(n),c.push(u.extendParams(o,n,this))}else{t=THREE.MeshStandardMaterial;var d=n.pbrMetallicRoughness||{};if(o.color=new THREE.Color(1,1,1),o.opacity=1,Array.isArray(d.baseColorFactor)){var h=d.baseColorFactor;o.color.fromArray(h),o.opacity=h[3]}void 0!==d.baseColorTexture&&c.push(this.assignTexture(o,"map",d.baseColorTexture)),o.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,o.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(c.push(this.assignTexture(o,"metalnessMap",d.metallicRoughnessTexture)),c.push(this.assignTexture(o,"roughnessMap",d.metallicRoughnessTexture)))}!0===n.doubleSided&&(o.side=THREE.DoubleSide);var p=n.alphaMode||M;return p===O?o.transparent=!0:(o.transparent=!1,p===R&&(o.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&t!==THREE.MeshBasicMaterial&&(c.push(this.assignTexture(o,"normalMap",n.normalTexture)),o.normalScale=new THREE.Vector2(1,1),void 0!==n.normalTexture.scale&&o.normalScale.set(n.normalTexture.scale,n.normalTexture.scale)),void 0!==n.occlusionTexture&&t!==THREE.MeshBasicMaterial&&(c.push(this.assignTexture(o,"aoMap",n.occlusionTexture)),void 0!==n.occlusionTexture.strength&&(o.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&t!==THREE.MeshBasicMaterial&&(o.emissive=(new THREE.Color).fromArray(n.emissiveFactor)),void 0!==n.emissiveTexture&&t!==THREE.MeshBasicMaterial&&c.push(this.assignTexture(o,"emissiveMap",n.emissiveTexture)),Promise.all(c).then(function(){var e;return e=t===THREE.ShaderMaterial?i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new t(o),void 0!==n.name&&(e.name=n.name),e.map&&(e.map.encoding=THREE.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=THREE.sRGBEncoding),e.specularMap&&(e.specularMap.encoding=THREE.sRGBEncoding),N(e,n),n.extensions&&L(i,e,n),e})},F.prototype.loadGeometries=function(e){var t=this,s=this.extensions,i=this.primitiveCache;function n(e){return s[r.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(r){return U(r,e,t)})}for(var o,a,c=[],l=0,u=e.length;l<u;l++){var d,h=e[l],p=(a=void 0,(a=(o=h).extensions&&o.extensions[r.KHR_DRACO_MESH_COMPRESSION])?"draco:"+a.bufferView+":"+a.indices+":"+k(a.attributes):o.indices+":"+k(o.attributes)+":"+o.mode),m=i[p];if(m)c.push(m.promise);else d=h.extensions&&h.extensions[r.KHR_DRACO_MESH_COMPRESSION]?n(h):U(new THREE.BufferGeometry,h,t),i[p]={primitive:h,promise:d},c.push(d)}return Promise.all(c)},F.prototype.loadMesh=function(e){for(var t=this,r=this.json,s=(this.extensions,r.meshes[e]),i=s.primitives,n=[],o=0,a=i.length;o<a;o++){var c=void 0===i[o].material?m=m||new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide}):this.getDependency("material",i[o].material);n.push(c)}return Promise.all(n).then(function(r){return t.loadGeometries(i).then(function(n){for(var o=[],a=0,c=n.length;a<c;a++){var l,u=n[a],d=i[a],h=r[a];if(d.mode===b||d.mode===E||d.mode===_||void 0===d.mode)!0===(l=!0===s.isSkinnedMesh?new THREE.SkinnedMesh(u,h):new THREE.Mesh(u,h)).isSkinnedMesh&&l.normalizeSkinWeights(),d.mode===E?l.drawMode=THREE.TriangleStripDrawMode:d.mode===_&&(l.drawMode=THREE.TriangleFanDrawMode);else if(d.mode===v)l=new THREE.LineSegments(u,h);else if(d.mode===y)l=new THREE.Line(u,h);else if(d.mode===g)l=new THREE.LineLoop(u,h);else{if(d.mode!==f)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);l=new THREE.Points(u,h)}Object.keys(l.geometry.morphAttributes).length>0&&I(l,s),l.name=s.name||"mesh_"+e,n.length>1&&(l.name+="_"+a),N(l,s),t.assignFinalMaterial(l),o.push(l)}if(1===o.length)return o[0];var p=new THREE.Group;for(a=0,c=o.length;a<c;a++)p.add(o[a]);return p})})},F.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],s=r[r.type];if(s)return"perspective"===r.type?t=new THREE.PerspectiveCamera(THREE.Math.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):"orthographic"===r.type&&(t=new THREE.OrthographicCamera(s.xmag/-2,s.xmag/2,s.ymag/2,s.ymag/-2,s.znear,s.zfar)),void 0!==r.name&&(t.name=r.name),N(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},F.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return r.inverseBindMatrices=e,r})},F.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],r=[],s=[],i=[],n=[],o=[],a=0,c=t.channels.length;a<c;a++){var l=t.channels[a],u=t.samplers[l.sampler],d=l.target,h=void 0!==d.node?d.node:d.id,m=void 0!==t.parameters?t.parameters[u.input]:u.input,f=void 0!==t.parameters?t.parameters[u.output]:u.output;r.push(this.getDependency("node",h)),s.push(this.getDependency("accessor",m)),i.push(this.getDependency("accessor",f)),n.push(u),o.push(d)}return Promise.all([Promise.all(r),Promise.all(s),Promise.all(i),Promise.all(n),Promise.all(o)]).then(function(r){for(var s=r[0],i=r[1],n=r[2],o=r[3],a=r[4],c=[],l=0,u=s.length;l<u;l++){var d=s[l],h=i[l],m=n[l],f=o[l],v=a[l];if(void 0!==d){var g;switch(d.updateMatrix(),d.matrixAutoUpdate=!0,T[v.path]){case T.weights:g=THREE.NumberKeyframeTrack;break;case T.rotation:g=THREE.QuaternionKeyframeTrack;break;case T.position:case T.scale:default:g=THREE.VectorKeyframeTrack}var y=d.name?d.name:d.uuid,b=void 0!==f.interpolation?A[f.interpolation]:THREE.InterpolateLinear,E=[];T[v.path]===T.weights?d.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&E.push(e.name?e.name:e.uuid)}):E.push(y);for(var _=0,w=E.length;_<w;_++){var S=new g(E[_]+"."+T[v.path],h.array,m.array,b);"CUBICSPLINE"===f.interpolation&&(S.createInterpolant=function(e){return new p(this.times,this.values,this.getValueSize()/3,e)},S.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(S)}}}var P=void 0!==t.name?t.name:"animation_"+e;return new THREE.AnimationClip(P,void 0,c)})},F.prototype.loadNode=function(e){var t=this.json,s=this.extensions,i=this,n=t.meshReferences,o=t.meshUses,a=t.nodes[e];return(!0===a.isBone?Promise.resolve(new THREE.Bone):void 0!==a.mesh?i.getDependency("mesh",a.mesh).then(function(e){var t;if(n[a.mesh]>1){var r=o[a.mesh]++;(t=e.clone()).name+="_instance_"+r,t.onBeforeRender=e.onBeforeRender;for(var s=0,i=t.children.length;s<i;s++)t.children[s].name+="_instance_"+r,t.children[s].onBeforeRender=e.children[s].onBeforeRender}else t=e;return void 0!==a.weights&&t.traverse(function(e){if(e.isMesh)for(var t=0,r=a.weights.length;t<r;t++)e.morphTargetInfluences[t]=a.weights[t]}),t}):void 0!==a.camera?i.getDependency("camera",a.camera):a.extensions&&a.extensions[r.KHR_LIGHTS_PUNCTUAL]&&void 0!==a.extensions[r.KHR_LIGHTS_PUNCTUAL].light?i.getDependency("light",a.extensions[r.KHR_LIGHTS_PUNCTUAL].light):Promise.resolve(new THREE.Object3D)).then(function(e){if(void 0!==a.name&&(e.name=THREE.PropertyBinding.sanitizeNodeName(a.name)),N(e,a),a.extensions&&L(s,e,a),void 0!==a.matrix){var t=new THREE.Matrix4;t.fromArray(a.matrix),e.applyMatrix(t)}else void 0!==a.translation&&e.position.fromArray(a.translation),void 0!==a.rotation&&e.quaternion.fromArray(a.rotation),void 0!==a.scale&&e.scale.fromArray(a.scale);return e})},F.prototype.loadScene=function(){function e(t,r,s,i){var n=s.nodes[t];return i.getDependency("node",t).then(function(e){return void 0===n.skin?e:i.getDependency("skin",n.skin).then(function(e){for(var r=[],s=0,n=(t=e).joints.length;s<n;s++)r.push(i.getDependency("node",t.joints[s]));return Promise.all(r)}).then(function(r){for(var s=!0===e.isGroup?e.children:[e],i=0,n=s.length;i<n;i++){for(var o=s[i],a=[],c=[],l=0,u=r.length;l<u;l++){var d=r[l];if(d){a.push(d);var h=new THREE.Matrix4;void 0!==t.inverseBindMatrices&&h.fromArray(t.inverseBindMatrices.array,16*l),c.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[l])}o.bind(new THREE.Skeleton(a,c),o.matrixWorld)}return e});var t}).then(function(t){r.add(t);var o=[];if(n.children)for(var a=n.children,c=0,l=a.length;c<l;c++){var u=a[c];o.push(e(u,t,s,i))}return Promise.all(o)})}return function(t){var r=this.json,s=this.extensions,i=this.json.scenes[t],n=new THREE.Scene;void 0!==i.name&&(n.name=i.name),N(n,i),i.extensions&&L(s,n,i);for(var o=i.nodes||[],a=[],c=0,l=o.length;c<l;c++)a.push(e(o[c],n,r,this));return Promise.all(a).then(function(){return n})}}(),e}()},function(e,t,r){"use strict";THREE.DRACOLoader=function(e){this.timeLoaded=0,this.manager=e||THREE.DefaultLoadingManager,this.materials=null,this.verbosity=0,this.attributeOptions={},this.drawMode=THREE.TrianglesDrawMode,this.nativeAttributeMap={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"}},THREE.DRACOLoader.prototype={constructor:THREE.DRACOLoader,load:function(e,t,r,s){var i=this,n=new THREE.FileLoader(i.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.load(e,function(e){i.decodeDracoFile(e,t)},r,s)},setPath:function(e){return this.path=e,this},setVerbosity:function(e){return this.verbosity=e,this},setDrawMode:function(e){return this.drawMode=e,this},setSkipDequantization:function(e,t){var r=!0;return void 0!==t&&(r=t),this.getAttributeOptions(e).skipDequantization=r,this},decodeDracoFile:function(e,t,r,s){var i=this;THREE.DRACOLoader.getDecoderModule().then(function(n){i.decodeDracoFileInternal(e,n.decoder,t,r,s)})},decodeDracoFileInternal:function(e,t,r,s,i){var n=new t.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength);var o=new t.Decoder,a=o.GetEncodedGeometryType(n);if(a==t.TRIANGULAR_MESH)this.verbosity>0&&console.log("Loaded a mesh.");else{if(a!=t.POINT_CLOUD){var c="THREE.DRACOLoader: Unknown geometry type.";throw console.error(c),new Error(c)}this.verbosity>0&&console.log("Loaded a point cloud.")}r(this.convertDracoGeometryTo3JS(t,o,a,n,s,i))},addAttributeToGeometry:function(e,t,r,s,i,n,o,a){if(0===n.ptr){var c="THREE.DRACOLoader: No attribute "+s;throw console.error(c),new Error(c)}var l,u,d=n.num_components(),h=r.num_points()*d;switch(i){case Float32Array:l=new e.DracoFloat32Array,t.GetAttributeFloatForAllPoints(r,n,l),a[s]=new Float32Array(h),u=THREE.Float32BufferAttribute;break;case Int8Array:l=new e.DracoInt8Array,t.GetAttributeInt8ForAllPoints(r,n,l),a[s]=new Int8Array(h),u=THREE.Int8BufferAttribute;break;case Int16Array:l=new e.DracoInt16Array,t.GetAttributeInt16ForAllPoints(r,n,l),a[s]=new Int16Array(h),u=THREE.Int16BufferAttribute;break;case Int32Array:l=new e.DracoInt32Array,t.GetAttributeInt32ForAllPoints(r,n,l),a[s]=new Int32Array(h),u=THREE.Int32BufferAttribute;break;case Uint8Array:l=new e.DracoUInt8Array,t.GetAttributeUInt8ForAllPoints(r,n,l),a[s]=new Uint8Array(h),u=THREE.Uint8BufferAttribute;break;case Uint16Array:l=new e.DracoUInt16Array,t.GetAttributeUInt16ForAllPoints(r,n,l),a[s]=new Uint16Array(h),u=THREE.Uint16BufferAttribute;break;case Uint32Array:l=new e.DracoUInt32Array,t.GetAttributeUInt32ForAllPoints(r,n,l),a[s]=new Uint32Array(h),u=THREE.Uint32BufferAttribute;break;default:c="THREE.DRACOLoader: Unexpected attribute type.";throw console.error(c),new Error(c)}for(var p=0;p<h;p++)a[s][p]=l.GetValue(p);o.addAttribute(s,new u(a[s],d)),e.destroy(l)},convertDracoGeometryTo3JS:function(e,t,r,s,i,n){var o,a;!0===this.getAttributeOptions("position").skipDequantization&&t.SkipAttributeTransform(e.POSITION);var c=performance.now();if(r===e.TRIANGULAR_MESH?(o=new e.Mesh,a=t.DecodeBufferToMesh(s,o)):(o=new e.PointCloud,a=t.DecodeBufferToPointCloud(s,o)),!a.ok()||0==o.ptr){var l="THREE.DRACOLoader: Decoding failed: ";throw l+=a.error_msg(),console.error(l),e.destroy(t),e.destroy(o),new Error(l)}var u,d=performance.now();e.destroy(s),r==e.TRIANGULAR_MESH?(u=o.num_faces(),this.verbosity>0&&console.log("Number of faces loaded: "+u.toString())):u=0;var h=o.num_points(),p=o.num_attributes();this.verbosity>0&&(console.log("Number of points loaded: "+h.toString()),console.log("Number of attributes loaded: "+p.toString()));var m=t.GetAttributeId(o,e.POSITION);if(-1==m){l="THREE.DRACOLoader: No position attribute found.";throw console.error(l),e.destroy(t),e.destroy(o),new Error(l)}var f=t.GetAttribute(o,m),v={},g=new THREE.BufferGeometry;if(i)for(var y in i){var b=n[y],E=i[y],_=t.GetAttributeByUniqueId(o,E);this.addAttributeToGeometry(e,t,o,y,b,_,g,v)}else for(var y in this.nativeAttributeMap){var w=t.GetAttributeId(o,e[this.nativeAttributeMap[y]]);if(-1!==w){this.verbosity>0&&console.log("Loaded "+y+" attribute.");_=t.GetAttribute(o,w);this.addAttributeToGeometry(e,t,o,y,Float32Array,_,g,v)}}if(r==e.TRIANGULAR_MESH)if(this.drawMode===THREE.TriangleStripDrawMode){var S=new e.DracoInt32Array;t.GetTriangleStripsFromMesh(o,S);v.indices=new Uint32Array(S.size());for(var P=0;P<S.size();++P)v.indices[P]=S.GetValue(P);e.destroy(S)}else{var x=3*u;v.indices=new Uint32Array(x);var C=new e.DracoInt32Array;for(P=0;P<u;++P){t.GetFaceFromMesh(o,P,C);var T=3*P;v.indices[T]=C.GetValue(0),v.indices[T+1]=C.GetValue(1),v.indices[T+2]=C.GetValue(2)}e.destroy(C)}g.drawMode=this.drawMode,r==e.TRIANGULAR_MESH&&g.setIndex(new(v.indices.length>65535?THREE.Uint32BufferAttribute:THREE.Uint16BufferAttribute)(v.indices,1));var A=new e.AttributeQuantizationTransform;if(A.InitFromAttribute(f)){g.attributes.position.isQuantized=!0,g.attributes.position.maxRange=A.range(),g.attributes.position.numQuantizationBits=A.quantization_bits(),g.attributes.position.minValues=new Float32Array(3);for(P=0;P<3;++P)g.attributes.position.minValues[P]=A.min_value(P)}return e.destroy(A),e.destroy(t),e.destroy(o),this.decode_time=d-c,this.import_time=performance.now()-d,this.verbosity>0&&(console.log("Decode time: "+this.decode_time),console.log("Import time: "+this.import_time)),g},isVersionSupported:function(e,t){THREE.DRACOLoader.getDecoderModule().then(function(r){t(r.decoder.isVersionSupported(e))})},getAttributeOptions:function(e){return void 0===this.attributeOptions[e]&&(this.attributeOptions[e]={}),this.attributeOptions[e]}},THREE.DRACOLoader.decoderPath="./",THREE.DRACOLoader.decoderConfig={},THREE.DRACOLoader.decoderModulePromise=null,THREE.DRACOLoader.setDecoderPath=function(e){THREE.DRACOLoader.decoderPath=e},THREE.DRACOLoader.setDecoderConfig=function(e){var t=THREE.DRACOLoader.decoderConfig.wasmBinary;THREE.DRACOLoader.decoderConfig=e||{},THREE.DRACOLoader.releaseDecoderModule(),t&&(THREE.DRACOLoader.decoderConfig.wasmBinary=t)},THREE.DRACOLoader.releaseDecoderModule=function(){THREE.DRACOLoader.decoderModulePromise=null},THREE.DRACOLoader.getDecoderModule=function(){var e=this,t=THREE.DRACOLoader.decoderPath,r=THREE.DRACOLoader.decoderConfig,s=THREE.DRACOLoader.decoderModulePromise;return s||("undefined"!=typeof DracoDecoderModule?s=Promise.resolve():"object"!=typeof WebAssembly||"js"===r.type?s=THREE.DRACOLoader._loadScript(t+"draco_decoder.js"):(r.wasmBinaryFile=t+"draco_decoder.wasm",s=THREE.DRACOLoader._loadScript(t+"draco_wasm_wrapper.js").then(function(){return THREE.DRACOLoader._loadArrayBuffer(r.wasmBinaryFile)}).then(function(e){r.wasmBinary=e})),s=s.then(function(){return new Promise(function(t){r.onModuleLoaded=function(r){e.timeLoaded=performance.now(),t({decoder:r})},DracoDecoderModule(r)})}),THREE.DRACOLoader.decoderModulePromise=s,s)},THREE.DRACOLoader._loadScript=function(e){var t=document.getElementById("decoder_script");null!==t&&t.parentNode.removeChild(t);var r=document.getElementsByTagName("head")[0],s=document.createElement("script");return s.id="decoder_script",s.type="text/javascript",s.src=e,new Promise(function(e){s.onload=e,r.appendChild(s)})},THREE.DRACOLoader._loadArrayBuffer=function(e){var t=new THREE.FileLoader;return t.setResponseType("arraybuffer"),new Promise(function(r,s){t.load(e,r,void 0,s)})}},function(e,t){e.exports="//#define PHYSICAL\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n\n//#include <uv_pars_fragment>\n//#include <uv2_pars_fragment>\n// REPLACED WITH\n#if defined(USE_MAP) || defined(USE_BUMPMAP) || defined(USE_NORMALMAP) || defined(USE_SPECULARMAP) || defined(USE_ALPHAMAP) || defined(USE_EMISSIVEMAP) || defined(USE_ROUGHNESSMAP) || defined(USE_METALNESSMAP) || defined(USE_LIGHTMAP) || defined(USE_AOMAP)\n\tvarying vec2 vUv;\n#endif\n\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\n#ifdef USE_AOMAP\n    uniform vec3 aoMapMix;\n#endif\n\n#ifdef MODE_XRAY\n    varying float vIntensity;\n#endif\n\n#ifdef CUT_PLANE\n    varying vec3 vWorldPosition;\n    uniform vec4 cutPlaneDirection;\n    uniform vec3 cutPlaneColor;\n#endif\n\nvoid main() {\n    #ifdef CUT_PLANE\n        if (dot(vWorldPosition, cutPlaneDirection.xyz) < -cutPlaneDirection.w) {\n            discard;\n        }\n    #endif\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n    #include <normal_fragment_maps>\n\n\t#ifdef CUT_PLANE\n\t    // on the cut surface (back facing fragments revealed), replace normal with cut plane direction\n        if (!gl_FrontFacing) {\n            normal = -cutPlaneDirection.xyz;\n            diffuseColor.rgb = cutPlaneColor.rgb;\n        }\n\t#endif\n\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)\n        vec2 vUv2 = vUv;\n    #endif\n\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t//#include <aomap_fragment>\n\t// REPLACED WITH\n\t#ifdef USE_AOMAP\n\t    // if cut plane is enabled, disable ambient occlusion on back facing fragments\n\t    #ifdef CUT_PLANE\n            if (gl_FrontFacing) {\n\t    #endif\n\n    \t// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n    \tvec3 aoSample = texture2D(aoMap, vUv).rgb;\n    \tvec3 aoFactors = mix(vec3(1.0), aoSample, clamp(aoMapMix * aoMapIntensity, 0.0, 1.0));\n    \tfloat ambientOcclusion = aoFactors.x * aoFactors.y * aoFactors.z;\n    \tfloat ambientOcclusion2 = ambientOcclusion * ambientOcclusion;\n    \treflectedLight.directDiffuse *= ambientOcclusion2;\n    \treflectedLight.directSpecular *= ambientOcclusion;\n    \t//reflectedLight.indirectDiffuse *= ambientOcclusion;\n\n    \t#if defined(USE_ENVMAP) && defined(PHYSICAL)\n    \t\tfloat dotNV = saturate(dot(geometry.normal, geometry.viewDir));\n    \t\treflectedLight.indirectSpecular *= computeSpecularOcclusion(dotNV, ambientOcclusion, material.specularRoughness);\n    \t#endif\n\n    \t#ifdef CUT_PLANE\n    \t    }\n    \t#endif\n    #endif\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\tgl_FragColor = vec4(outgoingLight, diffuseColor.a);\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n    #ifdef MODE_NORMALS\n        gl_FragColor = vec4(vec3(normal * 0.5 + 0.5), 1.0);\n    #endif\n\n    #ifdef MODE_XRAY\n        gl_FragColor = vec4(vec3(0.4, 0.7, 1.0) * vIntensity, 1.0);\n    #endif\n}\n"},function(e,t){e.exports="//#define PHYSICAL\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n\n#include <common>\n\n//#include <uv_pars_vertex>\n//#include <uv2_pars_vertex>\n// REPLACED WITH\n#if defined(USE_MAP) || defined(USE_BUMPMAP) || defined(USE_NORMALMAP) || defined(USE_SPECULARMAP) || defined(USE_ALPHAMAP) || defined(USE_EMISSIVEMAP) || defined(USE_ROUGHNESSMAP) || defined(USE_METALNESSMAP) || defined(USE_LIGHTMAP) || defined(USE_AOMAP)\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n#ifdef MODE_XRAY\n    varying float vIntensity;\n#endif\n\n#ifdef CUT_PLANE\n    varying vec3 vWorldPosition;\n#endif\n\nvoid main() {\n\n//\t#include <uv_vertex>\n//\t#include <uv2_vertex>\n//  REPLACED WITH\n#if defined(USE_MAP) || defined(USE_BUMPMAP) || defined(USE_NORMALMAP) || defined(USE_SPECULARMAP) || defined(USE_ALPHAMAP) || defined(USE_EMISSIVEMAP) || defined(USE_ROUGHNESSMAP) || defined(USE_METALNESSMAP) || defined(USE_LIGHTMAP) || defined(USE_AOMAP)\n\tvUv = (uvTransform * vec3(uv, 1)).xy;\n#endif\n\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\tvNormal = normalize(transformedNormal);\n#endif\n\n#ifdef MODE_XRAY\n    vIntensity = pow(abs(1.0 - abs(dot(vNormal, vec3(0.0, 0.0, 1.0)))), 3.0);\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = -mvPosition.xyz;\n\n\t// #include <worldpos_vertex>\n\t// REPLACED WITH\n\t#if defined(USE_ENVMAP) || defined(DISTANCE) || defined(USE_SHADOWMAP) || defined(CUT_PLANE)\n    \tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n    #endif\n\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n#ifdef CUT_PLANE\n    vWorldPosition = worldPosition.xyz / worldPosition.w;\n#endif\n\n#ifdef MODE_NORMALS\n    vNormal = normal;\n#endif\n}\n"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0);r(114);const i=s.OBJLoader;r(115);const n=s.PLYLoader;class o{constructor(e){this.objLoader=new i(e),this.plyLoader=new n(e)}isValid(e){const t=e.split(".").pop().toLowerCase();return o.extensions.indexOf(t)>=0}get(e){const t=e.split(".").pop().toLowerCase();return new Promise((r,s)=>{if("obj"===t)this.objLoader.load(e,t=>{const i=t.children[0].geometry;return i&&"Geometry"===i.type||"BufferGeometry"===i.type?r(i):s(new Error(`Can't parse geometry from '${e}'`))});else{if("ply"!==t)throw new Error(`Can't load geometry, unknown extension: '${t}' in '${e}'`);this.plyLoader.load(e,t=>t&&"Geometry"===t.type||"BufferGeometry"===t.type?r(t):s(new Error(`Can't parse geometry from '${e}'`)))}})}}o.extensions=["obj","ply"],t.default=o},function(e,t){THREE.OBJLoader=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,r=/^usemtl /;function s(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var s={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(s),s},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){var s=r.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){var r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){var s=this.vertices,i=this.object.geometry.vertices;i.push(s[e+0],s[e+1],s[e+2]),i.push(s[t+0],s[t+1],s[t+2]),i.push(s[r+0],s[r+1],s[r+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){var s=this.normals,i=this.object.geometry.normals;i.push(s[e+0],s[e+1],s[e+2]),i.push(s[t+0],s[t+1],s[t+2]),i.push(s[r+0],s[r+1],s[r+2])},addColor:function(e,t,r){var s=this.colors,i=this.object.geometry.colors;i.push(s[e+0],s[e+1],s[e+2]),i.push(s[t+0],s[t+1],s[t+2]),i.push(s[r+0],s[r+1],s[r+2])},addUV:function(e,t,r){var s=this.uvs,i=this.object.geometry.uvs;i.push(s[e+0],s[e+1]),i.push(s[t+0],s[t+1]),i.push(s[r+0],s[r+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,s,i,n,o,a,c){var l=this.vertices.length,u=this.parseVertexIndex(e,l),d=this.parseVertexIndex(t,l),h=this.parseVertexIndex(r,l);if(this.addVertex(u,d,h),void 0!==s&&""!==s){var p=this.uvs.length;u=this.parseUVIndex(s,p),d=this.parseUVIndex(i,p),h=this.parseUVIndex(n,p),this.addUV(u,d,h)}if(void 0!==o&&""!==o){var m=this.normals.length;u=this.parseNormalIndex(o,m),d=o===a?u:this.parseNormalIndex(a,m),h=o===c?u:this.parseNormalIndex(c,m),this.addNormal(u,d,h)}this.colors.length>0&&this.addColor(u,d,h)},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,r=0,s=e.length;r<s;r++)this.addVertexPoint(this.parseVertexIndex(e[r],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var r=this.vertices.length,s=this.uvs.length,i=0,n=e.length;i<n;i++)this.addVertexLine(this.parseVertexIndex(e[i],r));var o=0;for(n=t.length;o<n;o++)this.addUVLine(this.parseUVIndex(t[o],s))}};return e.startObject("",!1),e}function i(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null}return i.prototype={constructor:i,load:function(e,t,r,s){var i=this,n=new THREE.FileLoader(i.manager);n.setPath(this.path),n.load(e,function(e){t(i.parse(e))},r,s)},setPath:function(e){return this.path=e,this},setMaterials:function(e){return this.materials=e,this},parse:function(i){console.time("OBJLoader");var n=new s;-1!==i.indexOf("\r\n")&&(i=i.replace(/\r\n/g,"\n")),-1!==i.indexOf("\\\n")&&(i=i.replace(/\\\n/g,""));for(var o=i.split("\n"),a="",c="",l=[],u="function"==typeof"".trimLeft,d=0,h=o.length;d<h;d++)if(a=o[d],0!==(a=u?a.trimLeft():a.trim()).length&&"#"!==(c=a.charAt(0)))if("v"===c){var p=a.split(/\s+/);switch(p[0]){case"v":n.vertices.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])),8===p.length&&n.colors.push(parseFloat(p[4]),parseFloat(p[5]),parseFloat(p[6]));break;case"vn":n.normals.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3]));break;case"vt":n.uvs.push(parseFloat(p[1]),parseFloat(p[2]))}}else if("f"===c){for(var m=a.substr(1).trim().split(/\s+/),f=[],v=0,g=m.length;v<g;v++){var y=m[v];if(y.length>0){var b=y.split("/");f.push(b)}}var E=f[0];for(v=1,g=f.length-1;v<g;v++){var _=f[v],w=f[v+1];n.addFace(E[0],_[0],w[0],E[1],_[1],w[1],E[2],_[2],w[2])}}else if("l"===c){var S=a.substring(1).trim().split(" "),P=[],x=[];if(-1===a.indexOf("/"))P=S;else for(var C=0,T=S.length;C<T;C++){var A=S[C].split("/");""!==A[0]&&P.push(A[0]),""!==A[1]&&x.push(A[1])}n.addLineGeometry(P,x)}else if("p"===c){var M=a.substr(1).trim().split(" ");n.addPointGeometry(M)}else if(null!==(l=e.exec(a))){var R=(" "+l[0].substr(1).trim()).substr(1);n.startObject(R)}else if(r.test(a))n.object.startMaterial(a.substring(7).trim(),n.materialLibraries);else if(t.test(a))n.materialLibraries.push(a.substring(7).trim());else{if("s"!==c){if("\0"===a)continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+a+'"')}if((l=a.split(" ")).length>1){var O=l[1].trim().toLowerCase();n.object.smooth="0"!==O&&"off"!==O}else n.object.smooth=!0;(G=n.object.currentMaterial())&&(G.smooth=n.object.smooth)}n.finalize();var D=new THREE.Group;D.materialLibraries=[].concat(n.materialLibraries);for(d=0,h=n.objects.length;d<h;d++){var j=n.objects[d],L=j.geometry,N=j.materials,I="Line"===L.type,k="Points"===L.type,V=!1;if(0!==L.vertices.length){var F=new THREE.BufferGeometry;F.addAttribute("position",new THREE.Float32BufferAttribute(L.vertices,3)),L.normals.length>0?F.addAttribute("normal",new THREE.Float32BufferAttribute(L.normals,3)):F.computeVertexNormals(),L.colors.length>0&&(V=!0,F.addAttribute("color",new THREE.Float32BufferAttribute(L.colors,3))),L.uvs.length>0&&F.addAttribute("uv",new THREE.Float32BufferAttribute(L.uvs,2));for(var U,H=[],B=0,$=N.length;B<$;B++){var z=N[B],G=void 0;if(null!==this.materials)if(G=this.materials.create(z.name),!I||!G||G instanceof THREE.LineBasicMaterial){if(k&&G&&!(G instanceof THREE.PointsMaterial)){var q=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});THREE.Material.prototype.copy.call(q,G),q.color.copy(G.color),q.map=G.map,q.lights=!1,G=q}}else{var Q=new THREE.LineBasicMaterial;THREE.Material.prototype.copy.call(Q,G),Q.color.copy(G.color),Q.lights=!1,G=Q}G||((G=I?new THREE.LineBasicMaterial:k?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial).name=z.name),G.flatShading=!z.smooth,G.vertexColors=V?THREE.VertexColors:THREE.NoColors,H.push(G)}if(H.length>1){for(B=0,$=N.length;B<$;B++){z=N[B];F.addGroup(z.groupStart,z.groupCount,B)}U=I?new THREE.LineSegments(F,H):k?new THREE.Points(F,H):new THREE.Mesh(F,H)}else U=I?new THREE.LineSegments(F,H[0]):k?new THREE.Points(F,H[0]):new THREE.Mesh(F,H[0]);U.name=j.name,D.add(U)}}return console.timeEnd("OBJLoader"),D}},i}()},function(e,t){THREE.PLYLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.propertyNameMapping={}},THREE.PLYLoader.prototype={constructor:THREE.PLYLoader,load:function(e,t,r,s){var i=this,n=new THREE.FileLoader(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.load(e,function(e){t(i.parse(e))},r,s)},setPath:function(e){return this.path=e,this},setPropertyNameMapping:function(e){this.propertyNameMapping=e},parse:function(e){function t(e){var t="",r=0,s=/ply([\s\S]*)end_header\r?\n/.exec(e);null!==s&&(t=s[1],r=s[0].length);var i,n,o,a,c,l,d={comments:[],elements:[],headerLength:r},h=t.split("\n");for(var p=0;p<h.length;p++){var m=h[p];if(""!==(m=m.trim()))switch(n=(o=m.split(/\s+/)).shift(),m=o.join(" "),n){case"format":d.format=o[0],d.version=o[1];break;case"comment":d.comments.push(m);break;case"element":void 0!==i&&d.elements.push(i),(i={}).name=o[0],i.count=parseInt(o[1]),i.properties=[];break;case"property":i.properties.push((a=o,c=u.propertyNameMapping,l=void 0,"list"===(l={type:a[0]}).type?(l.name=a[3],l.countType=a[1],l.itemType=a[2]):l.name=a[1],l.name in c&&(l.name=c[l.name]),l));break;default:console.log("unhandled",n,o)}}return void 0!==i&&d.elements.push(i),d}function r(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function s(e,t){for(var s=t.split(/\s+/),i={},n=0;n<e.length;n++)if("list"===e[n].type){for(var o=[],a=r(s.shift(),e[n].countType),c=0;c<a;c++)o.push(r(s.shift(),e[n].itemType));i[e[n].name]=o}else i[e[n].name]=r(s.shift(),e[n].type);return i}function i(e,t){var r,i={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},a="";null!==(r=/end_header\s([\s\S]*)$/.exec(e))&&(a=r[1]);for(var c=a.split("\n"),l=0,u=0,d=0;d<c.length;d++){var h=c[d];if(""!==(h=h.trim())){u>=t.elements[l].count&&(l++,u=0);var p=s(t.elements[l].properties,h);o(i,t.elements[l].name,p),u++}}return n(i)}function n(e){var t=new THREE.BufferGeometry;return e.indices.length>0&&t.setIndex(e.indices),t.addAttribute("position",new THREE.Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&t.addAttribute("normal",new THREE.Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&t.addAttribute("uv",new THREE.Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&t.addAttribute("color",new THREE.Float32BufferAttribute(e.colors,3)),e.faceVertexUvs.length>0&&(t=t.toNonIndexed()).addAttribute("uv",new THREE.Float32BufferAttribute(e.faceVertexUvs,2)),t.computeBoundingSphere(),t}function o(e,t,r){if("vertex"===t)e.vertices.push(r.x,r.y,r.z),"nx"in r&&"ny"in r&&"nz"in r&&e.normals.push(r.nx,r.ny,r.nz),"s"in r&&"t"in r&&e.uvs.push(r.s,r.t),"red"in r&&"green"in r&&"blue"in r&&e.colors.push(r.red/255,r.green/255,r.blue/255);else if("face"===t){var s=r.vertex_indices||r.vertex_index,i=r.texcoord;3===s.length?(e.indices.push(s[0],s[1],s[2]),i&&6===i.length&&(e.faceVertexUvs.push(i[0],i[1]),e.faceVertexUvs.push(i[2],i[3]),e.faceVertexUvs.push(i[4],i[5]))):4===s.length&&(e.indices.push(s[0],s[1],s[3]),e.indices.push(s[1],s[2],s[3]))}}function a(e,t,r,s){switch(r){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,s),2];case"uint16":case"ushort":return[e.getUint16(t,s),2];case"int32":case"int":return[e.getInt32(t,s),4];case"uint32":case"uint":return[e.getUint32(t,s),4];case"float32":case"float":return[e.getFloat32(t,s),4];case"float64":case"double":return[e.getFloat64(t,s),8]}}function c(e,t,r,s){for(var i,n={},o=0,c=0;c<r.length;c++)if("list"===r[c].type){var l=[],u=(i=a(e,t+o,r[c].countType,s))[0];o+=i[1];for(var d=0;d<u;d++)i=a(e,t+o,r[c].itemType,s),l.push(i[0]),o+=i[1];n[r[c].name]=l}else i=a(e,t+o,r[c].type,s),n[r[c].name]=i[0],o+=i[1];return[n,o]}var l,u=this;if(e instanceof ArrayBuffer){var d=THREE.LoaderUtils.decodeText(new Uint8Array(e)),h=t(d);l="ascii"===h.format?i(d,h):function(e,t){for(var r,s={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},i="binary_little_endian"===t.format,a=new DataView(e,t.headerLength),l=0,u=0;u<t.elements.length;u++)for(var d=0;d<t.elements[u].count;d++){l+=(r=c(a,l,t.elements[u].properties,i))[1];var h=r[0];o(s,t.elements[u].name,h)}return n(s)}(e,h)}else l=i(e,t(e));return l}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0);class i{constructor(e){this.textureLoader=new s.TextureLoader(e)}isValid(e){const t=e.split(".").pop().toLowerCase();return i.extensions.indexOf(t)>=0}isValidMimeType(e){return i.mimeTypes.indexOf(e)>=0}get(e){return new Promise((t,r)=>{this.textureLoader.load(e,e=>{t(e)},null,e=>{console.error(e),r(new Error(e.message))})})}getImmediate(e){return this.textureLoader.load(e,null,null,e=>{console.error(e)})}}i.extensions=["jpg","png"],i.mimeTypes=["image/jpeg","image/png"],t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.visited={},this.visiting={},this.sorted=[]}sort(e){for(let t=0,r=e.length;t<r;++t)this.visit(e[t]);const t=this.sorted;return this.visited={},this.visiting={},this.sorted=[],t}visit(e){const t=this.visited,r=this.visiting;if(t[e.id]||r[e.id])return;r[e.id]=!0;const s=e.outs.properties;for(let e=0,t=s.length;e<t;++e){const t=s[e].outLinks;for(let e=0,r=t.length;e<r;++e){const r=t[e].destination.group,s=r.properties;for(let e=0,t=s.length;e<t;++e){const t=s[e].outLinks;for(let e=0,r=t.length;e<r;++e){const r=t[e].destination.group;this.visit(r.linkable)}}this.visit(r.linkable)}}r[e.id]=void 0,t[e.id]=!0,this.sorted.unshift(e)}}},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(119),n=r(120),o=r(53),a=r(127);let c=class extends o.default{constructor(e){super(e),this.view=null,this.canvas=null,this.overlay=null,this.splitter=null,this.onResize=this.onResize.bind(this),this.manipTarget=new i.default,this.addEventListener("pointerdown",this.manipTarget.onPointerDown),this.addEventListener("pointermove",this.manipTarget.onPointerMove),this.addEventListener("pointerup",this.manipTarget.onPointerUpOrCancel),this.addEventListener("pointercancel",this.manipTarget.onPointerUpOrCancel),this.addEventListener("wheel",this.manipTarget.onWheel),this.addEventListener("contextmenu",this.manipTarget.onContextMenu)}firstConnected(){this.classList.add("sv-scene-view"),this.style.touchAction="none",this.setAttribute("touch-action","none"),this.canvas=this.appendElement("canvas",{display:"block",width:"100%",height:"100%"}),this.overlay=this.appendElement("div",{position:"absolute",top:"0",bottom:"0",left:"0",right:"0",overflow:"hidden"}),this.overlay.classList.add("sv-content-overlay"),this.splitter=this.appendElement(a.default,{position:"absolute",top:"0",bottom:"0",left:"0",right:"0",overflow:"hidden"}),this.splitter.onChange=(e=>{this.view.horizontalSplit=e.horizontalSplit,this.view.verticalSplit=e.verticalSplit}),this.view=new n.default(this.system,this.canvas,this.overlay),this.view.on("layout",e=>this.splitter.layout=e.layout),this.view.layout=a.EQuadViewLayout.Single,this.splitter.layout=a.EQuadViewLayout.Single,this.manipTarget.next=this.view}connected(){this.view.attach(),window.addEventListener("resize",this.onResize),window.dispatchEvent(new CustomEvent("resize"))}disconnected(){this.view.detach(),window.removeEventListener("resize",this.onResize)}onResize(){this.view.resize()}};c=s([o.customElement("sv-scene-view")],c),t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=2;t.default=class{constructor(){this.next=null,this.activePositions=[],this.activeType="",this.centerX=0,this.centerY=0,this.startX=0,this.startY=0,this.isDragging=!1,this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUpOrCancel=this.onPointerUpOrCancel.bind(this),this.onDoubleClick=this.onDoubleClick.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this)}onPointerDown(e){if(this.activeType&&e.pointerType!==this.activeType)return;0===this.activePositions.length&&(this.startX=e.clientX,this.startY=e.clientY,this.isDragging=!1),this.activeType=e.pointerType,this.activePositions.push({id:e.pointerId,clientX:e.clientX,clientY:e.clientY}),e.currentTarget.setPointerCapture(e.pointerId);const t=this.createManipPointerEvent(e,"pointer-down");this.sendPointerEvent(t)&&e.stopPropagation(),e.preventDefault()}onPointerMove(e){const t=this.activePositions;for(let r=0,s=t.length;r<s;++r){const s=t[r];e.pointerId===s.id&&(s.clientX=e.clientX,s.clientY=e.clientY)}t.length>0&&!this.isDragging&&Math.abs(e.clientX-this.startX)+Math.abs(e.clientY-this.startY)>s&&(this.isDragging=!0);const r=t.length?"pointer-move":"pointer-hover",i=this.createManipPointerEvent(e,r);this.sendPointerEvent(i)&&e.stopPropagation(),e.preventDefault()}onPointerUpOrCancel(e){const t=this.activePositions;let r=!1;for(let s=0,i=t.length;s<i;++s)if(e.pointerId===t[s].id){t.splice(s,1),r=!0;break}if(!r)return;const s=this.createManipPointerEvent(e,"pointer-up");0===t.length&&(this.activeType=""),this.sendPointerEvent(s)&&e.stopPropagation(),e.preventDefault()}onDoubleClick(e){this.sendTriggerEvent(this.createManipTriggerEvent(e,"double-click"))&&e.preventDefault()}onContextMenu(e){this.sendTriggerEvent(this.createManipTriggerEvent(e,"context-menu")),e.preventDefault()}onWheel(e){this.sendTriggerEvent(this.createManipTriggerEvent(e,"wheel"))&&e.preventDefault()}createManipPointerEvent(e,t){let r=0,s=0,i=0,n=0,o=0,a=0;const c=this.activePositions,l=c.length;if(l>0){for(let e=0;e<l;++e)r+=c[e].clientX,s+=c[e].clientY;r/=l,s/=l,"pointer-move"!==t&&"pointer-hover"!==t||(o=r-this.centerX,a=s-this.centerY),this.centerX=r,this.centerY=s}else r=this.centerX,s=this.centerY;const u=e.currentTarget;if(u instanceof Element){const t=u.getBoundingClientRect();i=e.clientX-t.left,n=e.clientY-t.top}return{originalEvent:e,type:t,source:e.pointerType,isPrimary:e.isPrimary,isDragging:this.isDragging,activePositions:c,pointerCount:l,centerX:r,centerY:s,localX:i,localY:n,movementX:o,movementY:a,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey}}createManipTriggerEvent(e,t){let r=0;"wheel"===t&&(r=e.deltaY);let s=0,i=0;const n=e.currentTarget;if(n instanceof Element){const t=n.getBoundingClientRect();s=e.clientX-t.left,i=e.clientY-t.top}return{originalEvent:e,type:t,wheel:r,centerX:e.clientX,centerY:e.clientY,localX:s,localY:i,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey}}sendPointerEvent(e){return this.next&&this.next.onPointer(e)}sendTriggerEvent(e){return this.next&&this.next.onTrigger(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(24),i=r(121);var n;!function(e){e[e.Single=0]="Single",e[e.HorizontalSplit=1]="HorizontalSplit",e[e.VerticalSplit=2]="VerticalSplit",e[e.Quad=3]="Quad"}(n=t.EQuadViewLayout||(t.EQuadViewLayout={}));t.default=class extends i.default{constructor(e,t,r){super(e,t,r),this._layout=n.Quad,this._horizontalSplit=.5,this._verticalSplit=.5,this.addEvent("layout"),this.layout=n.Single}set layout(e){if(e===this._layout)return;this._layout=e;const t=this.viewports;switch(this._layout){case n.Single:this.setViewportCount(1);break;case n.HorizontalSplit:case n.VerticalSplit:this.setViewportCount(2);break;case n.Quad:this.setViewportCount(4)}this.updateSplitPositions(),t[1]&&(t[1].setBuiltInCamera(s.EProjection.Orthographic,s.EViewPreset.Top),t[1].enableCameraControl(!0).orientationEnabled=!1),t[2]&&(t[2].setBuiltInCamera(s.EProjection.Orthographic,s.EViewPreset.Left),t[2].enableCameraControl(!0).orientationEnabled=!1),t[3]&&(t[3].setBuiltInCamera(s.EProjection.Orthographic,s.EViewPreset.Front),t[3].enableCameraControl(!0).orientationEnabled=!1),this.emit({type:"layout",layout:e})}get layout(){return this._layout}set horizontalSplit(e){this._horizontalSplit=e,this.updateSplitPositions()}get horizontalSplit(){return this._horizontalSplit}set verticalSplit(e){this._verticalSplit=e,this.updateSplitPositions()}get verticalSplit(){return this._verticalSplit}updateSplitPositions(){const e=this._horizontalSplit,t=this._verticalSplit;switch(this._layout){case n.Single:this.viewports[0].setSize(0,0,1,1);break;case n.HorizontalSplit:this.viewports[0].setSize(0,0,e,1),this.viewports[1].setSize(e,0,1-e,1);break;case n.VerticalSplit:this.viewports[0].setSize(0,1-t,1,t),this.viewports[1].setSize(0,0,1,1-t);break;case n.Quad:this.viewports[0].setSize(0,1-t,e,t),this.viewports[1].setSize(e,1-t,1-e,t),this.viewports[2].setSize(0,0,e,1-t),this.viewports[3].setSize(e,0,1-e,1-t)}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(6),n=r(57),o=r(122);t.Viewport=o.default;const a=r(58),c=r(60),l=r(31),u=r(24);t.default=class extends i.default{constructor(e,t,r){super(),this.viewports=[],this.rendererComponent=null,this.targetViewport=null,this.targetObject3D=null,this.targetComponent=null,this.targetScene=null,this.targetCamera=null,this.defaultScene=new s.Scene,this.defaultCamera=new u.default,this.shouldResize=!1,this.system=e,this.canvas=t,this.overlay=r,this.renderer=new s.WebGLRenderer({canvas:t,antialias:!0}),this.renderer.autoClear=!1,this.picker=new c.default(this.renderer)}dispose(){this.renderer.dispose(),this.viewports.forEach(e=>e.dispose())}get canvasWidth(){return this.canvas.width}get canvasHeight(){return this.canvas.height}attach(){const e=this.canvasWidth,t=this.canvasHeight;this.viewports.forEach(r=>r.setCanvasSize(e,t)),this.renderer.setSize(e,t,!1),this.rendererComponent=this.system.getComponent(l.default,!0),this.rendererComponent.attachView(this)}detach(){this.rendererComponent=this.system.getComponent(l.default,!0),this.rendererComponent.detachView(this),this.rendererComponent=null}renderImage(e,t,r,s){console.log("RenderView.renderImage - width: %s, height: %s, format: %s, quality: %s",e,t,r,s);const i=this.canvas.width,n=this.canvas.height;this.setRenderSize(e,t),this.render();const o=this.canvas.toDataURL(r,s);return this.setRenderSize(i,n),o}render(){const e=this.rendererComponent.activeSceneComponent;if(!e)return;let t=e.scene,r=e.activeCamera;t&&r||(console.warn(t?"no camera":r?"no scene":"no scene/camera"),t=this.defaultScene,r=this.defaultCamera);const s=this.renderer;s.clear(),s.__view=this;const i=this.viewports;for(let e=0,n=i.length;e<n;++e){const n=i[e];s.__viewport=n;const o=n.updateCamera(r);n.applyViewport(this.renderer),s.render(t,o)}}setRenderSize(e,t){this.canvas.width=e,this.canvas.height=t,this.viewports.forEach(r=>r.setCanvasSize(e,t)),this.renderer.setSize(e,t,!1)}resize(){this.setRenderSize(this.canvas.clientWidth,this.canvas.clientHeight),this.render()}setViewportCount(e){const t=this.viewports;for(let r=e;r<t.length;++r)t[r].dispose();for(let r=t.length;r<e;++r){const e=(new a.default).appendTo(this.overlay);t[r]=new o.default,t[r].setCanvasSize(this.canvasWidth,this.canvasHeight),t[r].overlay=e}t.length=e}getViewportCount(){return this.viewports.length}onPointer(e){if(!this.system)return!1;let t=!1,r=!1;"pointer-hover"===e.type?r=!0:e.isPrimary&&"pointer-down"===e.type&&(r=!0,t=!0);const s=this.routeEvent(e,r,t);if(s){const e=s.component;if(e){e.emit(s);const t=e.getComponent(n.default);!s.stopPropagation&&t&&t.propagateUp(!1,!0,s)}return s.stopPropagation||this.system.emit(s),s.stopPropagation||s.viewport.onPointer(s)&&this.system.getMainComponent(l.default).forceRender(),!0}return!1}onTrigger(e){if(!this.system)return!1;const t=this.routeEvent(e,!0,!0);if(t){const e=t.component;if(e){e.emit(t);const r=e.getComponent(n.default);!t.stopPropagation&&r&&r.propagateUp(!1,!0,t)}return t.stopPropagation||this.system.emit(t),t.stopPropagation||t.viewport.onTrigger(t)&&this.system.getMainComponent(l.default).forceRender(),!0}return!1}pickPosition(e,t,r){return this.picker.pickPosition(this.targetScene,this.targetCamera,e,t,r)}pickNormal(e,t){return this.picker.pickNormal(this.targetScene,this.targetCamera,e,t)}routeEvent(e,t,r){let s=this.targetViewport,i=this.targetObject3D,n=this.targetComponent;if(t){s=null;const t=this.viewports;for(let r=0,i=t.length;r<i;++r){const i=t[r];if(i.isInside(e)){s=i;break}}}if(!s)return null;const o=e;if(o.view=this,o.viewport=s,o.deviceX=s.getDeviceX(e.localX),o.deviceY=s.getDeviceY(e.localY),o.stopPropagation=!1,r){const t=this.rendererComponent.activeSceneComponent,r=this.targetScene=t&&t.scene,s=this.targetCamera=t&&t.activeCamera;if(i=null,n=null,r&&s)if(void 0===(i=this.picker.pickObject(r,s,e)))console.log("Pick Index - Background");else{let e=i;for(;e&&!n;)(n=e.userData.component)||(e=e.parent);n?console.log("Pick Index - Component: %s",n.typeName):console.warn("Pick Index - Object without component")}}return o.object3D=i,o.component=n,this.targetViewport=s,this.targetObject3D=i,this.targetComponent=n,o}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(6),n=r(24),o=r(58),a=r(59);t.default=class extends i.default{constructor(e){super(),this.next=null,this._canvasWidth=1,this._canvasHeight=1,this._overlay=null,this._camera=null,this._controller=null,this.addEvent("dispose"),this.next=null,e=e||{},this._relRect={x:e.x||0,y:e.y||0,width:e.width||1,height:e.height||1},this._absRect={x:0,y:0,width:1,height:1},e.overlay&&(this._overlay=e.overlay)}get x(){return this._absRect.x}get y(){return this._absRect.y}get width(){return this._absRect.width}get height(){return this._absRect.height}get canvasWidth(){return this._canvasWidth}get canvasHeight(){return this._canvasHeight}get camera(){return this._camera}get controller(){return this._controller}get overlay(){return this._overlay}set overlay(e){this._overlay=e,this.updateGeometry()}dispose(){console.log("Viewport.dispose - "+this.toString()),this.emit({type:"dispose",viewport:this}),this._overlay&&(this._overlay.remove(),this._overlay=null)}setSize(e,t,r,s){const i=this._relRect;i.x=e,i.y=t,i.width=r,i.height=s,this.updateGeometry()}setCanvasSize(e,t){this._canvasWidth=e,this._canvasHeight=t,this.updateGeometry(),this._controller&&this._controller.setViewportSize(e,t)}setBuiltInCamera(e,t){this._camera?this._camera.setProjection(e):(this._camera=new n.default(e),this._camera.matrixAutoUpdate=!1),void 0!==t&&(this._camera.setPreset(t),this.overlay.setLabel(o.ELocation.TopRight,"view",n.EViewPreset[t],"ff-label-box"))}unsetBuiltInCamera(){this._camera=null,this._controller=null,this.overlay.unsetLabel(o.ELocation.TopRight,"view")}enableCameraControl(e){return!e&&this._controller?this._controller=null:e&&this._camera&&(this._controller||(this._controller=new a.default(this._camera),this._controller.setViewportSize(this.width,this.height),this._controller.updateController())),this._controller}zoomExtents(e){const t=this._camera,r=this._controller;t&&r&&(r.zoomExtents(e),r.updateCamera(null,!0))}isInside(e){return this.isPointInside(e.localX,e.localY)}isPointInside(e,t){const r=this._absRect;return t=this.canvasHeight-t,e>=r.x&&e<r.x+r.width&&t>=r.y&&t<r.y+r.height}getDevicePoint(e,t,r){const i=this._absRect,n=(e-i.x)/i.width*2-1,o=(this.canvasHeight-t-i.y)/i.height*2-1;return r?r.set(n,o):new s.Vector2(n,o)}getDeviceX(e){const t=this._absRect;return(e-t.x)/t.width*2-1}getDeviceY(e){const t=this._absRect;return(this.canvasHeight-e-t.y)/t.height*2-1}updateCamera(e){let t=e;if(this._camera&&(t=this._camera,this._controller&&this._controller.updateCamera()),!t)return;const r=this._absRect,s=r.width/r.height;if(s!==t.userData.aspect)if(t.userData.aspect=s,t.isUniversalCamera||t.isPerspectiveCamera)t.aspect=s,t.updateProjectionMatrix();else if(t.isOrthographicCamera){const e=.5*(t.top-t.bottom);t.left=-e*s,t.right=e*s,t.updateProjectionMatrix()}return t}applyViewport(e){const t=this._absRect;e.setViewport(t.x,t.y,t.width,t.height),e.viewport=this}applyPickViewport(e,t){const r=this._absRect,s=t.localX-r.x,i=this.canvasHeight-t.localY-r.y;e.viewport.set(-s,-i,r.width,r.height)}toViewportEvent(e){const t=e;return t.viewport=this,t.deviceX=this.getDeviceX(e.localX),t.deviceY=this.getDeviceY(e.localY),t}onPointer(e){return!!this._controller&&this._controller.onPointer(e)}onTrigger(e){return!!this._controller&&this._controller.onTrigger(e)}toString(){return`Viewport (x: ${this.x}, y: ${this.y}, width: ${this.width}, height: ${this.height})`}updateGeometry(){const e=this._relRect,t=this._absRect,r=this._canvasWidth,s=this._canvasHeight;t.x=Math.round(e.x*r),t.y=Math.round(e.y*s),t.width=Math.round(e.width*r),t.height=Math.round(e.height*s);const i=this._overlay;if(i){const e=this.canvasHeight-t.y-t.height;i.style.left=t.x?t.x.toFixed()+"px":"0",i.style.top=e?e.toFixed()+"px":"0",i.style.width=t.width.toFixed()+"px",i.style.height=t.height.toFixed()+"px"}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(19),n=new s.Vector4,o=(new s.Vector4,new s.Vector3),a=new s.Vector3,c=new s.Matrix4,l=new s.Euler,u=new s.Quaternion,d={PI:3.141592653589793,DOUBLE_PI:6.283185307179586,HALF_PI:1.5707963267948966,QUARTER_PI:.7853981633974483,DEG2RAD:.017453292519943295,RAD2DEG:57.29577951308232,composeOrbitMatrix:function(e,t,r){const i=e.x,n=e.y,o=e.z,a=t.x,c=t.y,l=t.z,u=Math.sin(i),d=Math.cos(i),h=Math.sin(n),p=Math.cos(n),m=Math.sin(o),f=Math.cos(o),v=p*f,g=f*h*u-m*d,y=f*h*d+m*u,b=p*m,E=u*h*m+f*d,_=m*h*d-f*u,w=-h,S=p*u,P=p*d,x=(r=r||new s.Matrix4).elements;return x[0]=v,x[1]=b,x[2]=w,x[3]=0,x[4]=g,x[5]=E,x[6]=S,x[7]=0,x[8]=y,x[9]=_,x[10]=P,x[11]=0,x[12]=a*v+c*g+l*y,x[13]=a*b+c*E+l*_,x[14]=a*w+c*S+l*P,x[15]=1,r},decomposeOrbitMatrix:function(e,t,r){l.setFromRotationMatrix(e,"ZYX"),l.toVector3(t),c.getInverse(e),n.set(0,0,0,1),n.applyMatrix4(c),r.x=-n.x,r.y=-n.y,r.z=-n.z},isMatrix4Identity:function(e){const t=e.elements;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]},decomposeTransformMatrix:function(e,t,r,s){c.fromArray(e),c.decompose(o,u,a),l.setFromQuaternion(u,"XYZ"),o.toArray(t),a.toArray(s),l.toVector3(o),n.multiplyScalar(i.default.RAD2DEG),o.toArray(r)}};t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0);t.default=class extends s.ShaderMaterial{constructor(){super(...arguments),this.isIndexShader=!0,this.uniformsNeedUpdate=!1,this.lights=!1,this.uniforms={index:{value:[0,0,0]}},this.vertexShader=["void main() {","  #include <begin_vertex>","  #include <project_vertex>","}"].join("\n"),this.fragmentShader=["uniform vec3 index;","void main() {","  gl_FragColor = vec4(index, 1.0);","}"].join("\n")}static indexFromPixel(e){return e[0]+e[1]<<8+e[2]<<16}static zoneFromPixel(e){return e[3]}setIndex(e){const t=e>>16,r=(e>>8)-(t<<8),s=e-(t<<16)-(r<<8),i=this.uniforms.index.value;i[0]=s/255,i[1]=r/255,i[2]=t/255,this.uniformsNeedUpdate=!0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0);t.default=class extends s.ShaderMaterial{constructor(){super(...arguments),this.isPositionShader=!0,this.uniforms={index:{value:0},range:{value:[-1,1]}},this.vertexShader=["varying vec3 vLocalPosition;","void main() {","  #include <begin_vertex>","  #include <project_vertex>","  vLocalPosition = vec3(position);","}"].join("\n"),this.fragmentShader=["uniform float index;","uniform vec2 range;","varying vec3 vLocalPosition;","vec4 toVec4(float v) {","  float vn = (v - range.x) / (range.y - range.x);","  float b0 = floor(vn * 255.0) / 255.0; vn = (vn - b0) * 256.0;","  float b1 = floor(vn * 255.0) / 255.0; vn = (vn - b1) * 256.0;","  float b2 = floor(vn * 255.0) / 255.0; vn = (vn - b2) * 256.0;","  float b3 = floor(vn * 255.0) / 255.0;","  return vec4(clamp(b0, 0.0, 1.0), clamp(b1, 0.0, 1.0), clamp(b2, 0.0, 1.0), clamp(b3, 0.0, 1.0));","}","void main() {","  gl_FragColor = (index == 0.0 ? toVec4(vLocalPosition.x)","    : (index == 1.0 ? toVec4(vLocalPosition.y) : toVec4(vLocalPosition.z)));","}"].join("\n")}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0);t.default=class extends s.ShaderMaterial{constructor(){super(...arguments),this.isNormalShader=!0,this.uniforms={index:{value:0}},this.vertexShader=["varying vec3 vLocalNormal;","void main() {","  #include <beginnormal_vertex>","  #include <begin_vertex>","  #include <project_vertex>","  vLocalNormal = vec3(normal);","}"].join("\n"),this.fragmentShader=["uniform vec3 index;","varying vec3 vLocalNormal;","void main() {","  vec3 normal = normalize(vLocalNormal);","  gl_FragColor = vec4(normal * 0.5 + 0.5, 1.0);","}"].join("\n")}}},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0}),r(128);const i=r(11);var n;!function(e){e[e.Single=0]="Single",e[e.HorizontalSplit=1]="HorizontalSplit",e[e.VerticalSplit=2]="VerticalSplit",e[e.Quad=3]="Quad"}(n=t.EQuadViewLayout||(t.EQuadViewLayout={}));let o=class extends i.default{constructor(){super(...arguments),this.layout=n.Single,this.horizontalPosition=.5,this.verticalPosition=.5}firstConnected(){this.classList.add("ff-quad-splitter")}render(){const e=this.layout;if(e===n.Single)return i.html``;const t=[];return e!==n.HorizontalSplit&&e!==n.Quad||t.push(i.html`
                <div class="ff-horizontal" style="position:absolute; top:0; bottom:0; left:0; right:0; display:flex;">
                    <div class="ff-left" style="flex:1 1;"></div>
                    <ff-splitter direction="horizontal" position=${this.horizontalPosition} @ff-splitter-change=${this.onSplitterChange}></ff-splitter>
                    <div style="flex:1 1;"></div>
                </div>
            `),e!==n.VerticalSplit&&e!==n.Quad||t.push(i.html`
                <div class="ff-vertical" style="position:absolute; top:0; bottom:0; left:0; right:0; display:flex; flex-direction: column">
                    <div class="ff-top" style="flex:1 1;"></div>
                    <ff-splitter direction="vertical" position=${this.verticalPosition} @ff-splitter-change=${this.onSplitterChange}></ff-splitter>
                    <div style="flex:1 1;"></div>
                </div>
            `),i.html`${t}`}onSplitterChange(e){"horizontal"===e.detail.direction?this.horizontalPosition=e.detail.position:this.verticalPosition=e.detail.position,this.onChange&&this.onChange({layout:this.layout,horizontalSplit:this.horizontalPosition,verticalSplit:this.verticalPosition,isDragging:e.detail.isDragging})}};s([i.property({attribute:!1})],o.prototype,"layout",void 0),s([i.property({attribute:!1})],o.prototype,"horizontalPosition",void 0),s([i.property({attribute:!1})],o.prototype,"verticalPosition",void 0),o=s([i.customElement("ff-quad-splitter")],o),t.default=o},function(e,t,r){"use strict";var s,i=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const n=r(11);let o=s=class extends n.default{constructor(){super(),this.direction="horizontal",this.width=5,this.margin=20,this.detached=!1,this._isActive=!1,this._offset=0,this._position=0,this.addEventListener("pointerdown",e=>this.onPointerDown(e)),this.addEventListener("pointermove",e=>this.onPointerMove(e)),this.addEventListener("pointerup",e=>this.onPointerUpOrCancel(e)),this.addEventListener("pointercancel",e=>this.onPointerUpOrCancel(e))}get position(){return this._position}isHorizontal(){return"horizontal"===this.direction}update(e){super.update(e);const t=this.isHorizontal(),r=this.width;this.setStyle({padding:t?`0 ${r}px`:`${r}px 0`,margin:t?`0 ${-r}px`:`${-r}px 0`,cursor:t?"col-resize":"row-resize"})}firstUpdated(){this.classList.add("ff-splitter"),this.setAttribute("touch-action","none"),this.setStyle({position:"relative",display:"block",zIndex:"1",touchAction:"none"})}onPointerDown(e){if(e.isPrimary){e.stopPropagation(),e.preventDefault(),this._isActive=!0,this.setPointerCapture(e.pointerId);const t=this.getBoundingClientRect();this._offset=this.isHorizontal()?t.left+.5*t.width-e.clientX:t.top+.5*t.height-e.clientY}}onPointerMove(e){if(e.isPrimary&&this._isActive){e.stopPropagation(),e.preventDefault();const t=this.parentElement;if(!t)return;const r=t.getBoundingClientRect(),i=this.isHorizontal(),n=i?r.width:r.height;let o=this._offset+(i?e.clientX-r.left:e.clientY-r.top),a=o/n;if(!this.detached){const e=this.previousElementSibling,r=this.nextElementSibling;if(e instanceof HTMLElement&&r instanceof HTMLElement){const c=Array.from(t.children);let l=0,u=n,d=!1;c.forEach(t=>{if(t instanceof s)return;if(t===e||t===r)return void(d=!0);const n=t.getBoundingClientRect(),o=i?n.width:n.height;u-=o,d||(l+=o)});const h=this.margin,p=u-h,m=(u-(o=(o-=l)<h?h:o>p?p:o))/n;a=o/n,e.style.flexBasis=(100*a).toFixed(3)+"%",r.style.flexBasis=(100*m).toFixed(3)+"%",setTimeout(()=>window.dispatchEvent(new CustomEvent("resize")),0)}}this._position=a,this.dispatchEvent(new CustomEvent(s.changeEvent,{detail:{direction:this.direction,position:this._position,isDragging:!0}}))}}onPointerUpOrCancel(e){e.isPrimary&&(e.stopPropagation(),e.preventDefault(),this._isActive=!1,this.dispatchEvent(new CustomEvent(s.changeEvent,{detail:{direction:this.direction,position:this._position,isDragging:!1}})))}};o.changeEvent="ff-splitter-change",i([n.property({type:String})],o.prototype,"direction",void 0),i([n.property({type:Number})],o.prototype,"width",void 0),i([n.property({type:Number})],o.prototype,"margin",void 0),i([n.property({type:Boolean})],o.prototype,"detached",void 0),o=s=i([n.customElement("ff-splitter")],o),t.default=o},function(e,t,r){"use strict";var s,i=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const n=r(11);let o=s=class extends n.default{constructor(){super(...arguments),this.visible=!1}firstConnected(){super.firstConnected(),this.classList.add("sv-spinner")}render(){return this.style.visibility=this.visible?"visible":"hidden",s.template}};o.template=n.html`<div class="sv-spinner-wheel"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve"><style type="text/css">.st0{fill:none;stroke:#009ADE;stroke-width:5;stroke-miterlimit:10;}.st1{fill:none;stroke:#FFCD00;stroke-width:5;stroke-miterlimit:10;}</style><circle class="st0" cx="256.6" cy="256" r="252"/><path class="st1" d="M408.6,307c-16.3-28-42.1-28.4-45.3-28.3c0,0,0-0.1,0-0.1L472,256l-108.7-22.6l0,0c1.1-1,22.3-19.7,54-20.2 c23.9-0.4,44.6-29.6,31.4-52.1c0,0-3.9,35.4-48.6,23.6c-31.4-8.3-49.9,9.7-52,12l0,0l60.9-93L316,164.5c0,0,0,0,0,0 c0.1-1.4,1.8-29.6,23.9-52.4c16.7-17.2,10.6-52.5-14.6-59.1c0,0,22.2,27.8-17.7,51c-28.1,16.3-28.4,42.1-28.3,45.3l-0.1,0 L256.6,40.5l-22.7,108.7c0,0,0,0,0,0c-0.9-1-19.7-22.2-20.2-54c-0.4-23.9-29.6-44.6-52.1-31.4c0,0,35.3,3.9,23.6,48.6 c-8.3,31.5,9.8,49.9,12,52.1l0,0l-93-60.9l0,0l0,0l49.6,75.7l11.3,17.2c0,0,0,0,0,0c-0.9,0-29.4-1.6-52.5-23.9 c-17.2-16.7-52.5-10.6-59.1,14.6c0,0,27.8-22.2,51,17.7c16.4,28.1,42.3,28.4,45.3,28.3c0,0,0,0,0,0L41.1,256l108.8,22.7v0 c-0.7,0.7-22,19.7-54,20.2c-23.9,0.4-44.6,29.6-31.4,52.1c0,0,3.9-35.4,48.6-23.6c31.5,8.3,50-9.9,52.1-12c0,0,0,0.1,0.1,0.1 l-60.9,92.9l92.9-60.9c0,1-1.6,29.5-23.9,52.5c-16.7,17.2-10.6,52.5,14.6,59.1c0,0-22.2-27.8,17.7-51c28.1-16.4,28.4-42.2,28.3-45.3 c0,0,0.1,0,0.1,0l22.7,108.7l22.7-108.7l0,0c0.8,0.9,19.7,22.1,20.2,54c0.4,23.9,29.6,44.6,52.1,31.4c0,0-35.3-3.9-23.6-48.5 c8.3-31.5-9.8-49.9-12-52.1c0,0,0.1,0,0.1-0.1l92.9,60.9l-32.1-49.1L348,315.4l0,0c1.3,0.1,29.6,1.7,52.4,23.9 c17.2,16.7,52.5,10.6,59.1-14.6C459.6,324.7,431.8,346.9,408.6,307z"/></svg></div>`,i([n.property({type:Boolean})],o.prototype,"visible",void 0),o=s=i([n.customElement("sv-spinner")],o),t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(131),i=r(55),n=r(54),o=r(132),a=r(204),c=r(205),l=r(35),u=r(16),d=r(94),h=r(95),p=r(49);class m{constructor(e,t){this.props=t,console.log(m.splashMessage);const r=new i.default;r.add(o.default),r.add(a.default);const s=this.system=new n.default(r),l=s.graph.createCustomNode(d.default);s.graph.createCustomNode(h.default),e&&new p.default(this).appendTo(e),this.documentProvider.createDocument(c),this.evaluateProps(),l.pulse.start()}get assetReader(){return this.system.getMainComponent(u.default)}get documentProvider(){return this.system.getMainComponent(l.default)}setRootUrl(e){this.assetReader.rootUrl=e}loadDocument(e,t){return this.assetReader.getJSON(e).then(r=>(t=void 0===t?!r.lights&&!r.cameras:t,this.documentProvider.amendDocument(r,e,t))).catch(e=>{throw console.warn(`error while loading document: ${e.message}`),e})}loadModel(e,t){return this.documentProvider.appendModel(e,t)}loadGeometry(e,t,r,s,i){return this.documentProvider.appendGeometry(e,t,r,s,i)}evaluateProps(){const e=this.props,t=this.assetReader;e.root=e.root||s.default("root")||s.default("r"),e.document=e.document||s.default("document")||s.default("d"),e.model=e.model||s.default("model")||s.default("m"),e.geometry=e.geometry||s.default("geometry")||s.default("g"),e.texture=e.texture||s.default("texture")||s.default("t"),this.setRootUrl(e.root||e.document||e.model||e.geometry||""),e.document&&(e.document=e.root?e.document:t.getAssetName(e.document),this.loadDocument(e.document)),e.model?(e.model=e.root?e.model:t.getAssetName(e.model),this.loadModel(e.model,"Medium")):e.geometry&&(e.geometry=e.root?e.geometry:t.getAssetName(e.geometry),e.texture=e.root?e.texture:t.getAssetName(e.texture),this.loadGeometry(e.geometry,e.texture,null,null,"Medium"))}}m.splashMessage=["Voyager - 3D Explorer and Tool Suite","3D Foundation Project","(c) 2018 Smithsonian Institution","https://3d.si.edu"].join("\n"),t.default=m,window.VoyagerMini=m},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const r=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);if(r)return r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):""}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(30),i=r(38),n=r(61),o=r(62),a=r(40),c=r(31),l=r(63),u=r(64),d=r(25),h=r(8),p=r(16),m=r(65),f=r(35),v=r(22),g=r(34),y=r(45),b=r(27),E=r(12),_=r(203),w=r(47),S=r(74),P=r(75),x=r(76),C=r(77),T=r(84),A=r(85),M=r(48),R=r(86),O=r(87),D=r(88),j=r(89),L=r(90),N=r(91),I=r(92),k=r(93),V=r(94),F=r(95),U=r(83),H=r(26),B=[s.default,i.default,n.default,o.default,a.default,c.default,l.default,u.default,d.default,h.default,p.default,m.default,f.default,v.default,g.default,y.default,b.default,E.default,_.default,w.default,S.default,P.default,x.default,C.default,T.default,A.default,M.default,R.default,O.default,D.default,j.default,L.default,N.default,I.default,k.default,V.default,F.default,U.default,H.default];t.default=B},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(134);t.Commander=s.default;const i=r(1);t.types=i.types;class n extends i.default{createActions(e){return{}}}n.typeName="CController",n.isSystemSingleton=!0,t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(6),i=r(135);class n extends s.default{constructor(e){super(),this.addEvent("update"),this.stack=[],this.pointer=-1,this.capacity=void 0!==e?e:n.defaultCapacity}register(e){let t;t="function"==typeof e?e:t=>new i.default(t,e);return(...e)=>{const r=t(e);this.do(r)}}setCapacity(e){for(this.capacity=e;this.stack.length>e;)this.stack.shift(),this.pointer--;this.pointer<0&&(this.stack=[],this.pointer=-1)}do(e){console.log(`Commander.do - '${e.name}'`),e.do(),e.canUndo()&&(this.stack.splice(this.pointer+1),this.stack.push(e),this.stack.length>this.capacity&&this.stack.shift(),this.pointer=this.stack.length-1,this.emit("update"))}undo(){if(this.pointer>=0){this.stack[this.pointer].undo(),this.pointer--,this.emit("update")}}redo(){if(this.pointer<this.stack.length-1){this.pointer++,this.stack[this.pointer].do(),this.emit("update")}}clear(){this.stack.length>0&&(this.stack=[],this.pointer=-1,this.emit("update"))}canUndo(){return this.pointer>=0}canRedo(){return this.pointer<this.stack.length-1}getUndoText(){return this.pointer>=0?"Undo "+this.stack[this.pointer].name:"Can't Undo"}getRedoText(){return this.pointer<this.stack.length-1?"Redo "+this.stack[this.pointer+1].name:"Can't Redo"}}n.defaultCapacity=30,t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(136);t.default=class{constructor(e,t){this._args=e,this._props=t,this._args=e,this._state=null}get name(){return this._props.name||s.normalize(this._props.do.name)}do(){if(this._state)throw new Error("undo should be called before execute can be applied again");this._state=this._props.do.apply(this._props.target,this._args)}undo(){if(!this._props.undo)throw new Error("can't undo this command");if(!this._state)throw new Error("execute should be called before undo can be applied");this._props.undo.call(this._props.target,this._state),this._state=null}canDo(){return!this._props.canDo||this._props.canDo()}canUndo(){return!!this._props.undo}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.camelize=function(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,(e,t)=>0==t?e.toLowerCase():e.toUpperCase()).replace(/\s+/g,"")},t.normalize=function(e){return e.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase())}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=Math.PI,i=.5*s;var n;!function(e){e[e.Linear=0]="Linear",e[e.EaseQuad=1]="EaseQuad",e[e.EaseInQuad=2]="EaseInQuad",e[e.EaseOutQuad=3]="EaseOutQuad",e[e.EaseCubic=4]="EaseCubic",e[e.EaseInCubic=5]="EaseInCubic",e[e.EaseOutCubic=6]="EaseOutCubic",e[e.EaseQuart=7]="EaseQuart",e[e.EaseInQuart=8]="EaseInQuart",e[e.EaseOutQuart=9]="EaseOutQuart",e[e.EaseQuint=10]="EaseQuint",e[e.EaseInQuint=11]="EaseInQuint",e[e.EaseOutQuint=12]="EaseOutQuint",e[e.EaseSine=13]="EaseSine",e[e.EaseInSine=14]="EaseInSine",e[e.EaseOutSine=15]="EaseOutSine"}(n=t.EEasingCurve||(t.EEasingCurve={})),t.getEasingFunction=function(e){return t.easingFunctions[n[e]]},t.easingFunctions={Linear:function(e){return e},EaseQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},EaseInQuad:function(e){return e*e},EaseOutQuad:function(e){return e*(2-e)},EaseCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},EaseInCubic:function(e){return e*e*e},EaseOutCubic:function(e){return--e*e*e+1},EaseQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},EaseInQuart:function(e){return e*e*e*e},EaseOutQuart:function(e){return 1- --e*e*e*e},EaseQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e},EaseInQuint:function(e){return e*e*e*e*e},EaseOutQuint:function(e){return 1+--e*e*e*e*e},EaseSine:function(e){return-.5*(Math.cos(e*s)-1)},EaseInSine:function(e){return 1-Math.cos(e*i)},EaseOutSine:function(e){return Math.sin(e*i)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(41),n=new s.Vector3,o=new s.Matrix4;class a extends s.LineSegments{constructor(e,t){t=Object.assign({},a.defaultProps,t);const r=new s.Box3;r.makeEmpty(),i.computeLocalBoundingBox(e,r);const n=t.length,o=[r.min.x,r.min.y,r.min.z],c=[r.max.x,r.max.y,r.max.z],l=[(c[0]-o[0])*n,(c[1]-o[1])*n,(c[2]-o[2])*n];let u;u=isFinite(l[0])&&isFinite(l[1])&&isFinite(l[2])?[o[0],o[1],o[2],o[0]+l[0],o[1],o[2],o[0],o[1],o[2],o[0],o[1]+l[1],o[2],o[0],o[1],o[2],o[0],o[1],o[2]+l[2],c[0],o[1],o[2],c[0]-l[0],o[1],o[2],c[0],o[1],o[2],c[0],o[1]+l[1],o[2],c[0],o[1],o[2],c[0],o[1],o[2]+l[2],o[0],c[1],o[2],o[0]+l[0],c[1],o[2],o[0],c[1],o[2],o[0],c[1]-l[1],o[2],o[0],c[1],o[2],o[0],c[1],o[2]+l[2],o[0],o[1],c[2],o[0]+l[0],o[1],c[2],o[0],o[1],c[2],o[0],o[1]+l[1],c[2],o[0],o[1],c[2],o[0],o[1],c[2]-l[2],o[0],c[1],c[2],o[0]+l[0],c[1],c[2],o[0],c[1],c[2],o[0],c[1]-l[1],c[2],o[0],c[1],c[2],o[0],c[1],c[2]-l[2],c[0],o[1],c[2],c[0]-l[0],o[1],c[2],c[0],o[1],c[2],c[0],o[1]+l[1],c[2],c[0],o[1],c[2],c[0],o[1],c[2]-l[2],c[0],c[1],o[2],c[0]-l[0],c[1],o[2],c[0],c[1],o[2],c[0],c[1]-l[1],o[2],c[0],c[1],o[2],c[0],c[1],o[2]+l[2],c[0],c[1],c[2],c[0]-l[0],c[1],c[2],c[0],c[1],c[2],c[0],c[1]-l[1],c[2],c[0],c[1],c[2],c[0],c[1],c[2]-l[2]]:[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1];const d=new s.BufferGeometry;d.addAttribute("position",new s.Float32BufferAttribute(u,3)),super(d,new s.LineBasicMaterial({color:t.color,depthTest:!1})),this.renderOrder=1,this.onBeforeRender=(()=>{e.updateMatrixWorld(!1),this.matrixWorld.copy(e.matrixWorld)})}dispose(){this.parent&&this.parent.remove(this),this.geometry.dispose()}static expandBoundingBox(e,t,r){const s=e.geometry;if(void 0!==s){let i=e;for(o.identity();i&&i!==t;)o.premultiply(i.matrix),i=i.parent;if(s.isGeometry){const e=s.vertices;for(let t=0,s=e.length;t<s;++t)n.copy(e[t]).applyMatrix4(o),r.expandByPoint(n)}else if(s.isBufferGeometry){const e=s.attributes.position;if(void 0!==e)for(let t=0,s=e.count;t<s;++t)n.fromBufferAttribute(e,t).applyMatrix4(o),r.expandByPoint(n)}}const i=e.children;for(let e=0,s=i.length;e<s;++e)a.expandBoundingBox(i[e],t,r)}}a.defaultProps={color:new s.Color("#ffd633"),length:.25},t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=function(e,t){const r=document.createElement("a");r.download=t,r.href=e,document.body.appendChild(r),r.click(),document.body.removeChild(r)};t.default={text:function(e,t){const r=window.URL.createObjectURL(new Blob([e],{type:"text/plain"}));s(r,t)},json:function(e,t){"object"==typeof e&&(e=JSON.stringify(e));const r=window.URL.createObjectURL(new Blob([e],{type:"text/json"}));s(r,t)},url:function(e,t){s(e,t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(30);t.Node=i.Node,t.types=i.types;const n=r(17),o=r(25);class a extends i.default{constructor(e,t){super(e,t),this.ins=this.addInputs(a.rgIns),this._object3D=null,this._isAttached=!1,this._object3D=new s.Object3D,this._object3D.matrixAutoUpdate=!1}get transform(){return this.node.components.get(n.default,!0)}get scene(){const e=this.transform;return e?e.getParentComponent(o.default,!0):void 0}get object3D(){return this._object3D}create(){super.create(),this.innerRoots.filter(e=>e.is(n.default)).forEach(e=>this._object3D.add(e.object3D)),this.trackComponent(n.default,e=>this.ins.visible.value&&this.attachObject3D(e),e=>this.detachObject3D(e))}dispose(){this.detachObject3D(this.transform),this.innerRoots.filter(e=>e.is(n.default)).forEach(e=>this._object3D.remove(e.object3D)),super.dispose()}update(e){super.update(e);const t=this.ins;if(t.visible.changed){const e=this.transform;t.visible.value?this.attachObject3D(e):this.detachObject3D(e)}return!0}onAddInnerRoot(e){e.is(n.default)&&this._object3D.add(e.object3D)}onRemoveInnerRoot(e){e.is(n.default)&&this._object3D.remove(e.object3D)}attachObject3D(e){this._isAttached||e&&(e.object3D.add(this._object3D),this._isAttached=!0)}detachObject3D(e){this._isAttached&&e&&(e.object3D.remove(this._object3D),this._isAttached=!1)}}a.typeName="CRenderGraph",a.rgIns={visible:i.types.Boolean("Graph.Visible",!0)},t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(142),i=r(175),n=r(176),o=r(177),a=r(178),c=r(179);t.default=class{constructor(){this._schemaValidator=new s({schemas:[i,n,o,a,c],allErrors:!0}),this._validateDocument=this._schemaValidator.getSchema("https://schemas.3d.si.edu/voyager/document.schema.json")}validate(e){return this._validateDocument(e)?(console.log("JSONValidator.validateDocument - OK"),!0):(console.warn(this._schemaValidator.errorsText(this._validateDocument.errors,{separator:", ",dataVar:"document"})),!1)}}},function(e,t,r){"use strict";var s=r(143),i=r(42),n=r(147),o=r(66),a=r(67),c=r(148),l=r(149),u=r(170),d=r(20);e.exports=g,g.prototype.validate=function(e,t){var r;if("string"==typeof e){if(!(r=this.getSchema(e)))throw new Error('no schema with key or ref "'+e+'"')}else{var s=this._addSchema(e);r=s.validate||this._compile(s)}var i=r(t);!0!==r.$async&&(this.errors=r.errors);return i},g.prototype.compile=function(e,t){var r=this._addSchema(e,void 0,t);return r.validate||this._compile(r)},g.prototype.addSchema=function(e,t,r,s){if(Array.isArray(e)){for(var n=0;n<e.length;n++)this.addSchema(e[n],void 0,r,s);return this}var o=this._getId(e);if(void 0!==o&&"string"!=typeof o)throw new Error("schema id must be string");return S(this,t=i.normalizeId(t||o)),this._schemas[t]=this._addSchema(e,r,s,!0),this},g.prototype.addMetaSchema=function(e,t,r){return this.addSchema(e,t,r,!0),this},g.prototype.validateSchema=function(e,t){var r=e.$schema;if(void 0!==r&&"string"!=typeof r)throw new Error("$schema must be a string");if(!(r=r||this._opts.defaultMeta||(s=this,i=s._opts.meta,s._opts.defaultMeta="object"==typeof i?s._getId(i)||i:s.getSchema(m)?m:void 0,s._opts.defaultMeta)))return this.logger.warn("meta-schema not available"),this.errors=null,!0;var s,i;var n=this.validate(r,e);if(!n&&t){var o="schema is invalid: "+this.errorsText();if("log"!=this._opts.validateSchema)throw new Error(o);this.logger.error(o)}return n},g.prototype.getSchema=function(e){var t=y(this,e);switch(typeof t){case"object":return t.validate||this._compile(t);case"string":return this.getSchema(t);case"undefined":return function(e,t){var r=i.schema.call(e,{schema:{}},t);if(r){var n=r.schema,a=r.root,c=r.baseId,l=s.call(e,n,a,void 0,c);return e._fragments[t]=new o({ref:t,fragment:!0,schema:n,root:a,baseId:c,validate:l}),l}}(this,e)}},g.prototype.removeSchema=function(e){if(e instanceof RegExp)return b(this,this._schemas,e),b(this,this._refs,e),this;switch(typeof e){case"undefined":return b(this,this._schemas),b(this,this._refs),this._cache.clear(),this;case"string":var t=y(this,e);return t&&this._cache.del(t.cacheKey),delete this._schemas[e],delete this._refs[e],this;case"object":var r=this._opts.serialize,s=r?r(e):e;this._cache.del(s);var n=this._getId(e);n&&(n=i.normalizeId(n),delete this._schemas[n],delete this._refs[n])}return this},g.prototype.addFormat=function(e,t){"string"==typeof t&&(t=new RegExp(t));return this._formats[e]=t,this},g.prototype.errorsText=function(e,t){if(!(e=e||this.errors))return"No errors";for(var r=void 0===(t=t||{}).separator?", ":t.separator,s=void 0===t.dataVar?"data":t.dataVar,i="",n=0;n<e.length;n++){var o=e[n];o&&(i+=s+o.dataPath+" "+o.message+r)}return i.slice(0,-r.length)},g.prototype._addSchema=function(e,t,r,s){if("object"!=typeof e&&"boolean"!=typeof e)throw new Error("schema should be object or boolean");var n=this._opts.serialize,a=n?n(e):e,c=this._cache.get(a);if(c)return c;s=s||!1!==this._opts.addUsedSchema;var l=i.normalizeId(this._getId(e));l&&s&&S(this,l);var u,d=!1!==this._opts.validateSchema&&!t;d&&!(u=l&&l==i.normalizeId(e.$schema))&&this.validateSchema(e,!0);var h=i.ids.call(this,e),p=new o({id:l,schema:e,localRefs:h,cacheKey:a,meta:r});"#"!=l[0]&&s&&(this._refs[l]=p);this._cache.put(a,p),d&&u&&this.validateSchema(e,!0);return p},g.prototype._compile=function(e,t){if(e.compiling)return e.validate=n,n.schema=e.schema,n.errors=null,n.root=t||n,!0===e.schema.$async&&(n.$async=!0),n;var r,i;e.compiling=!0,e.meta&&(r=this._opts,this._opts=this._metaOpts);try{i=s.call(this,e.schema,t,e.localRefs)}catch(t){throw delete e.validate,t}finally{e.compiling=!1,e.meta&&(this._opts=r)}return e.validate=i,e.refs=i.refs,e.refVal=i.refVal,e.root=i.root,i;function n(){var t=e.validate,r=t.apply(this,arguments);return n.errors=t.errors,r}},g.prototype.compileAsync=r(171);var h=r(172);g.prototype.addKeyword=h.add,g.prototype.getKeyword=h.get,g.prototype.removeKeyword=h.remove,g.prototype.validateKeyword=h.validate;var p=r(44);g.ValidationError=p.Validation,g.MissingRefError=p.MissingRef,g.$dataMetaSchema=u;var m="http://json-schema.org/draft-07/schema",f=["removeAdditional","useDefaults","coerceTypes","strictDefaults"],v=["/properties"];function g(e){if(!(this instanceof g))return new g(e);e=this._opts=d.copy(e)||{},function(e){var t=e._opts.logger;if(!1===t)e.logger={log:P,warn:P,error:P};else{if(void 0===t&&(t=console),!("object"==typeof t&&t.log&&t.warn&&t.error))throw new Error("logger must implement log, warn and error methods");e.logger=t}}(this),this._schemas={},this._refs={},this._fragments={},this._formats=c(e.format),this._cache=e.cache||new n,this._loadingSchemas={},this._compilations=[],this.RULES=l(),this._getId=function(e){switch(e.schemaId){case"auto":return w;case"id":return E;default:return _}}(e),e.loopRequired=e.loopRequired||1/0,"property"==e.errorDataPath&&(e._errorDataPathProperty=!0),void 0===e.serialize&&(e.serialize=a),this._metaOpts=function(e){for(var t=d.copy(e._opts),r=0;r<f.length;r++)delete t[f[r]];return t}(this),e.formats&&function(e){for(var t in e._opts.formats){var r=e._opts.formats[t];e.addFormat(t,r)}}(this),function(e){var t;e._opts.$data&&(t=r(174),e.addMetaSchema(t,t.$id,!0));if(!1===e._opts.meta)return;var s=r(73);e._opts.$data&&(s=u(s,v));e.addMetaSchema(s,m,!0),e._refs["http://json-schema.org/schema"]=m}(this),"object"==typeof e.meta&&this.addMetaSchema(e.meta),e.nullable&&this.addKeyword("nullable",{metaSchema:{type:"boolean"}}),function(e){var t=e._opts.schemas;if(!t)return;if(Array.isArray(t))e.addSchema(t);else for(var r in t)e.addSchema(t[r],r)}(this)}function y(e,t){return t=i.normalizeId(t),e._schemas[t]||e._refs[t]||e._fragments[t]}function b(e,t,r){for(var s in t){var i=t[s];i.meta||r&&!r.test(s)||(e._cache.del(i.cacheKey),delete t[s])}}function E(e){return e.$id&&this.logger.warn("schema $id ignored",e.$id),e.id}function _(e){return e.id&&this.logger.warn("schema id ignored",e.id),e.$id}function w(e){if(e.$id&&e.id&&e.$id!=e.id)throw new Error("schema $id is different from id");return e.$id||e.id}function S(e,t){if(e._schemas[t]||e._refs[t])throw new Error('schema with key or id "'+t+'" already exists')}function P(){}},function(e,t,r){"use strict";var s=r(42),i=r(20),n=r(44),o=r(67),a=r(68),c=i.ucs2length,l=r(43),u=n.Validation;function d(e,t,r){for(var s=0;s<this._compilations.length;s++){var i=this._compilations[s];if(i.schema==e&&i.root==t&&i.baseId==r)return s}return-1}function h(e,t){return"var pattern"+e+" = new RegExp("+i.toQuotedString(t[e])+");"}function p(e){return"var default"+e+" = defaults["+e+"];"}function m(e,t){return void 0===t[e]?"":"var refVal"+e+" = refVal["+e+"];"}function f(e){return"var customRule"+e+" = customRules["+e+"];"}function v(e,t){if(!e.length)return"";for(var r="",s=0;s<e.length;s++)r+=t(s,e);return r}e.exports=function e(t,r,g,y){var b=this,E=this._opts,_=[void 0],w={},S=[],P={},x=[],C={},T=[];r=r||{schema:t,refVal:_,refs:w};var A=function(e,t,r){var s=d.call(this,e,t,r);return s>=0?{index:s,compiling:!0}:(s=this._compilations.length,this._compilations[s]={schema:e,root:t,baseId:r},{index:s,compiling:!1})}.call(this,t,r,y);var M=this._compilations[A.index];if(A.compiling)return M.callValidate=function e(){var t=M.validate;var r=t.apply(this,arguments);e.errors=t.errors;return r};var R=this._formats;var O=this.RULES;try{var D=L(t,r,g,y);M.validate=D;var j=M.callValidate;return j&&(j.schema=D.schema,j.errors=null,j.refs=D.refs,j.refVal=D.refVal,j.root=D.root,j.$async=D.$async,E.sourceCode&&(j.source=D.source)),D}finally{(function(e,t,r){var s=d.call(this,e,t,r);s>=0&&this._compilations.splice(s,1)}).call(this,t,r,y)}function L(t,o,d,g){var y=!o||o&&o.schema==t;if(o.schema!=r.schema)return e.call(b,t,o,d,g);var P,C=!0===t.$async,A=a({isTop:!0,schema:t,isRoot:y,baseId:g,root:o,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:n.MissingRef,RULES:O,validate:a,util:i,resolve:s,resolveRef:N,usePattern:V,useDefault:F,useCustomRule:U,opts:E,formats:R,logger:b.logger,self:b});A=v(_,m)+v(S,h)+v(x,p)+v(T,f)+A,E.processCode&&(A=E.processCode(A));try{var M=new Function("self","RULES","formats","root","refVal","defaults","customRules","equal","ucs2length","ValidationError",A);P=M(b,O,R,r,_,x,T,l,c,u),_[0]=P}catch(e){throw b.logger.error("Error compiling schema, function code:",A),e}return P.schema=t,P.errors=null,P.refs=w,P.refVal=_,P.root=y?P:o,C&&(P.$async=!0),!0===E.sourceCode&&(P.source={code:A,patterns:S,defaults:x}),P}function N(t,i,n){i=s.url(t,i);var o,a,c=w[i];if(void 0!==c)return k(o=_[c],a="refVal["+c+"]");if(!n&&r.refs){var l=r.refs[i];if(void 0!==l)return o=r.refVal[l],a=I(i,o),k(o,a)}a=I(i);var u=s.call(b,L,r,i);if(void 0===u){var d=g&&g[i];d&&(u=s.inlineRef(d,E.inlineRefs)?d:e.call(b,d,r,g,t))}if(void 0!==u)return function(e,t){var r=w[e];_[r]=t}(i,u),k(u,a);!function(e){delete w[e]}(i)}function I(e,t){var r=_.length;return _[r]=t,w[e]=r,"refVal"+r}function k(e,t){return"object"==typeof e||"boolean"==typeof e?{code:t,schema:e,inline:!0}:{code:t,$async:e&&!!e.$async}}function V(e){var t=P[e];return void 0===t&&(t=P[e]=S.length,S[t]=e),"pattern"+t}function F(e){switch(typeof e){case"boolean":case"number":return""+e;case"string":return i.toQuotedString(e);case"object":if(null===e)return"null";var t=o(e),r=C[t];return void 0===r&&(r=C[t]=x.length,x[r]=e),"default"+r}}function U(e,t,r,s){if(!1!==b._opts.validateSchema){var i=e.definition.dependencies;if(i&&!i.every(function(e){return Object.prototype.hasOwnProperty.call(r,e)}))throw new Error("parent schema must have all required keywords: "+i.join(","));var n=e.definition.validateSchema;if(n){var o=n(t);if(!o){var a="keyword schema is invalid: "+b.errorsText(n.errors);if("log"!=b._opts.validateSchema)throw new Error(a);b.logger.error(a)}}}var c,l=e.definition.compile,u=e.definition.inline,d=e.definition.macro;if(l)c=l.call(b,t,r,s);else if(d)c=d.call(b,t,r,s),!1!==E.validateSchema&&b.validateSchema(c,!0);else if(u)c=u.call(b,s,e.keyword,t,r);else if(!(c=e.definition.validate))return;if(void 0===c)throw new Error('custom keyword "'+e.keyword+'"failed to compile');var h=T.length;return T[h]=c,{code:"customRule"+h,validate:c}}}},function(e,t,r){
/** @license URI.js v4.2.1 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js */
!function(e){"use strict";function t(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(t.length>1){t[0]=t[0].slice(0,-1);for(var s=t.length-1,i=1;i<s;++i)t[i]=t[i].slice(1,-1);return t[s]=t[s].slice(1),t.join("")}return t[0]}function r(e){return"(?:"+e+")"}function s(e){return void 0===e?"undefined":null===e?"null":Object.prototype.toString.call(e).split(" ").pop().split("]").shift().toLowerCase()}function i(e){return e.toUpperCase()}function n(e){var s=t("[0-9]","[A-Fa-f]"),i=r(r("%[EFef]"+s+"%"+s+s+"%"+s+s)+"|"+r("%[89A-Fa-f]"+s+"%"+s+s)+"|"+r("%"+s+s)),n="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",o=t("[\\:\\/\\?\\#\\[\\]\\@]",n),a=e?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",c=e?"[\\uE000-\\uF8FF]":"[]",l=t("[A-Za-z]","[0-9]","[\\-\\.\\_\\~]",a),u=r("[A-Za-z]"+t("[A-Za-z]","[0-9]","[\\+\\-\\.]")+"*"),d=r(r(i+"|"+t(l,n,"[\\:]"))+"*"),h=(r(r("25[0-5]")+"|"+r("2[0-4][0-9]")+"|"+r("1[0-9][0-9]")+"|"+r("[1-9][0-9]")+"|[0-9]"),r(r("25[0-5]")+"|"+r("2[0-4][0-9]")+"|"+r("1[0-9][0-9]")+"|"+r("0?[1-9][0-9]")+"|0?0?[0-9]")),p=r(h+"\\."+h+"\\."+h+"\\."+h),m=r(s+"{1,4}"),f=r(r(m+"\\:"+m)+"|"+p),v=r(r(m+"\\:")+"{6}"+f),g=r("\\:\\:"+r(m+"\\:")+"{5}"+f),y=r(r(m)+"?\\:\\:"+r(m+"\\:")+"{4}"+f),b=r(r(r(m+"\\:")+"{0,1}"+m)+"?\\:\\:"+r(m+"\\:")+"{3}"+f),E=r(r(r(m+"\\:")+"{0,2}"+m)+"?\\:\\:"+r(m+"\\:")+"{2}"+f),_=r(r(r(m+"\\:")+"{0,3}"+m)+"?\\:\\:"+m+"\\:"+f),w=r(r(r(m+"\\:")+"{0,4}"+m)+"?\\:\\:"+f),S=r(r(r(m+"\\:")+"{0,5}"+m)+"?\\:\\:"+m),P=r(r(r(m+"\\:")+"{0,6}"+m)+"?\\:\\:"),x=r([v,g,y,b,E,_,w,S,P].join("|")),C=r(r(l+"|"+i)+"+"),T=(r(x+"\\%25"+C),r(x+r("\\%25|\\%(?!"+s+"{2})")+C)),A=r("[vV]"+s+"+\\."+t(l,n,"[\\:]")+"+"),M=r("\\["+r(T+"|"+x+"|"+A)+"\\]"),R=r(r(i+"|"+t(l,n))+"*"),O=r(M+"|"+p+"(?!"+R+")|"+R),D=r("[0-9]*"),j=r(r(d+"@")+"?"+O+r("\\:"+D)+"?"),L=r(i+"|"+t(l,n,"[\\:\\@]")),N=r(L+"*"),I=r(L+"+"),k=r(r(i+"|"+t(l,n,"[\\@]"))+"+"),V=r(r("\\/"+N)+"*"),F=r("\\/"+r(I+V)+"?"),U=r(k+V),H=r(I+V),B="(?!"+L+")",$=(r(V+"|"+F+"|"+U+"|"+H+"|"+B),r(r(L+"|"+t("[\\/\\?]",c))+"*")),z=r(r(L+"|[\\/\\?]")+"*"),G=r(r("\\/\\/"+j+V)+"|"+F+"|"+H+"|"+B),q=r(u+"\\:"+G+r("\\?"+$)+"?"+r("\\#"+z)+"?"),Q=r(r("\\/\\/"+j+V)+"|"+F+"|"+U+"|"+B),J=r(Q+r("\\?"+$)+"?"+r("\\#"+z)+"?");return r(q+"|"+J),r(u+"\\:"+G+r("\\?"+$)+"?"),r(r("\\/\\/("+r("("+d+")@")+"?("+O+")"+r("\\:("+D+")")+"?)")+"?("+V+"|"+F+"|"+H+"|"+B+")"),r("\\?("+$+")"),r("\\#("+z+")"),r(r("\\/\\/("+r("("+d+")@")+"?("+O+")"+r("\\:("+D+")")+"?)")+"?("+V+"|"+F+"|"+U+"|"+B+")"),r("\\?("+$+")"),r("\\#("+z+")"),r(r("\\/\\/("+r("("+d+")@")+"?("+O+")"+r("\\:("+D+")")+"?)")+"?("+V+"|"+F+"|"+H+"|"+B+")"),r("\\?("+$+")"),r("\\#("+z+")"),r("("+d+")@"),r("\\:("+D+")"),{NOT_SCHEME:new RegExp(t("[^]","[A-Za-z]","[0-9]","[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(t("[^\\%\\:]",l,n),"g"),NOT_HOST:new RegExp(t("[^\\%\\[\\]\\:]",l,n),"g"),NOT_PATH:new RegExp(t("[^\\%\\/\\:\\@]",l,n),"g"),NOT_PATH_NOSCHEME:new RegExp(t("[^\\%\\/\\@]",l,n),"g"),NOT_QUERY:new RegExp(t("[^\\%]",l,n,"[\\:\\@\\/\\?]",c),"g"),NOT_FRAGMENT:new RegExp(t("[^\\%]",l,n,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(t("[^]",l,n),"g"),UNRESERVED:new RegExp(l,"g"),OTHER_CHARS:new RegExp(t("[^\\%]",l,o),"g"),PCT_ENCODED:new RegExp(i,"g"),IPV4ADDRESS:new RegExp("^("+p+")$"),IPV6ADDRESS:new RegExp("^\\[?("+x+")"+r(r("\\%25|\\%(?!"+s+"{2})")+"("+C+")")+"?\\]?$")}}var o=n(!1),a=n(!0),c=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],s=!0,i=!1,n=void 0;try{for(var o,a=e[Symbol.iterator]();!(s=(o=a.next()).done)&&(r.push(o.value),!t||r.length!==t);s=!0);}catch(e){i=!0,n=e}finally{try{!s&&a.return&&a.return()}finally{if(i)throw n}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},l=2147483647,u=/^xn--/,d=/[^\0-\x7E]/,h=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},m=Math.floor,f=String.fromCharCode;function v(e){throw new RangeError(p[e])}function g(e,t){var r=e.split("@"),s="";r.length>1&&(s=r[0]+"@",e=r[1]);var i=(e=e.replace(h,".")).split("."),n=function(e,t){for(var r=[],s=e.length;s--;)r[s]=t(e[s]);return r}(i,t).join(".");return s+n}function y(e){for(var t=[],r=0,s=e.length;r<s;){var i=e.charCodeAt(r++);if(i>=55296&&i<=56319&&r<s){var n=e.charCodeAt(r++);56320==(64512&n)?t.push(((1023&i)<<10)+(1023&n)+65536):(t.push(i),r--)}else t.push(i)}return t}var b=function(e,t){return e+22+75*(e<26)-((0!=t)<<5)},E=function(e,t,r){var s=0;for(e=r?m(e/700):e>>1,e+=m(e/t);e>455;s+=36)e=m(e/35);return m(s+36*e/(e+38))},_=function(e){var t,r=[],s=e.length,i=0,n=128,o=72,a=e.lastIndexOf("-");a<0&&(a=0);for(var c=0;c<a;++c)e.charCodeAt(c)>=128&&v("not-basic"),r.push(e.charCodeAt(c));for(var u=a>0?a+1:0;u<s;){for(var d=i,h=1,p=36;;p+=36){u>=s&&v("invalid-input");var f=(t=e.charCodeAt(u++))-48<10?t-22:t-65<26?t-65:t-97<26?t-97:36;(f>=36||f>m((l-i)/h))&&v("overflow"),i+=f*h;var g=p<=o?1:p>=o+26?26:p-o;if(f<g)break;var y=36-g;h>m(l/y)&&v("overflow"),h*=y}var b=r.length+1;o=E(i-d,b,0==d),m(i/b)>l-n&&v("overflow"),n+=m(i/b),i%=b,r.splice(i++,0,n)}return String.fromCodePoint.apply(String,r)},w=function(e){var t=[],r=(e=y(e)).length,s=128,i=0,n=72,o=!0,a=!1,c=void 0;try{for(var u,d=e[Symbol.iterator]();!(o=(u=d.next()).done);o=!0){var h=u.value;h<128&&t.push(f(h))}}catch(e){a=!0,c=e}finally{try{!o&&d.return&&d.return()}finally{if(a)throw c}}var p=t.length,g=p;for(p&&t.push("-");g<r;){var _=l,w=!0,S=!1,P=void 0;try{for(var x,C=e[Symbol.iterator]();!(w=(x=C.next()).done);w=!0){var T=x.value;T>=s&&T<_&&(_=T)}}catch(e){S=!0,P=e}finally{try{!w&&C.return&&C.return()}finally{if(S)throw P}}var A=g+1;_-s>m((l-i)/A)&&v("overflow"),i+=(_-s)*A,s=_;var M=!0,R=!1,O=void 0;try{for(var D,j=e[Symbol.iterator]();!(M=(D=j.next()).done);M=!0){var L=D.value;if(L<s&&++i>l&&v("overflow"),L==s){for(var N=i,I=36;;I+=36){var k=I<=n?1:I>=n+26?26:I-n;if(N<k)break;var V=N-k,F=36-k;t.push(f(b(k+V%F,0))),N=m(V/F)}t.push(f(b(N,0))),n=E(i,A,g==p),i=0,++g}}}catch(e){R=!0,O=e}finally{try{!M&&j.return&&j.return()}finally{if(R)throw O}}++i,++s}return t.join("")},S={version:"2.1.0",ucs2:{decode:y,encode:function(e){return String.fromCodePoint.apply(String,function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(e))}},decode:_,encode:w,toASCII:function(e){return g(e,function(e){return d.test(e)?"xn--"+w(e):e})},toUnicode:function(e){return g(e,function(e){return u.test(e)?_(e.slice(4).toLowerCase()):e})}},P={};function x(e){var t=e.charCodeAt(0);return t<16?"%0"+t.toString(16).toUpperCase():t<128?"%"+t.toString(16).toUpperCase():t<2048?"%"+(t>>6|192).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase():"%"+(t>>12|224).toString(16).toUpperCase()+"%"+(t>>6&63|128).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase()}function C(e){for(var t="",r=0,s=e.length;r<s;){var i=parseInt(e.substr(r+1,2),16);if(i<128)t+=String.fromCharCode(i),r+=3;else if(i>=194&&i<224){if(s-r>=6){var n=parseInt(e.substr(r+4,2),16);t+=String.fromCharCode((31&i)<<6|63&n)}else t+=e.substr(r,6);r+=6}else if(i>=224){if(s-r>=9){var o=parseInt(e.substr(r+4,2),16),a=parseInt(e.substr(r+7,2),16);t+=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a)}else t+=e.substr(r,9);r+=9}else t+=e.substr(r,3),r+=3}return t}function T(e,t){function r(e){var r=C(e);return r.match(t.UNRESERVED)?r:e}return e.scheme&&(e.scheme=String(e.scheme).replace(t.PCT_ENCODED,r).toLowerCase().replace(t.NOT_SCHEME,"")),void 0!==e.userinfo&&(e.userinfo=String(e.userinfo).replace(t.PCT_ENCODED,r).replace(t.NOT_USERINFO,x).replace(t.PCT_ENCODED,i)),void 0!==e.host&&(e.host=String(e.host).replace(t.PCT_ENCODED,r).toLowerCase().replace(t.NOT_HOST,x).replace(t.PCT_ENCODED,i)),void 0!==e.path&&(e.path=String(e.path).replace(t.PCT_ENCODED,r).replace(e.scheme?t.NOT_PATH:t.NOT_PATH_NOSCHEME,x).replace(t.PCT_ENCODED,i)),void 0!==e.query&&(e.query=String(e.query).replace(t.PCT_ENCODED,r).replace(t.NOT_QUERY,x).replace(t.PCT_ENCODED,i)),void 0!==e.fragment&&(e.fragment=String(e.fragment).replace(t.PCT_ENCODED,r).replace(t.NOT_FRAGMENT,x).replace(t.PCT_ENCODED,i)),e}function A(e){return e.replace(/^0*(.*)/,"$1")||"0"}function M(e,t){var r=e.match(t.IPV4ADDRESS)||[],s=c(r,2),i=s[1];return i?i.split(".").map(A).join("."):e}function R(e,t){var r=e.match(t.IPV6ADDRESS)||[],s=c(r,3),i=s[1],n=s[2];if(i){for(var o=i.toLowerCase().split("::").reverse(),a=c(o,2),l=a[0],u=a[1],d=u?u.split(":").map(A):[],h=l.split(":").map(A),p=t.IPV4ADDRESS.test(h[h.length-1]),m=p?7:8,f=h.length-m,v=Array(m),g=0;g<m;++g)v[g]=d[g]||h[f+g]||"";p&&(v[m-1]=M(v[m-1],t));var y=v.reduce(function(e,t,r){if(!t||"0"===t){var s=e[e.length-1];s&&s.index+s.length===r?s.length++:e.push({index:r,length:1})}return e},[]),b=y.sort(function(e,t){return t.length-e.length})[0],E=void 0;if(b&&b.length>1){var _=v.slice(0,b.index),w=v.slice(b.index+b.length);E=_.join(":")+"::"+w.join(":")}else E=v.join(":");return n&&(E+="%"+n),E}return e}var O=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,D=void 0==="".match(/(){0}/)[1];function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={},s=!1!==t.iri?a:o;"suffix"===t.reference&&(e=(t.scheme?t.scheme+":":"")+"//"+e);var i=e.match(O);if(i){D?(r.scheme=i[1],r.userinfo=i[3],r.host=i[4],r.port=parseInt(i[5],10),r.path=i[6]||"",r.query=i[7],r.fragment=i[8],isNaN(r.port)&&(r.port=i[5])):(r.scheme=i[1]||void 0,r.userinfo=-1!==e.indexOf("@")?i[3]:void 0,r.host=-1!==e.indexOf("//")?i[4]:void 0,r.port=parseInt(i[5],10),r.path=i[6]||"",r.query=-1!==e.indexOf("?")?i[7]:void 0,r.fragment=-1!==e.indexOf("#")?i[8]:void 0,isNaN(r.port)&&(r.port=e.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?i[4]:void 0)),r.host&&(r.host=R(M(r.host,s),s)),void 0!==r.scheme||void 0!==r.userinfo||void 0!==r.host||void 0!==r.port||r.path||void 0!==r.query?void 0===r.scheme?r.reference="relative":void 0===r.fragment?r.reference="absolute":r.reference="uri":r.reference="same-document",t.reference&&"suffix"!==t.reference&&t.reference!==r.reference&&(r.error=r.error||"URI is not a "+t.reference+" reference.");var n=P[(t.scheme||r.scheme||"").toLowerCase()];if(t.unicodeSupport||n&&n.unicodeSupport)T(r,s);else{if(r.host&&(t.domainHost||n&&n.domainHost))try{r.host=S.toASCII(r.host.replace(s.PCT_ENCODED,C).toLowerCase())}catch(e){r.error=r.error||"Host's domain name can not be converted to ASCII via punycode: "+e}T(r,o)}n&&n.parse&&n.parse(r,t)}else r.error=r.error||"URI can not be parsed.";return r}var L=/^\.\.?\//,N=/^\/\.(\/|$)/,I=/^\/\.\.(\/|$)/,k=/^\/?(?:.|\n)*?(?=\/|$)/;function V(e){for(var t=[];e.length;)if(e.match(L))e=e.replace(L,"");else if(e.match(N))e=e.replace(N,"/");else if(e.match(I))e=e.replace(I,"/"),t.pop();else if("."===e||".."===e)e="";else{var r=e.match(k);if(!r)throw new Error("Unexpected dot segment condition");var s=r[0];e=e.slice(s.length),t.push(s)}return t.join("")}function F(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.iri?a:o,s=[],i=P[(t.scheme||e.scheme||"").toLowerCase()];if(i&&i.serialize&&i.serialize(e,t),e.host)if(r.IPV6ADDRESS.test(e.host));else if(t.domainHost||i&&i.domainHost)try{e.host=t.iri?S.toUnicode(e.host):S.toASCII(e.host.replace(r.PCT_ENCODED,C).toLowerCase())}catch(r){e.error=e.error||"Host's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+r}T(e,r),"suffix"!==t.reference&&e.scheme&&(s.push(e.scheme),s.push(":"));var n=function(e,t){var r=!1!==t.iri?a:o,s=[];return void 0!==e.userinfo&&(s.push(e.userinfo),s.push("@")),void 0!==e.host&&s.push(R(M(String(e.host),r),r).replace(r.IPV6ADDRESS,function(e,t,r){return"["+t+(r?"%25"+r:"")+"]"})),"number"==typeof e.port&&(s.push(":"),s.push(e.port.toString(10))),s.length?s.join(""):void 0}(e,t);if(void 0!==n&&("suffix"!==t.reference&&s.push("//"),s.push(n),e.path&&"/"!==e.path.charAt(0)&&s.push("/")),void 0!==e.path){var c=e.path;t.absolutePath||i&&i.absolutePath||(c=V(c)),void 0===n&&(c=c.replace(/^\/\//,"/%2F")),s.push(c)}return void 0!==e.query&&(s.push("?"),s.push(e.query)),void 0!==e.fragment&&(s.push("#"),s.push(e.fragment)),s.join("")}function U(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments[3],i={};return s||(e=j(F(e,r),r),t=j(F(t,r),r)),!(r=r||{}).tolerant&&t.scheme?(i.scheme=t.scheme,i.userinfo=t.userinfo,i.host=t.host,i.port=t.port,i.path=V(t.path||""),i.query=t.query):(void 0!==t.userinfo||void 0!==t.host||void 0!==t.port?(i.userinfo=t.userinfo,i.host=t.host,i.port=t.port,i.path=V(t.path||""),i.query=t.query):(t.path?("/"===t.path.charAt(0)?i.path=V(t.path):(void 0===e.userinfo&&void 0===e.host&&void 0===e.port||e.path?e.path?i.path=e.path.slice(0,e.path.lastIndexOf("/")+1)+t.path:i.path=t.path:i.path="/"+t.path,i.path=V(i.path)),i.query=t.query):(i.path=e.path,void 0!==t.query?i.query=t.query:i.query=e.query),i.userinfo=e.userinfo,i.host=e.host,i.port=e.port),i.scheme=e.scheme),i.fragment=t.fragment,i}function H(e,t){return e&&e.toString().replace(t&&t.iri?a.PCT_ENCODED:o.PCT_ENCODED,C)}var B={scheme:"http",domainHost:!0,parse:function(e,t){return e.host||(e.error=e.error||"HTTP URIs must have a host."),e},serialize:function(e,t){return e.port!==("https"!==String(e.scheme).toLowerCase()?80:443)&&""!==e.port||(e.port=void 0),e.path||(e.path="/"),e}},$={scheme:"https",domainHost:B.domainHost,parse:B.parse,serialize:B.serialize},z={},G="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",q="[0-9A-Fa-f]",Q=r(r("%[EFef][0-9A-Fa-f]%"+q+q+"%"+q+q)+"|"+r("%[89A-Fa-f][0-9A-Fa-f]%"+q+q)+"|"+r("%"+q+q)),J=t("[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",'[\\"\\\\]'),K=new RegExp(G,"g"),X=new RegExp(Q,"g"),Y=new RegExp(t("[^]","[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]","[\\.]",'[\\"]',J),"g"),W=new RegExp(t("[^]",G,"[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]"),"g"),Z=W;function ee(e){var t=C(e);return t.match(K)?t:e}var te={scheme:"mailto",parse:function(e,t){var r=e,s=r.to=r.path?r.path.split(","):[];if(r.path=void 0,r.query){for(var i=!1,n={},o=r.query.split("&"),a=0,c=o.length;a<c;++a){var l=o[a].split("=");switch(l[0]){case"to":for(var u=l[1].split(","),d=0,h=u.length;d<h;++d)s.push(u[d]);break;case"subject":r.subject=H(l[1],t);break;case"body":r.body=H(l[1],t);break;default:i=!0,n[H(l[0],t)]=H(l[1],t)}}i&&(r.headers=n)}r.query=void 0;for(var p=0,m=s.length;p<m;++p){var f=s[p].split("@");if(f[0]=H(f[0]),t.unicodeSupport)f[1]=H(f[1],t).toLowerCase();else try{f[1]=S.toASCII(H(f[1],t).toLowerCase())}catch(e){r.error=r.error||"Email address's domain name can not be converted to ASCII via punycode: "+e}s[p]=f.join("@")}return r},serialize:function(e,t){var r,s=e,n=null!=(r=e.to)?r instanceof Array?r:"number"!=typeof r.length||r.split||r.setInterval||r.call?[r]:Array.prototype.slice.call(r):[];if(n){for(var o=0,a=n.length;o<a;++o){var c=String(n[o]),l=c.lastIndexOf("@"),u=c.slice(0,l).replace(X,ee).replace(X,i).replace(Y,x),d=c.slice(l+1);try{d=t.iri?S.toUnicode(d):S.toASCII(H(d,t).toLowerCase())}catch(e){s.error=s.error||"Email address's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+e}n[o]=u+"@"+d}s.path=n.join(",")}var h=e.headers=e.headers||{};e.subject&&(h.subject=e.subject),e.body&&(h.body=e.body);var p=[];for(var m in h)h[m]!==z[m]&&p.push(m.replace(X,ee).replace(X,i).replace(W,x)+"="+h[m].replace(X,ee).replace(X,i).replace(Z,x));return p.length&&(s.query=p.join("&")),s}},re=/^([^\:]+)\:(.*)/,se={scheme:"urn",parse:function(e,t){var r=e.path&&e.path.match(re),s=e;if(r){var i=t.scheme||s.scheme||"urn",n=r[1].toLowerCase(),o=r[2],a=i+":"+(t.nid||n),c=P[a];s.nid=n,s.nss=o,s.path=void 0,c&&(s=c.parse(s,t))}else s.error=s.error||"URN can not be parsed.";return s},serialize:function(e,t){var r=t.scheme||e.scheme||"urn",s=e.nid,i=r+":"+(t.nid||s),n=P[i];n&&(e=n.serialize(e,t));var o=e,a=e.nss;return o.path=(s||t.nid)+":"+a,o}},ie=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,ne={scheme:"urn:uuid",parse:function(e,t){var r=e;return r.uuid=r.nss,r.nss=void 0,t.tolerant||r.uuid&&r.uuid.match(ie)||(r.error=r.error||"UUID is not valid."),r},serialize:function(e,t){var r=e;return r.nss=(e.uuid||"").toLowerCase(),r}};P[B.scheme]=B,P[$.scheme]=$,P[te.scheme]=te,P[se.scheme]=se,P[ne.scheme]=ne,e.SCHEMES=P,e.pctEncChar=x,e.pctDecChars=C,e.parse=j,e.removeDotSegments=V,e.serialize=F,e.resolveComponents=U,e.resolve=function(e,t,r){var s=function(e,t){var r=e;if(t)for(var s in t)r[s]=t[s];return r}({scheme:"null"},r);return F(U(j(e,s),j(t,s),s,!0),s)},e.normalize=function(e,t){return"string"==typeof e?e=F(j(e,t),t):"object"===s(e)&&(e=j(F(e,t),t)),e},e.equal=function(e,t,r){return"string"==typeof e?e=F(j(e,r),r):"object"===s(e)&&(e=F(e,r)),"string"==typeof t?t=F(j(t,r),r):"object"===s(t)&&(t=F(t,r)),e===t},e.escapeComponent=function(e,t){return e&&e.toString().replace(t&&t.iri?a.ESCAPE:o.ESCAPE,x)},e.unescapeComponent=H,Object.defineProperty(e,"__esModule",{value:!0})}(t)},function(e,t,r){"use strict";e.exports=function(e){for(var t,r=0,s=e.length,i=0;i<s;)r++,(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<s&&56320==(64512&(t=e.charCodeAt(i)))&&i++;return r}},function(e,t,r){"use strict";var s=e.exports=function(e,t,r){"function"==typeof t&&(r=t,t={}),function e(t,r,i,n,o,a,c,l,u,d){if(n&&"object"==typeof n&&!Array.isArray(n)){for(var h in r(n,o,a,c,l,u,d),n){var p=n[h];if(Array.isArray(p)){if(h in s.arrayKeywords)for(var m=0;m<p.length;m++)e(t,r,i,p[m],o+"/"+h+"/"+m,a,o,h,n,m)}else if(h in s.propsKeywords){if(p&&"object"==typeof p)for(var f in p)e(t,r,i,p[f],o+"/"+h+"/"+f.replace(/~/g,"~0").replace(/\//g,"~1"),a,o,h,n,f)}else(h in s.keywords||t.allKeys&&!(h in s.skipKeywords))&&e(t,r,i,p,o+"/"+h,a,o,h,n)}i(n,o,a,c,l,u,d)}}(t,"function"==typeof(r=t.cb||r)?r:r.pre||function(){},r.post||function(){},e,"",e)};s.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0},s.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},s.propsKeywords={definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},s.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0}},function(e,t,r){"use strict";var s=e.exports=function(){this._cache={}};s.prototype.put=function(e,t){this._cache[e]=t},s.prototype.get=function(e){return this._cache[e]},s.prototype.del=function(e){delete this._cache[e]},s.prototype.clear=function(){this._cache={}}},function(e,t,r){"use strict";var s=r(20),i=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,n=[0,31,28,31,30,31,30,31,31,30,31,30,31],o=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d:\d\d)?$/i,a=/^[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*$/i,c=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9a-f]{2})*)?$/i,l=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#.\/;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,u=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,d=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,h=/^(?:\/(?:[^~\/]|~0|~1)*)*$/,p=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,m=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~\/]|~0|~1)*)*)$/;function f(e){return e="full"==e?"full":"fast",s.copy(f[e])}function v(e){var t=e.match(i);if(!t)return!1;var r=+t[1],s=+t[2],o=+t[3];return s>=1&&s<=12&&o>=1&&o<=(2==s&&function(e){return e%4==0&&(e%100!=0||e%400==0)}(r)?29:n[s])}function g(e,t){var r=e.match(o);if(!r)return!1;var s=r[1],i=r[2],n=r[3],a=r[5];return(s<=23&&i<=59&&n<=59||23==s&&59==i&&60==n)&&(!t||a)}e.exports=f,f.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d:\d\d)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d:\d\d)$/i,uri:/^(?:[a-z][a-z0-9+-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,"uri-template":l,url:u,email:/^[a-z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:a,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:_,uuid:d,"json-pointer":h,"json-pointer-uri-fragment":p,"relative-json-pointer":m},f.full={date:v,time:g,"date-time":function(e){var t=e.split(y);return 2==t.length&&v(t[0])&&g(t[1],!0)},uri:function(e){return b.test(e)&&c.test(e)},"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@\/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@\/?]|%[0-9a-f]{2})*)?$/i,"uri-template":l,url:u,email:/^[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:function(e){return e.length<=255&&a.test(e)},ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:_,uuid:d,"json-pointer":h,"json-pointer-uri-fragment":p,"relative-json-pointer":m};var y=/t|\s/i;var b=/\/|:/;var E=/[^\\]\\Z/;function _(e){if(E.test(e))return!1;try{return new RegExp(e),!0}catch(e){return!1}}},function(e,t,r){"use strict";var s=r(150),i=r(20).toHash;e.exports=function(){var e=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","items","contains","uniqueItems"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf","if"]}],t=["type","$comment"];return e.all=i(t),e.types=i(["number","integer","string","array","object","boolean","null"]),e.forEach(function(r){r.rules=r.rules.map(function(r){var i;if("object"==typeof r){var n=Object.keys(r)[0];i=r[n],r=n,i.forEach(function(r){t.push(r),e.all[r]=!0})}return t.push(r),e.all[r]={keyword:r,code:s[r],implements:i}}),e.all.$comment={keyword:"$comment",code:s.$comment},r.type&&(e.types[r.type]=r)}),e.keywords=i(t.concat(["$schema","$id","id","$data","$async","title","description","default","definitions","examples","readOnly","writeOnly","contentMediaType","contentEncoding","additionalItems","then","else"])),e.custom={},e}},function(e,t,r){"use strict";e.exports={$ref:r(151),allOf:r(152),anyOf:r(153),$comment:r(154),const:r(155),contains:r(156),dependencies:r(157),enum:r(158),format:r(159),if:r(160),items:r(161),maximum:r(69),minimum:r(69),maxItems:r(70),minItems:r(70),maxLength:r(71),minLength:r(71),maxProperties:r(72),minProperties:r(72),multipleOf:r(162),not:r(163),oneOf:r(164),pattern:r(165),properties:r(166),propertyNames:r(167),required:r(168),uniqueItems:r(169),validate:r(68)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s,i,n=" ",o=e.level,a=e.dataLevel,c=e.schema[t],l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,d="data"+(a||""),h="valid"+o;if("#"==c||"#/"==c)e.isRoot?(s=e.async,i="validate"):(s=!0===e.root.schema.$async,i="root.refVal[0]");else{var p=e.resolveRef(e.baseId,c,e.isRoot);if(void 0===p){var m=e.MissingRefError.message(e.baseId,c);if("fail"==e.opts.missingRefs){e.logger.error(m),(y=y||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { ref: '"+e.util.escapeQuotes(c)+"' } ",!1!==e.opts.messages&&(n+=" , message: 'can\\'t resolve reference "+e.util.escapeQuotes(c)+"' "),e.opts.verbose&&(n+=" , schema: "+e.util.toQuotedString(c)+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),n+=" } "):n+=" {} ";var f=n;n=y.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+f+"]); ":n+=" validate.errors = ["+f+"]; return false; ":n+=" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",u&&(n+=" if (false) { ")}else{if("ignore"!=e.opts.missingRefs)throw new e.MissingRefError(e.baseId,c,m);e.logger.warn(m),u&&(n+=" if (true) { ")}}else if(p.inline){var v=e.util.copy(e);v.level++;var g="valid"+v.level;v.schema=p.schema,v.schemaPath="",v.errSchemaPath=c,n+=" "+e.validate(v).replace(/validate\.schema/g,p.code)+" ",u&&(n+=" if ("+g+") { ")}else s=!0===p.$async||e.async&&!1!==p.$async,i=p.code}if(i){var y;(y=y||[]).push(n),n="",e.opts.passContext?n+=" "+i+".call(this, ":n+=" "+i+"( ",n+=" "+d+", (dataPath || '')",'""'!=e.errorPath&&(n+=" + "+e.errorPath);var b=n+=" , "+(a?"data"+(a-1||""):"parentData")+" , "+(a?e.dataPathArr[a]:"parentDataProperty")+", rootData)  ";if(n=y.pop(),s){if(!e.async)throw new Error("async schema referenced by sync schema");u&&(n+=" var "+h+"; "),n+=" try { await "+b+"; ",u&&(n+=" "+h+" = true; "),n+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ",u&&(n+=" "+h+" = false; "),n+=" } ",u&&(n+=" if ("+h+") { ")}else n+=" if (!"+b+") { if (vErrors === null) vErrors = "+i+".errors; else vErrors = vErrors.concat("+i+".errors); errors = vErrors.length; } ",u&&(n+=" else { ")}return n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.schema[t],n=e.schemaPath+e.util.getProperty(t),o=e.errSchemaPath+"/"+t,a=!e.opts.allErrors,c=e.util.copy(e),l="";c.level++;var u="valid"+c.level,d=c.baseId,h=!0,p=i;if(p)for(var m,f=-1,v=p.length-1;f<v;)m=p[f+=1],e.util.schemaHasRules(m,e.RULES.all)&&(h=!1,c.schema=m,c.schemaPath=n+"["+f+"]",c.errSchemaPath=o+"/"+f,s+="  "+e.validate(c)+" ",c.baseId=d,a&&(s+=" if ("+u+") { ",l+="}"));return a&&(s+=h?" if (true) { ":" "+l.slice(0,-1)+" "),s=e.util.cleanUpCode(s)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(n||""),d="valid"+i,h="errs__"+i,p=e.util.copy(e),m="";p.level++;var f="valid"+p.level;if(o.every(function(t){return e.util.schemaHasRules(t,e.RULES.all)})){var v=p.baseId;s+=" var "+h+" = errors; var "+d+" = false;  ";var g=e.compositeRule;e.compositeRule=p.compositeRule=!0;var y=o;if(y)for(var b,E=-1,_=y.length-1;E<_;)b=y[E+=1],p.schema=b,p.schemaPath=a+"["+E+"]",p.errSchemaPath=c+"/"+E,s+="  "+e.validate(p)+" ",p.baseId=v,s+=" "+d+" = "+d+" || "+f+"; if (!"+d+") { ",m+="}";e.compositeRule=p.compositeRule=g,s+=" "+m+" if (!"+d+") {   var err =   ",!1!==e.createErrors?(s+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",!1!==e.opts.messages&&(s+=" , message: 'should match some schema in anyOf' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),s+=" } "):s+=" {} ",s+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&l&&(e.async?s+=" throw new ValidationError(vErrors); ":s+=" validate.errors = vErrors; return false; "),s+=" } else {  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; } ",e.opts.allErrors&&(s+=" } "),s=e.util.cleanUpCode(s)}else l&&(s+=" if (true) { ");return s}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.schema[t],n=e.errSchemaPath+"/"+t,o=(e.opts.allErrors,e.util.toQuotedString(i));return!0===e.opts.$comment?s+=" console.log("+o+");":"function"==typeof e.opts.$comment&&(s+=" self._opts.$comment("+o+", "+e.util.toQuotedString(n)+", validate.root.schema);"),s}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(n||""),d="valid"+i,h=e.opts.$data&&o&&o.$data;h&&(s+=" var schema"+i+" = "+e.util.getData(o.$data,n,e.dataPathArr)+"; "),h||(s+=" var schema"+i+" = validate.schema"+a+";"),s+="var "+d+" = equal("+u+", schema"+i+"); if (!"+d+") {   ";var p=p||[];p.push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'const' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { allowedValue: schema"+i+" } ",!1!==e.opts.messages&&(s+=" , message: 'should be equal to constant' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),s+=" } "):s+=" {} ";var m=s;return s=p.pop(),!e.compositeRule&&l?e.async?s+=" throw new ValidationError(["+m+"]); ":s+=" validate.errors = ["+m+"]; return false; ":s+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" }",l&&(s+=" else { "),s}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(n||""),d="valid"+i,h="errs__"+i,p=e.util.copy(e);p.level++;var m="valid"+p.level,f="i"+i,v=p.dataLevel=e.dataLevel+1,g="data"+v,y=e.baseId,b=e.util.schemaHasRules(o,e.RULES.all);if(s+="var "+h+" = errors;var "+d+";",b){var E=e.compositeRule;e.compositeRule=p.compositeRule=!0,p.schema=o,p.schemaPath=a,p.errSchemaPath=c,s+=" var "+m+" = false; for (var "+f+" = 0; "+f+" < "+u+".length; "+f+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,f,e.opts.jsonPointers,!0);var _=u+"["+f+"]";p.dataPathArr[v]=f;var w=e.validate(p);p.baseId=y,e.util.varOccurences(w,g)<2?s+=" "+e.util.varReplace(w,g,_)+" ":s+=" var "+g+" = "+_+"; "+w+" ",s+=" if ("+m+") break; }  ",e.compositeRule=p.compositeRule=E,s+="  if (!"+m+") {"}else s+=" if ("+u+".length == 0) {";var S=S||[];S.push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",!1!==e.opts.messages&&(s+=" , message: 'should contain a valid item' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),s+=" } "):s+=" {} ";var P=s;return s=S.pop(),!e.compositeRule&&l?e.async?s+=" throw new ValidationError(["+P+"]); ":s+=" validate.errors = ["+P+"]; return false; ":s+=" var err = "+P+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" } else { ",b&&(s+="  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; } "),e.opts.allErrors&&(s+=" } "),s=e.util.cleanUpCode(s)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(n||""),d="errs__"+i,h=e.util.copy(e),p="";h.level++;var m="valid"+h.level,f={},v={},g=e.opts.ownProperties;for(_ in o){var y=o[_],b=Array.isArray(y)?v:f;b[_]=y}s+="var "+d+" = errors;";var E=e.errorPath;for(var _ in s+="var missing"+i+";",v)if((b=v[_]).length){if(s+=" if ( "+u+e.util.getProperty(_)+" !== undefined ",g&&(s+=" && Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(_)+"') "),l){s+=" && ( ";var w=b;if(w)for(var S=-1,P=w.length-1;S<P;){R=w[S+=1],S&&(s+=" || "),s+=" ( ( "+(L=u+(j=e.util.getProperty(R)))+" === undefined ",g&&(s+=" || ! Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(R)+"') "),s+=") && (missing"+i+" = "+e.util.toQuotedString(e.opts.jsonPointers?R:j)+") ) "}s+=")) {  ";var x="missing"+i,C="' + "+x+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(E,x,!0):E+" + "+x);var T=T||[];T.push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { property: '"+e.util.escapeQuotes(_)+"', missingProperty: '"+C+"', depsCount: "+b.length+", deps: '"+e.util.escapeQuotes(1==b.length?b[0]:b.join(", "))+"' } ",!1!==e.opts.messages&&(s+=" , message: 'should have ",1==b.length?s+="property "+e.util.escapeQuotes(b[0]):s+="properties "+e.util.escapeQuotes(b.join(", ")),s+=" when property "+e.util.escapeQuotes(_)+" is present' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),s+=" } "):s+=" {} ";var A=s;s=T.pop(),!e.compositeRule&&l?e.async?s+=" throw new ValidationError(["+A+"]); ":s+=" validate.errors = ["+A+"]; return false; ":s+=" var err = "+A+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{s+=" ) { ";var M=b;if(M)for(var R,O=-1,D=M.length-1;O<D;){R=M[O+=1];var j=e.util.getProperty(R),L=(C=e.util.escapeQuotes(R),u+j);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(E,R,e.opts.jsonPointers)),s+=" if ( "+L+" === undefined ",g&&(s+=" || ! Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(R)+"') "),s+=") {  var err =   ",!1!==e.createErrors?(s+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { property: '"+e.util.escapeQuotes(_)+"', missingProperty: '"+C+"', depsCount: "+b.length+", deps: '"+e.util.escapeQuotes(1==b.length?b[0]:b.join(", "))+"' } ",!1!==e.opts.messages&&(s+=" , message: 'should have ",1==b.length?s+="property "+e.util.escapeQuotes(b[0]):s+="properties "+e.util.escapeQuotes(b.join(", ")),s+=" when property "+e.util.escapeQuotes(_)+" is present' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),s+=" } "):s+=" {} ",s+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}s+=" }   ",l&&(p+="}",s+=" else { ")}e.errorPath=E;var N=h.baseId;for(var _ in f){y=f[_];e.util.schemaHasRules(y,e.RULES.all)&&(s+=" "+m+" = true; if ( "+u+e.util.getProperty(_)+" !== undefined ",g&&(s+=" && Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(_)+"') "),s+=") { ",h.schema=y,h.schemaPath=a+e.util.getProperty(_),h.errSchemaPath=c+"/"+e.util.escapeFragment(_),s+="  "+e.validate(h)+" ",h.baseId=N,s+=" }  ",l&&(s+=" if ("+m+") { ",p+="}"))}return l&&(s+="   "+p+" if ("+d+" == errors) {"),s=e.util.cleanUpCode(s)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(n||""),d="valid"+i,h=e.opts.$data&&o&&o.$data;h&&(s+=" var schema"+i+" = "+e.util.getData(o.$data,n,e.dataPathArr)+"; ");var p="i"+i,m="schema"+i;h||(s+=" var "+m+" = validate.schema"+a+";"),s+="var "+d+";",h&&(s+=" if (schema"+i+" === undefined) "+d+" = true; else if (!Array.isArray(schema"+i+")) "+d+" = false; else {"),s+=d+" = false;for (var "+p+"=0; "+p+"<"+m+".length; "+p+"++) if (equal("+u+", "+m+"["+p+"])) { "+d+" = true; break; }",h&&(s+="  }  "),s+=" if (!"+d+") {   ";var f=f||[];f.push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { allowedValues: schema"+i+" } ",!1!==e.opts.messages&&(s+=" , message: 'should be equal to one of the allowed values' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),s+=" } "):s+=" {} ";var v=s;return s=f.pop(),!e.compositeRule&&l?e.async?s+=" throw new ValidationError(["+v+"]); ":s+=" validate.errors = ["+v+"]; return false; ":s+=" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" }",l&&(s+=" else { "),s}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(n||"");if(!1===e.opts.format)return l&&(s+=" if (true) { "),s;var d,h=e.opts.$data&&o&&o.$data;h?(s+=" var schema"+i+" = "+e.util.getData(o.$data,n,e.dataPathArr)+"; ",d="schema"+i):d=o;var p=e.opts.unknownFormats,m=Array.isArray(p);if(h){s+=" var "+(f="format"+i)+" = formats["+d+"]; var "+(v="isObject"+i)+" = typeof "+f+" == 'object' && !("+f+" instanceof RegExp) && "+f+".validate; var "+(g="formatType"+i)+" = "+v+" && "+f+".type || 'string'; if ("+v+") { ",e.async&&(s+=" var async"+i+" = "+f+".async; "),s+=" "+f+" = "+f+".validate; } if (  ",h&&(s+=" ("+d+" !== undefined && typeof "+d+" != 'string') || "),s+=" (","ignore"!=p&&(s+=" ("+d+" && !"+f+" ",m&&(s+=" && self._opts.unknownFormats.indexOf("+d+") == -1 "),s+=") || "),s+=" ("+f+" && "+g+" == '"+r+"' && !(typeof "+f+" == 'function' ? ",e.async?s+=" (async"+i+" ? await "+f+"("+u+") : "+f+"("+u+")) ":s+=" "+f+"("+u+") ",s+=" : "+f+".test("+u+"))))) {"}else{var f;if(!(f=e.formats[o])){if("ignore"==p)return e.logger.warn('unknown format "'+o+'" ignored in schema at path "'+e.errSchemaPath+'"'),l&&(s+=" if (true) { "),s;if(m&&p.indexOf(o)>=0)return l&&(s+=" if (true) { "),s;throw new Error('unknown format "'+o+'" is used in schema at path "'+e.errSchemaPath+'"')}var v,g=(v="object"==typeof f&&!(f instanceof RegExp)&&f.validate)&&f.type||"string";if(v){var y=!0===f.async;f=f.validate}if(g!=r)return l&&(s+=" if (true) { "),s;if(y){if(!e.async)throw new Error("async format in sync schema");s+=" if (!(await "+(b="formats"+e.util.getProperty(o)+".validate")+"("+u+"))) { "}else{s+=" if (! ";var b="formats"+e.util.getProperty(o);v&&(b+=".validate"),s+="function"==typeof f?" "+b+"("+u+") ":" "+b+".test("+u+") ",s+=") { "}}var E=E||[];E.push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'format' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { format:  ",s+=h?""+d:""+e.util.toQuotedString(o),s+="  } ",!1!==e.opts.messages&&(s+=" , message: 'should match format \"",s+=h?"' + "+d+" + '":""+e.util.escapeQuotes(o),s+="\"' "),e.opts.verbose&&(s+=" , schema:  ",s+=h?"validate.schema"+a:""+e.util.toQuotedString(o),s+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),s+=" } "):s+=" {} ";var _=s;return s=E.pop(),!e.compositeRule&&l?e.async?s+=" throw new ValidationError(["+_+"]); ":s+=" validate.errors = ["+_+"]; return false; ":s+=" var err = "+_+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" } ",l&&(s+=" else { "),s}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(n||""),d="valid"+i,h="errs__"+i,p=e.util.copy(e);p.level++;var m="valid"+p.level,f=e.schema.then,v=e.schema.else,g=void 0!==f&&e.util.schemaHasRules(f,e.RULES.all),y=void 0!==v&&e.util.schemaHasRules(v,e.RULES.all),b=p.baseId;if(g||y){var E;p.createErrors=!1,p.schema=o,p.schemaPath=a,p.errSchemaPath=c,s+=" var "+h+" = errors; var "+d+" = true;  ";var _=e.compositeRule;e.compositeRule=p.compositeRule=!0,s+="  "+e.validate(p)+" ",p.baseId=b,p.createErrors=!0,s+="  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; }  ",e.compositeRule=p.compositeRule=_,g?(s+=" if ("+m+") {  ",p.schema=e.schema.then,p.schemaPath=e.schemaPath+".then",p.errSchemaPath=e.errSchemaPath+"/then",s+="  "+e.validate(p)+" ",p.baseId=b,s+=" "+d+" = "+m+"; ",g&&y?s+=" var "+(E="ifClause"+i)+" = 'then'; ":E="'then'",s+=" } ",y&&(s+=" else { ")):s+=" if (!"+m+") { ",y&&(p.schema=e.schema.else,p.schemaPath=e.schemaPath+".else",p.errSchemaPath=e.errSchemaPath+"/else",s+="  "+e.validate(p)+" ",p.baseId=b,s+=" "+d+" = "+m+"; ",g&&y?s+=" var "+(E="ifClause"+i)+" = 'else'; ":E="'else'",s+=" } "),s+=" if (!"+d+") {   var err =   ",!1!==e.createErrors?(s+=" { keyword: 'if' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { failingKeyword: "+E+" } ",!1!==e.opts.messages&&(s+=" , message: 'should match \"' + "+E+" + '\" schema' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),s+=" } "):s+=" {} ",s+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&l&&(e.async?s+=" throw new ValidationError(vErrors); ":s+=" validate.errors = vErrors; return false; "),s+=" }   ",l&&(s+=" else { "),s=e.util.cleanUpCode(s)}else l&&(s+=" if (true) { ");return s}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(n||""),d="valid"+i,h="errs__"+i,p=e.util.copy(e),m="";p.level++;var f="valid"+p.level,v="i"+i,g=p.dataLevel=e.dataLevel+1,y="data"+g,b=e.baseId;if(s+="var "+h+" = errors;var "+d+";",Array.isArray(o)){var E=e.schema.additionalItems;if(!1===E){s+=" "+d+" = "+u+".length <= "+o.length+"; ";var _=c;c=e.errSchemaPath+"/additionalItems",s+="  if (!"+d+") {   ";var w=w||[];w.push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+o.length+" } ",!1!==e.opts.messages&&(s+=" , message: 'should NOT have more than "+o.length+" items' "),e.opts.verbose&&(s+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),s+=" } "):s+=" {} ";var S=s;s=w.pop(),!e.compositeRule&&l?e.async?s+=" throw new ValidationError(["+S+"]); ":s+=" validate.errors = ["+S+"]; return false; ":s+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" } ",c=_,l&&(m+="}",s+=" else { ")}var P=o;if(P)for(var x,C=-1,T=P.length-1;C<T;)if(x=P[C+=1],e.util.schemaHasRules(x,e.RULES.all)){s+=" "+f+" = true; if ("+u+".length > "+C+") { ";var A=u+"["+C+"]";p.schema=x,p.schemaPath=a+"["+C+"]",p.errSchemaPath=c+"/"+C,p.errorPath=e.util.getPathExpr(e.errorPath,C,e.opts.jsonPointers,!0),p.dataPathArr[g]=C;var M=e.validate(p);p.baseId=b,e.util.varOccurences(M,y)<2?s+=" "+e.util.varReplace(M,y,A)+" ":s+=" var "+y+" = "+A+"; "+M+" ",s+=" }  ",l&&(s+=" if ("+f+") { ",m+="}")}if("object"==typeof E&&e.util.schemaHasRules(E,e.RULES.all)){p.schema=E,p.schemaPath=e.schemaPath+".additionalItems",p.errSchemaPath=e.errSchemaPath+"/additionalItems",s+=" "+f+" = true; if ("+u+".length > "+o.length+") {  for (var "+v+" = "+o.length+"; "+v+" < "+u+".length; "+v+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers,!0);A=u+"["+v+"]";p.dataPathArr[g]=v;M=e.validate(p);p.baseId=b,e.util.varOccurences(M,y)<2?s+=" "+e.util.varReplace(M,y,A)+" ":s+=" var "+y+" = "+A+"; "+M+" ",l&&(s+=" if (!"+f+") break; "),s+=" } }  ",l&&(s+=" if ("+f+") { ",m+="}")}}else if(e.util.schemaHasRules(o,e.RULES.all)){p.schema=o,p.schemaPath=a,p.errSchemaPath=c,s+="  for (var "+v+" = 0; "+v+" < "+u+".length; "+v+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers,!0);A=u+"["+v+"]";p.dataPathArr[g]=v;M=e.validate(p);p.baseId=b,e.util.varOccurences(M,y)<2?s+=" "+e.util.varReplace(M,y,A)+" ":s+=" var "+y+" = "+A+"; "+M+" ",l&&(s+=" if (!"+f+") break; "),s+=" }"}return l&&(s+=" "+m+" if ("+h+" == errors) {"),s=e.util.cleanUpCode(s)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s,i=" ",n=e.level,o=e.dataLevel,a=e.schema[t],c=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,d="data"+(o||""),h=e.opts.$data&&a&&a.$data;h?(i+=" var schema"+n+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; ",s="schema"+n):s=a,i+="var division"+n+";if (",h&&(i+=" "+s+" !== undefined && ( typeof "+s+" != 'number' || "),i+=" (division"+n+" = "+d+" / "+s+", ",e.opts.multipleOfPrecision?i+=" Math.abs(Math.round(division"+n+") - division"+n+") > 1e-"+e.opts.multipleOfPrecision+" ":i+=" division"+n+" !== parseInt(division"+n+") ",i+=" ) ",h&&(i+="  )  "),i+=" ) {   ";var p=p||[];p.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { multipleOf: "+s+" } ",!1!==e.opts.messages&&(i+=" , message: 'should be multiple of ",i+=h?"' + "+s:s+"'"),e.opts.verbose&&(i+=" , schema:  ",i+=h?"validate.schema"+c:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var m=i;return i=p.pop(),!e.compositeRule&&u?e.async?i+=" throw new ValidationError(["+m+"]); ":i+=" validate.errors = ["+m+"]; return false; ":i+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",u&&(i+=" else { "),i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(n||""),d="errs__"+i,h=e.util.copy(e);h.level++;var p="valid"+h.level;if(e.util.schemaHasRules(o,e.RULES.all)){h.schema=o,h.schemaPath=a,h.errSchemaPath=c,s+=" var "+d+" = errors;  ";var m,f=e.compositeRule;e.compositeRule=h.compositeRule=!0,h.createErrors=!1,h.opts.allErrors&&(m=h.opts.allErrors,h.opts.allErrors=!1),s+=" "+e.validate(h)+" ",h.createErrors=!0,m&&(h.opts.allErrors=m),e.compositeRule=h.compositeRule=f,s+=" if ("+p+") {   ";var v=v||[];v.push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",!1!==e.opts.messages&&(s+=" , message: 'should NOT be valid' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),s+=" } "):s+=" {} ";var g=s;s=v.pop(),!e.compositeRule&&l?e.async?s+=" throw new ValidationError(["+g+"]); ":s+=" validate.errors = ["+g+"]; return false; ":s+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" } else {  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; } ",e.opts.allErrors&&(s+=" } ")}else s+="  var err =   ",!1!==e.createErrors?(s+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",!1!==e.opts.messages&&(s+=" , message: 'should NOT be valid' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),s+=" } "):s+=" {} ",s+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l&&(s+=" if (false) { ");return s}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(n||""),d="valid"+i,h="errs__"+i,p=e.util.copy(e),m="";p.level++;var f="valid"+p.level,v=p.baseId,g="prevValid"+i,y="passingSchemas"+i;s+="var "+h+" = errors , "+g+" = false , "+d+" = false , "+y+" = null; ";var b=e.compositeRule;e.compositeRule=p.compositeRule=!0;var E=o;if(E)for(var _,w=-1,S=E.length-1;w<S;)_=E[w+=1],e.util.schemaHasRules(_,e.RULES.all)?(p.schema=_,p.schemaPath=a+"["+w+"]",p.errSchemaPath=c+"/"+w,s+="  "+e.validate(p)+" ",p.baseId=v):s+=" var "+f+" = true; ",w&&(s+=" if ("+f+" && "+g+") { "+d+" = false; "+y+" = ["+y+", "+w+"]; } else { ",m+="}"),s+=" if ("+f+") { "+d+" = "+g+" = true; "+y+" = "+w+"; }";return e.compositeRule=p.compositeRule=b,s+=m+"if (!"+d+") {   var err =   ",!1!==e.createErrors?(s+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { passingSchemas: "+y+" } ",!1!==e.opts.messages&&(s+=" , message: 'should match exactly one schema in oneOf' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),s+=" } "):s+=" {} ",s+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&l&&(e.async?s+=" throw new ValidationError(vErrors); ":s+=" validate.errors = vErrors; return false; "),s+="} else {  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; }",e.opts.allErrors&&(s+=" } "),s}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s,i=" ",n=e.level,o=e.dataLevel,a=e.schema[t],c=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,d="data"+(o||""),h=e.opts.$data&&a&&a.$data;h?(i+=" var schema"+n+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; ",s="schema"+n):s=a,i+="if ( ",h&&(i+=" ("+s+" !== undefined && typeof "+s+" != 'string') || "),i+=" !"+(h?"(new RegExp("+s+"))":e.usePattern(a))+".test("+d+") ) {   ";var p=p||[];p.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { pattern:  ",i+=h?""+s:""+e.util.toQuotedString(a),i+="  } ",!1!==e.opts.messages&&(i+=" , message: 'should match pattern \"",i+=h?"' + "+s+" + '":""+e.util.escapeQuotes(a),i+="\"' "),e.opts.verbose&&(i+=" , schema:  ",i+=h?"validate.schema"+c:""+e.util.toQuotedString(a),i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var m=i;return i=p.pop(),!e.compositeRule&&u?e.async?i+=" throw new ValidationError(["+m+"]); ":i+=" validate.errors = ["+m+"]; return false; ":i+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",u&&(i+=" else { "),i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(n||""),d="errs__"+i,h=e.util.copy(e),p="";h.level++;var m="valid"+h.level,f="key"+i,v="idx"+i,g=h.dataLevel=e.dataLevel+1,y="data"+g,b="dataProperties"+i,E=Object.keys(o||{}),_=e.schema.patternProperties||{},w=Object.keys(_),S=e.schema.additionalProperties,P=E.length||w.length,x=!1===S,C="object"==typeof S&&Object.keys(S).length,T=e.opts.removeAdditional,A=x||C||T,M=e.opts.ownProperties,R=e.baseId,O=e.schema.required;if(O&&(!e.opts.$data||!O.$data)&&O.length<e.opts.loopRequired)var D=e.util.toHash(O);if(s+="var "+d+" = errors;var "+m+" = true;",M&&(s+=" var "+b+" = undefined;"),A){if(s+=M?" "+b+" = "+b+" || Object.keys("+u+"); for (var "+v+"=0; "+v+"<"+b+".length; "+v+"++) { var "+f+" = "+b+"["+v+"]; ":" for (var "+f+" in "+u+") { ",P){if(s+=" var isAdditional"+i+" = !(false ",E.length)if(E.length>8)s+=" || validate.schema"+a+".hasOwnProperty("+f+") ";else{var j=E;if(j)for(var L=-1,N=j.length-1;L<N;)J=j[L+=1],s+=" || "+f+" == "+e.util.toQuotedString(J)+" "}if(w.length){var I=w;if(I)for(var k=-1,V=I.length-1;k<V;)ie=I[k+=1],s+=" || "+e.usePattern(ie)+".test("+f+") "}s+=" ); if (isAdditional"+i+") { "}if("all"==T)s+=" delete "+u+"["+f+"]; ";else{var F=e.errorPath,U="' + "+f+" + '";if(e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(e.errorPath,f,e.opts.jsonPointers)),x)if(T)s+=" delete "+u+"["+f+"]; ";else{s+=" "+m+" = false; ";var H=c;c=e.errSchemaPath+"/additionalProperties",(te=te||[]).push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { additionalProperty: '"+U+"' } ",!1!==e.opts.messages&&(s+=" , message: '",e.opts._errorDataPathProperty?s+="is an invalid additional property":s+="should NOT have additional properties",s+="' "),e.opts.verbose&&(s+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),s+=" } "):s+=" {} ";var B=s;s=te.pop(),!e.compositeRule&&l?e.async?s+=" throw new ValidationError(["+B+"]); ":s+=" validate.errors = ["+B+"]; return false; ":s+=" var err = "+B+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c=H,l&&(s+=" break; ")}else if(C)if("failing"==T){s+=" var "+d+" = errors;  ";var $=e.compositeRule;e.compositeRule=h.compositeRule=!0,h.schema=S,h.schemaPath=e.schemaPath+".additionalProperties",h.errSchemaPath=e.errSchemaPath+"/additionalProperties",h.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,f,e.opts.jsonPointers);var z=u+"["+f+"]";h.dataPathArr[g]=f;var G=e.validate(h);h.baseId=R,e.util.varOccurences(G,y)<2?s+=" "+e.util.varReplace(G,y,z)+" ":s+=" var "+y+" = "+z+"; "+G+" ",s+=" if (!"+m+") { errors = "+d+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+u+"["+f+"]; }  ",e.compositeRule=h.compositeRule=$}else{h.schema=S,h.schemaPath=e.schemaPath+".additionalProperties",h.errSchemaPath=e.errSchemaPath+"/additionalProperties",h.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,f,e.opts.jsonPointers);z=u+"["+f+"]";h.dataPathArr[g]=f;G=e.validate(h);h.baseId=R,e.util.varOccurences(G,y)<2?s+=" "+e.util.varReplace(G,y,z)+" ":s+=" var "+y+" = "+z+"; "+G+" ",l&&(s+=" if (!"+m+") break; ")}e.errorPath=F}P&&(s+=" } "),s+=" }  ",l&&(s+=" if ("+m+") { ",p+="}")}var q=e.opts.useDefaults&&!e.compositeRule;if(E.length){var Q=E;if(Q)for(var J,K=-1,X=Q.length-1;K<X;){var Y=o[J=Q[K+=1]];if(e.util.schemaHasRules(Y,e.RULES.all)){var W=e.util.getProperty(J),Z=(z=u+W,q&&void 0!==Y.default);h.schema=Y,h.schemaPath=a+W,h.errSchemaPath=c+"/"+e.util.escapeFragment(J),h.errorPath=e.util.getPath(e.errorPath,J,e.opts.jsonPointers),h.dataPathArr[g]=e.util.toQuotedString(J);G=e.validate(h);if(h.baseId=R,e.util.varOccurences(G,y)<2){G=e.util.varReplace(G,y,z);var ee=z}else{ee=y;s+=" var "+y+" = "+z+"; "}if(Z)s+=" "+G+" ";else{if(D&&D[J]){s+=" if ( "+ee+" === undefined ",M&&(s+=" || ! Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(J)+"') "),s+=") { "+m+" = false; ";F=e.errorPath,H=c;var te,re=e.util.escapeQuotes(J);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(F,J,e.opts.jsonPointers)),c=e.errSchemaPath+"/required",(te=te||[]).push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+re+"' } ",!1!==e.opts.messages&&(s+=" , message: '",e.opts._errorDataPathProperty?s+="is a required property":s+="should have required property \\'"+re+"\\'",s+="' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),s+=" } "):s+=" {} ";B=s;s=te.pop(),!e.compositeRule&&l?e.async?s+=" throw new ValidationError(["+B+"]); ":s+=" validate.errors = ["+B+"]; return false; ":s+=" var err = "+B+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c=H,e.errorPath=F,s+=" } else { "}else l?(s+=" if ( "+ee+" === undefined ",M&&(s+=" || ! Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(J)+"') "),s+=") { "+m+" = true; } else { "):(s+=" if ("+ee+" !== undefined ",M&&(s+=" &&   Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(J)+"') "),s+=" ) { ");s+=" "+G+" } "}}l&&(s+=" if ("+m+") { ",p+="}")}}if(w.length){var se=w;if(se)for(var ie,ne=-1,oe=se.length-1;ne<oe;){Y=_[ie=se[ne+=1]];if(e.util.schemaHasRules(Y,e.RULES.all)){h.schema=Y,h.schemaPath=e.schemaPath+".patternProperties"+e.util.getProperty(ie),h.errSchemaPath=e.errSchemaPath+"/patternProperties/"+e.util.escapeFragment(ie),s+=M?" "+b+" = "+b+" || Object.keys("+u+"); for (var "+v+"=0; "+v+"<"+b+".length; "+v+"++) { var "+f+" = "+b+"["+v+"]; ":" for (var "+f+" in "+u+") { ",s+=" if ("+e.usePattern(ie)+".test("+f+")) { ",h.errorPath=e.util.getPathExpr(e.errorPath,f,e.opts.jsonPointers);z=u+"["+f+"]";h.dataPathArr[g]=f;G=e.validate(h);h.baseId=R,e.util.varOccurences(G,y)<2?s+=" "+e.util.varReplace(G,y,z)+" ":s+=" var "+y+" = "+z+"; "+G+" ",l&&(s+=" if (!"+m+") break; "),s+=" } ",l&&(s+=" else "+m+" = true; "),s+=" }  ",l&&(s+=" if ("+m+") { ",p+="}")}}}return l&&(s+=" "+p+" if ("+d+" == errors) {"),s=e.util.cleanUpCode(s)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(n||""),d="errs__"+i,h=e.util.copy(e);h.level++;var p="valid"+h.level;if(s+="var "+d+" = errors;",e.util.schemaHasRules(o,e.RULES.all)){h.schema=o,h.schemaPath=a,h.errSchemaPath=c;var m="key"+i,f="idx"+i,v="i"+i,g="' + "+m+" + '",y="data"+(h.dataLevel=e.dataLevel+1),b="dataProperties"+i,E=e.opts.ownProperties,_=e.baseId;E&&(s+=" var "+b+" = undefined; "),s+=E?" "+b+" = "+b+" || Object.keys("+u+"); for (var "+f+"=0; "+f+"<"+b+".length; "+f+"++) { var "+m+" = "+b+"["+f+"]; ":" for (var "+m+" in "+u+") { ",s+=" var startErrs"+i+" = errors; ";var w=m,S=e.compositeRule;e.compositeRule=h.compositeRule=!0;var P=e.validate(h);h.baseId=_,e.util.varOccurences(P,y)<2?s+=" "+e.util.varReplace(P,y,w)+" ":s+=" var "+y+" = "+w+"; "+P+" ",e.compositeRule=h.compositeRule=S,s+=" if (!"+p+") { for (var "+v+"=startErrs"+i+"; "+v+"<errors; "+v+"++) { vErrors["+v+"].propertyName = "+m+"; }   var err =   ",!1!==e.createErrors?(s+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { propertyName: '"+g+"' } ",!1!==e.opts.messages&&(s+=" , message: 'property name \\'"+g+"\\' is invalid' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),s+=" } "):s+=" {} ",s+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&l&&(e.async?s+=" throw new ValidationError(vErrors); ":s+=" validate.errors = vErrors; return false; "),l&&(s+=" break; "),s+=" } }"}return l&&(s+="  if ("+d+" == errors) {"),s=e.util.cleanUpCode(s)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(n||""),d="valid"+i,h=e.opts.$data&&o&&o.$data;h&&(s+=" var schema"+i+" = "+e.util.getData(o.$data,n,e.dataPathArr)+"; ");var p="schema"+i;if(!h)if(o.length<e.opts.loopRequired&&e.schema.properties&&Object.keys(e.schema.properties).length){var m=[],f=o;if(f)for(var v,g=-1,y=f.length-1;g<y;){v=f[g+=1];var b=e.schema.properties[v];b&&e.util.schemaHasRules(b,e.RULES.all)||(m[m.length]=v)}}else m=o;if(h||m.length){var E=e.errorPath,_=h||m.length>=e.opts.loopRequired,w=e.opts.ownProperties;if(l)if(s+=" var missing"+i+"; ",_){h||(s+=" var "+p+" = validate.schema"+a+"; ");var S="' + "+(M="schema"+i+"["+(C="i"+i)+"]")+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(E,M,e.opts.jsonPointers)),s+=" var "+d+" = true; ",h&&(s+=" if (schema"+i+" === undefined) "+d+" = true; else if (!Array.isArray(schema"+i+")) "+d+" = false; else {"),s+=" for (var "+C+" = 0; "+C+" < "+p+".length; "+C+"++) { "+d+" = "+u+"["+p+"["+C+"]] !== undefined ",w&&(s+=" &&   Object.prototype.hasOwnProperty.call("+u+", "+p+"["+C+"]) "),s+="; if (!"+d+") break; } ",h&&(s+="  }  "),s+="  if (!"+d+") {   ",(A=A||[]).push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+S+"' } ",!1!==e.opts.messages&&(s+=" , message: '",e.opts._errorDataPathProperty?s+="is a required property":s+="should have required property \\'"+S+"\\'",s+="' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),s+=" } "):s+=" {} ";var P=s;s=A.pop(),!e.compositeRule&&l?e.async?s+=" throw new ValidationError(["+P+"]); ":s+=" validate.errors = ["+P+"]; return false; ":s+=" var err = "+P+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" } else { "}else{s+=" if ( ";var x=m;if(x)for(var C=-1,T=x.length-1;C<T;){O=x[C+=1],C&&(s+=" || "),s+=" ( ( "+(N=u+(L=e.util.getProperty(O)))+" === undefined ",w&&(s+=" || ! Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(O)+"') "),s+=") && (missing"+i+" = "+e.util.toQuotedString(e.opts.jsonPointers?O:L)+") ) "}s+=") {  ";var A;S="' + "+(M="missing"+i)+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(E,M,!0):E+" + "+M),(A=A||[]).push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+S+"' } ",!1!==e.opts.messages&&(s+=" , message: '",e.opts._errorDataPathProperty?s+="is a required property":s+="should have required property \\'"+S+"\\'",s+="' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),s+=" } "):s+=" {} ";P=s;s=A.pop(),!e.compositeRule&&l?e.async?s+=" throw new ValidationError(["+P+"]); ":s+=" validate.errors = ["+P+"]; return false; ":s+=" var err = "+P+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" } else { "}else if(_){h||(s+=" var "+p+" = validate.schema"+a+"; ");var M;S="' + "+(M="schema"+i+"["+(C="i"+i)+"]")+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(E,M,e.opts.jsonPointers)),h&&(s+=" if ("+p+" && !Array.isArray("+p+")) {  var err =   ",!1!==e.createErrors?(s+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+S+"' } ",!1!==e.opts.messages&&(s+=" , message: '",e.opts._errorDataPathProperty?s+="is a required property":s+="should have required property \\'"+S+"\\'",s+="' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),s+=" } "):s+=" {} ",s+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+p+" !== undefined) { "),s+=" for (var "+C+" = 0; "+C+" < "+p+".length; "+C+"++) { if ("+u+"["+p+"["+C+"]] === undefined ",w&&(s+=" || ! Object.prototype.hasOwnProperty.call("+u+", "+p+"["+C+"]) "),s+=") {  var err =   ",!1!==e.createErrors?(s+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+S+"' } ",!1!==e.opts.messages&&(s+=" , message: '",e.opts._errorDataPathProperty?s+="is a required property":s+="should have required property \\'"+S+"\\'",s+="' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),s+=" } "):s+=" {} ",s+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",h&&(s+="  }  ")}else{var R=m;if(R)for(var O,D=-1,j=R.length-1;D<j;){O=R[D+=1];var L=e.util.getProperty(O),N=(S=e.util.escapeQuotes(O),u+L);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(E,O,e.opts.jsonPointers)),s+=" if ( "+N+" === undefined ",w&&(s+=" || ! Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(O)+"') "),s+=") {  var err =   ",!1!==e.createErrors?(s+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+S+"' } ",!1!==e.opts.messages&&(s+=" , message: '",e.opts._errorDataPathProperty?s+="is a required property":s+="should have required property \\'"+S+"\\'",s+="' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),s+=" } "):s+=" {} ",s+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}e.errorPath=E}else l&&(s+=" if (true) {");return s}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s,i=" ",n=e.level,o=e.dataLevel,a=e.schema[t],c=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,d="data"+(o||""),h="valid"+n,p=e.opts.$data&&a&&a.$data;if(p?(i+=" var schema"+n+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; ",s="schema"+n):s=a,(a||p)&&!1!==e.opts.uniqueItems){p&&(i+=" var "+h+"; if ("+s+" === false || "+s+" === undefined) "+h+" = true; else if (typeof "+s+" != 'boolean') "+h+" = false; else { "),i+=" var i = "+d+".length , "+h+" = true , j; if (i > 1) { ";var m=e.schema.items&&e.schema.items.type,f=Array.isArray(m);if(!m||"object"==m||"array"==m||f&&(m.indexOf("object")>=0||m.indexOf("array")>=0))i+=" outer: for (;i--;) { for (j = i; j--;) { if (equal("+d+"[i], "+d+"[j])) { "+h+" = false; break outer; } } } ";else{i+=" var itemIndices = {}, item; for (;i--;) { var item = "+d+"[i]; ";var v="checkDataType"+(f?"s":"");i+=" if ("+e.util[v](m,"item",!0)+") continue; ",f&&(i+=" if (typeof item == 'string') item = '\"' + item; "),i+=" if (typeof itemIndices[item] == 'number') { "+h+" = false; j = itemIndices[item]; break; } itemIndices[item] = i; } "}i+=" } ",p&&(i+="  }  "),i+=" if (!"+h+") {   ";var g=g||[];g.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { i: i, j: j } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),e.opts.verbose&&(i+=" , schema:  ",i+=p?"validate.schema"+c:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var y=i;i=g.pop(),!e.compositeRule&&u?e.async?i+=" throw new ValidationError(["+y+"]); ":i+=" validate.errors = ["+y+"]; return false; ":i+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",u&&(i+=" else { ")}else u&&(i+=" if (true) { ");return i}},function(e,t,r){"use strict";var s=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"];e.exports=function(e,t){for(var r=0;r<t.length;r++){e=JSON.parse(JSON.stringify(e));var i,n=t[r].split("/"),o=e;for(i=1;i<n.length;i++)o=o[n[i]];for(i=0;i<s.length;i++){var a=s[i],c=o[a];c&&(o[a]={anyOf:[c,{$ref:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#"}]})}}return e}},function(e,t,r){"use strict";var s=r(44).MissingRef;e.exports=function e(t,r,i){var n=this;if("function"!=typeof this._opts.loadSchema)throw new Error("options.loadSchema should be a function");"function"==typeof r&&(i=r,r=void 0);var o=a(t).then(function(){var e=n._addSchema(t,void 0,r);return e.validate||function e(t){try{return n._compile(t)}catch(e){if(e instanceof s)return function i(e){var i=e.missingSchema;if(l(i))throw new Error("Schema "+i+" is loaded but "+e.missingRef+" cannot be resolved");var o=n._loadingSchemas[i];o||(o=n._loadingSchemas[i]=n._opts.loadSchema(i)).then(c,c);return o.then(function(e){if(!l(i))return a(e).then(function(){l(i)||n.addSchema(e,i,void 0,r)})}).then(function(){return function e(t){try{return n._compile(t)}catch(e){if(e instanceof s)return i(e);throw e}function i(s){var i=s.missingSchema;if(l(i))throw new Error("Schema "+i+" is loaded but "+s.missingRef+" cannot be resolved");var o=n._loadingSchemas[i];return o||(o=n._loadingSchemas[i]=n._opts.loadSchema(i)).then(c,c),o.then(function(e){if(!l(i))return a(e).then(function(){l(i)||n.addSchema(e,i,void 0,r)})}).then(function(){return e(t)});function c(){delete n._loadingSchemas[i]}function l(e){return n._refs[e]||n._schemas[e]}}}(t)});function c(){delete n._loadingSchemas[i]}function l(e){return n._refs[e]||n._schemas[e]}}(e);throw e}function i(s){var i=s.missingSchema;if(l(i))throw new Error("Schema "+i+" is loaded but "+s.missingRef+" cannot be resolved");var o=n._loadingSchemas[i];return o||(o=n._loadingSchemas[i]=n._opts.loadSchema(i)).then(c,c),o.then(function(e){if(!l(i))return a(e).then(function(){l(i)||n.addSchema(e,i,void 0,r)})}).then(function(){return e(t)});function c(){delete n._loadingSchemas[i]}function l(e){return n._refs[e]||n._schemas[e]}}}(e)});i&&o.then(function(e){i(null,e)},i);return o;function a(t){var r=t.$schema;return r&&!n.getSchema(r)?e.call(n,{$ref:r},!0):Promise.resolve()}}},function(e,t,r){"use strict";var s=/^[a-z_$][a-z0-9_$-]*$/i,i=r(173),n=r(73);e.exports={add:function(e,t){var r=this.RULES;if(r.keywords[e])throw new Error("Keyword "+e+" is already defined");if(!s.test(e))throw new Error("Keyword "+e+" is not a valid identifier");if(t){this.validateKeyword(t,!0);var n=t.type;if(Array.isArray(n))for(var o=0;o<n.length;o++)c(e,n[o],t);else c(e,n,t);var a=t.metaSchema;a&&(t.$data&&this._opts.$data&&(a={anyOf:[a,{$ref:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#"}]}),t.validateSchema=this.compile(a,!0))}function c(e,t,s){for(var n,o=0;o<r.length;o++){var a=r[o];if(a.type==t){n=a;break}}n||(n={type:t,rules:[]},r.push(n));var c={keyword:e,definition:s,custom:!0,code:i,implements:s.implements};n.rules.push(c),r.custom[e]=c}return r.keywords[e]=r.all[e]=!0,this},get:function(e){var t=this.RULES.custom[e];return t?t.definition:this.RULES.keywords[e]||!1},remove:function(e){var t=this.RULES;delete t.keywords[e],delete t.all[e],delete t.custom[e];for(var r=0;r<t.length;r++)for(var s=t[r].rules,i=0;i<s.length;i++)if(s[i].keyword==e){s.splice(i,1);break}return this},validate:function e(t,r){e.errors=null;var s=this._validateKeyword=this._validateKeyword||this.compile(o,!0);if(s(t))return!0;e.errors=s.errors;if(r)throw new Error("custom keyword definition is invalid: "+this.errorsText(s.errors));return!1}};var o={definitions:{simpleTypes:n.definitions.simpleTypes},type:"object",dependencies:{schema:["validate"],$data:["validate"],statements:["inline"],valid:{not:{required:["macro"]}}},properties:{type:n.properties.type,schema:{type:"boolean"},statements:{type:"boolean"},dependencies:{type:"array",items:{type:"string"}},metaSchema:{type:"object"},modifying:{type:"boolean"},valid:{type:"boolean"},$data:{type:"boolean"},async:{type:"boolean"},errors:{anyOf:[{type:"boolean"},{const:"full"}]}}}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s,i,n=" ",o=e.level,a=e.dataLevel,c=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,h="data"+(a||""),p="valid"+o,m="errs__"+o,f=e.opts.$data&&c&&c.$data;f?(n+=" var schema"+o+" = "+e.util.getData(c.$data,a,e.dataPathArr)+"; ",i="schema"+o):i=c;var v,g,y,b,E,_="definition"+o,w=this.definition,S="";if(f&&w.$data){E="keywordValidate"+o;var P=w.validateSchema;n+=" var "+_+" = RULES.custom['"+t+"'].definition; var "+E+" = "+_+".validate;"}else{if(!(b=e.useCustomRule(this,c,e.schema,e)))return;i="validate.schema"+l,E=b.code,v=w.compile,g=w.inline,y=w.macro}var x=E+".errors",C="i"+o,T="ruleErr"+o,A=w.async;if(A&&!e.async)throw new Error("async keyword in sync schema");if(g||y||(n+=x+" = null;"),n+="var "+m+" = errors;var "+p+";",f&&w.$data&&(S+="}",n+=" if ("+i+" === undefined) { "+p+" = true; } else { ",P&&(S+="}",n+=" "+p+" = "+_+".validateSchema("+i+"); if ("+p+") { ")),g)w.statements?n+=" "+b.validate+" ":n+=" "+p+" = "+b.validate+"; ";else if(y){var M=e.util.copy(e);S="";M.level++;var R="valid"+M.level;M.schema=b.validate,M.schemaPath="";var O=e.compositeRule;e.compositeRule=M.compositeRule=!0;var D=e.validate(M).replace(/validate\.schema/g,E);e.compositeRule=M.compositeRule=O,n+=" "+D}else{(I=I||[]).push(n),n="",n+="  "+E+".call( ",e.opts.passContext?n+="this":n+="self",v||!1===w.schema?n+=" , "+h+" ":n+=" , "+i+" , "+h+" , validate.schema"+e.schemaPath+" ",n+=" , (dataPath || '')",'""'!=e.errorPath&&(n+=" + "+e.errorPath);var j=a?"data"+(a-1||""):"parentData",L=a?e.dataPathArr[a]:"parentDataProperty",N=n+=" , "+j+" , "+L+" , rootData )  ";n=I.pop(),!1===w.errors?(n+=" "+p+" = ",A&&(n+="await "),n+=N+"; "):n+=A?" var "+(x="customErrors"+o)+" = null; try { "+p+" = await "+N+"; } catch (e) { "+p+" = false; if (e instanceof ValidationError) "+x+" = e.errors; else throw e; } ":" "+x+" = null; "+p+" = "+N+"; "}if(w.modifying&&(n+=" if ("+j+") "+h+" = "+j+"["+L+"];"),n+=""+S,w.valid)d&&(n+=" if (true) { ");else{var I;n+=" if ( ",void 0===w.valid?(n+=" !",n+=y?""+R:""+p):n+=" "+!w.valid+" ",n+=") { ",s=this.keyword,(I=I||[]).push(n),n="",(I=I||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: '"+(s||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { keyword: '"+this.keyword+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should pass \""+this.keyword+"\" keyword validation' "),e.opts.verbose&&(n+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),n+=" } "):n+=" {} ";var k=n;n=I.pop(),!e.compositeRule&&d?e.async?n+=" throw new ValidationError(["+k+"]); ":n+=" validate.errors = ["+k+"]; return false; ":n+=" var err = "+k+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";var V=n;n=I.pop(),g?w.errors?"full"!=w.errors&&(n+="  for (var "+C+"="+m+"; "+C+"<errors; "+C+"++) { var "+T+" = vErrors["+C+"]; if ("+T+".dataPath === undefined) "+T+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+T+".schemaPath === undefined) { "+T+'.schemaPath = "'+u+'"; } ',e.opts.verbose&&(n+=" "+T+".schema = "+i+"; "+T+".data = "+h+"; "),n+=" } "):!1===w.errors?n+=" "+V+" ":(n+=" if ("+m+" == errors) { "+V+" } else {  for (var "+C+"="+m+"; "+C+"<errors; "+C+"++) { var "+T+" = vErrors["+C+"]; if ("+T+".dataPath === undefined) "+T+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+T+".schemaPath === undefined) { "+T+'.schemaPath = "'+u+'"; } ',e.opts.verbose&&(n+=" "+T+".schema = "+i+"; "+T+".data = "+h+"; "),n+=" } } "):y?(n+="   var err =   ",!1!==e.createErrors?(n+=" { keyword: '"+(s||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { keyword: '"+this.keyword+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should pass \""+this.keyword+"\" keyword validation' "),e.opts.verbose&&(n+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?n+=" throw new ValidationError(vErrors); ":n+=" validate.errors = vErrors; return false; ")):!1===w.errors?n+=" "+V+" ":(n+=" if (Array.isArray("+x+")) { if (vErrors === null) vErrors = "+x+"; else vErrors = vErrors.concat("+x+"); errors = vErrors.length;  for (var "+C+"="+m+"; "+C+"<errors; "+C+"++) { var "+T+" = vErrors["+C+"]; if ("+T+".dataPath === undefined) "+T+".dataPath = (dataPath || '') + "+e.errorPath+";  "+T+'.schemaPath = "'+u+'";  ',e.opts.verbose&&(n+=" "+T+".schema = "+i+"; "+T+".data = "+h+"; "),n+=" } } else { "+V+" } "),n+=" } ",d&&(n+=" else { ")}return n}},function(e){e.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON Schema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}},function(e){e.exports={$id:"https://schemas.3d.si.edu/voyager/document.schema.json",$schema:"http://json-schema.org/draft-07/schema#",title:"Smithsonian 3D Document",description:"Describes a 3D document containing a scene with 3D models.",definitions:{scene:{$id:"#scene",type:"object",properties:{nodes:{type:"array",description:"The indices of the scene's root nodes.",items:{type:"integer",minimum:0},uniqueItems:!0,minItems:1},setup:{description:"The index of the scene's setup.",type:"integer",minimum:0}}},node:{$id:"#node",type:"object",properties:{name:{type:"string"},children:{type:"array",description:"The indices of this node's children.",items:{type:"integer",minimum:0},uniqueItems:!0,minItems:1},matrix:{description:"A floating-point 4x4 transformation matrix stored in column-major order.",type:"array",items:{type:"number"},minItems:16,maxItems:16,default:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},translation:{description:"The node's translation along the x, y, and z axes.",type:"array",items:{type:"number"},minItems:3,maxItems:3,default:[0,0,0]},rotation:{description:"The node's unit quaternion rotation in the order (x, y, z, w), where w is the scalar.",type:"array",items:{type:"number",minimum:-1,maximum:1},minItems:4,maxItems:4,default:[0,0,0,1]},scale:{description:"The node's non-uniform scale, given as the scaling factors along the x, y, and z axes.",type:"array",items:{type:"number"},minItems:3,maxItems:3,default:[1,1,1]},camera:{description:"The index of the camera component of this node.",type:"integer",minimum:0},light:{description:"The index of the light component of this node.",type:"integer",minimum:0},meta:{description:"The index of the meta data component of this node.",type:"integer",minimum:0},model:{description:"The index of the model component of this node.",type:"integer",minimum:0}},not:{anyOf:[{required:["matrix","translation"]},{required:["matrix","rotation"]},{required:["matrix","scale"]}]}},camera:{$id:"#camera",type:"object",properties:{type:{description:"Specifies if the camera uses a perspective or orthographic projection.",type:"string",enum:["perspective","orthographic"]},perspective:{description:"A perspective camera containing properties to create a perspective projection matrix.",type:"object",properties:{yfov:{type:"number",description:"The floating-point vertical field of view in radians.",exclusiveMinimum:0},aspectRatio:{type:"number",description:"The floating-point aspect ratio of the field of view.",exclusiveMinimum:0},znear:{type:"number",description:"The floating-point distance to the near clipping plane.",exclusiveMinimum:0},zfar:{type:"number",description:"The floating-point distance to the far clipping plane.",exclusiveMinimum:0}},required:["yfov","znear"]},orthographic:{description:"An orthographic camera containing properties to create an orthographic projection matrix.",type:"object",properties:{xmag:{type:"number",description:"The floating-point horizontal magnification of the view. Must not be zero."},ymag:{type:"number",description:"The floating-point vertical magnification of the view. Must not be zero."},znear:{type:"number",description:"The floating-point distance to the near clipping plane.",exclusiveMinimum:0},zfar:{type:"number",description:"The floating-point distance to the far clipping plane. `zfar` must be greater than `znear`.",exclusiveMinimum:0}},required:["xmag","ymag","znear","zfar"]}},required:["type"],not:{required:["perspective","orthographic"]}},light:{$id:"#light",type:"object",properties:{type:{description:"Specifies the type of the light source.",type:"string",enum:["ambient","directional","point","spot","hemisphere"]},color:{$ref:"#/definitions/colorRGB"},intensity:{type:"number",minimum:0,default:1},castShadow:{type:"boolean",default:!1},point:{type:"object",properties:{distance:{type:"number",minimum:0},decay:{type:"number",minimum:0}}},spot:{type:"object",properties:{distance:{type:"number",minimum:0},decay:{type:"number",minimum:0},angle:{type:"number",minimum:0},penumbra:{type:"number",minimum:0}}},hemisphere:{type:"object",properties:{groundColor:{$ref:"#/definitions/colorRGB"}}}},required:["type"],not:{required:["point","spot","hemisphere"]}},colorRGB:{$id:"#colorRGB",type:"array",items:{type:"number",minimum:0,maximum:1},minItems:3,maxItems:3,default:[1,1,1]}},type:"object",properties:{asset:{type:"object",properties:{type:{type:"string",const:"application/si-dpo-3d.document+json"},version:{description:"Version of this presentation description.",type:"string",minLength:1},copyright:{description:"A copyright message to credit the content creator.",type:"string",minLength:1},generator:{description:"Tool that generated this presentation description.",type:"string",minLength:1}},required:["type","version"]},scene:{description:"Index of the root scene of the document.",type:"integer",minimum:0},scenes:{description:"An array of scenes.",type:"array",items:{$ref:"#/definitions/scene"}},nodes:{description:"An array of nodes.",type:"array",items:{$ref:"#/definitions/node"},minItems:1},metas:{description:"An array of meta data components.",type:"array",items:{$ref:"./meta.schema.json"}},setups:{description:"An array of setup components.",type:"array",items:{$ref:"./setup.schema.json"},minItems:1},cameras:{description:"An array of camera components.",type:"array",items:{$ref:"#/definitions/camera"},minItems:1},lights:{description:"An array of light components.",type:"array",items:{$ref:"#/definitions/light"},minItems:1},models:{description:"An array of model components.",type:"array",items:{$ref:"./model.schema.json"},minItems:1}},required:["asset","scene","scenes"],additionalProperties:!1}},function(e){e.exports={$id:"https://schemas.3d.si.edu/voyager/common.schema.json",$schema:"http://json-schema.org/draft-07/schema#",title:"Math",description:"Definitions for mathematical compound objects such as vectors and matrices.",definitions:{units:{$id:"#units",type:"string",enum:["inherit","mm","cm","m","km","in","ft","yd","mi"]},vector2:{description:"2-component vector.",$id:"#vector2",type:"array",items:{type:"number"},minItems:2,maxItems:2,default:[0,0]},vector3:{description:"3-component vector.",$id:"#vector3",type:"array",items:{type:"number"},minItems:3,maxItems:3,default:[0,0,0]},vector4:{description:"4-component vector.",$id:"#vector4",type:"array",items:{type:"number"},minItems:4,maxItems:4,default:[0,0,0,0]},matrix3:{description:"3 by 3, matrix, storage: column-major.",$id:"#matrix3",type:"array",items:{type:"number"},minItems:9,maxItems:9,default:[1,0,0,0,1,0,0,0,1]},matrix4:{description:"4 by 4 matrix, storage: column-major.",$id:"#matrix4",type:"array",items:{type:"number"},minItems:16,maxItems:16,default:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},boundingBox:{description:"Axis-aligned 3D bounding box.",$id:"#boundingBox",type:"object",properties:{min:{$ref:"#/definitions/vector3"},max:{$ref:"#/definitions/vector3"}},required:["min","max"]}}}},function(e){e.exports={$id:"https://schemas.3d.si.edu/voyager/meta.schema.json",$schema:"http://json-schema.org/draft-07/schema#",title:"Meta",description:"Meta data for a scene or model item.",definitions:{image:{$id:"image",description:"Reference to a preview image",type:"object",properties:{uri:{description:"Location of the image resource, absolute URL or path relative to this document",type:"string",minLength:1},quality:{type:"string",enum:["Thumb","Low","Medium","High"]},byteSize:{type:"integer",minimum:1},width:{type:"integer",minimum:1},height:{type:"integer",minimum:1}},required:["uri","quality"]},article:{$id:"#article",description:"Reference to an external document (HTML)",type:"object",properties:{id:{type:"string",minLength:1},title:{description:"Short title.",type:"string"},lead:{description:"Short lead text.",type:"string"},tags:{description:"Array of tags, categorizing the article.",type:"array",items:{type:"string"}},uri:{description:"Location of the article resource, absolute URL or path relative to this document",type:"string",minLength:1},mimeType:{description:"MIME type of the resource.",type:"string"},thumbnailUri:{description:"Location of a thumbnail/preview image of the resource.",type:"string"}},required:["id","uri"],additionalProperties:!1}},type:"object",properties:{collection:{description:"Information retrieved from the collection record for the item.",type:"object"},process:{description:"Information about how the item was processed.",type:"object"},images:{type:"array",items:{$ref:"#/definitions/image"},minLength:1},articles:{type:"array",items:{$ref:"#/definitions/article"},minLength:1},leadArticle:{description:"Index of the main article. This is the default article displayed with the item.",type:"integer",minimum:0}},additionalProperties:!1}},function(e){e.exports={$id:"https://schemas.3d.si.edu/voyager/model.schema.json",$schema:"http://json-schema.org/draft-07/schema#",title:"Model",description:"Describes the visual representations (models, derivatives) of a 3D item.",definitions:{annotation:{description:"Spatial annotation (hot spot, hot zone) on a model. Annotations can reference articles.",type:"object",properties:{id:{type:"string",minLength:1},title:{type:"string"},lead:{type:"string"},tags:{description:"Array of tags, categorizing the annotation.",type:"array",items:{type:"string"}},articleId:{description:"Id of an article related to this annotation.",type:"string",minLength:1},imageUri:{description:"URI of an image resource for this annotation.",type:"string",minLength:1},style:{type:"string"},visible:{description:"Flag indicating whether the annotation is visible.",type:"boolean",default:!0},expanded:{description:"Flag indicating whether the annotation is displayed in expanded state.",type:"boolean",default:!1},scale:{description:"Scales the annotation relative to its default size.",type:"number",default:1},offset:{description:"Offsets the annotation along its direction.",type:"number",default:0},tilt:{description:"Tilt angle of the annotation relative to the direction vector in degrees.",type:"number",default:0},azimuth:{description:"Azimuth angle of a tilted annotation.",type:"number",default:0},position:{description:"Position where the annotation is anchored, in local item coordinates.",$ref:"./common.schema.json#/definitions/vector3"},direction:{description:"Direction of the stem of this annotation, usually corresponds to the surface normal.",$ref:"./common.schema.json#/definitions/vector3"},zoneIndex:{description:"Index of the zone on the zone texture.",type:"integer",minimum:0}},required:["id"],additionalProperties:!1},derivative:{description:"Visual representation derived from the master model.",type:"object",properties:{usage:{description:"usage categories for a derivative.",type:"string",enum:["Image2D","Web3D","Print3D","Editorial3D"]},quality:{type:"string",enum:["Thumb","Low","Medium","High","Highest","LOD","Stream"]},assets:{description:"List of individual resources this derivative is composed of.",type:"array",items:{$ref:"#/definitions/asset"}}}},asset:{description:"an individual resource for a 3D model.",type:"object",properties:{uri:{type:"string",minLength:1},type:{type:"string",enum:["Model","Geometry","Image","Points","Volume"]},part:{type:"string",minLength:1},mimeType:{type:"string",minLength:1},byteSize:{type:"integer",minimum:1},numFaces:{type:"integer",minimum:1},imageSize:{type:"integer",minimum:1},mapType:{type:"string",enum:["Color","Normal","Occlusion","Emissive","MetallicRoughness","Zone"]}},required:["uri","type"]},material:{description:"Surface properties for this model, shared by all derivatives.",type:"object",properties:{}}},type:"object",properties:{units:{$ref:"./common.schema.json#/definitions/units"},derivatives:{type:"array",items:{$ref:"#/definitions/derivative"}},translation:{description:"Translation vector. Must be applied to bring model into its 'neutral' pose.",$ref:"./common.schema.json#/definitions/vector3"},rotation:{description:"Rotation quaternion. Must be applied to bring model into its 'neutral' pose.",$ref:"./common.schema.json#/definitions/vector4"},boundingBox:{description:"Bounding box for this model, shared by all derivatives.",$ref:"./common.schema.json#/definitions/boundingBox"},material:{$ref:"#/definitions/material"},annotations:{description:"List of annotations to be displayed with the model",type:"array",items:{$ref:"#/definitions/annotation"}}},required:["units","derivatives"],additionalProperties:!1}},function(e){e.exports={$id:"https://schemas.3d.si.edu/voyager/setup.schema.json",$schema:"http://json-schema.org/draft-07/schema#",title:"Setup",description:"Tours and settings for explorer documents (background, interface, etc.)",definitions:{viewer:{type:"object",properties:{shader:{type:"string"},exposure:{type:"number"},gamma:{type:"number"},annotationsVisible:{type:"boolean"}},required:["shader","exposure","gamma"]},reader:{type:"object",properties:{enabled:{type:"boolean"},position:{type:"string"},articleId:{description:"Id of the article currently displayed in the reader.",type:"string",minLength:1}}},interface:{type:"object",properties:{visible:{type:"boolean"},logo:{type:"boolean"},menu:{type:"boolean"},tools:{type:"boolean"}}},navigation:{type:"object",properties:{type:{type:"string",enum:["Orbit","Walk"]},enabled:{type:"boolean"},autoZoom:{type:"boolean"},orbit:{$comment:"TODO: Implement",type:"object",properties:{}},walk:{$comment:"TODO: Implement",type:"object",properties:{}}}},background:{type:"object",properties:{style:{type:"string",enum:["Solid","LinearGradient","RadialGradient"]},color0:{$ref:"./common.schema.json#/definitions/vector3"},color1:{$ref:"./common.schema.json#/definitions/vector3"}}},floor:{type:"object",properties:{visible:{type:"boolean"},position:{$ref:"./common.schema.json#/definitions/vector3"},size:{type:"number"},color:{$ref:"./common.schema.json#/definitions/vector3"},opacity:{type:"number"},receiveShadow:{type:"boolean"}}},grid:{type:"object",properties:{visible:{type:"boolean"},color:{$ref:"./common.schema.json#/definitions/vector3"}}},tape:{type:"object",properties:{enabled:{type:"boolean"},startPosition:{$ref:"./common.schema.json#/definitions/vector3"},startDirection:{$ref:"./common.schema.json#/definitions/vector3"},endPosition:{$ref:"./common.schema.json#/definitions/vector3"},endDirection:{$ref:"./common.schema.json#/definitions/vector3"}}},slicer:{type:"object",properties:{enabled:{type:"boolean"},axis:{type:"string",enum:["X","Y","Z"]},inverted:{type:"boolean"},position:{type:"number"}}},tours:{description:"Animated tours.",type:"array",items:{type:"object",properties:{title:{type:"string"},lead:{type:"string"},tags:{description:"Array of tags, categorizing the tour.",type:"array",items:{type:"string"}},steps:{type:"array",items:{type:"object",properties:{title:{type:"string"},id:{type:"string"}}}}}}},snapshots:{description:"Snapshots are animatable scene states.",type:"object",properties:{features:{type:"array",items:{type:"string"}},targets:{type:"array",items:{type:"string"}},states:{type:"array",items:{type:"object"}}}}},type:"object",properties:{units:{$ref:"./common.schema.json#/definitions/units"},interface:{$ref:"#/definitions/interface"},viewer:{$ref:"#/definitions/viewer"},reader:{$ref:"#/definitions/reader"},navigation:{$ref:"#/definitions/navigation"},background:{$ref:"#/definitions/background"},floor:{$ref:"#/definitions/floor"},grid:{$ref:"#/definitions/grid"},tape:{$ref:"#/definitions/tape"},slicer:{$ref:"#/definitions/slicer"},tours:{$ref:"#/definitions/tours"}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(1),n=r(24);t.EProjection=n.EProjection;const o=r(9),a=r(19),c=new s.Vector3,l=new s.Vector3,u=new s.Euler,d=new s.Quaternion;class h extends o.default{constructor(e,t){super(e,t),this.ins=this.addInputs(h.camIns),this.object3D=new n.default}get camera(){return this.object3D}update(){const{autoActivate:e,activate:t}=this.ins;if(t.changed||e.changed&&e.value){const e=this.scene;e&&(e.activeCameraComponent=this)}const r=this.camera,{position:s,rotation:i,projection:n,fov:o,size:a,zoom:c,near:l,far:u}=this.ins;return(s.changed||i.changed)&&(r.position.fromArray(s.value),r.rotation.fromArray(i.value),r.updateMatrix()),n.changed&&r.setProjection(n.getValidatedValue()),r.fov=o.value,r.size=a.value,r.zoom=c.value,r.near=l.value,r.far=u.value,r.updateProjectionMatrix(),!0}dispose(){const e=this.scene;e&&e.activeCameraComponent===this&&(e.activeCameraComponent=null),super.dispose()}setPropertiesFromMatrix(e){const t=!e;e=e||this.object3D.matrix;const{position:r,rotation:s,order:i}=this.ins;e.decompose(c,d,l),c.toArray(r.value);const n=i.getOptionText();u.setFromQuaternion(d,n),u.toVector3(c),c.multiplyScalar(a.default.RAD2DEG).toArray(s.value),r.set(t),s.set(t)}}h.typeName="CCamera",h.camIns={autoActivate:i.types.Boolean("Camera.AutoActivate",!0),activate:i.types.Event("Camera.Activate"),position:i.types.Vector3("Transform.Position"),rotation:i.types.Vector3("Transform.Rotation"),order:i.types.Enum("Transform.Order",o.ERotationOrder,o.ERotationOrder.ZYX),projection:i.types.Enum("Projection.Type",n.EProjection,n.EProjection.Perspective),fov:i.types.Number("Projection.FovY",52),size:i.types.Number("Projection.Size",20),zoom:i.types.Number("Projection.Zoom",1),near:i.types.Number("Frustum.ZNear",.01),far:i.types.Number("Frustum.ZFar",1e4)},t.default=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(21);t.CLight=s.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(1),n=r(21);class o extends n.default{constructor(e,t){super(e,t),this.ins=this.addInputs(o.dirLightIns),this.object3D=new s.DirectionalLight}get light(){return this.object3D}update(e){super.update(e);const t=this.light,r=this.ins;if((r.position.changed||r.target.changed)&&(t.position.fromArray(r.position.value),t.target.position.fromArray(r.target.value),t.updateMatrix()),r.shadowSize.changed){const e=t.shadow.camera,s=.5*r.shadowSize.value;e.left=e.bottom=-s,e.right=e.top=s,e.updateProjectionMatrix()}return!0}}o.typeName="CDirectionalLight",o.dirLightIns={position:i.types.Vector3("Light.Position",[0,1,0]),target:i.types.Vector3("Light.Target"),shadowSize:i.types.Number("Shadow.Size",100)},t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(1),n=r(21);new s.Vector3;class o extends n.default{constructor(e,t){super(e,t),this.ins=this.addInputs(o.pointLightIns),this.object3D=new s.PointLight}get light(){return this.object3D}update(e){super.update(e);const t=this.light,r=this.ins;return r.position.changed&&(t.position.fromArray(r.position.value),t.updateMatrix()),(r.distance.changed||r.decay.changed)&&(t.distance=r.distance.value,t.decay=r.decay.value),t.updateMatrix(),!0}}o.typeName="CPointLight",o.pointLightIns={position:i.types.Vector3("Light.Position",[0,1,0]),distance:i.types.Number("Light.Distance"),decay:i.types.Number("Light.Decay",1)},t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(1),n=r(21),o=r(17),a=new s.Vector3;class c extends n.default{constructor(e,t){super(e,t),this.ins=this.addInputs(c.spotLightIns),this.object3D=new s.SpotLight}get light(){return this.object3D}update(e){super.update(e);const t=this.light,r=this.ins;if(r.position.changed||r.rotation.changed||r.order.changed){t.position.fromArray(r.position.value),a.fromArray(r.rotation.value).multiplyScalar(s.Math.DEG2RAD);const e=r.order.getOptionText();t.rotation.setFromVector3(a,e),t.updateMatrix()}return(r.distance.changed||r.decay.changed||r.angle.changed||r.penumbra.changed)&&(t.distance=r.distance.value,t.decay=r.decay.value,t.angle=r.angle.value*s.Math.DEG2RAD,t.penumbra=r.penumbra.value),!0}}c.typeName="CSpotLight",c.spotLightIns={position:i.types.Vector3("Light.Position",[0,1,0]),rotation:i.types.Vector3("Light.Rotation",[0,0,0]),order:i.types.Enum("Light.RotationOrder",o.ERotationOrder),distance:i.types.Number("Light.Distance"),decay:i.types.Number("Light.Decay",1),angle:i.types.Number("Light.Angle",45),penumbra:i.types.Number("Light.Penumbra",.5)},t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(6);class i extends s.default{constructor(e){super(),this.addEvent("update"),this._list=e||[],this._dict={},e&&e.forEach(e=>{e.id&&(this._dict[e.id]=e)})}get length(){return this._list.length}get ids(){return Object.keys(this._dict)}get items(){return this._list}set items(e){this._list=e,this._dict={},e.forEach(e=>{e.id&&(this._dict[e.id]=e)}),this.emit({type:"update",item:null,what:"update"})}append(e){this._list.push(e),e.id&&(this._dict[e.id]=e),this.emit({type:"update",item:e,what:"add"})}insertBefore(e,t){const r=this._list.indexOf(t);r>=0&&this.insertAt(e,r)}insertAt(e,t){this._list.splice(t,0,e),e.id&&(this._dict[e.id]=e),this.emit({type:"update",item:e,what:"add"})}replaceItem(e,t){const r=this._list.indexOf(t);r>=0&&this.replaceAt(e,r)}replaceAt(e,t){const r=this._list[t];r.id&&delete this._dict[r.id],this._list[t]=e,e.id&&(this._dict[e.id]=e),this.emit({type:"update",item:e,what:"replace"})}moveItem(e,t){const r=this._list.indexOf(e);this.moveAt(r,t)}moveAt(e,t){const r=this._list;if(e+t<0||e+t>=r.length)return;const s=r[e];if(t>0){for(let s=0;s<t;++s)r[e+s]=r[e+s+1];r[e+t]=s}else{if(!(t<0))return;for(let s=0;s>t;--s)r[e+s]=r[e+s-1];r[e+t]=s}this.emit({type:"update",item:s,what:"move"})}removeById(e){const t=this._dict[e];return t&&this.removeItem(t),t}removeItem(e){const t=this._list.indexOf(e);return this.removeAt(t),t}removeAt(e){const t=this._list;if(e<0||e>=t.length)return;const r=t[e];return t.splice(e,1),r.id&&delete this._dict[r.id],this.emit({type:"update",item:r,what:"remove"}),r}getAt(e){return this._list[e]}getById(e){return this._dict[e]}getIndexOf(e){return this._list.indexOf(e)}copy(e){this.items=e.slice()}clone(){return this._list.slice()}}t.default=i,i.prototype[Symbol.iterator]=function(){return{index:0,list:this._list,next:function(){return this.index<this.list.length?{value:this.list[this.index++],done:!1}:{done:!0}}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(6);t.default=class extends s.default{constructor(e){super(),this.addEvent("update"),this._dict={},e&&e.forEach(e=>{e.id&&(this._dict[e.id]=e)})}get length(){return this.ids.length}get items(){return this.ids.map(e=>this._dict[e])}set items(e){e.forEach(e=>{e.id&&(this._dict[e.id]=e)}),this.emit({type:"update",item:null,what:"update"})}get ids(){return Object.keys(this._dict)}get dictionary(){return this._dict}set dictionary(e){this._dict=e,this.emit({type:"update",item:null,what:"update"})}insert(e,t){if(!(t=t||e.id))throw new Error("can't insert, missing id");if(void 0!==this._dict[t])throw new Error(`id already exists: '${t}'`);this._dict[t]=e,this.emit({type:"update",item:e,what:"insert"})}remove(e){const t="string"==typeof e?e:e.id,r=this._dict[t];void 0!==r&&(delete this._dict[t],this.emit({type:"update",item:r,what:"remove"}))}get(e){return this._dict[e]}getOrCreate(e,t){let r=this._dict[e];return r||(r=this._dict[e]=t,this.emit({type:"update",item:r,what:"insert"})),r}copy(e){this.dictionary=Object.assign({},e)}clone(){return Object.assign({},this._dict)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(33),i={mm:{mm:1,cm:.1,m:.001,km:1,in:.0393701,ft:.00328084,yd:.00109361,mi:1},cm:{mm:10,cm:1,m:.01,km:1,in:.393701,ft:.0328084,yd:.0109361,mi:1},m:{mm:1e3,cm:100,m:1,km:1,in:39.3701,ft:3.28084,yd:1.09361,mi:1},km:{mm:1e6,cm:1e5,m:1e3,km:1,in:39370.1,ft:3280.84,yd:1093.61,mi:1},in:{mm:25.4,cm:2.54,m:.0254,km:1,in:1,ft:.0833333,yd:.0277778,mi:1},ft:{mm:304.8,cm:30.48,m:.3048,km:1,in:12,ft:1,yd:.333334,mi:1},yd:{mm:914.4,cm:91.44,m:.9144,km:1,in:36,ft:3,yd:1,mi:1},mi:{mm:1609e3,cm:160900,m:1609,km:1,in:63346456.693,ft:5278871.391,yd:1759623.797,mi:1}};t.default=function(e,t){const r=s.EUnitType[e],n=s.EUnitType[t];return i[r][n]||1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(189),i=r(79),n=[],o=[s.EDerivativeQuality.Thumb,s.EDerivativeQuality.Low,s.EDerivativeQuality.Medium,s.EDerivativeQuality.High,s.EDerivativeQuality.Highest];t.default=class{constructor(){this.derivatives={}}select(e,t){const r=s.EDerivativeUsage[e],i=s.EDerivativeQuality[t],n=o.indexOf(t);if(n<0)return console.warn(`derivative quality not supported: '${i}'`),null;const a=this.get(e,t);if(a)return a;for(let t=n+1;t<o.length;++t){const r=this.get(e,o[t]);if(r)return console.warn(`derivative quality '${i}' not available, using higher quality`),r}for(let t=n-1;t>=0;--t){const r=this.get(e,o[t]);if(r)return console.warn(`derivative quality '${i}' not available, using lower quality`),r}return console.warn(`no suitable derivative found for quality '${i}'`+` and usage '${r}'`),null}getByUsage(e){const t=s.EDerivativeUsage[e];return this.derivatives[t]||n}getArray(){return Object.keys(this.derivatives).reduce((e,t)=>e.concat(this.derivatives[t]),[])}get(e,t){const r=s.EDerivativeUsage[e],i=this.derivatives[r];if(i)for(let e=0,r=i.length;e<r;++e)if(i[e].data.quality===t)return i[e];return null}getOrCreate(e,t){const r=this.getOrCreateBin(e);for(let e=0,s=r.length;e<s;++e)if(r[e].data.quality===t)return r[e];const i=new s.default;return i.set("usage",e),i.set("quality",t),r.push(i),i}createModelAsset(e,t){t="string"==typeof t?s.EDerivativeQuality[t]:t,t=isFinite(t)?t:s.EDerivativeQuality.Medium;const r=this.getOrCreate(s.EDerivativeUsage.Web3D,t),n=new i.default;return n.setModel(e),r.addAsset(n),r}createMeshAsset(e,t,r,n,o){o="string"==typeof o?s.EDerivativeQuality[o]:o,o=isFinite(o)?o:s.EDerivativeQuality.Medium;const a=this.getOrCreate(s.EDerivativeUsage.Web3D,o),c=new i.default;if(c.setGeometry(e),a.addAsset(c),t){const e=new i.default;e.setTexture(t,i.EMapType.Color),a.addAsset(e)}if(r){const e=new i.default;e.setTexture(r,i.EMapType.Occlusion),a.addAsset(e)}if(n){const e=new i.default;e.setTexture(n,i.EMapType.Normal),a.addAsset(e)}return a}clear(){for(let e in this.derivatives)this.derivatives[e].forEach(e=>e.dispose());this.derivatives={}}toJSON(){const e=[];for(let t in this.derivatives)this.derivatives[t].forEach(t=>e.push(t.toJSON()));return e}fromJSON(e){this.clear(),e.forEach(e=>{this.getOrCreateBin(s.EDerivativeUsage[e.usage]).push(new s.default(e))})}toString(e=!1){const t=this.derivatives,r=Object.keys(t);return e?`Derivatives (${r.length}) \n `+r.map(e=>t[e].map(e=>e.toString(!0)).join("\n ")).join("\n "):`Derivatives (${r.length}) `+r.map(e=>`${e} (${t[e].length})`).join(", ")}getOrCreateBin(e){const t=s.EDerivativeUsage[e];return this.derivatives[t]||(this.derivatives[t]=[])}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(41),n=r(32),o=r(46);t.EDerivativeQuality=o.EDerivativeQuality,t.EDerivativeUsage=o.EDerivativeUsage;const a=r(37),c=r(79);t.Asset=c.default,t.EAssetType=c.EAssetType;class l extends n.default{constructor(){super(...arguments),this.model=null}static fromJSON(e){return new l(e)}dispose(){this.unload(),super.dispose()}load(e){if(this.data.usage!==o.EDerivativeUsage.Web3D)throw new Error("can't load, not a Web3D derivative");const t=this.findAsset(c.EAssetType.Model);if(t)return e.getModel(t.data.uri).then(e=>(this.model&&i.disposeObject(this.model),this.model=e,e));const r=this.findAsset(c.EAssetType.Geometry),n=this.findAssets(c.EAssetType.Image);return r?e.getGeometry(r.data.uri).then(t=>(this.model=new s.Mesh(t,new a.default),Promise.all(n.map(t=>e.getTexture(t.data.uri))).catch(e=>(console.warn("failed to load texture files"),[])))).then(e=>{const t=this.model.material;return this.assignTextures(n,e,t),t.map||(t.color.setScalar(.5),t.roughness=.8,t.metalness=0),this.model}):void 0}unload(){this.model&&i.disposeObject(this.model)}createAsset(e,t){const r=new c.default;return r.data.type=e,r.data.uri=t,this.addAsset(r),r}addAsset(e){if(!e.data.uri)throw new Error("uri must be specified");this.data.assets.push(e),this.update()}removeAsset(e){const t=this.data.assets.indexOf(e);t>=0&&this.data.assets.splice(t,1)}findAsset(e){return this.data.assets.find(t=>t.data.type===e)}findAssets(e){return this.data.assets.filter(t=>t.data.type===e)}toString(e=!1){const t=this.data;return e?`Derivative - usage: '${o.EDerivativeUsage[t.usage]}', quality: '${o.EDerivativeQuality[t.quality]}'\n   `+t.assets.map(e=>e.toString()).join("\n   "):`Derivative - usage: '${o.EDerivativeUsage[t.usage]}', quality: '${o.EDerivativeQuality[t.quality]}', #assets: ${t.assets.length})`}init(){return{usage:o.EDerivativeUsage.Web3D,quality:o.EDerivativeQuality.Medium,assets:[]}}deflate(e,t){t.usage=o.EDerivativeUsage[e.usage],t.quality=o.EDerivativeQuality[e.quality],t.assets=e.assets.map(e=>e.toJSON())}inflate(e,t){if(t.usage=o.EDerivativeUsage[e.usage],void 0===t.usage)throw new Error(`unknown derivative usage: ${e.usage}`);if(t.quality=o.EDerivativeQuality[e.quality],void 0===t.quality)throw new Error(`unknown derivative quality: ${e.quality}`);t.assets=e.assets.map(e=>new c.default(e))}assignTextures(e,t,r){for(let s=0;s<e.length;++s){const i=e[s],n=t[s];switch(i.data.mapType){case c.EMapType.Color:r.map=n;break;case c.EMapType.Occlusion:r.aoMap=n;break;case c.EMapType.Emissive:r.emissiveMap=n;break;case c.EMapType.MetallicRoughness:r.metalnessMap=n,r.roughnessMap=n;break;case c.EMapType.Normal:r.normalMap=n}}}}t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(80);t.HTMLSprite=i.default;t.default=class extends s.Object3D{constructor(){super(...arguments),this.isHTMLSpriteGroup=!0,this._visible=!0}get visible(){return this._visible}set visible(e){if(e!==this._visible){this._visible=e;const t=this.children;for(let r=0,s=t.length;r<s;++r)t[r].visible=e}}dispose(){const e=this.children;for(let t=0,r=e.length;t<r;++t)e[t].dispose()}disposeHTMLContainer(e){const t=this.children;for(let r=0,s=t.length;r<s;++r)t[r].disposeHTMLElement(e)}render(e,t){if(!this.visible)return;const r=this.children;for(let s=0,i=r.length;s<i;++s)r[s].renderHTMLElement(e,t)}update(){const e=this.children;for(let t=0,r=e.length;t<r;++t)e[t].update()}}},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(0),n=r(11),o=r(82);t.default=class extends o.default{constructor(e){super(e),this.pin=new i.Mesh(new i.CylinderBufferGeometry(.5,.02,3,16,1),new i.MeshPhongMaterial({color:"#f21818"})),this.pin.geometry.translate(0,1.5,0),this.pin.frustumCulled=!1,this.pin.matrixAutoUpdate=!1,this.add(this.pin),this.update()}update(){const e=this.annotation.data;this.pin.scale.setScalar(e.scale),this.pin.position.y=e.offset,this.pin.updateMatrix(),super.update()}renderHTMLElement(e,t){return null}updateHTMLElement(e){}createHTMLElement(){return null}};let a=class extends o.AnnotationElement{firstConnected(){super.firstConnected(),this.classList.add("sv-pin-annotation")}render(){const e=this.sprite.annotation.data;return n.html`<div>${e.title}</div>`}};a=s([n.customElement("sv-pin-annotation")],a)},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(0),n=r(19),o=r(11),a=r(82),c=["sv-q0","sv-q1","sv-q2","sv-q3"];t.default=class extends a.default{constructor(e){super(e),this.quadrant=-1;const t=new i.Geometry;t.vertices.push(new i.Vector3(0,0,0),new i.Vector3(0,1,0));const r=new i.LineBasicMaterial({color:"#009cde"});r.transparent=!0,this.beam=new i.Line(t,r),this.beam.frustumCulled=!1,this.beam.matrixAutoUpdate=!1,this.add(this.beam),this.update()}update(){const e=this.annotation.data;this.beam.scale.setScalar(5*e.scale),this.beam.position.y=e.offset,this.beam.updateMatrix(),super.update()}renderHTMLElement(e,t){const r=super.renderHTMLElement(e,t,this.beam),s=n.default.scaleLimit(this.viewAngle*n.default.RAD2DEG,90,100,1,0)*r.getOpacity();return r.style.opacity=s.toString(),this.beam.material.opacity=s,r.style.visibility=s?"visible":"hidden",this.orientationQuadrant!==this.quadrant&&(r.classList.remove(c[this.quadrant]),r.classList.add(c[this.orientationQuadrant]),this.quadrant=this.orientationQuadrant),r}updateHTMLElement(e){e.performUpdate()}createHTMLElement(){return new l(this)}};let l=class extends a.AnnotationElement{constructor(e){super(e),this.handler=0,this.isExpanded=!0,this.currentOpacity=0,this.targetOpacity=0,this.onClickArticle=this.onClickArticle.bind(this),this.titleElement=this.appendElement("div"),this.titleElement.classList.add("sv-content","sv-title"),this.wrapperElement=this.appendElement("div"),this.contentElement=this.createElement("div",null,this.wrapperElement),this.contentElement.classList.add("sv-content","sv-description")}getOpacity(){return this.currentOpacity=this.targetOpacity,this.currentOpacity}firstConnected(){super.firstConnected(),this.classList.add("sv-beam-annotation")}update(e){super.update(e);const t=this.sprite.annotation.data;this.titleElement.innerText=t.title;const r=o.html`<p>${t.lead}</p>
            ${t.articleId?o.html`<ff-button inline text="Read more..." icon="document" @click=${this.onClickArticle}></ff-button>`:null}`;o.render(r,this.contentElement),this.targetOpacity=t.visible?1:0,this.isExpanded!==t.expanded&&(this.isExpanded=t.expanded,window.clearTimeout(this.handler),this.isExpanded?(this.classList.add("sv-expanded"),this.contentElement.style.display="inherit",this.contentElement.style.height=this.contentElement.scrollHeight+"px"):(this.classList.remove("sv-expanded"),this.contentElement.style.height="0",this.handler=window.setTimeout(()=>this.contentElement.style.display="none",300)))}onClickArticle(e){e.stopPropagation(),this.sprite.emitLinkEvent(this.sprite.annotation.data.articleId)}};l=s([o.customElement("sv-beam-annotation")],l)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1);t.Node=s.Node,t.types=s.types;class i extends s.default{preRender(e){}postRender(e){}}i.typeName="CRenderable",t.default=i,i.prototype.preRender=null,i.prototype.postRender=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(9),i=r(24);t.EProjection=i.EProjection;const n=r(16);var o;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Top=2]="Top",e[e.Bottom=3]="Bottom",e[e.Front=4]="Front",e[e.Back=5]="Back",e[e.None=6]="None"}(o=t.EViewPreset||(t.EViewPreset={}));class a extends s.default{constructor(){super(...arguments),this.ins=this.addInputs(a.navIns)}get assetReader(){return this.getMainComponent(n.default)}create(){super.create(),this.system.on(["pointer-down","pointer-up","pointer-move"],this.onPointer,this),this.system.on("wheel",this.onTrigger,this),this.assetReader.outs.completed.on("value",this.onLoadingCompleted,this)}dispose(){this.assetReader.outs.completed.off("value",this.onLoadingCompleted,this),this.system.off(["pointer-down","pointer-up","pointer-move"],this.onPointer,this),this.system.off("wheel",this.onTrigger,this),super.dispose()}fromData(e){this.ins.copyValues({enabled:!!e.enabled,autoZoom:!!e.autoZoom})}toData(){return{enabled:this.ins.enabled.value,autoZoom:this.ins.autoZoom.value}}onPointer(e){}onTrigger(e){}onLoadingCompleted(e){this.ins.zoomExtents.set()}}a.typeName="CVNavigation",a.navIns={enabled:s.types.Boolean("Navigation.Enabled",!0),includeLights:s.types.Boolean("Navigation.IncludeLights",!0),autoZoom:s.types.Boolean("Navigation.AutoZoom",!0),zoomExtents:s.types.Event("Navigation.ZoomExtents"),preset:s.types.Enum("Camera.ViewPreset",o,o.None),projection:s.types.Enum("Camera.Projection",i.EProjection,i.EProjection.Perspective)},t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(9),i=r(196);t.EBackgroundStyle=i.EBackgroundStyle;class n extends s.default{constructor(e,t){super(e,t),this.ins=this.addInputs(n.backgroundIns),this.object3D=new i.default}get background(){return this.object3D}update(e){super.update(e);const t=this.ins,r=this.background.material;return t.style.changed&&(r.style=t.style.getValidatedValue()),t.color0.changed&&r.color0.fromArray(t.color0.value),t.color1.changed&&r.color1.fromArray(t.color1.value),t.noise.changed&&(r.noise=t.noise.value),!0}dispose(){this.background.dispose(),super.dispose()}}n.typeName="CBackground",n.backgroundIns={style:s.types.Enum("Background.Style",i.EBackgroundStyle,i.EBackgroundStyle.RadialGradient),color0:s.types.ColorRGB("Background.Color0",[.2,.25,.3]),color1:s.types.ColorRGB("Background.Color1",[.01,.03,.05]),noise:s.types.Number("Background.Noise",{min:0,max:1,bar:!0,preset:.02})},t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0);var i;!function(e){e[e.Solid=0]="Solid",e[e.LinearGradient=1]="LinearGradient",e[e.RadialGradient=2]="RadialGradient"}(i=t.EBackgroundStyle||(t.EBackgroundStyle={}));t.default=class extends s.Mesh{constructor(){super(new n,new o),this.frustumCulled=!1,this.renderOrder=-1/0,this.matrixAutoUpdate=!1}dispose(){this.geometry.dispose(),this.material.dispose()}updateMatrixWorld(e){}};class n extends s.BufferGeometry{constructor(){super();const e=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),t=new s.InterleavedBuffer(e,5);this.setIndex([0,1,2,0,2,3]),this.addAttribute("position",new s.InterleavedBufferAttribute(t,3,0,!1)),this.addAttribute("uv",new s.InterleavedBufferAttribute(t,2,3,!1))}}t.BackgroundGeometry=n;class o extends s.RawShaderMaterial{constructor(){super(...arguments),this.depthTest=!1,this.depthWrite=!1,this.transparent=!1,this.uniforms={style:{value:i.LinearGradient},color0:{value:new s.Vector3(.15,.2,.25)},color1:{value:new s.Vector3(0,0,0)},noise:{value:.02}},this.vertexShader=["precision highp float;","attribute vec3 position;","attribute vec2 uv;","varying vec2 ndc;","void main() {","  ndc = position.xy;","  gl_Position = vec4(position, 1.0);","}"].join("\n"),this.fragmentShader=["precision highp float;","uniform vec3 color0;","uniform vec3 color1;","uniform float noise;","uniform int style;","varying vec2 ndc;","float rand(vec2 co) {","float dt = dot(co.xy ,vec2(12.9898, 78.233));","float sn = mod(dt, 3.14);","return fract(sin(sn) * 43758.5453);","}","void main() {","  float f = style == 0 ? 0.0 : (style == 1 ? ndc.y * 0.5 + 0.5 : length(ndc) * 0.707);","  gl_FragColor = vec4(mix(color0, color1, f) + noise * rand(ndc), 1.0);","}"].join("\n")}set style(e){this.uniforms.style.value=e}get style(){return this.uniforms.style.value}set color0(e){if(e instanceof s.Color){const t=this.uniforms.color0.value;t.x=e.r,t.y=e.g,t.z=e.b}else this.uniforms.color0.value.copy(e)}get color0(){return this.uniforms.color0.value}set color1(e){if(e instanceof s.Color){const t=this.uniforms.color1.value;t.x=e.r,t.y=e.g,t.z=e.b}else this.uniforms.color1.value.copy(e)}get color1(){return this.uniforms.color1.value}set noise(e){this.uniforms.noise.value=e}get noise(){return this.uniforms.noise.value}}t.BackgroundMaterial=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(9),i=r(198);class n extends s.default{constructor(e,t){super(e,t),this.ins=this.addInputs(n.floorIns),this.object3D=new i.default}get floor(){return this.object3D}update(e){super.update(e);const t=this.ins,r=this.floor;return(t.position.changed||t.radius.changed)&&(r.position.fromArray(t.position.value),r.scale.setScalar(t.radius.value),r.updateMatrix()),t.color.changed&&r.material.color.fromArray(t.color.value),t.opacity.changed&&(r.material.opacity=t.opacity.value),!0}dispose(){this.floor.dispose(),super.dispose()}}n.typeName="CFloor",n.floorIns={position:s.types.Vector3("Floor.Position",[0,-25,0]),radius:s.types.Number("Floor.Radius",50),color:s.types.ColorRGB("Floor.Color",[.6,.75,.8]),opacity:s.types.Percent("Floor.Opacity",.5),castShadow:s.types.Boolean("Shadow.Cast"),receiveShadow:s.types.Boolean("Shadow.Receive")},t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(199),n=r(200);t.default=class extends s.Mesh{constructor(){super(new s.PlaneBufferGeometry(2,2,1,1),new o),this.geometry.rotateX(-90*s.Math.DEG2RAD),this.receiveShadow=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};class o extends s.MeshPhongMaterial{constructor(e){super(e),this.defines={},this.type="FloorMaterial",this.isMeshPhongMaterial=!0,this.isFloorMaterial=!0,this.defines={},this.uniforms=s.UniformsUtils.merge([s.ShaderLib.phong.uniforms]),this.vertexShader=n,this.fragmentShader=i,this.transparent=!0}}t.FloorMaterial=o},function(e,t){e.exports="\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n\n// #include <uv_pars_fragment>\n// replaced with\nvarying vec2 vUv;\n\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n    vec2 coords = vUv * 2.0 - 1.0;\n    float f = dot(coords, coords);\n\tgl_FragColor = vec4(outgoingLight, mix(diffuseColor.a, 0.0, f));\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n\n"},function(e,t){e.exports="\n#define PHONG\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n\n// #include <uv_pars_vertex>\n// replaced with\nvarying vec2 vUv;\nuniform mat3 uvTransform;\n\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t// #include <uv_vertex>\n\t// replaced with\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n\n"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0);class i extends s.LineSegments{constructor(e){super(i.generate(e),new s.LineBasicMaterial({vertexColors:s.VertexColors}))}update(e){this.geometry&&this.geometry.dispose(),this.geometry=i.generate(e)}static generate(e){const t=new s.Color(e.mainColor),r=new s.Color(e.subColor),i=e.mainDivisions*e.subDivisions,n=e.size/i,o=.5*e.size,a=[],c=[];for(let s=0,l=0,u=-o;s<=i;++s,u+=n){a.push(-o,0,u,o,0,u),a.push(u,0,-o,u,0,o);const i=s%e.subDivisions==0?t:r;i.toArray(c,l),l+=3,i.toArray(c,l),l+=3,i.toArray(c,l),l+=3,i.toArray(c,l),l+=3}const l=new s.BufferGeometry;return l.addAttribute("position",new s.Float32BufferAttribute(a,3)),l.addAttribute("color",new s.Float32BufferAttribute(c,3)),l}}t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0);t.default=class extends s.Group{constructor(){super();const e=new s.MeshStandardMaterial({color:"white",metalness:1});e.transparent=!0;const t=new s.Mesh(this.createLatheGeometry([0,0,.25,.4,.4,10]),e),r=new s.MeshStandardMaterial({color:"#ffcd00",roughness:.8,metalness:.1});r.transparent=!0;const i=new s.Mesh(this.createLatheGeometry([0,10,3.4,10,3.5,10.1,3.5,11,3.45,11.1,2.05,12.5,2,12.6,2,17.4,2.05,17.5,3.45,18.9,3.5,19,3.5,19.9,3.4,20,0,20]),r);t.matrixAutoUpdate=!1,this.add(t),i.matrixAutoUpdate=!1,this.add(i),this.matrixAutoUpdate=!1,this.scale.setScalar(.1),this.updateMatrix()}dispose(){}createLatheGeometry(e){const t=[];for(let r=0,i=e.length;r<i;r+=2)t.push(new s.Vector2(e[r],e[r+1]));return new s.LatheBufferGeometry(t,16)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1),i=r(12);class n extends s.default{constructor(){super(...arguments),this.ins=this.addInputs(n.ins)}get model(){return this.getComponent(i.default)}update(e){return!0}}n.typeName="CVAnnotations",n.ins={},t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=[r(96).default];t.default=s},function(e){e.exports={asset:{type:"application/si-dpo-3d.document+json",version:"1.0",copyright:"(c) Smithsonian Institution, all rights reserved",generator:"Voyager"},scene:0,scenes:[{nodes:[0,1],setup:0}],nodes:[{translation:[0,0,15],camera:0},{name:"Lights",children:[2,3,4,5]},{name:"Key",translation:[-1.5,2,2],light:0},{name:"Fill #1",translation:[3,1,2],light:1},{name:"Fill #2",translation:[1,-2,1],light:3},{name:"Rim",translation:[1,0,-1],light:2}],setups:[{units:"cm",interface:{visible:!0,logo:!0,menu:!0,tools:!0},viewer:{shader:"Default",exposure:1,gamma:1,annotationsVisible:!1},reader:{enabled:!1,position:"Overlay"},navigation:{type:"Orbit",enabled:!0,autoZoom:!0,orbit:{orbit:[-24,-26,0],offset:[0,0,150],minOrbit:[-90,null,null],maxOrbit:[90,null,null],minOffset:[null,null,.1],maxOffset:[null,null,1e4]}},background:{style:"RadialGradient",color0:[.2,.25,.3],color1:[.01,.03,.05]},floor:{visible:!1,position:[0,-25,0],size:50,color:[.6,.75,.8],opacity:.5,receiveShadow:!1},grid:{visible:!1,color:[.5,.7,.8]},tape:{enabled:!1,startPosition:[0,0,0],startDirection:[0,0,0],endPosition:[0,0,0],endDirection:[0,0,0]},slicer:{enabled:!1,axis:"X",inverted:!1,position:.5}}],cameras:[{type:"perspective",perspective:{yfov:52,znear:.1,zfar:1e5}}],lights:[{type:"directional",color:[1,.95,.9],intensity:.9},{type:"directional",color:[.9,.95,1],intensity:.6},{type:"directional",color:[1,1,1],intensity:.8},{type:"directional",color:[.8,.85,1],intensity:.8}]}},function(e,t,r){}]);