!function(e){var t={};function r(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(s,i,function(t){return e[t]}.bind(null,i));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=82)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(10),i=r(61);t.types=i.types;const n=r(136),o=r(87),a=r(137);function l(e){return e?"string"==typeof e?e:e.type:c.type}t.componentTypeName=l;class c extends s.default{constructor(e){super({knownEvents:!1}),this.ins=new n.default(this),this.outs=new n.default(this),this.changed=!0,this.updated=!1,this._node=null,this._name="",this._trackers=[],this._firstAttached=!1,this.id=e}get type(){return this.constructor.type}get text(){return this.constructor.text}get icon(){return this.constructor.icon}get system(){return this._node.system}get graph(){return this._node.graph}get node(){return this._node}get components(){return this._node.components}get hierarchy(){return this._node.components.get("CHierarchy")}get isNodeSingleton(){return this.constructor.isNodeSingleton}get isGraphSingleton(){return this.constructor.isGraphSingleton}get isSystemSingleton(){return this.constructor.isSystemSingleton}get name(){return this._name}get displayName(){return this._name||this.text||this.type}set name(e){this._name=e,this.emit({type:"change",component:this,what:"name"})}attach(e){this._node&&this.detach(),this._node=e,this._firstAttached||(this._firstAttached=!0,this.create()),e._addComponent(this)}create(){}update(e){throw new Error("this should never be called")}tick(e){throw new Error("this should never be called")}finalize(e){throw new Error("this should never be called")}detach(){this._node&&(this._node._removeComponent(this),this._node=null)}dispose(){this.ins.dispose(),this.outs.dispose(),this._trackers.forEach(e=>e.dispose()),this.detach(),this.emit({type:"dispose",component:this})}requestSort(){this.graph.requestSort()}is(e){const t=l(e);let r=this;do{if((r=Object.getPrototypeOf(r)).type===t)return!0}while(r.type!==c.type);return!1}unlinkAllProperties(){this.ins.unlinkAllProperties(),this.outs.unlinkAllProperties()}resetChanged(){this.changed=!1;const e=this.ins.properties;for(let t=0,r=e.length;t<r;++t)e[t].changed=!1}trackComponent(e,t,r){const s=new o.default(this._node.components,e,t,r);return this._trackers.push(s),s}referenceComponent(e){return new a.default(this.system,e)}propagateUp(e){let t=this;for(;t;){if(t.emit(e),e.stopPropagation)return;const r=t.components.getArray();for(let s=0,i=r.length;s<i;++s){const i=r[s];if(i!==t&&(i.emit(e),e.stopPropagation))return}const s=t.components.get("CHierarchy");t=s?s.parent:null}e.stopPropagation||this.system.emit(e)}propagateDown(e){const t=this.components.get("CHierarchy"),r=t?t.children:null;for(let t=0,s=r.length;t<s;++t){const s=r[t].components.getArray();for(let r=0,i=s.length;r<i;++t)if(s[r].emit(e),e.stopPropagation)return;for(let r=0,i=s.length;r<i;++t)if(s[r].propagateDown(e),e.stopPropagation)return}}toString(){return`${this.type}${this.name?" ("+this.name+")":""}`}deflate(){let e={};const t=this.ins.deflate();t&&(e.ins=t);const r=this.outs.deflate();return r&&(e.outs=r),e}inflate(e){e.ins&&this.ins.inflate(e.ins),e.outs&&this.outs.inflate(e.outs)}inflateReferences(e){const t=this.system.components.getDictionary();e.ins&&this.ins.inflateLinks(e.ins,t),e.outs&&this.outs.inflateLinks(e.outs,t)}addInputs(e,t){return this.ins.createPropertiesFromTemplates(e,t)}addOutputs(e,t){return this.outs.createPropertiesFromTemplates(e,t)}}c.type="Component",c.text="",c.icon="",c.isNodeSingleton=!0,c.isGraphSingleton=!1,c.isSystemSingleton=!1,t.default=c,c.prototype.update=null,c.prototype.tick=null,c.prototype.finalize=null},function(e,t,r){"use strict";var s,i=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const n=r(127);var o=r(127);t.property=o.property;var a=r(5);t.html=a.html,t.svg=a.svg,t.render=a.render,t.TemplateResult=a.TemplateResult;var l=r(221);t.repeat=l.repeat;let c=s=class extends n.LitElement{constructor(){super(...arguments),this._isFirstConnected=!1}static setStyle(e,t){Object.assign(e.style,t)}static setAttribs(e,t){for(let r in t)e.setAttribute(r,t[r])}get shady(){return this.constructor.shady}appendTo(e){return e.appendChild(this),this}removeChildren(){for(;this.firstChild;)this.removeChild(this.firstChild)}getChildrenArray(){return Array.from(this.children)}appendElement(e,t){return this.createElement(e,t,this)}createElement(e,t,r){let s;return s="string"==typeof e?document.createElement(e):e instanceof HTMLElement?e:new e,t&&Object.assign(s.style,t),r&&r.appendChild(s),s}setStyle(e){return s.setStyle(this,e),this}setAttribute(e,t){return super.setAttribute(e,t),this}setAttributes(e){return s.setAttribs(this,e),this}addClass(...e){return e.forEach(e=>this.classList.add(e)),this}removeClass(...e){return e.forEach(e=>this.classList.remove(e)),this}setClass(e,t){return t?this.classList.add(e):this.classList.remove(e),this}hasFocus(){return document.activeElement===this}on(e,t,r){return this.addEventListener(e,t,r),this}off(e,t,r){return this.removeEventListener(e,t,r),this}connectedCallback(){this._isFirstConnected||(this._isFirstConnected=!0,this.firstConnected()),this.connected(),super.connectedCallback()}disconnectedCallback(){super.disconnectedCallback(),this.disconnected()}createRenderRoot(){return this.shady?super.createRenderRoot():this}firstConnected(){}connected(){}disconnected(){}};function d(e){return t=>(t.tagName=e,customElements.define(t.tagName,t),t)}c.tagName="ff-custom-element",c.shady=!1,c=s=i([d("ff-custom-element")],c),t.default=c,t.customElement=d},function(e,t){e.exports=THREE},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(135);t.labels={xyzw:["X","Y","Z","W"],rgba:["R","G","B","A"]};const i=function(e){return void 0===e||"object"==typeof e&&!Array.isArray(e)?e:{preset:e}};t.makeType=function(e,t,r){return{path:t,schema:(r=i(r))?Object.assign({},e,r):e}},t.makeEnumType=function(e,t,r){r=i(r);const n={enum:e,options:s.enumToArray(e),preset:0};return{path:t,schema:r?Object.assign({},n,r):n}},t.makeOptionType=function(e,t,r){const s={options:e,preset:0};return{path:t,schema:(r=i(r))?Object.assign({},s,r):s}},t.makeObjectType=function(e,t,r){const s={preset:null,objectType:e};return{path:t,schema:(r=i(r))?Object.assign({},s,r):s}},t.schemas={Number:{preset:0},Integer:{preset:0,step:1,speed:.34,precision:0},Natural:{preset:0,step:1,speed:.34,precision:0,min:0},Vector2:{preset:[0,0]},Vector3:{preset:[0,0,0]},Vector4:{preset:[0,0,0,0]},Matrix2:{preset:[1,0,0,1]},Matrix3:{preset:[1,0,0,0,1,0,0,0,1]},Matrix4:{preset:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},Scale2:{preset:[1,1]},Scale3:{preset:[1,1,1]},IntVec2:{preset:[0,0],step:1,speed:.34,precision:0},IntVec3:{preset:[0,0,0],step:1,speed:.34,precision:0},ColorRGB:{preset:[1,1,1],semantic:"color",labels:t.labels.rgba,min:0,max:1,bar:!0},ColorRGBA:{preset:[1,1,1,1],semantic:"color",labels:t.labels.rgba,min:0,max:1,bar:!0},Boolean:{preset:!1},String:{preset:""},Object:{preset:null,objectType:Object},Event:{preset:0,event:!0}},t.types={Property:(e,r)=>t.makeType(void 0,e,r),Number:(e,r)=>t.makeType(t.schemas.Number,e,r),Integer:(e,r)=>t.makeType(t.schemas.Integer,e,r),Natural:(e,r)=>t.makeType(t.schemas.Natural,e,r),Vector2:(e,r)=>t.makeType(t.schemas.Vector2,e,r),Vector3:(e,r)=>t.makeType(t.schemas.Vector3,e,r),Vector4:(e,r)=>t.makeType(t.schemas.Vector4,e,r),IntVec2:(e,r)=>t.makeType(t.schemas.IntVec2,e,r),IntVec3:(e,r)=>t.makeType(t.schemas.IntVec3,e,r),Matrix2:(e,r)=>t.makeType(t.schemas.Matrix2,e,r),Matrix3:(e,r)=>t.makeType(t.schemas.Matrix3,e,r),Matrix4:(e,r)=>t.makeType(t.schemas.Matrix4,e,r),Scale2:(e,r)=>t.makeType(t.schemas.Scale2,e,r),Scale3:(e,r)=>t.makeType(t.schemas.Scale3,e,r),ColorRGB:(e,r)=>t.makeType(t.schemas.ColorRGB,e,r),ColorRGBA:(e,r)=>t.makeType(t.schemas.ColorRGBA,e,r),Boolean:(e,r)=>t.makeType(t.schemas.Boolean,e,r),String:(e,r)=>t.makeType(t.schemas.String,e,r),Enum:(e,r,s)=>t.makeEnumType(r,e,s),Option:(e,r,s)=>t.makeOptionType(r,e,s),Object:(e,r,s)=>t.makeObjectType(r,e,s),Event:(e,r)=>t.makeType(t.schemas.Event,e,r)}},function(e,t,r){"use strict";r.d(t,"f",function(){return s}),r.d(t,"g",function(){return i}),r.d(t,"b",function(){return o}),r.d(t,"a",function(){return a}),r.d(t,"d",function(){return l}),r.d(t,"c",function(){return c}),r.d(t,"e",function(){return d});
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const s=`{{lit-${String(Math.random()).slice(2)}}}`,i=`\x3c!--${s}--\x3e`,n=new RegExp(`${s}|${i}`),o="$lit$";class a{constructor(e,t){this.parts=[],this.element=t;let r=-1,i=0;const a=[],l=t=>{const u=t.content,h=document.createTreeWalker(u,133,null,!1);let p=0;for(;h.nextNode();){r++;const t=h.currentNode;if(1===t.nodeType){if(t.hasAttributes()){const a=t.attributes;let l=0;for(let e=0;e<a.length;e++)a[e].value.indexOf(s)>=0&&l++;for(;l-- >0;){const s=e.strings[i],a=d.exec(s)[2],l=a.toLowerCase()+o,c=t.getAttribute(l).split(n);this.parts.push({type:"attribute",index:r,name:a,strings:c}),t.removeAttribute(l),i+=c.length-1}}"TEMPLATE"===t.tagName&&l(t)}else if(3===t.nodeType){const e=t.data;if(e.indexOf(s)>=0){const s=t.parentNode,o=e.split(n),l=o.length-1;for(let e=0;e<l;e++)s.insertBefore(""===o[e]?c():document.createTextNode(o[e]),t),this.parts.push({type:"node",index:++r});""===o[l]?(s.insertBefore(c(),t),a.push(t)):t.data=o[l],i+=l}}else if(8===t.nodeType)if(t.data===s){const e=t.parentNode;null!==t.previousSibling&&r!==p||(r++,e.insertBefore(c(),t)),p=r,this.parts.push({type:"node",index:r}),null===t.nextSibling?t.data="":(a.push(t),r--),i++}else{let e=-1;for(;-1!==(e=t.data.indexOf(s,e+1));)this.parts.push({type:"node",index:-1})}}};l(t);for(const e of a)e.parentNode.removeChild(e)}}const l=e=>-1!==e.index,c=()=>document.createComment(""),d=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F \x09\x0a\x0c\x0d"'>=\/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/},function(e,t,r){"use strict";r.r(t);var s=r(6);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class i{handleAttributeExpressions(e,t,r,i){const n=t[0];if("."===n){return new s.f(e,t.slice(1),r).parts}return"@"===n?[new s.d(e,t.slice(1),i.eventContext)]:"?"===n?[new s.c(e,t.slice(1),r)]:new s.a(e,t,r).parts}handleTextExpression(e){return new s.e(e)}}const n=new i;var o=r(15),a=r(17),l=r(8),c=r(7),d=r(18),u=r(16),h=r(35),p=r(4);r.d(t,"html",function(){return f}),r.d(t,"svg",function(){return m}),r.d(t,"DefaultTemplateProcessor",function(){return i}),r.d(t,"defaultTemplateProcessor",function(){return n}),r.d(t,"directive",function(){return a.a}),r.d(t,"isDirective",function(){return a.b}),r.d(t,"removeNodes",function(){return l.b}),r.d(t,"reparentNodes",function(){return l.c}),r.d(t,"noChange",function(){return c.a}),r.d(t,"nothing",function(){return c.b}),r.d(t,"AttributeCommitter",function(){return s.a}),r.d(t,"AttributePart",function(){return s.b}),r.d(t,"BooleanAttributePart",function(){return s.c}),r.d(t,"EventPart",function(){return s.d}),r.d(t,"isPrimitive",function(){return s.h}),r.d(t,"NodePart",function(){return s.e}),r.d(t,"PropertyCommitter",function(){return s.f}),r.d(t,"PropertyPart",function(){return s.g}),r.d(t,"parts",function(){return d.a}),r.d(t,"render",function(){return d.b}),r.d(t,"templateCaches",function(){return u.a}),r.d(t,"templateFactory",function(){return u.b}),r.d(t,"TemplateInstance",function(){return h.a}),r.d(t,"SVGTemplateResult",function(){return o.a}),r.d(t,"TemplateResult",function(){return o.b}),r.d(t,"createMarker",function(){return p.c}),r.d(t,"isTemplatePartActive",function(){return p.d}),r.d(t,"Template",function(){return p.a});
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const f=(e,...t)=>new o.b(e,t,"html",n),m=(e,...t)=>new o.a(e,t,"svg",n)},function(e,t,r){"use strict";r.d(t,"h",function(){return c}),r.d(t,"a",function(){return d}),r.d(t,"b",function(){return u}),r.d(t,"e",function(){return h}),r.d(t,"c",function(){return p}),r.d(t,"f",function(){return f}),r.d(t,"g",function(){return m}),r.d(t,"d",function(){return y});var s=r(17),i=r(8),n=r(7),o=r(35),a=r(15),l=r(4);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const c=e=>null===e||!("object"==typeof e||"function"==typeof e);class d{constructor(e,t,r){this.dirty=!0,this.element=e,this.name=t,this.strings=r,this.parts=[];for(let e=0;e<r.length-1;e++)this.parts[e]=this._createPart()}_createPart(){return new u(this)}_getValue(){const e=this.strings,t=e.length-1;let r="";for(let s=0;s<t;s++){r+=e[s];const t=this.parts[s];if(void 0!==t){const e=t.value;if(null!=e&&(Array.isArray(e)||"string"!=typeof e&&e[Symbol.iterator]))for(const t of e)r+="string"==typeof t?t:String(t);else r+="string"==typeof e?e:String(e)}}return r+=e[t]}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class u{constructor(e){this.value=void 0,this.committer=e}setValue(e){e===n.a||c(e)&&e===this.value||(this.value=e,Object(s.b)(e)||(this.committer.dirty=!0))}commit(){for(;Object(s.b)(this.value);){const e=this.value;this.value=n.a,e(this)}this.value!==n.a&&this.committer.commit()}}class h{constructor(e){this.value=void 0,this._pendingValue=void 0,this.options=e}appendInto(e){this.startNode=e.appendChild(Object(l.c)()),this.endNode=e.appendChild(Object(l.c)())}insertAfterNode(e){this.startNode=e,this.endNode=e.nextSibling}appendIntoPart(e){e._insert(this.startNode=Object(l.c)()),e._insert(this.endNode=Object(l.c)())}insertAfterPart(e){e._insert(this.startNode=Object(l.c)()),this.endNode=e.endNode,e.endNode=this.startNode}setValue(e){this._pendingValue=e}commit(){for(;Object(s.b)(this._pendingValue);){const e=this._pendingValue;this._pendingValue=n.a,e(this)}const e=this._pendingValue;e!==n.a&&(c(e)?e!==this.value&&this._commitText(e):e instanceof a.b?this._commitTemplateResult(e):e instanceof Node?this._commitNode(e):Array.isArray(e)||e[Symbol.iterator]?this._commitIterable(e):e===n.b?(this.value=n.b,this.clear()):this._commitText(e))}_insert(e){this.endNode.parentNode.insertBefore(e,this.endNode)}_commitNode(e){this.value!==e&&(this.clear(),this._insert(e),this.value=e)}_commitText(e){const t=this.startNode.nextSibling;e=null==e?"":e,t===this.endNode.previousSibling&&3===t.nodeType?t.data=e:this._commitNode(document.createTextNode("string"==typeof e?e:String(e))),this.value=e}_commitTemplateResult(e){const t=this.options.templateFactory(e);if(this.value&&this.value.template===t)this.value.update(e.values);else{const r=new o.a(t,e.processor,this.options),s=r._clone();r.update(e.values),this._commitNode(s),this.value=r}}_commitIterable(e){Array.isArray(this.value)||(this.value=[],this.clear());const t=this.value;let r,s=0;for(const i of e)void 0===(r=t[s])&&(r=new h(this.options),t.push(r),0===s?r.appendIntoPart(this):r.insertAfterPart(t[s-1])),r.setValue(i),r.commit(),s++;s<t.length&&(t.length=s,this.clear(r&&r.endNode))}clear(e=this.startNode){Object(i.b)(this.startNode.parentNode,e.nextSibling,this.endNode)}}class p{constructor(e,t,r){if(this.value=void 0,this._pendingValue=void 0,2!==r.length||""!==r[0]||""!==r[1])throw new Error("Boolean attributes can only contain a single expression");this.element=e,this.name=t,this.strings=r}setValue(e){this._pendingValue=e}commit(){for(;Object(s.b)(this._pendingValue);){const e=this._pendingValue;this._pendingValue=n.a,e(this)}if(this._pendingValue===n.a)return;const e=!!this._pendingValue;this.value!==e&&(e?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name)),this.value=e,this._pendingValue=n.a}}class f extends d{constructor(e,t,r){super(e,t,r),this.single=2===r.length&&""===r[0]&&""===r[1]}_createPart(){return new m(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class m extends u{}let v=!1;try{const e={get capture(){return v=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}class y{constructor(e,t,r){this.value=void 0,this._pendingValue=void 0,this.element=e,this.eventName=t,this.eventContext=r,this._boundHandleEvent=(e=>this.handleEvent(e))}setValue(e){this._pendingValue=e}commit(){for(;Object(s.b)(this._pendingValue);){const e=this._pendingValue;this._pendingValue=n.a,e(this)}if(this._pendingValue===n.a)return;const e=this._pendingValue,t=this.value,r=null==e||null!=t&&(e.capture!==t.capture||e.once!==t.once||e.passive!==t.passive),i=null!=e&&(null==t||r);r&&this.element.removeEventListener(this.eventName,this._boundHandleEvent,this._options),i&&(this._options=g(e),this.element.addEventListener(this.eventName,this._boundHandleEvent,this._options)),this.value=e,this._pendingValue=n.a}handleEvent(e){"function"==typeof this.value?this.value.call(this.eventContext||this.element,e):this.value.handleEvent(e)}}const g=e=>e&&(v?{capture:e.capture,passive:e.passive,once:e.once}:e.capture)},function(e,t,r){"use strict";r.d(t,"a",function(){return s}),r.d(t,"b",function(){return i});
/**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const s={},i={}},function(e,t,r){"use strict";r.d(t,"a",function(){return s}),r.d(t,"c",function(){return i}),r.d(t,"b",function(){return n});
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const s=void 0!==window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,i=(e,t,r=null,s=null)=>{let i=t;for(;i!==r;){const t=i.nextSibling;e.insertBefore(i,s),i=t}},n=(e,t,r=null)=>{let s=t;for(;s!==r;){const t=s.nextSibling;e.removeChild(s),s=t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";t.default=function(e,t){let r;e&&"number"==typeof e||(e=12);do{r="";for(let t=0;t<e;++t)r+=s[62*Math.random()|0]}while(t&&t[r]);return r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=Symbol("Publisher private data"),i=Symbol("Publisher strict option");t.default=class{constructor(e){const t=!e||e.knownEvents;this[s]={[i]:t}}on(e,t,r){if(Array.isArray(e))return void e.forEach(e=>{this.on(e,t,r)});if(!t)throw new Error("missing callback function");let n=this[s][e];if(!n){if(this[s][i])throw new Error(`can't subscribe; unknown event: '${e}'`);n=this[s][e]=[]}let o={callback:t,context:r};n.push(o)}addEventListener(e,t,r){this.on(e,t,r)}once(e,t,r){if(Array.isArray(e))return void e.forEach(e=>{this.once(e,t,r)});const s=i=>{this.off(e,s,r),t.call(r,i)};s.cb=t,this.on(e,s,r)}off(e,t,r){if("object"==typeof e){if(Array.isArray(e))e.forEach(e=>{this.off(e,t,r)});else{const t=this[s];for(let r=0,s=Object.keys(t).length;r<s;++r){const r=t[e],s=[];for(let t=0,i=r.length;t<i;++t){const i=r[t];e&&i.context!==e&&s.push(i)}t[e]=s}}return}const i=this[s][e];if(!i)throw new Error(`can't unsubscribe; unknown event type: '${e}'`);const n=[];for(let e=0,s=i.length;e<s;++e){const s=i[e];(t&&t!==s.callback&&t!==s.callback.cb||r&&r!==s.context)&&n.push(s)}this[s][e]=n}removeEventListener(e,t,r){this.off(e,t,r)}emit(e,t){let r,n;if("string"==typeof e?(r=e,n=t):(r=e.type,n=e),!r)throw new Error(`empty or invalid event type: '${r}'`);const o=this[s],a=o[r];if(a)for(let e=0,t=a.length;e<t;++e){const t=a[e];t.context?t.callback.call(t.context,n):t.callback(n)}else if(o[i])throw new Error(`can't emit; unknown event type: '${r}'`)}addEvent(e){this[s][e]||(this[s][e]=[])}addEvents(...e){e.forEach(e=>{this[s][e]||(this[s][e]=[])})}hasEvent(e){return!!this[s][e]}listEvents(){return Object.getOwnPropertyNames(this[s])}}},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0}),r(42);const i=r(1);let n=class extends i.default{constructor(){super(),this.name="",this.index=0,this.selectedIndex=-1,this.selected=!1,this.selectable=!1,this.disabled=!1,this.icon="",this.caret=!1,this.inline=!1,this.addEventListener("click",e=>this.onClick(e)),this.addEventListener("keydown",e=>this.onKeyDown(e))}firstConnected(){this.inline?this.classList.add("ff-inline","ff-button"):this.classList.add("ff-control","ff-button"),this.tabIndex=0}shouldUpdate(e){return(e.has("selectedIndex")||e.has("index"))&&this.selectedIndex>=0&&(this.selected=this.index===this.selectedIndex),e.has("disabled")&&this.setClass("ff-disabled",this.disabled),!0}render(){return i.html`${this.renderIcon()}${this.renderText()}${this.renderCaret()}`}renderIcon(){return this.icon?i.html`<ff-icon class="ff-off" name=${this.icon}></ff-icon>`:null}renderText(){return this.text?i.html`<div class="ff-text ff-off">${this.text}</div>`:null}renderCaret(){return this.caret?i.html`<div class="ff-caret-down ff-off"></div>`:null}onClick(e){this.selectable&&(this.selected=!this.selected)}onKeyDown(e){document.activeElement!==this||"Space"!==e.code&&"Enter"!==e.code||this.dispatchEvent(new MouseEvent("click",{bubbles:!0}))}};s([i.property({type:String})],n.prototype,"name",void 0),s([i.property({type:Number})],n.prototype,"index",void 0),s([i.property({type:Number})],n.prototype,"selectedIndex",void 0),s([i.property({type:Boolean,reflect:!0})],n.prototype,"selected",void 0),s([i.property({type:Boolean})],n.prototype,"selectable",void 0),s([i.property({type:Boolean})],n.prototype,"disabled",void 0),s([i.property()],n.prototype,"text",void 0),s([i.property()],n.prototype,"icon",void 0),s([i.property({type:Boolean})],n.prototype,"caret",void 0),s([i.property({type:Boolean})],n.prototype,"inline",void 0),n=s([i.customElement("ff-button")],n),t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(3),i=r(0),n=r(47),o=r(19),a=r(62),l=r(48),c=r(36),d={selNodeCount:s.types.Integer("Selection.Nodes"),selComponentCount:s.types.Integer("Selection.Components")};class u extends c.default{constructor(e){super(e),this.outs=this.addOutputs(d),this.multiSelect=!1,this.exclusiveSelect=!0,this.selectedNodes=new a.default,this.selectedComponents=new n.default,this._activeGraph=null,this.addEvents("select-node","select-component","active-graph","update"),this.selectedNodes.on(o.default,e=>this.onSelectNode(e.node,e.add)),this.selectedComponents.on(i.default,e=>this.onSelectComponent(e.component,e.add))}get activeGraph(){return this._activeGraph}set activeGraph(e){if(e!==this.activeGraph){this.clearSelection();const t=this._activeGraph;this._activeGraph=e,this.onActiveGraph(e),this.emit({type:"active-graph",previous:t,next:e})}}hasParentGraph(){return this._activeGraph&&this._activeGraph.parent}activateParentGraph(){this._activeGraph&&this._activeGraph.parent.graph&&(this.activeGraph=this._activeGraph.parent.graph)}hasChildGraph(){return this.selectedComponents.has(l.default)}activateChildGraph(){const e=this.selectedComponents.get(l.default);e&&(this.activeGraph=e.innerGraph)}create(){super.create(),this._activeGraph=this.system.graph,this.system.nodes.on(o.default,this.onSystemNode,this),this.system.components.on(i.default,this.onSystemComponent,this)}dispose(){this.system.nodes.off(o.default,this.onSystemNode,this),this.system.components.off(i.default,this.onSystemComponent,this),super.dispose()}createActions(e){return{selectNode:e.register({name:"Select Node",do:this.selectNode,target:this}),selectComponent:e.register({name:"Select Component",do:this.selectComponent,target:this}),clearSelection:e.register({name:"Clear Selection",do:this.clearSelection,target:this})}}nodeContainsSelectedComponent(e){const t=e.components.getArray();for(let e=0,r=t.length;e<r;++e)if(this.selectedComponents.contains(t[e]))return!0;return!1}selectNode(e,t=!1){this.activeGraph=e.graph;const r=this.selectedNodes,s=this.multiSelect&&t;e&&r.contains(e)?s&&r._remove(e):(this.exclusiveSelect&&this.selectedComponents._clear(),s||r._clear(),e&&r._add(e)),this.updateStats()}selectComponent(e,t=!1){this.activeGraph=e.graph;const r=this.selectedComponents,s=this.multiSelect&&t;e&&r.contains(e)?s&&r._remove(e):(this.exclusiveSelect&&this.selectedNodes._clear(),s||r._clear(),e&&r._add(e)),this.updateStats()}clearSelection(){this.selectedNodes._clear(),this.selectedComponents._clear(),this.updateStats()}onSelectNode(e,t){}onSelectComponent(e,t){}onActiveGraph(e){}onSystemNode(e){e.remove&&this.selectedNodes.contains(e.node)&&this.selectedNodes._remove(e.node)}onSystemComponent(e){e.remove&&this.selectedComponents.contains(e.component)&&this.selectedComponents._remove(e.component)}updateStats(){const e=this.outs;e.selNodeCount.setValue(this.selectedNodes.length),e.selComponentCount.setValue(this.selectedComponents.length)}}u.type="CSelection",t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(64);class n extends s.default{constructor(e){super(e),this.views=[],this._activeSceneComponent=null,this.addEvents("active-scene","active-camera")}get activeSceneComponent(){return this._activeSceneComponent}set activeSceneComponent(e){if(e!==this._activeSceneComponent){const t=this._activeSceneComponent,r=this.activeCameraComponent;t&&t.off("active-camera",this.onActiveCamera,this),e&&e.on("active-camera",this.onActiveCamera,this),this._activeSceneComponent=e;const s=this.activeCameraComponent,i={type:"active-scene",previous:t,next:e};this.emit(i);const n={type:"active-camera",previous:r,next:s};this.emit(n)}}get activeSceneGraph(){return this._activeSceneComponent?this._activeSceneComponent.graph:null}get activeScene(){return this._activeSceneComponent?this._activeSceneComponent.scene:null}get activeCameraComponent(){return this._activeSceneComponent?this._activeSceneComponent.activeCameraComponent:null}get activeCamera(){const e=this._activeSceneComponent?this._activeSceneComponent.activeCameraComponent:null;return e?e.camera:null}create(){this.trackComponent(i.default,e=>{e.on("pulse",this.onPulse,this)},e=>{e.off("pulse",this.onPulse,this)})}attachView(e){this.views.push(e)}detachView(e){const t=this.views.indexOf(e);if(t<0)throw new Error("render view not registered");this.views.splice(t,1)}onPulse(){this.views.forEach(e=>{e.render()})}onActiveCamera(e){this.emit(e)}}n.type="CRenderer",n.isSystemSingleton=!0,t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(28),n={view:null,viewport:null,renderer:null,scene:null,camera:null,geometry:null,material:null,group:null},o=function(e){e.material&&(e.onBeforeRender=function(t,r,s,i,n){n.isIndexShader&&n.setIndex(e.id)})},a=function(e){e.material&&(e.onBeforeRender=null)};class l extends s.default{constructor(e){super(e),this._object3D=null,this.addEvent("object")}get transform(){return this.node.components.get(i.default)}get object3D(){return this._object3D}set object3D(e){const t=this.transform,r=this._object3D;r&&(e.userData.component=null,r.onBeforeRender=null,r.onAfterRender=null,this.unregisterPickableObject3D(r,!0),t&&t.removeObject3D(r)),this.emit({type:"object",current:r,next:e}),this._object3D=e,e&&(e.userData.component=this,e.matrixAutoUpdate=!1,e.onBeforeRender=this._onBeforeRender.bind(this),this.afterRender&&(e.onAfterRender=this._onAfterRender.bind(this)),this.registerPickableObject3D(e,!0),t&&t.addObject3D(e))}create(){this.trackComponent(i.default,e=>{this._object3D&&e.addObject3D(this._object3D)},e=>{this._object3D&&e.removeObject3D(this._object3D)})}dispose(){if(this._object3D){const e=this.transform;e&&e.removeObject3D(this._object3D)}super.dispose()}beforeRender(e){}afterRender(e){}addObject3D(e){this._object3D.add(e),this.registerPickableObject3D(e,!0)}removeObject3D(e){this._object3D.remove(e),this.unregisterPickableObject3D(e,!0)}registerPickableObject3D(e,t=!1){t&&e===this._object3D?e.children.forEach(e=>e.traverse(e=>o(e))):t?e.traverse(e=>o(e)):e!==this._object3D&&o(e)}unregisterPickableObject3D(e,t=!1){t&&e===this._object3D?e.children.forEach(e=>e.traverse(e=>a(e))):t?e.traverse(e=>a(e)):e!==this._object3D&&a(e)}toString(){return super.toString()+(this._object3D?` - type: ${this._object3D.type}`:" - (null)")}_onBeforeRender(e,t,r,s,i,o){i.isIndexShader&&i.setIndex(this.object3D.id),this.beforeRender&&(n.view=e.__view,n.viewport=e.__viewport,n.renderer=e,n.scene=t,n.camera=r,n.geometry=s,n.material=i,n.group=o,this.beforeRender(n))}_onAfterRender(e,t,r,s,i,o){n.view=e.__view,n.viewport=e.__viewport,n.renderer=e,n.scene=t,n.camera=r,n.geometry=s,n.material=i,n.group=o,this.afterRender(n)}}l.type="CObject3D",t.default=l,l.prototype.beforeRender=null,l.prototype.afterRender=null},function(e,t,r){"use strict";r.d(t,"b",function(){return n}),r.d(t,"a",function(){return o});var s=r(8),i=r(4);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class n{constructor(e,t,r,s){this.strings=e,this.values=t,this.type=r,this.processor=s}getHTML(){const e=this.strings.length-1;let t="";for(let r=0;r<e;r++){const e=this.strings[r],s=i.e.exec(e);t+=s?e.substr(0,s.index)+s[1]+s[2]+i.b+s[3]+i.f:e+i.g}return t+this.strings[e]}getTemplateElement(){const e=document.createElement("template");return e.innerHTML=this.getHTML(),e}}class o extends n{getHTML(){return`<svg>${super.getHTML()}</svg>`}getTemplateElement(){const e=super.getTemplateElement(),t=e.content,r=t.firstChild;return t.removeChild(r),Object(s.c)(t,r.firstChild),e}}},function(e,t,r){"use strict";r.d(t,"b",function(){return i}),r.d(t,"a",function(){return n});var s=r(4);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function i(e){let t=n.get(e.type);void 0===t&&(t={stringsArray:new WeakMap,keyString:new Map},n.set(e.type,t));let r=t.stringsArray.get(e.strings);if(void 0!==r)return r;const i=e.strings.join(s.f);return void 0===(r=t.keyString.get(i))&&(r=new s.a(e,e.getTemplateElement()),t.keyString.set(i,r)),t.stringsArray.set(e.strings,r),r}const n=new Map},function(e,t,r){"use strict";r.d(t,"a",function(){return i}),r.d(t,"b",function(){return n});
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const s=new WeakMap,i=e=>(...t)=>{const r=e(...t);return s.set(r,!0),r},n=e=>"function"==typeof e&&s.has(e)},function(e,t,r){"use strict";r.d(t,"a",function(){return o}),r.d(t,"b",function(){return a});var s=r(8),i=r(6),n=r(16);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const o=new WeakMap,a=(e,t,r)=>{let a=o.get(t);void 0===a&&(Object(s.b)(t,t.firstChild),o.set(t,a=new i.e(Object.assign({templateFactory:n.b},r))),a.appendInto(t)),a.setValue(e),a.commit()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(9),i=r(10),n=r(0),o=r(47);function a(e){return e?"string"==typeof e?e:e.type:l.type}t.nodeTypeName=a;class l extends i.default{constructor(e){super({knownEvents:!1}),this.components=new o.default,this._graph=null,this._name="",this.id=e}get type(){return this.constructor.type}get text(){return this.constructor.text}get icon(){return this.constructor.icon}get system(){return this._graph.system}get graph(){return this._graph}get name(){return this._name}get displayName(){return this._name||this.text||this.type}set name(e){this._name=e,this.emit({type:"change",what:"name",node:this})}attach(e){this._graph&&this.detach(),this._graph=e,e._addNode(this)}detach(){this._graph&&(this._graph._removeNode(this),this._graph=null)}createComponents(){}clear(){this.components.getArray().slice().forEach(e=>e.dispose())}dispose(){this.components.getArray().slice().forEach(e=>e.dispose()),this.detach(),this.emit({type:"dispose",node:this})}createComponent(e,t,r){const i=new(this.system.registry.getComponentType(n.componentTypeName(e)))(r||s.default(12,this.system.components.getDictionary()));return i.attach(this),t&&(i.name=t),i}is(e){const t=a(e);let r=this;do{if((r=Object.getPrototypeOf(r)).type===t)return!0}while(r.type!==l.type);return!1}toString(e=!1){const t=this.components.getArray(),r=`Node '${this.name}' - ${t.length} components`;return e?r+"\n"+t.map(e=>"  "+e.toString()).join("\n"):r}deflate(){const e={},t=[],r=this.components.getArray();for(let e=0,s=r.length;e<s;++e){const s=r[e],i=this.deflateComponent(s);i.type=s.type,i.id=s.id,s.name&&(i.name=s.name),t.push(i)}return t.length>0&&(e.components=t),e}inflate(e,t){e.components&&e.forEach(e=>{this.createComponent(e.type,e.name,e.id).inflate(e)})}inflateReferences(e){e.components&&e.components.forEach(e=>{this.components.getById(e.id).inflateReferences(e)})}deflateComponent(e){return e.deflate()}_addComponent(e){if(e.isNodeSingleton&&this.components.has(e))throw new Error(`only one component of type '${e.type}' allowed per node`);this.graph._addComponent(e),this.components._add(e)}_removeComponent(e){this.components._remove(e),this.graph._removeComponent(e)}}l.type="Node",l.text="",l.icon="",t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s={PI:3.141592653589793,DOUBLE_PI:6.283185307179586,HALF_PI:1.5707963267948966,QUARTER_PI:.7853981633974483,DEG2RAD:.017453292519943295,RAD2DEG:57.29577951308232,limit:(e,t,r)=>e<t?t:e>r?r:e,limitInt:function(e,t,r){return(e=Math.trunc(e))<t?t:e>r?r:e},normalize:(e,t,r)=>(e-t)/(r-t),normalizeLimit:(e,t,r)=>(e=(e-t)/(r-t))<0?0:e>1?1:e,denormalize:(e,t,r)=>(t+e)*(r-t),scale:(e,t,r,s,i)=>s+(e-t)/(r-t)*(i-s),scaleLimit:(e,t,r,s,i)=>s+((e=e<t?t:e>r?r:e)-t)/(r-t)*(i-s),deg2rad:function(e){return.017453292519943295*e},rad2deg:function(e){return 57.29577951308232*e},deltaRadians:function(e,t){return e=(e%=s.DOUBLE_PI)<0?e+s.DOUBLE_PI:e,(t=(t%=s.DOUBLE_PI)<0?t+s.DOUBLE_PI:t)-e>s.PI&&(e+=s.DOUBLE_PI),t-e},deltaDegrees:function(e,t){return e=(e%=s.DOUBLE_PI)<0?e+s.DOUBLE_PI:e,(t=(t%=s.DOUBLE_PI)<0?t+s.DOUBLE_PI:t)-e>s.PI&&(e+=s.DOUBLE_PI),t-e},curves:{linear:e=>e,easeIn:e=>Math.sin(e*s.HALF_PI),easeOut:e=>Math.cos(e*s.HALF_PI-s.PI)+1,ease:e=>.5*Math.cos(e*s.PI-s.PI)+.5,easeInQuad:e=>e*e,easeOutQuad:e=>e*(2-e),easeQuad:e=>e<.5?2*e*e:(4-2*e)*e-1,easeInCubic:e=>e*e*e,easeOutCubic:e=>--e*e*e+1,easeCubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1- --e*e*e*e,easeQuart:e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e}};t.default=s},function(e,t,r){"use strict";function s(e){return"/"===e.charAt(0)}function i(e,t){for(var r=t,s=r+1,i=e.length;s<i;r+=1,s+=1)e[r]=e[s];e.pop()}r.r(t),t.default=function(e,t){void 0===t&&(t="");var r,n=e&&e.split("/")||[],o=t&&t.split("/")||[],a=e&&s(e),l=t&&s(t),c=a||l;if(e&&s(e)?o=n:n.length&&(o.pop(),o=o.concat(n)),!o.length)return"/";if(o.length){var d=o[o.length-1];r="."===d||".."===d||""===d}else r=!1;for(var u=0,h=o.length;h>=0;h--){var p=o[h];"."===p?i(o,h):".."===p?(i(o,h),u++):u&&(i(o,h),u--)}if(!c)for(;u--;u)o.unshift("..");!c||""===o[0]||o[0]&&s(o[0])||o.unshift("");var f=o.join("/");return r&&"/"!==f.substr(-1)&&(f+="/"),f}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(21),i=r(36),n=r(12),o=r(13),a=r(197),l=r(51),c=r(38),d=r(27),u=r(76),h=function(e){const t=s.default(".",e);return{path:t,name:"/"===t&&"/"!==e[0]?e:e.substr(t.length)}};class p extends i.default{constructor(e){super(e),this._activePresentation=null,this._activeItem=null,this.addEvent("presentation")}get activePresentation(){return this._activePresentation}set activePresentation(e){if(e!==this._activePresentation){const t=this._activePresentation;this._activePresentation=e,this.activeItem=null,t&&t.innerGraph.nodes.off(d.default,this.onItem,this),e&&e.innerGraph.nodes.on(d.default,this.onItem,this),this.renderer.activeSceneComponent=e?e.scene:null,this.emit({type:"active-presentation",previous:t,next:e})}}get presentations(){return this.node.components.getArray(u.default)}get presentationCount(){return this.node.components.getArray(u.default).length}get activeItem(){return this._activeItem}set activeItem(e){e!==this._activeItem&&e&&e.graph.parent!==this._activePresentation&&(this.activePresentation=e.graph.parent);const t=this._activeItem;this._activeItem=e,this.emit({type:"active-item",previous:t,next:this._activeItem})}get items(){return this._activePresentation?this._activePresentation.innerGraph.nodes.getArray(d.default):[]}get selection(){return this.system.components.safeGet(n.default)}get renderer(){return this.system.components.safeGet(o.default)}get loaders(){return this.system.components.safeGet(c.default)}createActions(e){return{}}create(){super.create(),this.node.components.on(u.default,this.onPresentation,this),this.selection.selectedComponents.on(u.default,this.onSelectPresentation,this)}dispose(){this.node.components.off(u.default,this.onPresentation,this),this.selection.selectedComponents.off(u.default,this.onSelectPresentation,this),super.dispose()}loadItem(e,t,r){return console.log("CExplorer.loadItem - URL: %s",e),this.loaders.loadJSON(e).then(i=>{const n=s.default(".",e);return this.openItem(i,e,t,n,r)})}openItem(e,t,r,i,n){const o=r?r.substr(s.default(".",r).length):"";return this.loaders.validateItem(e).then(e=>{const a=(r,s,i)=>{if(0===r){const r=s.createCustomNode(d.default);return r.item.setUrl(t,i,n),r.item.fromData(e),r}return null},l=e.meta.presentationTemplateUri;return l?(r=s.default(o,l,r||i),console.log(`Loading presentation template: ${r}`),this.loadPresentation(r,a,n)):this.openDefaultPresentation(a,i,n)})}loadModel(e,t,r,i){const n=l.EDerivativeQuality[t]||l.EDerivativeQuality.Medium,{path:o,name:a}=h(e),c=s.default(i?i+"-item.json":"item.json",o);return Promise.resolve().then(()=>(console.log(`CExplorer.loadModel - Creating new 3D item with a web derivative, quality: ${l.EDerivativeQuality[n]}`,`\nmodel url: ${e}`,`\nitem url: ${c}`),this.openDefaultPresentation((e,t,r)=>{if(0===e){const e=t.createCustomNode(d.default);return e.item.setUrl(c,o,i),e.model.derivatives.createModelAsset(a,n),e}return null},o,i)))}loadGeometryAndTexture(e,t,r,i,n){const o=l.EDerivativeQuality[r]||l.EDerivativeQuality.Medium,{path:a,name:c}=h(e),u=t?h(t).name:"",p=s.default(n?n+"-item.json":"item.json",a);return Promise.resolve().then(()=>(console.log(`CExplorer.loadGeometryAndTexture - Creating a new 3D item with a web derivative of quality: ${l.EDerivativeQuality[r]}`,`\ngeometry url: ${e}`,`\ntexture url: ${u?a+u:"(none)"}`,`\nitem url: ${p}`),this.openDefaultPresentation((e,t,r)=>{if(0===e){const e=t.createCustomNode(d.default);return e.item.setUrl(p,a,n),e.model.derivatives.createMeshAsset(c,u,o),e}return null},a,n)))}loadPresentation(e,t,r){console.log("CExplorer.loadPresentation - URL: %s",e);s.default(".",e);return this.loaders.loadJSON(e).then(i=>{const n=s.default(".",e);this.openPresentation(i,e,t,n,r)})}openDefaultPresentation(e,t,r){console.log("CExplorer.openDefaultPresentation - Opening presentation from default template");const s=t+"template.json";return this.openPresentation(a,s,e,t,r)}openPresentation(e,t,r,s,i){return this.closeAll(),this.loaders.validatePresentation(e).then(e=>{const n=this.node.createComponent(u.default);n.setUrl(t,s,i),n.fromData(e,r)})}closeAll(){this.node.components.cloneArray(u.default).forEach(e=>e.dispose())}onPresentation(e){this.emit({type:"presentation",add:e.add,remove:e.remove,presentation:e.component}),e.add&&(this.activePresentation=e.component)}onSelectPresentation(e){e.add&&(this.activePresentation=e.component)}onItem(e){this.emit({type:"item",add:e.add,remove:e.remove,item:e.node}),e.add&&(this.activeItem=e.node)}}p.type="CVPresentationController",p.isSystemSingleton=!0,t.default=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(97),i=r(28);class n extends s.default{get transform(){return this.components.get(i.default)}createComponents(){this.createComponent(i.default)}}n.type="NTransform",t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(3),n=r(13),o=r(28),a={view:null,viewport:null,renderer:null,scene:null,camera:null},l={type:"before-render",component:null,context:a},c={type:"after-render",component:null,context:a},d={activate:i.types.Event("Activate")};class u extends o.default{constructor(e){super(e),this._activeCameraComponent=null,this.ins=this.addInputs(d,0),this.addEvents("before-render","after-render","active-camera")}get scene(){return this.object3D}get activeCameraComponent(){return this._activeCameraComponent}set activeCameraComponent(e){if(e!==this._activeCameraComponent){const t=this._activeCameraComponent;this._activeCameraComponent=e;const r={type:"active-camera",previous:t,next:e};this.emit(r),this.renderer&&this.renderer.emit(r)}}get activeCamera(){return this._activeCameraComponent?this._activeCameraComponent.camera:null}get renderer(){return this.system.graph.components.get(n.default)}create(){super.create();const e=this.renderer;e&&!e.activeSceneComponent&&(e.activeSceneComponent=this)}update(e){const t=super.update(e);if(this.ins.activate.changed){const e=this.renderer;e&&(e.activeSceneComponent=this)}return t}dispose(){const e=this.renderer;e&&e.activeSceneComponent===this&&(e.activeSceneComponent=null),super.dispose()}beforeRender(e){}afterRender(e){}createObject3D(){const e=new s.Scene;return e.onBeforeRender=this._onBeforeRender.bind(this),e.onAfterRender=this._onAfterRender.bind(this),e}_onBeforeRender(e,t,r){a.view=e.__view,a.viewport=e.__viewport,a.renderer=e,a.scene=t,a.camera=r,this.beforeRender&&this.beforeRender(a),l.component=this,this.emit(l)}_onAfterRender(e,t,r){a.view=e.__view,a.viewport=e.__viewport,a.renderer=e,a.scene=t,a.camera=r,this.afterRender&&this.afterRender(a),c.component=this,this.emit(c)}}u.type="CScene",u.isGraphSingleton=!0,t.default=u,u.prototype.beforeRender=null,u.prototype.afterRender=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(3),n=r(24),o=r(39);t.EShaderMode=o.EShaderMode,t.EUnitType=o.EUnitType;const a=r(26),l=r(40),c={units:i.types.Enum("Scene.Units",o.EUnitType,o.EUnitType.cm),shader:i.types.Enum("Renderer.Shader",o.EShaderMode),exposure:i.types.Number("Renderer.Exposure",1),gamma:i.types.Number("Renderer.Gamma",1),zoomExtents:i.types.Event("ZoomExtents")};class d extends n.default{constructor(){super(...arguments),this.ins=this.addInputs(c),this.boundingBox=new s.Box3,this._zoomViews=!1}create(){this.scene.background=(new s.TextureLoader).load("images/bg-gradient-blue.jpg"),this.graph.components.on(a.default,this.onModelComponent,this)}update(e){super.update(e);const t=this.ins;if(t.units.changed&&this.updateModels(),t.shader.changed){const e=t.shader.getValidatedValue();this.graph.components.getArray(a.default).forEach(t=>t.setShaderMode(e))}if(t.zoomExtents.changed){this._zoomViews=!0;const e=this.system.components.get(l.default);e&&e.ins.zoomExtents.set()}return!0}beforeRender(e){this.updated&&(e.renderer.toneMappingExposure=this.ins.exposure.value),this._zoomViews&&e.viewport.moveCameraToView(this.boundingBox)}finalize(){this._zoomViews=!1}fromData(e){this.ins.copyValues({units:o.EUnitType[e.units]||o.EUnitType.mm,shader:o.EShaderMode[e.shader]||o.EShaderMode.Default,exposure:void 0!==e.exposure?e.exposure:1,gamma:void 0!==e.gamma?e.gamma:1})}toData(){const e=this.ins;return{units:o.EUnitType[e.units.value],shader:o.EShaderMode[e.shader.value],exposure:e.exposure.value,gamma:e.gamma.value}}onModelComponent(e){e.add?(e.component.setGlobalUnits(this.ins.units.value),e.component.on("change",this.updateModels,this)):e.remove&&e.component.off("change",this.updateModels,this)}updateModels(){const e=this.boundingBox.makeEmpty(),t=this.transform.getChildren(a.default,!0),r=this.ins.units.getValidatedValue();t.forEach(t=>{t.setGlobalUnits(r),e.expandByObject(t.object3D)}),this.emit({type:"change",what:"boundingBox",component:this})}}d.type="CVScene",t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(66),n=r(3),o=r(14),a=r(95),l=r(70);t.EShaderMode=l.EShaderMode;const c=r(51),d=r(196),u=r(38),h=new s.Vector3,p=new s.Vector3,f=new s.Quaternion,m=new s.Box3,v={mm:{mm:1,cm:.1,m:.001,in:.0393701,ft:.00328084,yd:.00109361},cm:{mm:10,cm:1,m:.01,in:.393701,ft:.0328084,yd:.0109361},m:{mm:1e3,cm:100,m:1,in:39.3701,ft:3.28084,yd:1.09361},in:{mm:25.4,cm:2.54,m:.0254,in:1,ft:.0833333,yd:.0277778},ft:{mm:304.8,cm:30.48,m:.3048,in:12,ft:1,yd:.333334},yd:{mm:914.4,cm:91.44,m:.9144,in:36,ft:3,yd:1}},y={visible:n.types.Boolean("Visible",!0),units:n.types.Enum("Units",a.EUnitType,a.EUnitType.cm),quality:n.types.Enum("Quality",c.EDerivativeQuality,c.EDerivativeQuality.High),autoLoad:n.types.Boolean("Auto.Load",!0),position:n.types.Vector3("Pose.Position"),rotation:n.types.Vector3("Pose.Rotation"),center:n.types.Event("Pose.Center"),dumpDerivatives:n.types.Event("Derivatives.Dump")},g={globalUnits:n.types.Enum("GlobalUnits",a.EUnitType,a.EUnitType.cm),unitScale:n.types.Number("UnitScale",{preset:1,precision:5})};class b extends o.default{constructor(){super(...arguments),this.ins=this.addInputs(y),this.outs=this.addOutputs(g),this.assetPath="",this.assetBaseName="",this._derivatives=new d.default,this._activeDerivative=null,this._boundingBox=new s.Box3,this._boxFrame=null}get derivatives(){return this._derivatives}get boundingBox(){return this._boundingBox}get activeDerivative(){return this._activeDerivative}create(){super.create(),this.object3D=new s.Group}update(){const e=this.ins;if(!this.activeDerivative&&e.autoLoad.changed&&e.autoLoad.value)this.autoLoad(e.quality.value);else if(e.quality.changed){const t=this.derivatives.select(c.EDerivativeUsage.Web3D,e.quality.value);t&&t!==this.activeDerivative&&this.loadDerivative(t).catch(e=>{console.warn("Model.update - failed to load derivative"),console.warn(e)})}return e.visible.changed&&(this.object3D.visible=e.visible.value),e.units.changed&&(this.updateUnitScale(),this.emit({type:"change",what:"boundingBox",component:this})),e.center.changed&&this.center(),(e.position.changed||e.rotation.changed)&&this.updateMatrixFromProps(),e.dumpDerivatives.changed&&console.log(this.derivatives.toString(!0)),!0}dispose(){this.derivatives.clear(),this._activeDerivative=null,super.dispose()}center(){const e=this.object3D,t=this.ins.position;e.matrix.decompose(h,f,p),e.matrix.makeRotationFromQuaternion(f),m.makeEmpty(),i.computeLocalBoundingBox(e,m,e.parent),m.getCenter(h),h.multiplyScalar(-1).toArray(t.value),t.set()}setGlobalUnits(e){this.outs.globalUnits.setValue(e),this.updateUnitScale()}setFromMatrix(e){const{position:t,rotation:r}=this.ins;e.decompose(h,f,p),h.multiplyScalar(1/this.outs.unitScale.value).toArray(t.value),i.quaternionToDegrees(f,b.rotationOrder,r.value),t.set(),r.set()}setShaderMode(e){this.object3D.traverse(t=>{const r=t.material;r&&r.isUberPBRMaterial&&r.setShaderMode(e)})}deflate(){const e=this.toData();return e?{data:e}:null}inflate(e){e.data&&this.fromData(e)}toData(){const e=this.ins,t={units:a.EUnitType[e.units.value],derivatives:this.derivatives.toData()};t.boundingBox={min:this._boundingBox.min.toArray(),max:this._boundingBox.max.toArray()};const r=e.position.value;0===r[0]&&0===r[1]&&0===r[2]||(t.translation=h.toArray());const s=e.rotation.value;return 0===s[0]&&0===s[1]&&0===s[2]||(i.degreesToQuaternion(s,b.rotationOrder,f),t.rotation=f.toArray()),t}fromData(e){const{units:t,position:r,rotation:n}=this.ins;t.setValue(a.EUnitType[e.units]||0),e.derivatives&&this.derivatives.fromData(e.derivatives),(e.translation||e.rotation)&&(r.setValue(e.translation?e.translation.slice():[0,0,0]),e.rotation?(f.fromArray(e.rotation),n.setValue(i.quaternionToDegrees(f,b.rotationOrder))):n.setValue([0,0,0]),this.updateMatrixFromProps()),e.boundingBox&&(this._boundingBox.min.fromArray(e.boundingBox.min),this._boundingBox.max.fromArray(e.boundingBox.max),this._boxFrame=new s.Box3Helper(this._boundingBox,"#ffffff"),this.addObject3D(this._boxFrame),this.emit({type:"change",what:"derivative",component:this})),this.ins.autoLoad.set()}inflateReferences(){}updateUnitScale(){const e=a.EUnitType[this.ins.units.getValidatedValue()],t=a.EUnitType[this.outs.globalUnits.value];this.outs.unitScale.setValue(v[e][t]),this.updateMatrixFromProps()}updateMatrixFromProps(){const e=this.ins,t=this.outs.unitScale.value;h.fromArray(e.position.value).multiplyScalar(t),i.degreesToQuaternion(e.rotation.value,b.rotationOrder,f),p.setScalar(t);const r=this.object3D;r.matrix.compose(h,f,p),r.matrixWorldNeedsUpdate=!0}autoLoad(e){const t=[],r=this.derivatives.select(c.EDerivativeUsage.Web3D,c.EDerivativeQuality.Thumb);r&&t.push(r);const s=this.derivatives.select(c.EDerivativeUsage.Web3D,e);return s&&s!==r&&t.push(s),0===t.length?Promise.resolve():t.reduce((e,t)=>e.then(()=>this.loadDerivative(t)),Promise.resolve())}loadDerivative(e){const t=this.system.components.safeGet(u.default);return e.load(t,this.assetPath).then(()=>{e.model&&(this._boxFrame&&(this.removeObject3D(this._boxFrame),this._boxFrame.geometry.dispose()),this._activeDerivative&&(this.removeObject3D(this._activeDerivative.model),this._activeDerivative.dispose()),i.computeLocalBoundingBox(e.model,this._boundingBox),this._activeDerivative=e,this.addObject3D(e.model),this.emit({type:"change",what:"derivative",component:this}))})}}b.type="CVModel",b.rotationOrder="ZYX",t.default=b},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(23),i=r(72),n=r(26),o=r(73),a=r(74),l=r(54),c=r(75);class d extends s.default{get item(){return this.components.get(i.default)}get meta(){return this.components.get(o.default)}get process(){return this.components.get(a.default)}get model(){return this.components.get(n.default)}get documents(){return this.components.get(c.default)}get annotations(){return this.components.get(l.default)}createComponents(){super.createComponents(),this.createComponent(i.default),this.createComponent(o.default),this.createComponent(a.default),this.createComponent(n.default),this.createComponent(l.default),this.createComponent(c.default),this.name="Item"}}d.type="NVItem",t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(20),n=r(3),o=r(37),a=new s.Vector3,l=new s.Vector3,c=new s.Quaternion,d=new s.Euler;var u;!function(e){e[e.XYZ=0]="XYZ",e[e.YZX=1]="YZX",e[e.ZXY=2]="ZXY",e[e.XZY=3]="XZY",e[e.YXZ=4]="YXZ",e[e.ZYX=5]="ZYX"}(u=t.ERotationOrder||(t.ERotationOrder={}));const h={position:n.types.Vector3("Position"),rotation:n.types.Vector3("Rotation"),order:n.types.Enum("Order",u),scale:n.types.Vector3("Scale",[1,1,1])},p={matrix:n.types.Matrix4("Matrix")};class f extends o.default{constructor(e){super(e),this.ins=this.addInputs(h),this.outs=this.addOutputs(p),this._object3D=this.createObject3D(),this._object3D.matrixAutoUpdate=!1}get transform(){return this}get object3D(){return this._object3D}get children(){return this._children||[]}get matrix(){return this._object3D.matrix}update(e){const t=this._object3D,{position:r,rotation:s,order:n,scale:o}=this.ins,{matrix:l}=this.outs;t.position.fromArray(r.value),a.fromArray(s.value).multiplyScalar(i.default.DEG2RAD);const c=n.getOptionText();return t.rotation.setFromVector3(a,c),t.scale.fromArray(o.value),t.updateMatrix(),t.matrix.toArray(l.value),l.set(),!0}dispose(){this._object3D&&(this._object3D.parent&&this._object3D.parent.remove(this._object3D),this._object3D.children.slice().forEach(e=>this._object3D.remove(e)),super.dispose())}setFromMatrix(e){const{position:t,rotation:r,order:s,scale:n}=this.ins;e.decompose(a,c,l),a.toArray(t.value);const o=s.getOptionText();d.setFromQuaternion(c,o),d.toVector3(a),a.multiplyScalar(i.default.RAD2DEG).toArray(r.value),l.toArray(n.value),t.set(),r.set(),n.set()}addChild(e){super.addChild(e),this._object3D.add(e._object3D)}removeChild(e){this._object3D.remove(e._object3D),super.removeChild(e)}addObject3D(e){this._object3D.add(e)}removeObject3D(e){this._object3D.remove(e)}createObject3D(){return new s.Object3D}}f.type="CTransform",t.default=f},function(e,t,r){"use strict";function s(e,t,r){var s=r?" !== ":" === ",i=r?" || ":" && ",n=r?"!":"",o=r?"":"!";switch(e){case"null":return t+s+"null";case"array":return n+"Array.isArray("+t+")";case"object":return"("+n+t+i+"typeof "+t+s+'"object"'+i+o+"Array.isArray("+t+"))";case"integer":return"(typeof "+t+s+'"number"'+i+o+"("+t+" % 1)"+i+t+s+t+")";default:return"typeof "+t+s+'"'+e+'"'}}e.exports={copy:function(e,t){for(var r in t=t||{},e)t[r]=e[r];return t},checkDataType:s,checkDataTypes:function(e,t){switch(e.length){case 1:return s(e[0],t,!0);default:var r="",i=n(e);for(var o in i.array&&i.object&&(r=i.null?"(":"(!"+t+" || ",r+="typeof "+t+' !== "object")',delete i.null,delete i.array,delete i.object),i.number&&delete i.integer,i)r+=(r?" && ":"")+s(o,t,!0);return r}},coerceToTypes:function(e,t){if(Array.isArray(t)){for(var r=[],s=0;s<t.length;s++){var n=t[s];i[n]?r[r.length]=n:"array"===e&&"array"===n&&(r[r.length]=n)}if(r.length)return r}else{if(i[t])return[t];if("array"===e&&"array"===t)return["array"]}},toHash:n,getProperty:l,escapeQuotes:c,equal:r(68),ucs2length:r(145),varOccurences:function(e,t){t+="[^0-9]";var r=e.match(new RegExp(t,"g"));return r?r.length:0},varReplace:function(e,t,r){return t+="([^0-9])",r=r.replace(/\$/g,"$$$$"),e.replace(new RegExp(t,"g"),r+"$1")},cleanUpCode:function(e){return e.replace(d,"").replace(u,"").replace(h,"if (!($1))")},finalCleanUpCode:function(e,t){var r=e.match(p);r&&2==r.length&&(e=t?e.replace(m,"").replace(g,b):e.replace(f,"").replace(v,y));return(r=e.match(E))&&3===r.length?e.replace(_,""):e},schemaHasRules:function(e,t){if("boolean"==typeof e)return!e;for(var r in e)if(t[r])return!0},schemaHasRulesExcept:function(e,t,r){if("boolean"==typeof e)return!e&&"not"!=r;for(var s in e)if(s!=r&&t[s])return!0},toQuotedString:P,getPathExpr:function(e,t,r,s){return C(e,r?"'/' + "+t+(s?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):s?"'[' + "+t+" + ']'":"'[\\'' + "+t+" + '\\']'")},getPath:function(e,t,r){var s=P(r?"/"+S(t):l(t));return C(e,s)},getData:function(e,t,r){var s,i,n,o;if(""===e)return"rootData";if("/"==e[0]){if(!w.test(e))throw new Error("Invalid JSON-pointer: "+e);i=e,n="rootData"}else{if(!(o=e.match(x)))throw new Error("Invalid JSON-pointer: "+e);if(s=+o[1],"#"==(i=o[2])){if(s>=t)throw new Error("Cannot access property/index "+s+" levels up, current level is "+t);return r[t-s]}if(s>t)throw new Error("Cannot access data "+s+" levels up, current level is "+t);if(n="data"+(t-s||""),!i)return n}for(var a=n,c=i.split("/"),d=0;d<c.length;d++){var u=c[d];u&&(n+=l(D(u)),a+=" && "+n)}return a},unescapeFragment:function(e){return D(decodeURIComponent(e))},unescapeJsonPointer:D,escapeFragment:function(e){return encodeURIComponent(S(e))},escapeJsonPointer:S};var i=n(["string","number","integer","boolean","null"]);function n(e){for(var t={},r=0;r<e.length;r++)t[e[r]]=!0;return t}var o=/^[a-z$_][a-z$_0-9]*$/i,a=/'|\\/g;function l(e){return"number"==typeof e?"["+e+"]":o.test(e)?"."+e:"['"+c(e)+"']"}function c(e){return e.replace(a,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}var d=/else\s*{\s*}/g,u=/if\s*\([^)]+\)\s*\{\s*\}(?!\s*else)/g,h=/if\s*\(([^)]+)\)\s*\{\s*\}\s*else(?!\s*if)/g;var p=/[^v.]errors/g,f=/var errors = 0;|var vErrors = null;|validate.errors = vErrors;/g,m=/var errors = 0;|var vErrors = null;/g,v="return errors === 0;",y="validate.errors = null; return true;",g=/if \(errors === 0\) return data;\s*else throw new ValidationError\(vErrors\);/,b="return data;",E=/[^A-Za-z_$]rootData[^A-Za-z0-9_$]/g,_=/if \(rootData === undefined\) rootData = data;/;function P(e){return"'"+c(e)+"'"}var w=/^\/(?:[^~]|~0|~1)*$/,x=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function C(e,t){return'""'==e?t:(e+" + "+t).replace(/' \+ '/g,"")}function S(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}function D(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i={visible:s.types.Boolean("Interface.Visible",!0),logo:s.types.Boolean("Interface.Logo",!0)};class n extends s.default{constructor(){super(...arguments),this.ins=this.addInputs(i)}fromData(e){this.ins.setValues({visible:e.visible,logo:e.logo})}toData(){const e=this.ins;return{visible:e.visible.value,logo:e.logo.value}}}n.type="CVInterface",t.default=n},function(e,t,r){"use strict";var s,i=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const n=r(1);let o=s=class extends n.default{constructor(){super(),this.direction="horizontal",this.width=5,this.margin=20,this.detached=!1,this._isActive=!1,this._offset=0,this._position=0,this.addEventListener("pointerdown",e=>this.onPointerDown(e)),this.addEventListener("pointermove",e=>this.onPointerMove(e)),this.addEventListener("pointerup",e=>this.onPointerUpOrCancel(e)),this.addEventListener("pointercancel",e=>this.onPointerUpOrCancel(e))}get position(){return this._position}isHorizontal(){return"horizontal"===this.direction}update(e){super.update(e);const t=this.isHorizontal(),r=this.width;this.setStyle({padding:t?`0 ${r}px`:`${r}px 0`,margin:t?`0 ${-r}px`:`${-r}px 0`,cursor:t?"col-resize":"row-resize"})}firstUpdated(){this.setAttribute("touch-action","none"),this.setStyle({position:"relative",display:"block",zIndex:"1",touchAction:"none"})}onPointerDown(e){if(e.isPrimary){e.stopPropagation(),e.preventDefault(),this._isActive=!0,this.setPointerCapture(e.pointerId);const t=this.getBoundingClientRect();this._offset=this.isHorizontal()?t.left+.5*t.width-e.clientX:t.top+.5*t.height-e.clientY}}onPointerMove(e){if(e.isPrimary&&this._isActive){e.stopPropagation(),e.preventDefault();const t=this.parentElement;if(!t)return;const r=t.getBoundingClientRect(),i=this.isHorizontal(),n=i?r.width:r.height;let o=this._offset+(i?e.clientX-r.left:e.clientY-r.top),a=o/n;if(!this.detached){const e=this.previousElementSibling,r=this.nextElementSibling;if(e instanceof HTMLElement&&r instanceof HTMLElement){const l=Array.from(t.children);let c=0,d=n,u=!1;l.forEach(t=>{if(t instanceof s)return;if(t===e||t===r)return void(u=!0);const n=t.getBoundingClientRect(),o=i?n.width:n.height;d-=o,u||(c+=o)});const h=this.margin,p=d-h,f=(d-(o=(o-=c)<h?h:o>p?p:o))/n;a=o/n,e.style.flexBasis=(100*a).toFixed(3)+"%",r.style.flexBasis=(100*f).toFixed(3)+"%",setTimeout(()=>window.dispatchEvent(new CustomEvent("resize")),0)}}this._position=a,this.dispatchEvent(new CustomEvent(s.changeEvent,{detail:{direction:this.direction,position:this._position,isDragging:!0}}))}}onPointerUpOrCancel(e){e.isPrimary&&(e.stopPropagation(),e.preventDefault(),this._isActive=!1,this.dispatchEvent(new CustomEvent(s.changeEvent,{detail:{direction:this.direction,position:this._position,isDragging:!1}})))}};o.changeEvent="ff-splitter-change",i([n.property({type:String})],o.prototype,"direction",void 0),i([n.property({type:Number})],o.prototype,"width",void 0),i([n.property({type:Number})],o.prototype,"margin",void 0),i([n.property({type:Boolean})],o.prototype,"detached",void 0),o=s=i([n.customElement("ff-splitter")],o),t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(3),i=r(0),n=r(65),o=r(22),a=r(33),l={activate:s.types.Event("Activate")};class c extends i.default{constructor(){super(...arguments),this.ins=this.addInputs(l),this.tasks=null,this.presentations=null,this.selection=null,this.activePresentation=null,this.activeItem=null}create(){this.tasks=this.system.graph.components.safeGet(a.default),this.presentations=this.system.graph.components.safeGet(o.default),this.selection=this.system.graph.components.safeGet(n.default)}update(){return this.ins.activate.changed&&(this.tasks.activeTask=this),!1}createView(){throw new Error("must override")}activate(){this.presentations.on("active-presentation",this.onActivePresentation,this),this.presentations.on("active-item",this.onActiveItem,this),this.setActivePresentation(this.presentations.activePresentation),this.activePresentation=this.presentations.activePresentation,this.setActiveItem(this.presentations.activeItem),this.activeItem=this.presentations.activeItem}deactivate(){this.setActivePresentation(null),this.activePresentation=null,this.setActiveItem(null),this.activeItem=null,this.presentations.off("active-presentation",this.onActivePresentation,this),this.presentations.off("active-item",this.onActiveItem,this)}setActivePresentation(e){}setActiveItem(e){}onActivePresentation(e){this.setActivePresentation(e.next),this.activePresentation=e.next}onActiveItem(e){this.setActiveItem(e.next),this.activeItem=e.next}}c.type="CVTask",c.text="Task",c.icon="fa fa-tasks",t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(36),i=r(12),n=r(32);class o extends s.default{constructor(e){super(e),this._taskNode=null,this._tasks=[],this._activeTask=null,this.addEvent("task")}get activeTask(){return this._activeTask}set activeTask(e){if(e!==this._activeTask){const t=this._activeTask;this._activeTask=e,t&&t.deactivate(),this.emit({type:"active-task",previous:t,next:e}),e&&e.activate()}}setTaskTypes(e){this.activeTask=null,this._tasks&&this._tasks.forEach(e=>e.dispose()),this._tasks=e.map(e=>this._taskNode.createComponent(e)),this.activeTask=this._tasks[0]}get tasks(){return this._tasks}get selection(){return this.system.components.safeGet(i.default)}createActions(e){return{}}create(){super.create(),this._taskNode=this.graph.createNode("Tasks"),this.selection.selectedComponents.on(n.default,this.onSelectTask,this)}dispose(){this.selection.selectedComponents.off(n.default,this.onSelectTask,this),super.dispose()}onSelectTask(e){e.add&&(this.activeTask=e.component)}}o.type="CVTaskController",t.default=o},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1);t.customElement=i.customElement,t.property=i.property,t.html=i.html,t.TemplateResult=i.TemplateResult;class n extends i.default{constructor(e){super(),this.system=e}}s([i.property({attribute:!1})],n.prototype,"system",void 0),t.default=n},function(e,t,r){"use strict";r.d(t,"a",function(){return n});var s=r(8),i=r(4);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class n{constructor(e,t,r){this._parts=[],this.template=e,this.processor=t,this.options=r}update(e){let t=0;for(const r of this._parts)void 0!==r&&r.setValue(e[t]),t++;for(const e of this._parts)void 0!==e&&e.commit()}_clone(){const e=s.a?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),t=this.template.parts;let r=0,n=0;const o=e=>{const s=document.createTreeWalker(e,133,null,!1);let a=s.nextNode();for(;r<t.length&&null!==a;){const e=t[r];if(Object(i.d)(e))if(n===e.index){if("node"===e.type){const e=this.processor.handleTextExpression(this.options);e.insertAfterNode(a.previousSibling),this._parts.push(e)}else this._parts.push(...this.processor.handleAttributeExpressions(a,e.name,e.strings,this.options));r++}else n++,"TEMPLATE"===a.nodeName&&o(a.content),a=s.nextNode();else this._parts.push(void 0),r++}};return o(e),s.a&&(document.adoptNode(e),customElements.upgrade(e)),e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(84);t.Commander=s.default;const i=r(0);t.types=i.types;class n extends i.default{createActions(e){return{}}}n.type="CController",n.isSystemSingleton=!0,t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(19);t.Node=i.default;const n=(e,t,r)=>{let s;const i=e.children;for(let e=0,r=i.length;e<r;++e)if(s=i[e].components.get(t))return s;if(r)for(let e=0,r=i.length;e<r;++e)if(s=n(i[e],t,!0))return s;return null},o=(e,t,r)=>{let s=[];const i=e.children;for(let e=0,r=i.length;e<r;++e)s=s.concat(i[e].components.getArray(t));if(r)for(let e=0,r=i.length;e<r;++e)s=s.concat(o(i[e],t,!0));return s};class a extends s.default{constructor(){super(...arguments),this._parent=null,this._children=[]}get parent(){return this._parent}get children(){return this._children||[]}dispose(){this._parent&&this._parent.removeChild(this),this._children.slice().forEach(e=>e.node.dispose()),super.dispose()}getRoot(e){let t=this;for(;t._parent;)t=t._parent;return t?t.node.components.get(e):null}getParent(e,t){let r=this._parent;if(!r)return null;let s=r.node.components.get(e);if(s)return s;if(t){if(!(r=r._parent)){const e=this.graph.parent;r=e?e.hierarchy:null}for(;r;)if(s=r.node.components.get(e))return s}return null}getChild(e,t){return n(this,e,t)}getChildren(e,t){return o(this,e,t)}hasChildren(e,t){return!!n(this,e,t)}addChild(e){if(e._parent)throw new Error("can't add as child: component already has a parent");if(e===this.graph.root)throw new Error("can't add as child: component is root of graph");e._parent=this,this._children.push(e);const t={type:"hierarchy",add:!0,remove:!1,parent:this,child:e};for(;e;)e.emit(t),e.node.emit(t),e=e._parent;this.graph.emit(t),this.system.emit(t)}removeChild(e){if(e._parent!==this)throw new Error("component not a child of this");const t=this._children.indexOf(e);this._children.splice(t,1),e._parent=null;const r={type:"hierarchy",add:!1,remove:!0,parent:this,child:e};for(;e;)e.emit(r),e.node.emit(r),e=e._parent;this.graph.emit(r),this.system.emit(r)}deflate(){const e=super.deflate();return this._children.length>0&&(e.children=this._children.map(e=>e.id)),e}inflateReferences(e){super.inflateReferences(e);const t=this.system.components.getDictionary();e.children&&e.children.forEach(e=>{const r=t[e];this.addChild(r)})}toString(){return super.toString()+` - children: ${this.children.length}`}}a.type="CHierarchy",t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(21),i=r(2),n=r(0),o=r(140),a=r(141),l=r(186),c=r(191),d=r(194),u=!1;class h extends n.default{constructor(e){super(e);const t=this._loadingManager=new p;this.jsonLoader=new o.default(t),this.validator=new a.default,this.modelLoader=new l.default(t),this.geometryLoader=new c.default(t),this.textureLoader=new d.default(t)}loadJSON(e,t){return e=s.default(e,t),this.jsonLoader.load(e)}loadModel(e,t){const r=s.default(e.uri,t);return this.modelLoader.load(r)}loadGeometry(e,t){const r=s.default(e.uri,t);return this.geometryLoader.load(r)}loadTexture(e,t){const r=s.default(e.uri,t);return this.textureLoader.load(r)}validatePresentation(e){return new Promise((t,r)=>this.validator.validatePresentation(e)?t(e):r(new Error("invalid presentation data, validation failed")))}validateItem(e){return new Promise((t,r)=>this.validator.validateItem(e)?t(e):r(new Error("invalid item data, validation failed")))}}h.type="CVLoaders",t.default=h;class p extends i.LoadingManager{onLoadingStart(){u&&console.log("Loading files...")}onLoadingProgress(e,t,r){u&&console.log(`Loaded ${t} of ${r} files: ${e}`)}onLoadingCompleted(){u&&console.log("Loading completed")}onLoadingError(){u&&console.error("Loading error")}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(95);t.EUnitType=s.EUnitType,function(e){e[e.Default=0]="Default",e[e.Clay=1]="Clay",e[e.XRay=2]="XRay",e[e.Normals=3]="Normals",e[e.Wireframe=4]="Wireframe"}(t.EShaderMode||(t.EShaderMode={})),function(e){e[e.Solid=0]="Solid",e[e.LinearGradient=1]="LinearGradient",e[e.RadialGradient=2]="RadialGradient"}(t.EBackgroundType||(t.EBackgroundType={})),function(e){e[e.Orbit=0]="Orbit",e[e.Walk=1]="Walk"}(t.ENavigationType||(t.ENavigationType={})),function(e){e[e.Overlay=0]="Overlay",e[e.Left=1]="Left",e[e.Right=2]="Right"}(t.EReaderPosition||(t.EReaderPosition={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(20),n=r(3),o=r(0),a=r(71),l=r(13),c=r(50);t.EProjection=c.EProjection;const d=r(25),u=new s.Box3,h=new s.Vector3,p=new s.Vector3,f=(new s.Vector3,[[0,-90,0],[0,90,0],[-90,0,0],[90,0,0],[0,0,0],[0,180,0]]),m=function(e,t){for(let r=0,s=e.length;r<s;++r)e[r]=null===e[r]?t:e[r];return e};var v;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Top=2]="Top",e[e.Bottom=3]="Bottom",e[e.Front=4]="Front",e[e.Back=5]="Back",e[e.None=6]="None"}(v=t.EViewPreset||(t.EViewPreset={}));const y={preset:n.types.Enum("View.Preset",v,v.None),projection:n.types.Enum("View.Projection",c.EProjection,c.EProjection.Perspective),enabled:n.types.Boolean("Manip.Enabled",!0),zoomExtents:n.types.Event("Manip.ZoomExtents"),orbit:n.types.Vector3("Manip.Orbit",[-25,-25,0]),offset:n.types.Vector3("Manip.Offset",[0,0,100]),minOrbit:n.types.Vector3("Manip.Min.Orbit",[-90,-1/0,-1/0]),minOffset:n.types.Vector3("Manip.Min.Offset",[-1/0,-1/0,.1]),maxOrbit:n.types.Vector3("Manip.Max.Orbit",[90,1/0,1/0]),maxOffset:n.types.Vector3("Manip.Max.Offset",[1/0,1/0,1/0])};class g extends o.default{constructor(){super(...arguments),this.ins=this.addInputs(y),this._manip=new a.default,this._activeScene=null}get renderer(){return this.system.graph.components.safeGet(l.default)}create(){super.create(),this._manip.cameraMode=!0,this.system.on(["pointer-down","pointer-up","pointer-move"],this.onPointer,this),this.system.on("wheel",this.onTrigger,this),this._activeScene=this.renderer.activeSceneComponent,this.renderer.on("active-scene",this.onActiveScene,this)}dispose(){super.dispose(),this.system.off(["pointer-down","pointer-up","pointer-move"],this.onPointer,this),this.system.off("wheel",this.onTrigger,this),this.renderer.off("active-scene",this.onActiveScene,this),this._activeScene=null}update(){const e=this._manip,t=this._activeScene?this._activeScene.activeCameraComponent:null,r=t?t.camera:null,{projection:s,preset:n,zoomExtents:o,orbit:a,offset:l,minOrbit:d,minOffset:m,maxOrbit:y,maxOffset:g}=this.ins;if(r&&s.changed&&(r.setProjection(s.value),e.orthographicMode=s.value===c.EProjection.Orthographic),n.changed&&n.value!==v.None&&a.setValue(f[n.getValidatedValue()].slice()),r&&o.changed){r.updateMatrixWorld(!1),u.copy(this._activeScene.boundingBox),u.applyMatrix4(r.matrixWorldInverse),u.getSize(h),u.getCenter(p);const e=.75*Math.max(h.x,h.y,h.z);r.isPerspectiveCamera?l.value[2]=e+e/(2*Math.tan(r.fov*i.default.DEG2RAD*.5)):l.value[2]=2*h.z,l.set()}return(a.changed||l.changed)&&(e.orbit.fromArray(a.value),e.offset.fromArray(l.value)),(d.changed||m.changed||y.changed||g.changed)&&(e.minOrbit.fromArray(d.value),e.minOffset.fromArray(m.value),e.maxOrbit.fromArray(y.value),e.maxOffset.fromArray(g.value)),!0}tick(){const e=this._manip,t=this._activeScene&&this._activeScene.activeCameraComponent,r=this.ins;if(r.enabled.value){const s=e.update();if(s&&(e.orbit.toArray(r.orbit.value),r.orbit.set(!0),e.offset.toArray(r.offset.value),r.offset.set(!0),r.preset.setValue(v.None,!0)),t&&(s||this.updated)){const e=t.camera,r=t.transform;return r?this._manip.toObject(r.object3D):this._manip.toObject(e),e.isOrthographicCamera&&(e.size=this._manip.offset.z,e.updateProjectionMatrix()),!0}}return!1}fromData(e){const t=e.orbit;this.ins.copyValues({enabled:e.enabled,orbit:t.orbit.slice(),offset:t.offset.slice(),minOrbit:m(t.minOrbit.slice(),-1/0),maxOrbit:m(t.maxOrbit.slice(),1/0),minOffset:m(t.minOffset.slice(),-1/0),maxOffset:m(t.maxOffset.slice(),1/0)})}toData(){const e=this.ins;return{type:"Orbit",enabled:e.enabled.value,orbit:{orbit:e.orbit.cloneValue(),offset:e.offset.cloneValue(),minOrbit:e.minOrbit.cloneValue(),maxOrbit:e.maxOrbit.cloneValue(),minOffset:e.minOffset.cloneValue(),maxOffset:e.maxOffset.cloneValue()}}}onPointer(e){const t=e.viewport;t.viewportCamera||this.ins.enabled.value&&this._activeScene&&this._activeScene.activeCameraComponent&&(this._manip.setViewportSize(t.width,t.height),this._manip.onPointer(e),e.stopPropagation=!0)}onTrigger(e){const t=e.viewport;t.viewportCamera||this.ins.enabled.value&&this._activeScene&&this._activeScene.activeCameraComponent&&(this._manip.setViewportSize(t.width,t.height),this._manip.onTrigger(e),e.stopPropagation=!0)}onActiveScene(e){e.next instanceof d.default&&(this._activeScene=e.next,this.ins.zoomExtents.set())}}g.type="CVOrbitNavigation",t.default=g},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(3),i=r(14),n={color:s.types.ColorRGB("Color"),intensity:s.types.Number("Intensity",1)};class o extends i.default{constructor(){super(...arguments),this.ins=this.addInputs(n)}get light(){return this.object3D}}o.type="CLight",t.default=o},function(e,t,r){"use strict";var s,i=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const n=r(1);t.html=n.html;let o=s=class extends n.default{constructor(){super(...arguments),this.template=null,this.name=""}static add(e,t){if(s.templates[e])throw new Error(`icon already registered: '${e}'`);s.templates[e]=t}firstConnected(){this.classList.add("ff-icon")}render(){if(this.name){const e=this.constructor.templates[this.name];return e||console.warn(`icon not found: '${this.name}'`),e}return this.template?this.template:n.html`[icon undefined]`}};o.templates={},i([n.property({attribute:!1})],o.prototype,"template",void 0),i([n.property({type:String})],o.prototype,"name",void 0),o=s=i([n.customElement("ff-icon")],o),t.default=o,o.add("empty",n.html``),o.add("check",n.html`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg>`),o.add("close",n.html`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512"><path d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"/></svg>`),o.add("grip",n.html`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M149.333 56v80c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V56c0-13.255 10.745-24 24-24h101.333c13.255 0 24 10.745 24 24zm181.334 240v-80c0-13.255-10.745-24-24-24H205.333c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.256 0 24.001-10.745 24.001-24zm32-240v80c0 13.255 10.745 24 24 24H488c13.255 0 24-10.745 24-24V56c0-13.255-10.745-24-24-24H386.667c-13.255 0-24 10.745-24 24zm-32 80V56c0-13.255-10.745-24-24-24H205.333c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.256 0 24.001-10.745 24.001-24zm-205.334 56H24c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24zM0 376v80c0 13.255 10.745 24 24 24h101.333c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H24c-13.255 0-24 10.745-24 24zm386.667-56H488c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H386.667c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24zm0 160H488c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H386.667c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24zM181.333 376v80c0 13.255 10.745 24 24 24h101.333c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H205.333c-13.255 0-24 10.745-24 24z"/></svg>`),o.add("info",n.html`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/></svg>`),o.add("warning",n.html`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"/></svg>`),o.add("error",n.html`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"/></svg>`)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(12),i=r(1),n=r(22);t.default=class extends i.default{constructor(e){super(),this.presentations=null,this.selection=null,this.task=e}get system(){return this.task.system}firstConnected(){this.classList.add("sv-task-view"),this.presentations=this.system.components.safeGet(n.default),this.selection=this.system.components.safeGet(s.default)}connected(){this.presentations.on("active-presentation",this.onActivePresentation,this),this.presentations.on("active-item",this.onActiveItem,this),this.setActiveItem(this.presentations.activeItem)}disconnected(){this.presentations.off("active-presentation",this.onActivePresentation,this),this.presentations.off("active-item",this.onActiveItem,this)}onActivePresentation(e){}onActiveItem(e){this.setActiveItem(e.next)}setActiveItem(e){}}},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(0),n=r(12),o=r(1),a=r(122),l=r(27),c=r(22);let d=class extends a.default{constructor(){super(...arguments),this.system=null,this.presentations=null,this.selection=null}firstConnected(){super.firstConnected(),this.classList.add("sv-scrollable","sv-item-list"),this.presentations=this.system.components.safeGet(c.default),this.selection=this.system.components.safeGet(n.default)}connected(){super.connected(),this.selection.selectedNodes.on(l.default,this.onSelectItem,this),this.selection.selectedComponents.on(i.default,this.onSelectComponent,this),this.presentations.on("active-presentation",this.onActivePresentation,this),this.presentations.on("active-item",this.onActiveItem,this)}disconnected(){this.selection.selectedNodes.off(l.default,this.onSelectItem,this),this.selection.selectedComponents.off(i.default,this.onSelectComponent,this),this.presentations.off("active-presentation",this.onActivePresentation,this),this.presentations.off("active-item",this.onActiveItem,this),super.disconnected()}update(e){return this.data=this.presentations.items,super.update(e)}renderItem(e){const t=e===this.presentations.activeItem;return o.html`<div class="ff-flex-row"><ff-icon name=${t?"check":"empty"}></ff-icon>
            <ff-text class="ff-ellipsis">${e.displayName}</ff-text></div>`}isItemSelected(e){return this.selection.selectedNodes.contains(e)||this.selection.nodeContainsSelectedComponent(e)}onClickItem(e,t){this.presentations.activeItem=t}onClickEmpty(){}onActivePresentation(e){this.requestUpdate()}onActiveItem(e){this.requestUpdate()}onSelectItem(e){this.requestUpdate()}onSelectComponent(e){e.component.node.type===l.default.type&&this.requestUpdate()}};s([o.property({attribute:!1})],d.prototype,"system",void 0),d=s([o.customElement("sv-item-list")],d)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(21),i=r(121),n=r(53),o=r(36),a=r(12),l=r(78),c=r(22),d=r(33),u=r(248);t.EStoryMode=u.EStoryMode;const h={save:o.types.Event("Save"),download:o.types.Event("Download"),exit:o.types.Event("Exit"),mode:o.types.Enum("Mode",u.EStoryMode),expertMode:o.types.Boolean("ExpertMode"),referrer:o.types.String("Referrer")};class p extends o.default{constructor(){super(...arguments),this.ins=this.addInputs(h),this.selection=null,this.presentations=null,this.tasks=null}createActions(e){return{}}create(){this.selection=this.graph.components.get(a.default),this.presentations=this.graph.components.get(c.default),this.tasks=this.graph.components.get(d.default)}update(){const e=this.ins;if(e.mode.changed){const t=u.default[u.EStoryMode[e.mode.getValidatedValue()]];t&&this.tasks.setTaskTypes(t)}if(e.save.changed){let e,t;const r=this.getSelectedActiveItem(),n=this.getSelectedActivePresentation();if(r){e=r.item.url;const s=r.item.urlName;t=new File([JSON.stringify(r.item.toData())],s,{type:"text/json"})}else if(n){const r=(e=n.presentation.url).substr(s.default(".",e).length);t=new File([JSON.stringify(n.toData())],r,{type:"text/json"})}e&&(console.log(`uploading file to '${e}'`),i.default.file(e,"PUT",t).then(()=>{new l.default(`Successfully uploaded file to '${e}'`,"info",4e3)}).catch(t=>{new l.default(`Failed to upload file to '${e}'`,"error",8e3)}))}if(e.download.changed){const e=this.getSelectedActiveItem(),t=this.getSelectedActivePresentation();if(e)n.default.json(e.item.toData(),e.item.urlName);else if(t){const e=t.presentation.url,r=e.substr(s.default(".",e).length);n.default.json(t.toData(),r)}}return e.exit.changed&&this.exit(),!1}getSelectedActivePresentation(){const e=this.presentations.activePresentation;return this.selection.selectedComponents.contains(e)?e:null}getSelectedActiveItem(){const e=this.presentations.activeItem;return this.selection.nodeContainsSelectedComponent(e)?e:null}exit(){const e=this.ins.referrer.value;e&&location.assign(e)}}p.type="CVStoryController",p.isSystemSingleton=!0,t.default=p},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1),n=r(249),o=r(125),a=r(81);let l=class extends i.default{setPanelsMovable(e){const t=this.getElementsByTagName(a.default.tagName);for(let r of t)r.movable=e}setPanelsClosable(e){const t=this.getElementsByTagName(a.default.tagName);for(let r of t)r.closable=e}setLayout(e,t){for(;this.firstChild;)this.removeChild(this.firstChild);let r;switch(e.type){case"strip":r=new n.default;break;case"stack":r=new o.default}r.setLayout(e,t),this.appendChild(r),setTimeout(()=>window.dispatchEvent(new CustomEvent("resize")),0)}getLayout(){const e=this.firstChild;return e&&(e instanceof n.default||e instanceof o.default)?e.getLayout():null}firstConnected(){this.setStyle({display:"flex",alignItems:"stretch"})}};l.changeEvent="ff-dock-view-change",l=s([i.customElement("ff-dock-view")],l),t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(10),i=r(0),n=[];t.default=class extends s.default{constructor(){super({knownEvents:!1}),this._typeLists={[i.default.type]:[]},this._idDict={}}_add(e){if(void 0!==this._idDict[e.id])throw new Error("component already in set");this._idDict[e.id]=e;let t=e;const r={type:"",add:!0,remove:!1,component:e};do{const s=(t=Object.getPrototypeOf(t)).type;(this._typeLists[s]||(this._typeLists[s]=[])).push(e),r.type=s,this.emit(r)}while(t.type!==i.default.type)}_remove(e){if(this._idDict[e.id]!==e)throw new Error("component not in set");delete this._idDict[e.id];let t=e;const r={type:"",add:!1,remove:!0,component:e};do{const s=(t=Object.getPrototypeOf(t)).type,i=this._typeLists[s];i.splice(i.indexOf(e),1),r.type=s,this.emit(r)}while(t.type!==i.default.type)}_clear(){this.cloneArray().forEach(e=>this._remove(e))}get length(){return this._typeLists[i.default.type].length}has(e){const t=this._typeLists[i.componentTypeName(e)];return t&&t.length>0}contains(e){return!!this._idDict[e.id]}count(e){const t=this._typeLists[i.componentTypeName(e)];return t?t.length:0}getDictionary(){return this._idDict}getArray(e){return this._typeLists[i.componentTypeName(e)]||n}cloneArray(e){return this.getArray(e).slice()}get(e){const t=this._typeLists[i.componentTypeName(e)];return t?t[0]:void 0}safeGet(e){const t=i.componentTypeName(e),r=this._typeLists[t],s=r?r[0]:void 0;if(!s)throw new Error(`no components of type '${t}' in set`);return s}getById(e){return this._idDict[e]||null}findByName(e,t){const r=this.getArray(t);for(let t=0,s=r.length;t<s;++t)if(r[t].name===e)return r[t];return null}on(e,t,r){super.on(i.componentTypeName(e),t,r)}once(e,t,r){super.once(i.componentTypeName(e),t,r)}off(e,t,r){super.off(i.componentTypeName(e),t,r)}toString(e=!1){return e?this.getArray().map(e=>e.displayName).join("\n"):`components: ${this.length}, types: ${Object.keys(this._typeLists).length}`}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(63);class n extends s.default{constructor(){super(...arguments),this._innerGraph=null,this._innerRoot=null}get innerGraph(){return this._innerGraph}get innerRoot(){return this._innerRoot}set innerRoot(e){this._innerRoot=e}create(){this._innerGraph=new i.default(this.system,this)}update(e){return!1}tick(e){return this._innerGraph.tick(e)}finalize(e){return this._innerGraph.finalize(e)}dispose(){this._innerGraph.clear(),this._innerGraph=null,this._innerRoot=null,super.dispose()}inflate(e){super.inflate(e),this._innerGraph.inflate(e.graph)}deflate(){const e=super.deflate();return e.graph=this._innerGraph.deflate(),e}}n.type="CGraph",t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(20),n=.5*Math.PI,o=new s.Box3,a=new s.Vector3,l=new s.Vector3,c=new s.Vector3,d=new s.Matrix4,u=(new s.Matrix4,[new s.Vector3(0,-n,0),new s.Vector3(0,n,0),new s.Vector3(-n,0,0),new s.Vector3(n,0,0),new s.Vector3(0,0,0),new s.Vector3(0,Math.PI,0)]);var h,p;!function(e){e[e.Perspective=0]="Perspective",e[e.Orthographic=1]="Orthographic"}(h=t.EProjection||(t.EProjection={})),function(e){e[e.None=-1]="None",e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Top=2]="Top",e[e.Bottom=3]="Bottom",e[e.Front=4]="Front",e[e.Back=5]="Back"}(p=t.EViewPreset||(t.EViewPreset={}));t.default=class extends s.Camera{constructor(e){super(),this.isUniversalCamera=!0,this.fov=50,this.size=20,this.aspect=1,this.distance=20,this.zoom=1,this.near=.1,this.far=2e3,this.focus=10,this.filmGauge=35,this.filmOffset=0,this.view=null,this.setProjection(e)}setProjection(e){e===h.Orthographic?(this.type="OrthographicCamera",this.isPerspectiveCamera=!1,this.isOrthographicCamera=!0):(this.type="PerspectiveCamera",this.isPerspectiveCamera=!0,this.isOrthographicCamera=!1),this.updateProjectionMatrix()}getProjection(){return this.isOrthographicCamera?h.Orthographic:h.Perspective}setPreset(e){e!==p.None?(this.rotation.setFromVector3(u[e],"XYZ"),this.position.set(0,0,this.distance).applyQuaternion(this.quaternion)):(this.rotation.set(0,0,0),this.position.set(0,0,0)),this.updateMatrix()}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*s.Math.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*s.Math.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*s.Math.RAD2DEG*Math.atan(Math.tan(.5*s.Math.DEG2RAD*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,r,i,n,o){this.isPerspectiveCamera?s.PerspectiveCamera.prototype.setViewOffset.call(this,e,t,r,i,n,o):s.OrthographicCamera.prototype.setViewOffset.call(this,e,t,r,i,n,o)}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}zoomToView(){}moveToView(e){this.updateMatrixWorld(!1),o.copy(e),d.extractRotation(this.matrixWorldInverse),o.applyMatrix4(d),o.getSize(a),o.getCenter(l);const t=Math.max(a.x/this.aspect,a.y);c.set(-l.x,-l.y,0),this.isPerspectiveCamera?c.z=a.z/(2*Math.tan(this.fov*i.default.DEG2RAD*.5)):(this.size=.5*t,c.z=2*a.z,this.far=Math.max(this.far,2*c.z)),d.extractRotation(this.matrixWorld),c.applyMatrix4(d),this.matrix.decompose(this.position,this.quaternion,this.scale),this.position.copy(c),this.updateMatrix()}updateProjectionMatrix(){const e=this.near,t=this.far,r=this.aspect,i=this.zoom,n=this.view;if(this.isOrthographicCamera){const s=this.size,o=s/(2*i),a=o*r;let l=-a,c=a,d=o,u=-o;if(n&&n.enabled){const e=i/(n.width/n.fullWidth),t=i/(n.height/n.fullHeight),o=s*r/n.width,a=s/n.height;c=(l+=o*(n.offsetX/e))+o*(n.width/e),u=(d-=a*(n.offsetY/t))-a*(n.height/t)}this.projectionMatrix.makeOrthographic(l,c,d,u,e,t)}else{let a=e*Math.tan(.5*s.Math.DEG2RAD*this.fov)/i,l=2*a,c=r*l,d=-.5*c;n&&n.enabled&&(d+=n.offsetX*c/n.fullWidth,a-=n.offsetY*l/n.fullHeight,c*=n.width/n.fullWidth,l*=n.height/n.fullHeight);var o=this.filmOffset;0!==o&&(d+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(d,d+c,a,a-l,e,t)}this.projectionMatrixInverse.getInverse(this.projectionMatrix)}copy(e,t){return super.copy(e,t),this.type=e.type,this.isOrthographicCamera=e.isOrthographicCamera,this.isPerspectiveCamera=e.isPerspectiveCamera,this.fov=e.fov,this.size=e.size,this.aspect=e.aspect,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.view=e.view?Object.assign({},e.view):null,this}clone(){return(new this.constructor).copy(this)}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.size=this.size,t.object.aspect=this.aspect,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(3),i=r(49);t.EProjection=i.EProjection;const n=r(14),o=r(24),a={activate:s.types.Event("Activate"),position:s.types.Vector3("Transform.Position"),rotation:s.types.Vector3("Transform.Rotation"),projection:s.types.Enum("Projection.Type",i.EProjection,i.EProjection.Perspective),fov:s.types.Number("Projection.FovY",52),size:s.types.Number("Projection.Size",20),zoom:s.types.Number("Projection.Zoom",1),near:s.types.Number("Frustum.ZNear",.01),far:s.types.Number("Frustum.ZFar",1e4)};class l extends n.default{constructor(){super(...arguments),this.ins=this.addInputs(a)}get camera(){return this.object3D}get scene(){return this.graph.components.get(o.default)}create(){super.create(),this.object3D=new i.default;const e=this.scene;e&&!e.activeCameraComponent&&(e.activeCameraComponent=this)}update(){const{activate:e,position:t,rotation:r,projection:s,fov:i,size:n,zoom:o,near:a,far:l}=this.ins;if(e.changed){const e=this.scene;e&&(e.activeCameraComponent=this)}const c=this.camera;return(t.changed||r.changed)&&(c.position.fromArray(t.value),c.rotation.fromArray(r.value),c.updateMatrix()),s.changed&&c.setProjection(s.getValidatedValue()),c.fov=i.value,c.size=n.value,c.zoom=o.value,c.near=a.value,c.far=l.value,c.updateProjectionMatrix(),!0}dispose(){const e=this.scene;e&&e.activeCameraComponent===this&&(e.activeCameraComponent=null),super.dispose()}}l.type="CCamera",t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(66),n=r(70),o=r(96);var a,l;t.Asset=o.default,t.EAssetType=o.EAssetType,function(e){e[e.Web2D=0]="Web2D",e[e.Web3D=1]="Web3D",e[e.Print=2]="Print",e[e.Editorial=3]="Editorial"}(a=t.EDerivativeUsage||(t.EDerivativeUsage={})),function(e){e[e.Thumb=0]="Thumb",e[e.Low=1]="Low",e[e.Medium=2]="Medium",e[e.High=3]="High",e[e.Highest=4]="Highest",e[e.LOD=5]="LOD",e[e.Stream=6]="Stream"}(l=t.EDerivativeQuality||(t.EDerivativeQuality={}));t.default=class{constructor(e,t){this.id="",void 0===t?this.fromData(e):(this.usage=e,this.quality=t,this.assets=[]),this.model=null}dispose(){this.model&&i.disposeObject(this.model)}load(e,t){if(this.usage!==a.Web3D)throw new Error("can't load, not a Web3D derivative");console.log("Derivative.load - asset path: %s",t);const r=this.findAsset(o.EAssetType.Model);if(r)return e.loadModel(r,t).then(e=>(this.model&&i.disposeObject(this.model),this.model=e,e));const l=this.findAsset(o.EAssetType.Geometry),c=this.findAssets(o.EAssetType.Image);return l?e.loadGeometry(l,t).then(r=>(this.model=new s.Mesh(r,new n.default),Promise.all(c.map(r=>e.loadTexture(r,t))).catch(e=>(console.warn("failed to load texture files"),[])))).then(e=>{const t=this.model.material;return this.assignTextures(c,e,t),t.map||(t.color.setScalar(.5),t.roughness=.8,t.metalness=0),this.model}):void 0}createAsset(e,t){if(!t)throw new Error("uri must be specified");const r=new o.default(e,t);return this.assets.push(r),r}fromData(e){if(this.usage=a[e.usage],void 0===this.usage)throw new Error(`unknown derivative usage: ${e.usage}`);if(this.quality=l[e.quality],void 0===this.quality)throw new Error(`unknown derivative quality: ${e.quality}`);this.assets=e.assets.map(e=>new o.default(e))}toData(){return{usage:a[this.usage],quality:l[this.quality],assets:this.assets.map(e=>e.toData())}}toString(e=!1){return e?`Derivative - usage: '${a[this.usage]}', quality: '${l[this.quality]}'\n   `+this.assets.map(e=>e.toString()).join("\n   "):`Derivative - usage: '${a[this.usage]}', quality: '${l[this.quality]}', #assets: ${this.assets.length})`}findAsset(e){return this.assets.find(t=>t.type===e)}findAssets(e){return this.assets.filter(t=>t.type===e)}assignTextures(e,t,r){for(let s=0;s<e.length;++s){const i=e[s],n=t[s];switch(i.mapType){case o.EMapType.Color:r.map=n;break;case o.EMapType.Occlusion:r.aoMap=n;break;case o.EMapType.Emissive:r.emissiveMap=n;break;case o.EMapType.MetallicRoughness:r.metalnessMap=n,r.roughnessMap=n;break;case o.EMapType.Normal:r.normalMap=n}}}disposeMesh(e){e.geometry.dispose();const t=e.material;t.map&&t.map.dispose(),t.aoMap&&t.aoMap.dispose(),t.emissiveMap&&t.emissiveMap.dispose(),t.metalnessMap&&t.metalnessMap.dispose(),t.roughnessMap&&t.roughnessMap.dispose(),t.normalMap&&t.normalMap.dispose()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(3),i=r(0),n=r(39),o={visible:s.types.Boolean("Visible",!1),position:s.types.Enum("Position",n.EReaderPosition),url:s.types.String("DocumentURL","")};class a extends i.default{constructor(){super(...arguments),this.ins=this.addInputs(o)}setDocument(e){this.ins.url.setValue(e.uri)}fromData(e){this.ins.setValues({visible:e.visible,position:n.EReaderPosition[e.position]||n.EReaderPosition.Overlay,url:e.url})}toData(){const e=this.ins;return{visible:e.visible.value,position:n.EReaderPosition[e.position.value]||"Overlay",url:e.url.value}}}a.type="CVReader",t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=function(e,t){const r=document.createElement("a");r.download=t,r.href=e,document.body.appendChild(r),r.click(),document.body.removeChild(r)};t.default={text:function(e,t){const r=window.URL.createObjectURL(new Blob([e],{type:"text/plain"}));s(r,t)},json:function(e,t){"object"==typeof e&&(e=JSON.stringify(e));const r=window.URL.createObjectURL(new Blob([e],{type:"text/json"}));s(r,t)},url:function(e,t){s(e,t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(9),i=r(0),n=r(26),o=r(199),a=r(200);class l extends i.default{constructor(){super(...arguments),this.annotations={},this.groups={}}get model(){return this.node.components.get(n.default)}createAnnotation(e,t,r=-1){const i=new o.default(s.default(6,this.annotations));return i.position=e,i.direction=t,i.zoneIndex=r,this.addAnnotation(i),i}getAnnotations(){return Object.keys(this.annotations).map(e=>this.annotations[e])}getAnnotationById(e){return this.annotations[e]}addAnnotation(e){this.annotations[e.id]=e,this.emit({type:"annotation",add:!0,remove:!1,annotation:e})}removeAnnotation(e){delete this.annotations[e.id],this.emit({type:"annotation",add:!1,remove:!0,annotation:e})}createGroup(){const e=new a.default(s.default(6,this.groups));return this.addGroup(e),e}getGroups(){return Object.keys(this.groups).map(e=>this.groups[e])}getGroupById(e){return this.groups[e]}addGroup(e){this.groups[e.id]=e,this.emit({type:"group",add:!0,remove:!1,group:e})}removeGroup(e){delete this.groups[e.id],this.emit({type:"group",add:!1,remove:!0,group:e})}deflate(){const e=this.toData();return e?{data:e}:null}inflate(e){e.data&&this.fromData(e)}toData(){let e=null;const t=Object.keys(this.annotations);t.length>0&&((e=e||{}).annotations=t.map(e=>this.annotations[e].deflate()));const r=Object.keys(this.groups);return r.length>0&&((e=e||{}).groups=r.map(e=>this.groups[e].deflate())),e}fromData(e){e.annotations&&e.annotations.forEach(e=>this.addAnnotation(new o.default(e.id).inflate(e))),e.groups&&e.groups.forEach(e=>this.addGroup(new a.default(e.id).inflate(e)))}}l.type="CVAnnotations",t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(23),i=r(41);class n extends s.default{get light(){return this.components.get(i.default)}}n.type="NLight",t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(13),i=r(23),n=r(108),o=r(110),a=r(111),l=r(30),c=r(52),d=r(112),u=r(113),h=r(40),p=r(25);class f extends i.default{constructor(){super(...arguments),this._isActive=!1,this._data={navigation:null,interface:null,reader:null}}get renderer(){return this.system.graph.components.safeGet(s.default)}get interface(){return this.system.graph.components.safeGet(l.default)}get reader(){return this.system.graph.components.safeGet(c.default)}get navigation(){return this.system.graph.components.safeGet(h.default)}get scene(){return this.graph.components.safeGet(p.default)}get background(){return this.components.safeGet(o.default)}get groundPlane(){return this.components.safeGet(a.default)}get homeGrid(){return this.components.safeGet(n.default)}get tapeTool(){return this.components.safeGet(d.default)}get sectionTool(){return this.components.safeGet(u.default)}createComponents(){super.createComponents(),this.createComponent(o.default),this.createComponent(a.default),this.createComponent(n.default),this.createComponent(d.default),this.createComponent(u.default),this.name="Setup",this.renderer.on("active-scene",this.onActiveScene,this)}dispose(){this.renderer.off("active-scene",this.onActiveScene,this),super.dispose()}toData(){const e={};this._isActive&&(this._data.navigation=this.navigation.toData(),this._data.interface=this.interface.toData(),this._data.reader=this.reader.toData()),e.navigation=this._data.navigation,e.interface=this._data.interface,e.reader=this._data.reader;const t=this.navigation.toData();t&&(e.navigation=t);const r=this.interface.toData();r&&(e.interface=r);const s=this.reader.toData();s&&(e.reader=s);const i=this.scene.toData();i&&(e.scene=i);const n=this.background.toData();n&&(e.background=n);const o=this.groundPlane.toData();o&&(e.groundPlane=o);const a=this.homeGrid.toData();a&&(e.grid=a);const l=this.tapeTool.toData();l&&(e.tapeTool=l);const c=this.sectionTool.toData();return c&&(e.sectionTool=c),e}fromData(e){this._data.navigation=e.navigation?Object.assign({},e.navigation):null,this._data.interface=e.interface?Object.assign({},e.interface):null,this._data.reader=e.reader?Object.assign({},e.reader):null,e.scene&&this.scene.fromData(e.scene),e.background&&this.background.fromData(e.background),e.groundPlane&&this.groundPlane.fromData(e.groundPlane),e.grid&&this.homeGrid.fromData(e.grid),e.tapeTool&&this.tapeTool.fromData(e.tapeTool),e.sectionTool&&this.sectionTool.fromData(e.sectionTool),this._isActive&&this.pushToGlobal()}onActiveScene(e){e.previous&&e.previous.graph===this.graph&&(this.pullFromGlobal(),this._isActive=!1),e.next&&e.next.graph===this.graph&&(this.pushToGlobal(),this._isActive=!0)}pushToGlobal(){this._data.navigation&&this.navigation.fromData(this._data.navigation),this._data.interface&&this.interface.fromData(this._data.interface),this._data.reader&&this.reader.fromData(this._data.reader)}pullFromGlobal(){this._data.navigation=this.navigation.toData(),this._data.interface=this.interface.toData(),this._data.reader=this.reader.toData()}}f.type="NVPresentationConfig",t.default=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0);class i extends s.default{constructor(e){super(e),this._material=null,this.addEvent("material")}get material(){return this._material}set material(e){this._material=e,this.emit("material",e)}}i.type="CMaterial",t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0);class i extends s.default{constructor(e){super(e),this._geometry=null,this.addEvent("geometry")}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.emit("geometry",e)}}i.type="CGeometry",t.default=i},function(e,t,r){"use strict";var s,i=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const n=r(1);let o=s=class extends n.default{constructor(){super(),this.anchor=null,this.portal=null,this.position=void 0,this.align=void 0,this.justify=void 0,this.positionX=0,this.positionY=0,this.offsetX=0,this.offsetY=0,this.keepVisible=!1,this.onResize=this.onResize.bind(this),this.onPointerDown=this.onPointerDown.bind(this)}connected(){this.calculatePosition(),window.addEventListener("resize",this.onResize),document.addEventListener("pointerdown",this.onPointerDown,{capture:!0,passive:!0})}disconnected(){window.removeEventListener("resize",this.onResize),document.removeEventListener("pointerdown",this.onPointerDown)}firstUpdated(){this.setStyle({position:"fixed",zIndex:"1000"}),this.classList.add("ff-popup")}updated(){this.isConnected&&this.calculatePosition()}calculatePosition(){let e,t;const r=this.getBoundingClientRect();let s;if(t=this.portal?this.portal.getBoundingClientRect():{left:0,top:0,right:window.innerWidth,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight},"center"===this.position)s=this.center(r,t);else if("anchor"===this.position){const i=this.anchor||this.parentElement;i&&(e=i.getBoundingClientRect(),s=this.positionToAnchor(r,e,t))}else s={x:this.positionX,y:this.positionY};this.keepVisible&&"center"!==this.position&&(s=this.keepFloaterVisible(s,r,t)),this.style.left=Math.round(s.x)+"px",this.style.top=Math.round(s.y)+"px"}center(e,t){return{x:Math.round(.5*(t.width-e.width)),y:Math.round(.5*(t.height-e.height))}}positionToAnchor(e,t,r){const s=this.align,i=this.justify,n=this.offsetX,o=this.offsetY,a={x:0,y:0};switch(s){case"start":a.x="start"!==i&&"end"!==i?t.left-e.width-n:t.left;break;case"end":a.x="start"!==i&&"end"!==i?t.right+n:t.right-e.width;break;case"fixed":a.x=this.positionX;break;default:a.x=t.left+.5*(t.width-e.width)}switch(i){case"start":a.y=t.top-e.height-o;break;case"end":a.y=t.bottom+o;break;case"fixed":a.y=this.positionY;break;default:a.y=t.top+.5*(t.height-e.height)}return a.x+=this.offsetX,a.y+=this.offsetY,a}keepFloaterVisible(e,t,r){const s=this.offsetX,i=this.offsetY;return t.width>r.width?e.x=.5*(r.width-t.width):e.x<r.left+s?e.x=r.left+s:e.x+t.width+s>r.right&&(e.x=r.right-t.width-s),t.height>r.height?e.y=.5*(r.height-t.height):e.y<r.top+i?e.y=r.top+i:e.y+t.height+i>r.bottom&&(e.y=r.bottom-t.height-i),e}onResize(){this.calculatePosition()}onPointerDown(e){e.target instanceof Node&&this.contains(e.target)||this.dispatchEvent(new CustomEvent(s.closeEvent))}};o.closeEvent="ff-close",i([n.property({attribute:!1})],o.prototype,"anchor",void 0),i([n.property({attribute:!1})],o.prototype,"portal",void 0),i([n.property({type:String})],o.prototype,"position",void 0),i([n.property({type:String})],o.prototype,"align",void 0),i([n.property({type:String})],o.prototype,"justify",void 0),i([n.property({type:Number})],o.prototype,"positionX",void 0),i([n.property({type:Number})],o.prototype,"positionY",void 0),i([n.property({type:Number})],o.prototype,"offsetX",void 0),i([n.property({type:Number})],o.prototype,"offsetY",void 0),i([n.property({type:Boolean})],o.prototype,"keepVisible",void 0),o=s=i([n.customElement("ff-popup")],o),t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const r=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);if(r)return r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):""}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(133),i=r(10),n=r(86),o=r(134),a=r(3);t.schemas=a.schemas,t.types=a.types;t.default=class extends i.default{constructor(e,t,r){if(super(),this.addEvents("value","link","change","dispose"),!t||void 0===t.preset)throw new Error("missing schema/preset");const s=t.preset,i=Array.isArray(s);this.type=typeof(i?s[0]:s),this.schema=t,this.user=r||!1,this.elementCount=i?s.length:1,this.inLinks=[],this.outLinks=[],this._group=null,this._key="",this._path=e,this.value=null,this.reset(),this.changed=!t.event}get group(){return this._group}get key(){return this._key}get path(){return this._path}set path(e){this._path=e,this.emit({type:"change",what:"path",property:this})}attach(e,t,r){e._addProperty(this,t,r)}detach(){this._group&&this._group._removeProperty(this)}dispose(){this.unlink(),this.detach(),this.emit({type:"dispose",property:this})}setValue(e,t){this.value=e,t||(this.changed=!0,this.isInput()&&(this._group.linkable.changed=!0)),this.emit("value",e);const r=this.outLinks;for(let e=0,t=r.length;e<t;++e)r[e].push()}copyValue(e,t){Array.isArray(e)&&(e=e.slice()),this.setValue(e,t)}set(e){e||(this.changed=!0,this.isInput()&&(this._group.linkable.changed=!0)),this.emit("value",this.value);const t=this.outLinks;for(let e=0,r=t.length;e<r;++e)t[e].push()}cloneValue(){const e=this.value;return Array.isArray(e)?e.slice():e}getValidatedValue(e){const t=this.value;if(this.isArray()){e=e||[];for(let r=0,s=t.length;r<s;++r)e[r]=this.validateValue(t[r]);return e}return this.validateValue(t)}linkTo(e,t,r){e.linkFrom(this,t,r)}linkFrom(e,t,r){if(!this.canLinkFrom(e,t,r))throw new Error("can't link");const s=new o.default(e,this,t,r);e.addOutLink(s),this.addInLink(s)}unlinkTo(e,t,r){e.unlinkFrom(this,t,r)}unlinkFrom(e,t,r){const s=this.inLinks.find(s=>s.source===e&&s.sourceIndex===t&&s.destinationIndex===r);return!!s&&(e.removeOutLink(s),this.removeInLink(s),!0)}unlink(){if(this.inLinks.slice().forEach(e=>{e.source.removeOutLink(e),this.removeInLink(e)}),this.outLinks.slice().forEach(e=>{this.removeOutLink(e),e.destination.removeInLink(e)}),0!==this.inLinks.length||0!==this.outLinks.length)throw new Error("fatal: leftover links")}addInLink(e){if(e.destination!==this)throw new Error("input link's destination must equal this");this.inLinks.push(e),this.requestSort(),this.emit({type:"link",add:!0,remove:!1,link:e})}addOutLink(e){if(e.source!==this)throw new Error("output link's source must equal this");this.outLinks.push(e),this.requestSort(),e.push()}removeInLink(e){const t=this.inLinks.indexOf(e);if(t<0)throw new Error("input link not found");this.inLinks.splice(t,1),this.requestSort(),0===this.inLinks.length&&"object"===this.type&&this.reset(),this.emit({type:"link",add:!1,remove:!0,link:e})}removeOutLink(e){const t=this.outLinks.indexOf(e);if(t<0)throw new Error("output link not found");this.outLinks.splice(t,1),this.requestSort()}canLinkTo(e,t,r){return e.canLinkFrom(this,t,r)}canLinkFrom(e,t,r){if(this.isOutput())return!1;const i=t>=0,o=r>=0;if(!e.isArray()&&i)throw new Error("non-array source property; can't link to element");if(!this.isArray()&&o)throw new Error("non-array destination property; can't link to element");const a=e.isArray()&&!i;return a===(this.isArray()&&!o)&&(!a||e.elementCount===this.elementCount)&&!("object"===e.type&&"object"===this.type&&!s.default(e.schema.objectType,this.schema.objectType))&&n.canConvert(e.type,this.type)}reset(){let e;if(this.isMulti()){let t=this.value;t?t.length=1:e=t=[],t[0]=this.clonePreset()}else e=this.clonePreset();this.setValue(e)}setMultiChannelCount(e){if(!this.isMulti())throw new Error("can't set multi channel count on non-multi property");const t=this.value,r=t.length;t.length=e;for(let s=r;s<e;++s)t[s]=this.clonePreset();this.changed=!0}requestSort(){this._group&&this._group.linkable&&this._group.linkable.requestSort()}setOptions(e){if(!this.schema.options)throw new Error(`property type mismatch, can't set options on '${this.path}'`);this.schema.options=e.slice(),this.emit({type:"change",what:"options",property:this})}getOptionText(){const e=this.schema.options;if("number"===this.type&&e){const t=Math.trunc(this.value);return e[t<0?0:t>=e.length?0:t]||""}}isInput(){return this._group&&this._group===this._group.linkable.ins}isOutput(){return this._group&&this._group===this._group.linkable.outs}isArray(){return Array.isArray(this.schema.preset)}isMulti(){return!!this.schema.multi}isDefault(){const e=this.schema.multi?this.value[0]:this.value,t=this.schema.preset,r=Array.isArray(e)?e.length:-1;if(r!==(Array.isArray(t)?t.length:-1))return!1;if(r>=0){for(let s=0;s<r;++s)if(e[s]!==t[s])return!1;return!0}return e===t}hasInLinks(e){const t=this.inLinks;if(!(e>=0))return t.length>0;for(let r=0,s=t.length;r<s;++r)if(t[r].destinationIndex===e)return!0;return!1}hasMainInLinks(){const e=this.inLinks;for(let t=0,r=e.length;t<r;++t)if(!(e[t].destinationIndex>=0))return!0;return!1}hasOutLinks(e){const t=this.outLinks;if(!(e>=0))return t.length>0;for(let r=0,s=t.length;r<s;++r)if(t[r].sourceIndex===e)return!0;return!1}inLinkCount(){return this.inLinks.length}outLinkCount(){return this.outLinks.length}deflate(){let e=this.user?{path:this.path,schema:Object.assign({},this.schema)}:null;return this.isOutput()||this.hasMainInLinks()||this.isDefault()||"object"===this.type||((e=e||{}).value=this.value),this.outLinks.length>0&&((e=e||{}).links=this.outLinks.map(e=>{const t={id:e.destination._group.linkable.id,key:e.destination.key};return e.sourceIndex>=0&&(t.srcIndex=e.sourceIndex),e.destinationIndex>=0&&(t.dstIndex=e.destinationIndex),t})),e}inflate(e,t){void 0!==e.value&&(this.value=e.value),void 0!==e.links&&e.links.forEach(e=>{t[e.id].ins[e.key].linkFrom(this,e.srcIndex,e.dstIndex)})}toString(){const e=this.schema,t=e.event?"event":e.options?"enum":this.type;return`${this.path} [${t}]`}validateValue(e){const t=this.schema;if(t.enum){const r=Math.trunc(e);return t.enum[r]?r:0}if(t.options){const r=Math.trunc(e);return r<0?0:r>=t.options.length?0:r}return"number"===this.type?(e=t.min?Math.max(t.min,e):e,e=t.max?Math.min(t.max,e):e):e}clonePreset(){const e=this.schema.preset;return Array.isArray(e)?e.slice():e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(10),i=r(19),n=[];t.default=class extends s.default{constructor(){super({knownEvents:!1}),this._typeLists={[i.default.type]:[]},this._idDict={}}_add(e){if(void 0!==this._idDict[e.id])throw new Error("node already in set");this._idDict[e.id]=e;let t=e;const r={type:"",add:!0,remove:!1,node:e};do{const s=(t=Object.getPrototypeOf(t)).type;(this._typeLists[s]||(this._typeLists[s]=[])).push(e),r.type=s,this.emit(r)}while(t.type!==i.default.type)}_remove(e){if(this._idDict[e.id]!==e)throw new Error("node not in set");delete this._idDict[e.id];let t=e;const r={type:"",add:!1,remove:!0,node:e};do{const s=(t=Object.getPrototypeOf(t)).type,i=this._typeLists[s];i.splice(i.indexOf(e),1),r.type=s,this.emit(r)}while(t.type!==i.default.type)}_clear(){this.cloneArray().forEach(e=>this._remove(e))}get length(){return this._typeLists[i.default.type].length}has(e){const t=this._typeLists[i.nodeTypeName(e)];return t&&t.length>0}contains(e){return!!this._idDict[e.id]}count(e){const t=this._typeLists[i.nodeTypeName(e)];return t?t.length:0}getDictionary(){return this._idDict}getArray(e){return this._typeLists[i.nodeTypeName(e)]||n}cloneArray(e){return this.getArray(e).slice()}get(e){const t=this._typeLists[i.nodeTypeName(e)];return t?t[0]:void 0}safeGet(e){const t=i.nodeTypeName(e),r=this._typeLists[t],s=r?r[0]:void 0;if(!s)throw new Error(`no nodes of type '${t}' in set`);return s}getById(e){return this._idDict[e]||null}findByName(e,t){const r=this.getArray(t);for(let t=0,s=r.length;t<s;++t)if(r[t].name===e)return r[t];return null}findRoots(e){const t=this._typeLists[i.nodeTypeName(e)],r=[];for(let e=0,s=t.length;e<s;++e){const s=t[e].components.get("CHierarchy");s&&s.parent||r.push(t[e])}return r}on(e,t,r){super.on(i.nodeTypeName(e),t,r)}once(e,t,r){super.once(i.nodeTypeName(e),t,r)}off(e,t,r){super.off(i.nodeTypeName(e),t,r)}toString(e=!1){return e?this.getArray().map(e=>e.displayName).join("\n"):`nodes: ${this.length}, types: ${Object.keys(this._typeLists).length}`}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(9),i=r(10),n=r(138),o=r(47),a=r(19),l=r(62);t.default=class extends i.default{constructor(e,t){super({knownEvents:!1}),this.nodes=new l.default,this.components=new o.default,this._sorter=new n.default,this._sortRequested=!0,this._sortedList=null,this._finalizeList=[],this.system=e,this.parent=t}set root(e){this._root=e,this.parent&&(this.parent.innerRoot=e)}get root(){return this._root}tick(e){this._sortRequested&&(this._sortRequested=!1,this.sort());const t=this._sortedList;let r=!1;for(let s=0,i=t.length;s<i;++s){const i=t[s];i.updated=!1,i.changed&&(i.update&&i.update(e)&&(r=i.updated=!0),i.resetChanged()),i.tick&&i.tick(e)&&(r=!0)}return r}finalize(e){const t=this._finalizeList;for(let r=0,s=t.length;r<s;++r)t[r].finalize(e)}clear(){const e=this.nodes.cloneArray();for(let t=0,r=e.length;t<r;++t)e[t].dispose()}requestSort(){this._sortRequested=!0}sort(){this._sortedList=this._sorter.sort(this.components.getArray());const e=this.parent?this.parent.name||this.parent.type:"System";console.log("Graph.sort - %s: sorted %s components",e,this._sortedList.length)}createCustomNode(e,t,r){const i=new(this.system.registry.getNodeType(a.nodeTypeName(e)))(r||s.default(12,this.system.nodes.getDictionary()));return i.attach(this),t&&(i.name=t),r||i.createComponents(),i}createNode(e,t){const r=new a.default(t||s.default(12,this.system.nodes.getDictionary()));return r.attach(this),e&&(r.name=e),r}toString(e=!1){const t=this.nodes.getArray(),r=this.components.count(),s=`Graph - ${t.length} nodes, ${r} components.`;return e?s+"\n"+t.map(e=>e.toString(!0)).join("\n"):s}deflate(){const e={},t=[],r=this.nodes.getArray();for(let e=0,s=r.length;e<s;++e){const s=r[e],i=this.deflateNode(s);i.type=s.type,i.id=s.id,s.name&&(i.name=s.name),t.push(i)}return t.length>0&&(e.nodes=t),e}inflate(e){e.nodes&&e.nodes.forEach(e=>{this.createCustomNode(e.type,e.name,e.id).inflate(e)})}inflateReferences(e){e.nodes&&e.nodes.forEach(e=>{this.nodes.getById(e.id).inflateReferences(e)})}deflateNode(e){return e.deflate()}_addNode(e){this.system._addNode(e),this.nodes._add(e)}_removeNode(e){this.nodes._remove(e),this.system._removeNode(e)}_addComponent(e){if(e.isGraphSingleton&&this.components.has(e))throw new Error(`only one component of type '${e.type}' allowed per graph`);this.system._addComponent(e),this.components._add(e),e.finalize&&this._finalizeList.push(e),this._sortRequested=!0}_removeComponent(e){this.components._remove(e),this.system._removeComponent(e),e.finalize&&this._finalizeList.splice(this._finalizeList.indexOf(e),1),this._sortRequested=!0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0);class i extends s.default{constructor(e){super(e),this.addEvent("pulse"),this.onAnimationFrame=this.onAnimationFrame.bind(this),this.context={time:new Date,secondsElapsed:0,secondsDelta:0,frameNumber:0},this._secondsStarted=.001*Date.now(),this._secondsStopped=this._secondsStarted,this._animHandler=0,this._pulseEvent={type:"pulse",context:this.context}}start(){0===this._animHandler&&(this._secondsStopped>0&&(this._secondsStarted+=.001*Date.now()-this._secondsStopped,this._secondsStopped=0),this._animHandler=window.requestAnimationFrame(this.onAnimationFrame))}stop(){0!==this._animHandler&&(0===this._secondsStopped&&(this._secondsStopped=.001*Date.now()),window.cancelAnimationFrame(this._animHandler),this._animHandler=0)}pulse(e){const t=this.context;t.time.setTime(e);const r=.001*e-this._secondsStarted;t.secondsDelta=r-t.secondsElapsed,t.secondsElapsed=r,t.frameNumber++,this.system.graph.tick(this.context),this.emit(this._pulseEvent),this.system.graph.finalize(this.context)}onAnimationFrame(){this.pulse(Date.now()),this._animHandler=window.requestAnimationFrame(this.onAnimationFrame)}}i.type="CPulse",i.isSystemSingleton=!0,t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(87),n=r(12),o=r(139),a=r(14),l=r(28),c=r(24),d={bracketsVisible:s.types.Boolean("Brackets.Visible",!0)};class u extends n.default{constructor(){super(...arguments),this.ins=this.addInputs(d),this.startX=0,this.startY=0,this._brackets=new Map,this._sceneTracker=null}create(){super.create(),this.system.on("pointer-down",this.onPointerDown,this),this.system.on("pointer-up",this.onPointerUp,this)}dispose(){this.system.off("pointer-down",this.onPointerDown,this),this.system.off("pointer-up",this.onPointerUp,this),this._sceneTracker.dispose(),super.dispose()}update(){return!0}onSelectNode(e,t){super.onSelectNode(e,t);const r=e.components.get(l.default);r&&this.updateBracket(r,t)}onSelectComponent(e,t){super.onSelectComponent(e,t),(e instanceof a.default||e instanceof l.default)&&this.updateBracket(e,t)}onActiveGraph(e){this._sceneTracker&&this._sceneTracker.dispose(),e&&(this._sceneTracker=new i.default(e.components,c.default,e=>{e.on("after-render",this.onSceneAfterRender,this)},e=>{e.off("after-render",this.onSceneAfterRender,this)}))}onPointerDown(e){e.isPrimary&&(this.startX=e.centerX,this.startY=e.centerY)}onPointerUp(e){if(e.isPrimary){Math.abs(this.startX-e.centerX)+Math.abs(this.startY-e.centerY)<2&&(e.component?this.selectComponent(e.component,e.ctrlKey):e.ctrlKey||this.clearSelection())}}onSceneAfterRender(e){const t=e.context.renderer,r=e.context.camera;if(this.ins.bracketsVisible.value)for(let e of this._brackets)t.render(e[1],r)}updateBracket(e,t){if(e)if(t){if(e.object3D){const t=new o.default(e.object3D);this._brackets.set(e,t)}}else{const t=this._brackets.get(e);t&&(this._brackets.delete(e),t.dispose())}}}u.type="CPickSelection",t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=new s.Vector3,n=new s.Matrix4,o=new s.Euler;new s.Quaternion;t.degreesToQuaternion=function(e,t,r){const n=r||new s.Quaternion;return i.fromArray(e).multiplyScalar(s.Math.DEG2RAD),o.setFromVector3(i,t),n.setFromEuler(o,!1),n},t.quaternionToDegrees=function(e,t,r){const n=r||[0,0,0];return o.setFromQuaternion(e,t,!1),o.toVector3(i),i.multiplyScalar(s.Math.RAD2DEG).toArray(n),n},t.disposeObject=function(e){const t=new Map,r=new Map,s=new Map;e.traverse(e=>{const i=e;if(i.isMesh){const e=i.geometry;e&&t.set(e.uuid,e);const n=i.material;if(n){r.set(n.uuid,n);for(let e in n){const t=n[e];t&&t.isTexture&&s.set(t.uuid,t)}}}});for(let e of s)e[1].dispose();for(let e of r)e[1].dispose();for(let e of t)e[1].dispose()},t.computeLocalBoundingBox=function e(t,r,s){s||(s=t);const o=t.geometry;if(o&&t.visible){let e=t;for(n.identity();e&&e!==s;)n.premultiply(e.matrix),e=e.parent;if(o.isGeometry){const e=o.vertices;for(let t=0,s=e.length;t<s;++t)i.copy(e[t]).applyMatrix4(n),r.expandByPoint(i)}else if(o.isBufferGeometry){const e=o.attributes.position;if(void 0!==e)for(let t=0,s=e.count;t<s;++t)i.fromBufferAttribute(e,t).applyMatrix4(n),r.expandByPoint(i)}}const a=t.children;for(let t=0,i=a.length;t<i;++t)e(a[t],r,s)}},function(e,t,r){"use strict";var s=r(144),i=r(68),n=r(29),o=r(88),a=r(146);function l(e,t,r){var s=this._refs[r];if("string"==typeof s){if(!this._refs[s])return l.call(this,e,t,s);s=this._refs[s]}if((s=s||this._schemas[r])instanceof o)return p(s.schema,this._opts.inlineRefs)?s.schema:s.validate||this._compile(s);var i,n,a,d=c.call(this,t,r);return d&&(i=d.schema,t=d.root,a=d.baseId),i instanceof o?n=i.validate||e.call(this,i.schema,t,void 0,a):void 0!==i&&(n=p(i,this._opts.inlineRefs)?i:e.call(this,i,t,void 0,a)),n}function c(e,t){var r=s.parse(t),i=m(r),n=f(this._getId(e.schema));if(0===Object.keys(e.schema).length||i!==n){var a=y(i),l=this._refs[a];if("string"==typeof l)return function(e,t,r){var s=c.call(this,e,t);if(s){var i=s.schema,n=s.baseId;e=s.root;var o=this._getId(i);return o&&(n=g(n,o)),u.call(this,r,n,i,e)}}.call(this,e,l,r);if(l instanceof o)l.validate||this._compile(l),e=l;else{if(!((l=this._schemas[a])instanceof o))return;if(l.validate||this._compile(l),a==y(t))return{schema:l,root:e,baseId:n};e=l}if(!e.schema)return;n=f(this._getId(e.schema))}return u.call(this,r,n,e.schema,e)}e.exports=l,l.normalizeId=y,l.fullPath=f,l.url=g,l.ids=function(e){var t=y(this._getId(e)),r={"":t},o={"":f(t,!1)},l={},c=this;return a(e,{allKeys:!0},function(e,t,a,d,u,h,p){if(""!==t){var f=c._getId(e),m=r[d],v=o[d]+"/"+u;if(void 0!==p&&(v+="/"+("number"==typeof p?p:n.escapeFragment(p))),"string"==typeof f){f=m=y(m?s.resolve(m,f):f);var g=c._refs[f];if("string"==typeof g&&(g=c._refs[g]),g&&g.schema){if(!i(e,g.schema))throw new Error('id "'+f+'" resolves to more than one schema')}else if(f!=y(v))if("#"==f[0]){if(l[f]&&!i(e,l[f]))throw new Error('id "'+f+'" resolves to more than one schema');l[f]=e}else c._refs[f]=v}r[t]=m,o[t]=v}}),l},l.inlineRef=p,l.schema=c;var d=n.toHash(["properties","patternProperties","enum","dependencies","definitions"]);function u(e,t,r,s){if(e.fragment=e.fragment||"","/"==e.fragment.slice(0,1)){for(var i=e.fragment.split("/"),o=1;o<i.length;o++){var a=i[o];if(a){if(void 0===(r=r[a=n.unescapeFragment(a)]))break;var l;if(!d[a]&&((l=this._getId(r))&&(t=g(t,l)),r.$ref)){var u=g(t,r.$ref),h=c.call(this,s,u);h&&(r=h.schema,s=h.root,t=h.baseId)}}}return void 0!==r&&r!==s.schema?{schema:r,root:s,baseId:t}:void 0}}var h=n.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]);function p(e,t){return!1!==t&&(void 0===t||!0===t?function e(t){var r;if(Array.isArray(t)){for(var s=0;s<t.length;s++)if("object"==typeof(r=t[s])&&!e(r))return!1}else for(var i in t){if("$ref"==i)return!1;if("object"==typeof(r=t[i])&&!e(r))return!1}return!0}(e):t?function e(t){var r,s=0;if(Array.isArray(t)){for(var i=0;i<t.length;i++)if("object"==typeof(r=t[i])&&(s+=e(r)),s==1/0)return 1/0}else for(var n in t){if("$ref"==n)return 1/0;if(h[n])s++;else if("object"==typeof(r=t[n])&&(s+=e(r)+1),s==1/0)return 1/0}return s}(e)<=t:void 0)}function f(e,t){return!1!==t&&(e=y(e)),m(s.parse(e))}function m(e){return s.serialize(e).split("#")[0]+"#"}var v=/#\/?$/;function y(e){return e?e.replace(v,""):""}function g(e,t){return t=y(t),s.resolve(e,t)}},function(e,t,r){"use strict";var s=Array.isArray,i=Object.keys,n=Object.prototype.hasOwnProperty;e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){var o,a,l,c=s(t),d=s(r);if(c&&d){if((a=t.length)!=r.length)return!1;for(o=a;0!=o--;)if(!e(t[o],r[o]))return!1;return!0}if(c!=d)return!1;var u=t instanceof Date,h=r instanceof Date;if(u!=h)return!1;if(u&&h)return t.getTime()==r.getTime();var p=t instanceof RegExp,f=r instanceof RegExp;if(p!=f)return!1;if(p&&f)return t.toString()==r.toString();var m=i(t);if((a=m.length)!==i(r).length)return!1;for(o=a;0!=o--;)if(!n.call(r,m[o]))return!1;for(o=a;0!=o--;)if(!e(t[l=m[o]],r[l]))return!1;return!0}return t!=t&&r!=r}},function(e,t,r){"use strict";var s=r(67);function i(e,t,r){this.message=r||i.message(e,t),this.missingRef=s.url(e,t),this.missingSchema=s.normalizeId(s.fullPath(this.missingRef))}function n(e){return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}e.exports={Validation:n(function(e){this.message="validation failed",this.errors=e,this.ajv=this.validation=!0}),MissingRef:n(i)},i.message=function(e,t){return"can't resolve reference "+t+" from id "+e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(189),n=r(190),o=r(39);t.EShaderMode=o.EShaderMode;t.default=class extends s.MeshStandardMaterial{constructor(e){super(),this._clayColor=new s.Color("#a67a6c"),this._paramCopy={},this._sideCopy=s.FrontSide,this.type="UberPBRMaterial",this.isUberPBRMaterial=!0,this.isMeshStandardMaterial=!0,this.isMeshPhysicalMaterial=!1,this.defines={STANDARD:!0,PHYSICAL:!1,OBJECTSPACE_NORMALMAP:!1,MODE_NORMALS:!1,MODE_XRAY:!1,CUT_PLANE:!1},this.uniforms=s.UniformsUtils.merge([s.ShaderLib.standard.uniforms,{aoMapMix:{value:new s.Vector3(.25,.25,.25)},cutPlaneDirection:{value:new s.Vector4(0,0,-1,0)},cutPlaneColor:{value:new s.Vector3(1,0,0)}}]),this._aoMapMix=this.uniforms.aoMapMix.value,this._cutPlaneDirection=this.uniforms.cutPlaneDirection.value,this._cutPlaneColor=this.uniforms.cutPlaneColor.value,this.vertexShader=n,this.fragmentShader=i,this.color=new s.Color(16777215),this.roughness=.7,this.metalness=0,e&&this.setValues(e)}set cutPlaneDirection(e){this._cutPlaneDirection.copy(e)}get cutPlaneDirection(){return this._cutPlaneDirection}set cutPlaneColor(e){this._cutPlaneColor.copy(e)}get cutPlaneColor(){return this._cutPlaneColor}set aoMapMix(e){this._aoMapMix.copy(e)}get aoMapMix(){return this._aoMapMix}setShaderMode(e){switch(Object.assign(this,this._paramCopy),this.defines.MODE_NORMALS=!1,this.defines.MODE_XRAY=!1,this.needsUpdate=!0,e){case o.EShaderMode.Clay:this._paramCopy={color:this.color,map:this.map,roughness:this.roughness,metalness:this.metalness,aoMapIntensity:this.aoMapIntensity,blending:this.blending,transparent:this.transparent,depthWrite:this.depthWrite},this.color=this._clayColor,this.map=null,this.roughness=1,this.metalness=0,this.aoMapIntensity*=1,this.blending=s.NoBlending,this.transparent=!1,this.depthWrite=!0;break;case o.EShaderMode.Normals:this._paramCopy={blending:this.blending,transparent:this.transparent,depthWrite:this.depthWrite},this.defines.MODE_NORMALS=!0,this.blending=s.NoBlending,this.transparent=!1,this.depthWrite=!0;break;case o.EShaderMode.XRay:this._paramCopy={side:this.side,blending:this.blending,transparent:this.transparent,depthWrite:this.depthWrite},this.defines.MODE_XRAY=!0,this.side=s.DoubleSide,this.blending=s.AdditiveBlending,this.transparent=!0,this.depthWrite=!1;break;case o.EShaderMode.Wireframe:this._paramCopy={wireframe:this.wireframe},this.wireframe=!0}}enableCutPlane(e){this.defines.CUT_PLANE=e,e?(this._sideCopy=this.side,this.side=s.DoubleSide):this.side=this._sideCopy}enableObjectSpaceNormalMap(e){this.defines.OBJECTSPACE_NORMALMAP!==e&&(this.needsUpdate=!0),this.defines.OBJECTSPACE_NORMALMAP=e}copyStandardMaterial(e){return this.color=e.color,this.roughness=e.roughness,this.roughnessMap=e.roughnessMap,this.metalness=e.metalness,this.metalnessMap=e.metalnessMap,this.map=e.map,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.normalMap=e.normalMap,this}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(20),n=r(195),o=r(49);t.EProjection=o.EProjection;const a=new s.Vector3,l=new s.Vector3;var c,d;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Top=2]="Top",e[e.Bottom=3]="Bottom",e[e.Front=4]="Front",e[e.Back=5]="Back",e[e.None=6]="None"}(t.EViewPreset||(t.EViewPreset={})),function(e){e[e.Off=0]="Off",e[e.Pan=1]="Pan",e[e.Orbit=2]="Orbit",e[e.Dolly=3]="Dolly",e[e.Zoom=4]="Zoom",e[e.PanDolly=5]="PanDolly",e[e.Roll=6]="Roll"}(c||(c={})),function(e){e[e.Off=0]="Off",e[e.Active=1]="Active",e[e.Release=2]="Release"}(d||(d={}));t.default=class{constructor(){this.orbit=new s.Vector3(0,0,0),this.offset=new s.Vector3(0,0,50),this.size=50,this.zoom=1,this.minOrbit=new s.Vector3(-90,-1/0,-1/0),this.maxOrbit=new s.Vector3(90,1/0,1/0),this.minOffset=new s.Vector3(-1/0,-1/0,.1),this.maxOffset=new s.Vector3(1/0,1/0,1e3),this.orientationEnabled=!0,this.offsetEnabled=!0,this.cameraMode=!0,this.orthographicMode=!1,this.mode=c.Off,this.phase=d.Off,this.prevPinchDist=0,this.deltaX=0,this.deltaY=0,this.deltaPinch=0,this.deltaWheel=0,this.viewportWidth=100,this.viewportHeight=100}onPointer(e){if(e.isPrimary)if("pointer-down"===e.type)this.phase=d.Active;else if("pointer-up"===e.type)return this.phase=d.Release,!0;if("pointer-down"===e.type&&(this.mode=this.getModeFromEvent(e)),this.deltaX+=e.movementX,this.deltaY+=e.movementY,2===e.pointerCount){const t=e.activePositions,r=t[1].clientX-t[0].clientX,s=t[1].clientY-t[0].clientY,i=Math.sqrt(r*r+s*s),n=this.prevPinchDist||i;this.deltaPinch*=n>0?i/n:1,this.prevPinchDist=i}else this.deltaPinch=1,this.prevPinchDist=0;return!0}onTrigger(e){return"wheel"===e.type&&(this.deltaWheel+=i.default.limit(e.wheel,-1,1),!0)}setViewportSize(e,t){this.viewportWidth=e,this.viewportHeight=t}setFromCamera(e,t=!1){const r=this.orbit,s=this.offset;n.default.decomposeOrbitMatrix(e.matrix,r,s),this.orbit.multiplyScalar(n.default.RAD2DEG);const i=e;(this.orthographicMode=i.isOrthographicCamera)&&(this.size=i.isUniversalCamera?i.size:i.top-i.bottom),t&&(this.minOffset.min(s),this.maxOffset.max(s))}setFromObject(e){n.default.decomposeOrbitMatrix(e.matrix,this.orbit,this.offset),this.orbit.multiplyScalar(n.default.RAD2DEG),this.orthographicMode=!1}setFromMatrix(e,t=!1){n.default.decomposeOrbitMatrix(e,this.orbit,this.offset),this.orbit.multiplyScalar(n.default.RAD2DEG),this.orthographicMode=!1}toCamera(e){a.copy(this.orbit).multiplyScalar(i.default.DEG2RAD),l.copy(this.offset),this.orthographicMode&&(l.z=this.maxOffset.z),n.default.composeOrbitMatrix(a,l,e.matrix),e.matrixWorldNeedsUpdate=!0;const t=e;if(t.isOrthographicCamera){if(t.isUniversalCamera)t.size=this.offset.z;else{const r=e.userData.aspect||1,s=.5*this.offset.z;t.left=-s*r,t.right=s*r,t.bottom=-s,t.top=s}t.updateProjectionMatrix()}}toObject(e){a.copy(this.orbit).multiplyScalar(i.default.DEG2RAD),l.copy(this.offset),this.orthographicMode&&(l.z=this.maxOffset.z),n.default.composeOrbitMatrix(a,l,e.matrix),e.matrixWorldNeedsUpdate=!0}toMatrix(e){a.copy(this.orbit).multiplyScalar(i.default.DEG2RAD),l.copy(this.offset),this.orthographicMode&&(l.z=this.maxOffset.z),n.default.composeOrbitMatrix(a,l,e)}update(){return(this.phase!==d.Off||0!==this.deltaWheel)&&(0!==this.deltaWheel?(this.updatePose(0,0,.07*this.deltaWheel+1,0,0,0),this.deltaWheel=0,!0):this.phase===d.Active?(0!==this.deltaX||0!==this.deltaY||1!==this.deltaPinch)&&(this.updateByMode(),this.deltaX=0,this.deltaY=0,this.deltaPinch=1,!0):this.phase===d.Release&&(this.deltaX*=.85,this.deltaY*=.85,this.deltaPinch=1,this.updateByMode(),Math.abs(this.deltaX)+Math.abs(this.deltaY)<.1&&(this.mode=c.Off,this.phase=d.Off),!0))}updateByMode(){switch(this.mode){case c.Orbit:this.updatePose(0,0,1,this.deltaY,this.deltaX,0);break;case c.Pan:this.updatePose(this.deltaX,this.deltaY,1,0,0,0);break;case c.Roll:this.updatePose(0,0,1,0,0,this.deltaX);break;case c.Dolly:this.updatePose(0,0,.0075*this.deltaY+1,0,0,0);break;case c.PanDolly:const e=.5*(this.deltaPinch-1)+1;this.updatePose(this.deltaX,this.deltaY,1/e,0,0,0)}}updatePose(e,t,r,s,n,o){const{orbit:a,minOrbit:l,maxOrbit:c,offset:d,minOffset:u,maxOffset:h}=this;let p=this.cameraMode?-1:1;if(this.orientationEnabled&&(a.x+=p*s*300/this.viewportHeight,a.y+=p*n*300/this.viewportHeight,a.z+=p*o*300/this.viewportHeight,a.x=i.default.limit(a.x,l.x,c.x),a.y=i.default.limit(a.y,l.y,c.y),a.z=i.default.limit(a.z,l.z,c.z)),this.offsetEnabled){const s=d.z=r*d.z;d.x+=e*s*p*2/this.viewportHeight,d.y-=t*s*p*2/this.viewportHeight,d.x=i.default.limit(d.x,u.x,h.x),d.y=i.default.limit(d.y,u.y,h.y),d.z=i.default.limit(d.z,u.z,h.z)}}getModeFromEvent(e){if("mouse"===e.source){const t=e.originalEvent.button;if(0===t)return e.ctrlKey?c.Pan:e.altKey?c.Dolly:c.Orbit;if(2===t)return e.altKey?c.Roll:c.Pan;if(1===t)return c.Dolly}else if("touch"===e.source){const t=e.pointerCount;return 1===t?c.Orbit:2===t?c.PanDolly:c.Pan}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(21),i=r(53),n=r(0),o=r(73),a=r(74),l=r(26),c=r(75),d=r(54),u={dump:n.types.Event("Dump"),download:n.types.Event("Download")};class h extends n.default{constructor(){super(...arguments),this.ins=this.addInputs(u),this.url=""}get urlPath(){return s.default(".",this.url)}get urlName(){return this.url.substr(this.urlPath.length)}setUrl(e,t,r){this.url=e,this.model.assetPath=t||this.urlPath||"",this.model.assetBaseName=r||"",this.node.name=this.urlName}get meta(){return this.components.get(o.default)}get process(){return this.components.get(a.default)}get model(){return this.components.get(l.default)}get documents(){return this.components.get(c.default)}get annotations(){return this.components.get(d.default)}update(){const e=this.ins;return e.dump.changed&&(console.log("CItemData - dump"),console.log(JSON.parse(JSON.stringify(this.toData())))),e.download.changed&&i.default.json(this.toData(),this.urlName||"item.json"),!1}fromData(e){e.meta&&this.meta&&this.meta.fromData(e.meta),e.process&&this.process&&this.process.fromData(e.process),e.model&&this.model&&this.model.fromData(e.model),e.documents&&this.documents&&this.documents.fromData(e.documents),e.annotations&&this.annotations&&this.annotations.fromData(e.annotations)}toData(){const e={info:{type:h.mimeType,copyright:"Copyright Smithsonian Institution",generator:"Voyager Item Parser",version:"1.2"},model:this.model.toData()},t=this.meta.toData();t&&(e.meta=t);const r=this.process.toData();r&&(e.process=r);const s=this.documents.toData();s&&(e.documents=s);const i=this.annotations.toData();return i&&(e.annotations=i),e}}h.type="CVItemData",h.mimeType="application/si-dpo-3d.item+json",t.default=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0);class i extends s.default{constructor(){super(...arguments),this.data={}}set(e,t){this.data[e]=t}get(e){return this.data[e]}remove(e){delete this.data[e]}clear(){this.data={}}hasData(){return Object.keys(this.data).length>0}deflate(){const e=this.toData();return e?{data:e}:null}inflate(e){e.data&&this.fromData(e)}toData(){return this.hasData()?Object.assign({},this.data):null}fromData(e){this.data=Object.assign({},e)}}i.type="CVMeta",t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0);class i extends s.default{constructor(){super(...arguments),this.data={}}set(e,t){this.data[e]=t}get(e){return this.data[e]}remove(e){delete this.data[e]}clear(){this.data={}}hasData(){return Object.keys(this.data).length>0}deflate(){const e=this.toData();return e?{data:e}:null}inflate(e){e.data&&this.fromData(e)}toData(){return this.hasData()?Object.assign({},this.data):null}fromData(e){this.data=Object.assign({},e)}}i.type="CVProcess",t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(9),i=r(0),n=r(52),o=r(198);class a extends i.default{constructor(){super(...arguments),this.mainDocument=null,this.documents={}}get reader(){return this.system.components.get(n.default)}createDocument(){const e=new o.default(s.default(6,this.documents));return this.addDocument(e),e}getDocuments(){return Object.keys(this.documents).map(e=>this.documents[e])}getDocumentById(e){return this.documents[e]}addDocument(e){this.documents[e.id]=e,this.emit({type:"document",add:!0,remove:!1,document:e})}removeDocument(e){delete this.documents[e.id],this.emit({type:"document",add:!1,remove:!0,document:e})}deflate(){const e=this.toData();return e?{data:e}:null}inflate(e){e.data&&this.fromData(e)}toData(){let e=null;this.mainDocument&&((e=e||{}).mainDocumentId=this.mainDocument.id);const t=Object.keys(this.documents);return t.length>0&&((e=e||{}).documents=t.map(e=>this.documents[e].deflate())),e}fromData(e){e.documents&&e.documents.forEach(e=>this.addDocument(new o.default(e.id).inflate(e))),e.mainDocumentId&&(this.mainDocument=this.documents[e.mainDocumentId])}}a.type="CVDocuments",t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(98),n=r(25),o=r(99),a=r(77),l=r(56),c={activate:s.types.Event("Activate"),dump:s.types.Event("Dump"),download:s.types.Event("Download")};class d extends i.default{constructor(){super(...arguments),this.ins=this.addInputs(c)}get presentation(){return this.innerGraph.components.get(o.default)}get scene(){return this.innerGraph.components.get(n.default)}get setup(){return this.innerGraph.nodes.get(l.default)}setUrl(e,t,r){this.presentation.setUrl(e,t,r),this.innerGraph.nodes.get(a.default).setUrl(e,t)}create(){super.create();const e=this.innerGraph;e.createNode("Main").createComponent(o.default),e.createCustomNode(a.default).addChild(this.innerGraph.createCustomNode(l.default))}update(e){const t=this.ins;return t.activate.changed&&this.scene.ins.activate.set(),t.dump.changed&&this.presentation.ins.dump.set(!0),t.download.changed&&this.presentation.ins.download.set(!0),!0}fromData(e,t){this.presentation.fromData(e,t)}toData(e=!1){return this.presentation.toData(e)}}d.type="CVPresentation",d.mimeType="application/si-dpo-3d.presentation+json",t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(21),n=r(20),o=r(23),a=r(100),l=r(101),c=r(55),d=r(102),u=r(104),h=r(106),p=r(38),f=r(25),m=r(72),v=r(56),y=r(114),g=r(27),b=new s.Vector3,E=new s.Vector3,_=new s.Matrix4,P=new s.Quaternion,w=new s.Euler;class x extends a.default{get scene(){return this.components.safeGet(f.default)}get loadingManager(){return this.system.components.safeGet(p.default)}setUrl(e,t){this.url=e,this.assetPath=t||i.default(".",e)}createComponents(){this.createComponent(f.default),this.name="Scene"}deflate(){const e=this.toData();return e?{data:e}:null}inflate(e){e.data&&this.fromData(e)}toData(e){const t=e?0:void 0,r={scene:{nodes:[]}},s=this.scene.children;return s.length>0&&(r.nodes=[],s.forEach(e=>{const s=e.node;if(s instanceof o.default){const e=this.nodeToData(s,r,t);r.scene.nodes.push(e)}})),r}fromData(e,t){e.scene.nodes.forEach(r=>{const s=e.nodes[r];this.nodeFromData(this,s,e,t)})}nodeToData(e,t,r){const s=this.transformToData(e.transform);e.name&&(s.name=e.name);const i=t.nodes.length;if(t.nodes.push(s),e instanceof g.default)if(void 0===r)t.items=t.items||[],s.item=t.items.length,t.items.push(e.item.toData());else{t.references=t.references||[],s.reference=t.references.length;const e=(r++).toString();t.references.push({uri:e})}else e instanceof y.default?(t.references=t.references||[],s.reference=t.references.length,t.references.push(e.toData())):e instanceof l.default?(t.cameras=t.cameras||[],s.camera=t.cameras.length,t.cameras.push(this.cameraToData(e))):e instanceof c.default&&(t.lights=t.lights||[],s.light=t.lights.length,t.lights.push(this.lightToData(e)));const n=e.transform.children;return n.length>0&&(s.children=[],n.forEach(e=>{const i=e.node;if(i instanceof o.default&&!i.is(v.default)){const e=this.nodeToData(i,t,r);s.children.push(e)}})),i}transformToData(e){e.object3D.matrix.decompose(b,P,E);const t={};return 0===b.x&&0===b.y&&0===b.z||(t.translation=b.toArray()),0===P.x&&0===P.y&&0===P.z&&1===P.w||(t.rotation=P.toArray()),1===E.x&&1===E.y&&1===E.z||(t.scale=E.toArray()),t}cameraToData(e){const t=e.camera.ins,r={};return t.projection.getValidatedValue()===l.EProjection.Perspective?(r.type="perspective",r.perspective={yfov:t.fov.value,znear:t.near.value,zfar:t.far.value}):(r.type="orthographic",r.orthographic={ymag:t.size.value,znear:t.near.value,zfar:t.far.value}),r}lightToData(e){const t=e.light.ins,r={color:t.color.value.slice(),intensity:t.intensity.value};switch(e.type){case d.default.type:r.type="directional";break;case u.default.type:r.type="point",r.point={distance:t.distance.value,decay:t.decay.value};break;case h.default.type:r.type="spot",r.spot={distance:t.distance.value,decay:t.decay.value,angle:t.angle.value,penumbra:t.penumbra.value};break;default:throw new Error(`unsupported light type: '${e.type}'`)}return r}nodeFromData(e,t,r,s){let n=null;if(isFinite(t.reference)){const e=r.references[t.reference];if(e.mimeType===m.default.mimeType){const t=Number(e.uri);if(isFinite(t))n=s&&s(t,this.graph,this.assetPath);else{const t=i.default(e.uri,this.assetPath),r=this.loadingManager;(n=this.graph.createCustomNode(g.default)).item.setUrl(t),r.loadJSON(t).then(e=>r.validateItem(e).then(e=>{n.item.fromData(e)})).catch(e=>{console.warn(`failed to create item from reference uri: ${e}`)})}}n||(n=this.graph.createCustomNode(y.default)).fromData(e)}else if(isFinite(t.item)){const e=r.items[t.item];(n=this.graph.createCustomNode(g.default)).item.fromData(e)}else if(isFinite(t.camera)){const e=r.cameras[t.camera];n=this.cameraFromData(e)}else if(isFinite(t.light)){const e=r.lights[t.light];n=this.lightFromData(e)}else n=this.graph.createCustomNode(o.default);t.name&&(n.name=t.name),this.transformFromData(t,n.transform),e.transform.addChild(n.transform),t.children&&t.children.forEach(e=>{const t=r.nodes[e];this.nodeFromData(n,t,r,s)})}transformFromData(e,t){const{position:r,rotation:s,order:i,scale:o}=t.ins;i.setValue(0),e.matrix?(_.fromArray(e.matrix),_.decompose(b,P,E),b.toArray(r.value),w.setFromQuaternion(P,"XYZ"),w.toVector3(b).multiplyScalar(n.default.RAD2DEG).toArray(s.value),E.toArray(o.value),r.set(),s.set(),o.set()):(e.translation&&r.setValue(e.translation.slice()),e.rotation&&(P.fromArray(e.rotation),w.setFromQuaternion(P,"XYZ"),w.toVector3(b).multiplyScalar(n.default.RAD2DEG).toArray(s.value),s.set()),e.scale&&o.setValue(e.scale.slice()),t.changed=!0)}cameraFromData(e){const t=this.graph.createCustomNode(l.default);return"perspective"===e.type?t.camera.ins.copyValues({projection:l.EProjection.Perspective,fov:e.perspective.yfov,near:e.perspective.znear,far:e.perspective.zfar}):t.camera.ins.copyValues({projection:l.EProjection.Orthographic,size:e.orthographic.ymag,near:e.orthographic.znear,far:e.orthographic.zfar}),t}lightFromData(e){let t;switch(e.type){case"directional":(t=this.graph.createCustomNode(d.default)).light.ins.copyValues({position:[0,0,0],target:[0,0,0]});break;case"point":(t=this.graph.createCustomNode(u.default)).light.ins.copyValues({distance:e.point.distance||0,decay:void 0!==e.point.decay?e.point.decay:1});break;case"spot":(t=this.graph.createCustomNode(h.default)).light.ins.copyValues({distance:e.point.distance||0,decay:void 0!==e.point.decay?e.point.decay:1,angle:void 0!==e.spot.angle?e.spot.angle:Math.PI/4,penumbra:e.spot.penumbra||0});break;default:throw new Error(`unsupported light type: '${e.type}'`)}return t.light.ins.copyValues({color:void 0!==e.color?e.color.slice():[1,1,1],intensity:void 0!==e.intensity?e.intensity:1}),t}}x.type="NVPresentationScene",t.default=x},function(e,t,r){"use strict";var s,i=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0}),r(42);const n=r(1),o={info:"ff-info",success:"ff-success",warning:"ff-warning",error:"ff-error"},a={info:"info",success:"check",warning:"warning",error:"error"},l={info:2e3,success:2e3,warning:5e3,error:0};let c=s=class extends n.default{constructor(e,t,r){super(),this._handler=0,this.on("transitionend",this.remove.bind(this)),this.message=e||"<messge>",this.level=t||"info",this.timeout=void 0!==r?r:l[this.level];const i=document.getElementById(s.stackId);i?i.appendChild(this):console.warn(`element '#${s.stackId}' not found`)}close(){this._handler>0&&(window.clearTimeout(this._handler),this._handler=0),this.classList.add("ff-out")}firstUpdated(){this.classList.add("ff-flex-row","ff-notification",o[this.level]),this.timeout>0&&(this._handler=window.setTimeout(()=>this.close(),this.timeout))}render(){const e=a[this.level];return n.html`<ff-icon name=${e}></ff-icon>
            <div class="ff-text">${this.message}</div>
            <ff-button inline icon="close" @click=${this.onClose}>`}onClose(e){e.stopPropagation(),this.close()}};c.stackId="ff-notification-stack",i([n.property({type:String})],c.prototype,"message",void 0),i([n.property({type:String})],c.prototype,"level",void 0),i([n.property({type:Number})],c.prototype,"timeout",void 0),c=s=i([n.customElement("ff-notification")],c),t.default=c,t.info=((e,t)=>new c(e,"info",t)),t.success=((e,t)=>new c(e,"success",t)),t.warning=((e,t)=>new c(e,"warning",t)),t.error=((e,t)=>new c(e,"error",t))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(3),i=r(27),n=r(54),o=r(239),a=r(32);var l;!function(e){e[e.Off=0]="Off",e[e.Move=1]="Move",e[e.Create=2]="Create"}(l=t.EAnnotationsTaskMode||(t.EAnnotationsTaskMode={}));const c={mode:s.types.Enum("Mode",l,l.Off)};class d extends a.default{constructor(){super(...arguments),this.ins=this.addInputs(c),this.activeAnnotations=null}createView(){return new o.default(this)}activate(){super.activate(),this.selection.selectedComponents.on(n.default,this.onSelectAnnotations,this)}deactivate(){super.deactivate(),this.selection.selectedComponents.off(n.default,this.onSelectAnnotations,this)}setActiveItem(e){e?(this.activeAnnotations=e.annotations,this.selection.selectComponent(this.activeAnnotations)):this.activeAnnotations=null}onSelectAnnotations(e){e.add&&e.component.node instanceof i.default&&(this.presentations.activeItem=e.component.node)}}d.type="CVAnnotationsTask",d.text="Annotations",d.icon="comment",t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(3),n=r(118),o=r(13),a=r(27),l=r(30),c=r(26),d=r(245),u=r(32),h=new s.Vector3,p=new s.Vector3,f=new s.Matrix4,m=new s.Quaternion,v=new s.Quaternion;var y;!function(e){e[e.Off=0]="Off",e[e.Translate=1]="Translate",e[e.Rotate=2]="Rotate"}(y=t.EPoseManipMode||(t.EPoseManipMode={}));const g={mode:i.types.Enum("Mode",y,y.Off)};class b extends u.default{constructor(){super(...arguments),this.ins=this.addInputs(g),this.activeModel=null,this._interfaceVisible=!1,this._gridVisible=!1,this._viewport=null,this._deltaX=0,this._deltaY=0}get renderer(){return this.system.graph.components.get(o.default)}get interface(){return this.system.graph.components.get(l.default)}createView(){return new d.default(this)}activate(){super.activate(),this.selection.selectedComponents.on(c.default,this.onSelectModel,this),this.system.on(["pointer-down","pointer-up","pointer-move"],this.onPointer,this),this.renderer.views.forEach(e=>{e instanceof n.default&&(e.layout=n.EQuadViewLayout.Quad)});const e=this.interface;e&&(this._interfaceVisible=e.ins.visible.value,e.ins.visible.setValue(!1))}deactivate(){super.deactivate(),this.selection.selectedComponents.off(c.default,this.onSelectModel,this),this.system.off(["pointer-down","pointer-up","pointer-move"],this.onPointer,this),this.system.components.get(o.default).views.forEach(e=>{e instanceof n.default&&(e.layout=n.EQuadViewLayout.Single)});const e=this.interface;e&&e.ins.visible.setValue(this._interfaceVisible)}tick(){const e=this.ins.mode.value;if(e===y.Off||!this.activeModel)return!1;const t=this._deltaX,r=this._deltaY;if(0===t&&0===r)return!1;this._deltaX=this._deltaY=0;const s=this.activeModel.object3D,i=this._viewport.viewportCamera;if(!i)return!1;if(i.matrixWorld.decompose(h,m,h),e===y.Rotate){const e=.002*(t-r);p.set(0,0,-1).applyQuaternion(m),v.setFromAxisAngle(p,e),f.makeRotationFromQuaternion(v)}else{const e=i.size/this._viewport.width;p.set(t*e,-r*e,0).applyQuaternion(m),f.identity().setPosition(p)}return f.multiply(s.matrix),this.activeModel.setFromMatrix(f),!0}setActivePresentation(e){const t=this.activePresentation;t&&t.setup.homeGrid.ins.visible.setValue(this._gridVisible),e&&(this._gridVisible=e.setup.homeGrid.ins.visible.value,e.setup.homeGrid.ins.visible.setValue(!0))}setActiveItem(e){e&&e.model?(this.activeModel=e.model,this.selection.selectComponent(this.activeModel)):this.activeModel=null}onPointer(e){if(this.ins.mode.value!==y.Off&&this.activeModel&&"pointer-move"===e.type&&1===e.originalEvent.buttons){const t=e.ctrlKey?.1:e.shiftKey?10:1;this._deltaX+=e.movementX*t,this._deltaY+=e.movementY*t,this._viewport=e.viewport,e.stopPropagation=!0}}onSelectModel(e){e.add&&e.component.node instanceof a.default&&(this.presentations.activeItem=e.component.node)}}b.type="CVPoseTask",b.text="Pose",b.icon="move",t.default=b},function(e,t,r){"use strict";var s,i=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const n=r(9),o=r(1),a=r(46);let l=s=class extends o.default{constructor(){super(),this.text="Panel",this.closable=!0,this.movable=!0,this.active=!1,this.header=null,this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.onDrop=this.onDrop.bind(this),this.addEventListener("dragover",this.onDragOver),this.addEventListener("dragleave",this.onDragLeave),this.addEventListener("drop",this.onDrop),this.id=n.default(),this.contentId="",this.dropZone="none"}static getPanelById(e){return document.getElementById(e)}get parentStack(){return this.parentElement}setLayout(e,t){this.text=e.text||"",this.closable=e.closable||!1,this.movable=e.movable||!1,this.contentId=e.contentId;const r=t.get(e.contentId);if(r){const e=r();e.classList.add("ff-fullsize"),this.appendChild(e)}else console.warn(`failed to create content element for id: ${e.contentId}`)}getLayout(){return{contentId:this.contentId,text:this.text,closable:this.closable,movable:this.movable}}movePanel(e,t){const r=s.getPanelById(e),i=r.parentStack;if(r===this&&1===i.getPanelCount())return;const n=this.parentStack;if("before"===t||"after"===t){if(r===this)return;let e=this;if("after"===t){const t=this.header.nextElementSibling;e=t?t.panel:null}if(r===e)return;i.removePanel(r),n.insertPanel(r,e),n.activatePanel(r)}else{i.removePanel(r),n.parentElement.insertPanel(r,n,t)}setTimeout(()=>window.dispatchEvent(new CustomEvent("resize")),0)}activatePanel(){this.parentStack.activatePanel(this)}closePanel(){this.parentStack.removePanel(this),setTimeout(()=>window.dispatchEvent(new CustomEvent("resize")),0)}update(e){super.update(e),this.header&&this.header.requestUpdate(),e.has("active")&&(this.style.display=this.active?"flex":"none")}firstUpdated(){this.setStyle({flex:"1 1 100%",position:"relative",flexDirection:"column",boxSizing:"border-box",overflow:"hidden"})}onDragOver(e){if(Array.from(e.dataTransfer.items).find(e=>e.type===s.dragDropMimeType)){const t=this.getDropZone(e);t!==this.dropZone&&(this.dropZone=t,this.updateDropMarker()),e.stopPropagation(),e.preventDefault()}}onDragLeave(e){"none"!==this.dropZone&&(this.dropZone="none",this.updateDropMarker())}onDrop(e){const t=this.dropZone;"none"!==t&&(this.dropZone="none",this.updateDropMarker()),e.stopPropagation();const r=e.dataTransfer.getData(s.dragDropMimeType);this.movePanel(r,t),this.dispatchEvent(new CustomEvent(a.default.changeEvent,{bubbles:!0}))}getDropZone(e){const t=this.getBoundingClientRect(),r=(e.clientX-t.left)/t.width,s=(e.clientY-t.top)/t.height;let i;return i=r>.33&&r<.67&&s>.33&&s<.67?"after":r<s?r+s<1?"left":"bottom":r+s<1?"top":"right"}updateDropMarker(){const e=this.dropZone;let t=this.getElementsByClassName("ff-dock-drop-marker").item(0);if(t&&"none"===e)return void this.removeChild(t);t||((t=document.createElement("div")).classList.add("ff-dock-drop-marker"),this.appendChild(t));const r=t.style;switch(r.pointerEvents="none",r.zIndex="1",r.position="absolute",r.left="0",r.right="0",r.top="0",r.bottom="0",e){case"left":r.right="50%";break;case"right":r.left="50%";break;case"top":r.bottom="50%";break;case"bottom":r.top="50%"}}};l.dragDropMimeType="application/x-ff-dock-panel",i([o.property({type:String})],l.prototype,"text",void 0),i([o.property({type:Boolean})],l.prototype,"closable",void 0),i([o.property({type:Boolean})],l.prototype,"movable",void 0),i([o.property({type:Boolean,reflect:!0})],l.prototype,"active",void 0),l=s=i([o.customElement("ff-dock-panel")],l),t.default=l},function(e,t,r){"use strict";var s,i=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const n=r(60),o=r(128),a=r(129),l=r(45),c=r(1),d=r(42),u=r(46),h=r(251),p=r(254),f=r(255),m=r(256),v=r(257),y=r(258),g=r(259);r(262);const b=r(263);d.default.add("hierarchy",c.html`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M104 272h192v48h48v-48h192v48h48v-57.59c0-21.17-17.22-38.41-38.41-38.41H344v-64h40c17.67 0 32-14.33 32-32V32c0-17.67-14.33-32-32-32H256c-17.67 0-32 14.33-32 32v96c0 8.84 3.58 16.84 9.37 22.63S247.16 160 256 160h40v64H94.41C73.22 224 56 241.23 56 262.41V320h48v-48zm168-160V48h96v64h-96zm336 240h-96c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h96c17.67 0 32-14.33 32-32v-96c0-17.67-14.33-32-32-32zm-16 112h-64v-64h64v64zM368 352h-96c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h96c17.67 0 32-14.33 32-32v-96c0-17.67-14.33-32-32-32zm-16 112h-64v-64h64v64zM128 352H32c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h96c17.67 0 32-14.33 32-32v-96c0-17.67-14.33-32-32-32zm-16 112H48v-64h64v64z"/></svg>`),d.default.add("move",c.html`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M352.201 425.775l-79.196 79.196c-9.373 9.373-24.568 9.373-33.941 0l-79.196-79.196c-15.119-15.119-4.411-40.971 16.971-40.97h51.162L228 284H127.196v51.162c0 21.382-25.851 32.09-40.971 16.971L7.029 272.937c-9.373-9.373-9.373-24.569 0-33.941L86.225 159.8c15.119-15.119 40.971-4.411 40.971 16.971V228H228V127.196h-51.23c-21.382 0-32.09-25.851-16.971-40.971l79.196-79.196c9.373-9.373 24.568-9.373 33.941 0l79.196 79.196c15.119 15.119 4.411 40.971-16.971 40.971h-51.162V228h100.804v-51.162c0-21.382 25.851-32.09 40.97-16.971l79.196 79.196c9.373 9.373 9.373 24.569 0 33.941L425.773 352.2c-15.119 15.119-40.971 4.411-40.97-16.971V284H284v100.804h51.23c21.382 0 32.09 25.851 16.971 40.971z"/></svg>`),d.default.add("camera",c.html`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M512 144v288c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V144c0-26.5 21.5-48 48-48h88l12.3-32.9c7-18.7 24.9-31.1 44.9-31.1h125.5c20 0 37.9 12.4 44.9 31.1L376 96h88c26.5 0 48 21.5 48 48zM376 288c0-66.2-53.8-120-120-120s-120 53.8-120 120 53.8 120 120 120 120-53.8 120-120zm-32 0c0 48.5-39.5 88-88 88s-88-39.5-88-88 39.5-88 88-88 88 39.5 88 88z"/></svg>`),d.default.add("save",c.html`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"/></svg>`),d.default.add("exit",c.html`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M497 273L329 441c-15 15-41 4.5-41-17v-96H152c-13.3 0-24-10.7-24-24v-96c0-13.3 10.7-24 24-24h136V88c0-21.4 25.9-32 41-17l168 168c9.3 9.4 9.3 24.6 0 34zM192 436v-40c0-6.6-5.4-12-12-12H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h84c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12H96c-53 0-96 43-96 96v192c0 53 43 96 96 96h84c6.6 0 12-5.4 12-12z"/></svg>`),d.default.add("expert",c.html`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M278.9 511.5l-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2l43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6l144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"/></svg>`);let E=s=class extends c.default{constructor(e){if(super(),this.onUnload=this.onUnload.bind(this),e)this.application=e;else{const e={item:this.getAttribute("item"),presentation:this.getAttribute("presentation"),template:this.getAttribute("template"),model:this.getAttribute("model"),geometry:this.getAttribute("geometry"),texture:this.getAttribute("texture"),quality:this.getAttribute("quality"),referrer:this.getAttribute("referrer"),mode:this.getAttribute("mode"),expert:this.hasAttribute("expert")};this.application=new a.default(null,e)}this.dockView=null;const t=this.application.system,r=t.components.get(l.default);r.ins.expertMode.on("value",this.onExpertMode,this);const i=this.registry=new Map,c=this.application.explorer;i.set("explorer",()=>new f.default(c)),i.set("task",()=>new m.default(t)),i.set("log",()=>new v.default(t)),i.set("console",()=>new y.default(t)),i.set("navigator",()=>new b.default(t)),i.set("hierarchy",()=>new h.default(t)),i.set("inspector",()=>new g.default(t));const d=void 0!==n.default("reset")?null:o.default.get("voyager-story",s.stateKey);this.state=d||{regularLayout:s.regularLayout,expertLayout:s.expertLayout,expertMode:r.ins.expertMode.value},r.ins.expertMode.setValue(this.state.expertMode)}firstConnected(){this.setStyle({display:"flex",flexDirection:"column"}),this.appendElement(new p.default(this.application.system)),this.dockView=this.appendElement(u.default),this.restoreLayout(),window.addEventListener("beforeunload",this.onUnload)}disconnected(){this.storeLayout(),o.default.set("voyager-story",s.stateKey,this.state)}onUnload(){this.storeLayout(),o.default.set("voyager-story",s.stateKey,this.state)}onExpertMode(e){e!==this.state.expertMode&&(this.storeLayout(),this.state.expertMode=e,this.restoreLayout())}storeLayout(){const e=this.state;e.expertMode?e.expertLayout=this.dockView.getLayout():e.regularLayout=this.dockView.getLayout()}restoreLayout(){const e=this.state;this.dockView.setLayout(e.expertMode?e.expertLayout:e.regularLayout,this.registry),this.dockView.setPanelsMovable(!0)}};E.stateKey="main-view-state2",E.regularLayout={type:"strip",direction:"horizontal",size:1,elements:[{type:"strip",direction:"vertical",size:.25,elements:[{type:"stack",size:.2,activePanelIndex:0,panels:[{contentId:"navigator",text:"Navigator"}]},{type:"stack",size:.8,activePanelIndex:0,panels:[{contentId:"task",text:"Task"}]}]},{type:"strip",direction:"vertical",size:.75,elements:[{type:"stack",size:.75,activePanelIndex:0,panels:[{contentId:"explorer",text:"Explorer"}]},{type:"stack",size:.2,activePanelIndex:0,panels:[{contentId:"log",text:"Log"}]}]}]},E.expertLayout={type:"strip",direction:"horizontal",size:1,elements:[{type:"strip",direction:"vertical",size:.22,elements:[{type:"stack",size:.3,activePanelIndex:0,panels:[{contentId:"navigator",text:"Navigator"}]},{type:"stack",size:.7,activePanelIndex:0,panels:[{contentId:"task",text:"Task"}]}]},{type:"strip",direction:"vertical",size:.56,elements:[{type:"stack",size:.5,activePanelIndex:0,panels:[{contentId:"explorer",text:"Explorer"}]},{type:"stack",size:.2,activePanelIndex:0,panels:[{contentId:"log",text:"Log"},{contentId:"console",text:"Console"}]}]},{type:"strip",direction:"vertical",size:.22,elements:[{type:"stack",size:.5,activePanelIndex:0,panels:[{contentId:"hierarchy",text:"Hierarchy"}]},{type:"stack",size:.5,activePanelIndex:0,panels:[{contentId:"inspector",text:"Inspector"}]}]}]},E=s=i([c.customElement("voyager-story")],E),t.default=E},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(60),i=r(84),n=r(85),o=r(132),a=r(64),l=r(13),c=r(65),d=r(38),u=r(40),h=r(30),p=r(52),f=r(22),m=r(201),v=r(204),y=r(213),g=r(214),b=r(218),E=r(219),_=r(220),P=r(117);class w{constructor(e,t){this.props=t,console.log(w.splashMessage);const r=new n.default;r.registerComponentType(m.componentTypes),r.registerComponentType(v.componentTypes),r.registerComponentType(y.componentTypes),r.registerComponentType(g.componentTypes),r.registerNodeType(b.nodeTypes),r.registerNodeType(E.nodeTypes),r.registerNodeType(_.nodeTypes),this.commander=new i.default;const s=this.system=new o.default(r),x=s.graph.createNode("Explorer");x.createComponent(a.default),x.createComponent(l.default),x.createComponent(c.default).createActions(this.commander),x.createComponent(d.default),x.createComponent(u.default),x.createComponent(h.default),x.createComponent(p.default),s.graph.createNode("Presentations").createComponent(f.default).createActions(this.commander),e&&new P.default(this).appendTo(e),x.components.get(a.default).start(),this.startup().catch(e=>{console.warn("application startup failed: "+e.message)})}startup(){const e=this.props,t=this.system.components.safeGet(f.default);return e.presentation=e.presentation||s.default("presentation")||s.default("p"),e.item=e.item||s.default("item")||s.default("i"),e.template=e.template||s.default("template")||s.default("t"),e.model=e.model||s.default("model")||s.default("m"),e.geometry=e.geometry||s.default("geometry")||s.default("g"),e.texture=e.texture||s.default("texture")||s.default("tex"),e.quality=e.quality||s.default("quality")||s.default("q"),e.base=e.base||s.default("base")||s.default("b"),e.presentation?t.loadPresentation(e.presentation,null,e.base):e.item?t.loadItem(e.item,e.template,e.base):e.model?t.loadModel(e.model,e.quality,e.template,e.base):e.geometry?t.loadGeometryAndTexture(e.geometry,e.texture,e.quality,e.template,e.base):Promise.resolve()}}w.splashMessage=["Voyager - 3D Explorer and Tool Suite","3D Foundation Project","(c) 2018 Smithsonian Institution","https://3d.si.edu"].join("\n"),t.default=w,window.VoyagerExplorer=w},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(10),i=r(130);class n extends s.default{constructor(e){super(),this.addEvent("change"),this.stack=[],this.pointer=-1,this.capacity=void 0!==e?e:n.defaultCapacity}register(e){let t;t="function"==typeof e?e:t=>new i.default(t,e);return(...e)=>{const r=t(e);this.do(r)}}setCapacity(e){for(this.capacity=e;this.stack.length>e;)this.stack.shift(),this.pointer--;this.pointer<0&&(this.stack=[],this.pointer=-1)}do(e){console.log(`Commander.do - '${e.name}'`),e.do(),e.canUndo()&&(this.stack.splice(this.pointer+1),this.stack.push(e),this.stack.length>this.capacity&&this.stack.shift(),this.pointer=this.stack.length-1,this.emit("change"))}undo(){if(this.pointer>=0){this.stack[this.pointer].undo(),this.pointer--,this.emit("change")}}redo(){if(this.pointer<this.stack.length-1){this.pointer++,this.stack[this.pointer].do(),this.emit("change")}}clear(){this.stack.length>0&&(this.stack=[],this.pointer=-1,this.emit("change"))}canUndo(){return this.pointer>=0}canRedo(){return this.pointer<this.stack.length-1}getUndoText(){return this.pointer>=0?"Undo "+this.stack[this.pointer].name:"Can't Undo"}getRedoText(){return this.pointer<this.stack.length-1?"Redo "+this.stack[this.pointer+1].name:"Can't Redo"}}n.defaultCapacity=30,t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.nodeTypes={},this.componentTypes={}}getNodeType(e){const t=this.nodeTypes[e];if(!t)throw new Error(`node type not found for type id: '${e}'`);return t}getComponentType(e){const t=this.componentTypes[e];if(!t)throw new Error(`component type not found for type id: '${e}'`);return t}registerNodeType(e){if(Array.isArray(e))e.forEach(e=>this.registerNodeType(e));else{if(this.nodeTypes[e.type])throw console.warn(e),new Error(`node type already registered: '${e.type}'`);this.nodeTypes[e.type]=e}}registerComponentType(e){if(Array.isArray(e))e.forEach(e=>this.registerComponentType(e));else{if(this.componentTypes[e.type])throw console.warn(e),new Error(`component type already registered: '${e.type}'`);this.componentTypes[e.type]=e}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=[function(e){return e},function(e,t){for(let r=0,s=t.length;r<s;++r)t[r]=e[r];return t}],i=[function(e){return!!e},function(e,t){for(let r=0,s=t.length;r<s;++r)t[r]=!!e[r];return t}],n=[function(e){return String(e)},function(e,t){for(let r=0,s=t.length;r<s;++r)t[r]=String(e[r]);return t}],o=[function(e,t){throw new Error(`illegal value conversion from ${typeof e} to ${typeof t}`)},function(e,t,r){throw new Error(`illegal array conversion from ${typeof e[0]} to ${typeof t[0]}`)}],a={number:{number:s,boolean:i,string:n,object:o},boolean:{number:[function(e){return e?1:0},function(e,t){for(let r=0,s=t.length;r<s;++r)t[r]=e[r]?1:0;return t}],boolean:s,string:n,object:o},string:{number:[function(e){return parseFloat(e)||0},function(e,t){for(let r=0,s=t.length;r<s;++r)t[r]=parseFloat(e[r])||0;return t}],boolean:i,string:s,object:o},object:{number:o,boolean:i,string:n,object:s}},l={number:{number:!0,boolean:!0,string:!0,object:!1},boolean:{number:!0,boolean:!0,string:!0,object:!1},string:{number:!0,boolean:!0,string:!0,object:!1},object:{number:!1,boolean:!0,string:!0,object:!0}},c=[[function(e,t,r){return r(e,t)},function(e,t,r){return t[0]=r(e),t},function(e,t,r){return t[1]=r(e),t},function(e,t,r){return t[2]=r(e),t},function(e,t,r){return t[3]=r(e),t}],[function(e,t,r){return r(e[0])},function(e,t,r){return t[0]=r(e[0]),t},function(e,t,r){return t[1]=r(e[0]),t},function(e,t,r){return t[2]=r(e[0]),t},function(e,t,r){return t[3]=r(e[0]),t}],[function(e,t,r){return r(e[1])},function(e,t,r){return t[0]=r(e[1]),t},function(e,t,r){return t[1]=r(e[1]),t},function(e,t,r){return t[2]=r(e[1]),t},function(e,t,r){return t[3]=r(e[1]),t}],[function(e,t,r){return r(e[2])},function(e,t,r){return t[0]=r(e[2]),t},function(e,t,r){return t[1]=r(e[2]),t},function(e,t,r){return t[2]=r(e[2]),t},function(e,t,r){return t[3]=r(e[2]),t}],[function(e,t,r){return r(e[3])},function(e,t,r){return t[0]=r(e[3]),t},function(e,t,r){return t[1]=r(e[3]),t},function(e,t,r){return t[2]=r(e[3]),t},function(e,t,r){return t[3]=r(e[3]),t}]];t.getConversionFunction=function(e,t,r){const s=r?1:0;return a[e][t][s]},t.canConvert=function(e,t){return l[e][t]},t.getElementCopyFunction=function(e,t,r){return-1===e&&-1===t?r:e<=3&&t<=3?c[e+1][t+1]:function(r,s,i){return s[t]=i(r[e]),s}},t.getMultiCopyFunction=function(e,t,r){return!1===e?!1===t?r:function(e,t,s){for(let s=0,i=t.length;s<i;++s)t[s]=r(e,t[s]);return t}:!1===t?function(e,t,s){return e.length>0&&(t=r(e[0],t)),t}:function(e,t,s){for(let s=0,i=e.length,n=t.length;s<n;++s)t[s]=r(e[s%i],t[s]);return t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0);t.default=class{constructor(e,t,r,i){this.type=s.componentTypeName(t),this.didAdd=r,this.willRemove=i,this._set=e,e.on(this.type,this.onComponent,this),this.component=e.get(t),this.component&&r&&r(this.component)}dispose(){this._set.off(this.type,this.onComponent,this),this.component=null,this.didAdd=null,this.willRemove=null}onComponent(e){e.add?(this.component=e.component,this.didAdd&&this.didAdd(e.component)):e.remove&&(this.willRemove&&this.willRemove(e.component),this.component=null)}}},function(e,t,r){"use strict";var s=r(29);e.exports=function(e){s.copy(e,this)}},function(e,t,r){"use strict";e.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var r,s="boolean"==typeof t.cycles&&t.cycles,i=t.cmp&&(r=t.cmp,function(e){return function(t,s){var i={key:t,value:e[t]},n={key:s,value:e[s]};return r(i,n)}}),n=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var r,o;if(Array.isArray(t)){for(o="[",r=0;r<t.length;r++)r&&(o+=","),o+=e(t[r])||"null";return o+"]"}if(null===t)return"null";if(-1!==n.indexOf(t)){if(s)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=n.push(t)-1,l=Object.keys(t).sort(i&&i(t));for(o="",r=0;r<l.length;r++){var c=l[r],d=e(t[c]);d&&(o&&(o+=","),o+=JSON.stringify(c)+":"+d)}return n.splice(a,1),"{"+o+"}"}}(e)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s="",i=!0===e.schema.$async,n=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),o=e.self._getId(e.schema);if(e.isTop&&(s+=" var validate = ",i&&(e.async=!0,s+="async "),s+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",o&&(e.opts.sourceCode||e.opts.processCode)&&(s+=" /*# sourceURL="+o+" */ ")),"boolean"==typeof e.schema||!n&&!e.schema.$ref){var a=e.level,l=e.dataLevel,c=e.schema["false schema"],d=e.schemaPath+e.util.getProperty("false schema"),u=e.errSchemaPath+"/false schema",h=!e.opts.allErrors,p="data"+(l||""),f="valid"+a;if(!1===e.schema){e.isTop?h=!0:s+=" var "+f+" = false; ",(X=X||[]).push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'false schema' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",!1!==e.opts.messages&&(s+=" , message: 'boolean schema is false' "),e.opts.verbose&&(s+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),s+=" } "):s+=" {} ";var m=s;s=X.pop(),!e.compositeRule&&h?e.async?s+=" throw new ValidationError(["+m+"]); ":s+=" validate.errors = ["+m+"]; return false; ":s+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else e.isTop?s+=i?" return data; ":" validate.errors = null; return true; ":s+=" var "+f+" = true; ";return e.isTop&&(s+=" }; return validate; "),s}if(e.isTop){var v=e.isTop;a=e.level=0,l=e.dataLevel=0,p="data";e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[void 0],s+=" var vErrors = null; ",s+=" var errors = 0;     ",s+=" if (rootData === undefined) rootData = data; "}else{a=e.level,p="data"+((l=e.dataLevel)||"");if(o&&(e.baseId=e.resolve.url(e.baseId,o)),i&&!e.async)throw new Error("async schema in sync schema");s+=" var errs_"+a+" = errors;"}f="valid"+a,h=!e.opts.allErrors;var y="",g="",b=e.schema.type,E=Array.isArray(b);if(b&&e.opts.nullable&&!0===e.schema.nullable&&(E?-1==b.indexOf("null")&&(b=b.concat("null")):"null"!=b&&(b=[b,"null"],E=!0)),E&&1==b.length&&(b=b[0],E=!1),e.schema.$ref&&n){if("fail"==e.opts.extendRefs)throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'" (see option extendRefs)');!0!==e.opts.extendRefs&&(n=!1,e.logger.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(e.schema.$comment&&e.opts.$comment&&(s+=" "+e.RULES.all.$comment.code(e,"$comment")),b){if(e.opts.coerceTypes)var _=e.util.coerceToTypes(e.opts.coerceTypes,b);var P=e.RULES.types[b];if(_||E||!0===P||P&&!Y(P)){d=e.schemaPath+".type",u=e.errSchemaPath+"/type",d=e.schemaPath+".type",u=e.errSchemaPath+"/type";var w=E?"checkDataTypes":"checkDataType";if(s+=" if ("+e.util[w](b,p,!0)+") { ",_){var x="dataType"+a,C="coerced"+a;s+=" var "+x+" = typeof "+p+"; ","array"==e.opts.coerceTypes&&(s+=" if ("+x+" == 'object' && Array.isArray("+p+")) "+x+" = 'array'; "),s+=" var "+C+" = undefined; ";var S="",D=_;if(D)for(var M,T=-1,R=D.length-1;T<R;)M=D[T+=1],T&&(s+=" if ("+C+" === undefined) { ",S+="}"),"array"==e.opts.coerceTypes&&"array"!=M&&(s+=" if ("+x+" == 'array' && "+p+".length == 1) { "+C+" = "+p+" = "+p+"[0]; "+x+" = typeof "+p+";  } "),"string"==M?s+=" if ("+x+" == 'number' || "+x+" == 'boolean') "+C+" = '' + "+p+"; else if ("+p+" === null) "+C+" = ''; ":"number"==M||"integer"==M?(s+=" if ("+x+" == 'boolean' || "+p+" === null || ("+x+" == 'string' && "+p+" && "+p+" == +"+p+" ","integer"==M&&(s+=" && !("+p+" % 1)"),s+=")) "+C+" = +"+p+"; "):"boolean"==M?s+=" if ("+p+" === 'false' || "+p+" === 0 || "+p+" === null) "+C+" = false; else if ("+p+" === 'true' || "+p+" === 1) "+C+" = true; ":"null"==M?s+=" if ("+p+" === '' || "+p+" === 0 || "+p+" === false) "+C+" = null; ":"array"==e.opts.coerceTypes&&"array"==M&&(s+=" if ("+x+" == 'string' || "+x+" == 'number' || "+x+" == 'boolean' || "+p+" == null) "+C+" = ["+p+"]; ");s+=" "+S+" if ("+C+" === undefined) {   ",(X=X||[]).push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { type: '",s+=E?""+b.join(","):""+b,s+="' } ",!1!==e.opts.messages&&(s+=" , message: 'should be ",s+=E?""+b.join(","):""+b,s+="' "),e.opts.verbose&&(s+=" , schema: validate.schema"+d+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),s+=" } "):s+=" {} ";m=s;s=X.pop(),!e.compositeRule&&h?e.async?s+=" throw new ValidationError(["+m+"]); ":s+=" validate.errors = ["+m+"]; return false; ":s+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" } else {  ";var O=l?"data"+(l-1||""):"parentData";s+=" "+p+" = "+C+"; ",l||(s+="if ("+O+" !== undefined)"),s+=" "+O+"["+(l?e.dataPathArr[l]:"parentDataProperty")+"] = "+C+"; } "}else{(X=X||[]).push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { type: '",s+=E?""+b.join(","):""+b,s+="' } ",!1!==e.opts.messages&&(s+=" , message: 'should be ",s+=E?""+b.join(","):""+b,s+="' "),e.opts.verbose&&(s+=" , schema: validate.schema"+d+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),s+=" } "):s+=" {} ";m=s;s=X.pop(),!e.compositeRule&&h?e.async?s+=" throw new ValidationError(["+m+"]); ":s+=" validate.errors = ["+m+"]; return false; ":s+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}s+=" } "}}if(e.schema.$ref&&!n)s+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",h&&(s+=" } if (errors === ",s+=v?"0":"errs_"+a,s+=") { ",g+="}");else{var A=e.RULES;if(A)for(var j=-1,k=A.length-1;j<k;)if(Y(P=A[j+=1])){if(P.type&&(s+=" if ("+e.util.checkDataType(P.type,p)+") { "),e.opts.useDefaults&&!e.compositeRule)if("object"==P.type&&e.schema.properties){c=e.schema.properties;var I=Object.keys(c);if(I)for(var L,V=-1,N=I.length-1;V<N;){if(void 0!==($=c[L=I[V+=1]]).default)s+="  if ("+(U=p+e.util.getProperty(L))+" === undefined ","empty"==e.opts.useDefaults&&(s+=" || "+U+" === null || "+U+" === '' "),s+=" ) "+U+" = ","shared"==e.opts.useDefaults?s+=" "+e.useDefault($.default)+" ":s+=" "+JSON.stringify($.default)+" ",s+="; "}}else if("array"==P.type&&Array.isArray(e.schema.items)){var F=e.schema.items;if(F){T=-1;for(var $,z=F.length-1;T<z;){var U;if(void 0!==($=F[T+=1]).default)s+="  if ("+(U=p+"["+T+"]")+" === undefined ","empty"==e.opts.useDefaults&&(s+=" || "+U+" === null || "+U+" === '' "),s+=" ) "+U+" = ","shared"==e.opts.useDefaults?s+=" "+e.useDefault($.default)+" ":s+=" "+JSON.stringify($.default)+" ",s+="; "}}}var H=P.rules;if(H)for(var B,G=-1,q=H.length-1;G<q;)if(K(B=H[G+=1])){var Q=B.code(e,B.keyword,P.type);Q&&(s+=" "+Q+" ",h&&(y+="}"))}if(h&&(s+=" "+y+" ",y=""),P.type&&(s+=" } ",b&&b===P.type&&!_)){s+=" else { ";var X;d=e.schemaPath+".type",u=e.errSchemaPath+"/type";(X=X||[]).push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { type: '",s+=E?""+b.join(","):""+b,s+="' } ",!1!==e.opts.messages&&(s+=" , message: 'should be ",s+=E?""+b.join(","):""+b,s+="' "),e.opts.verbose&&(s+=" , schema: validate.schema"+d+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),s+=" } "):s+=" {} ";m=s;s=X.pop(),!e.compositeRule&&h?e.async?s+=" throw new ValidationError(["+m+"]); ":s+=" validate.errors = ["+m+"]; return false; ":s+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" } "}h&&(s+=" if (errors === ",s+=v?"0":"errs_"+a,s+=") { ",g+="}")}}function Y(e){for(var t=e.rules,r=0;r<t.length;r++)if(K(t[r]))return!0}function K(t){return void 0!==e.schema[t.keyword]||t.implements&&function(t){for(var r=t.implements,s=0;s<r.length;s++)if(void 0!==e.schema[r[s]])return!0}(t)}return h&&(s+=" "+g+" "),v?(i?(s+=" if (errors === 0) return data;           ",s+=" else throw new ValidationError(vErrors); "):(s+=" validate.errors = vErrors; ",s+=" return errors === 0;       "),s+=" }; return validate;"):s+=" var "+f+" = errors === errs_"+a+";",s=e.util.cleanUpCode(s),v&&(s=e.util.finalCleanUpCode(s,i)),s}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s,i=" ",n=e.level,o=e.dataLevel,a=e.schema[t],l=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,u="data"+(o||""),h=e.opts.$data&&a&&a.$data;h?(i+=" var schema"+n+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; ",s="schema"+n):s=a;var p="maximum"==t,f=p?"exclusiveMaximum":"exclusiveMinimum",m=e.schema[f],v=e.opts.$data&&m&&m.$data,y=p?"<":">",g=p?">":"<",b=void 0;if(v){var E=e.util.getData(m.$data,o,e.dataPathArr),_="exclusive"+n,P="exclType"+n,w="exclIsNumber"+n,x="' + "+(D="op"+n)+" + '";i+=" var schemaExcl"+n+" = "+E+"; ",i+=" var "+_+"; var "+P+" = typeof "+(E="schemaExcl"+n)+"; if ("+P+" != 'boolean' && "+P+" != 'undefined' && "+P+" != 'number') { ";var C;b=f;(C=C||[]).push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(b||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",!1!==e.opts.messages&&(i+=" , message: '"+f+" should be boolean' "),e.opts.verbose&&(i+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),i+=" } "):i+=" {} ";var S=i;i=C.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+S+"]); ":i+=" validate.errors = ["+S+"]; return false; ":i+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else if ( ",h&&(i+=" ("+s+" !== undefined && typeof "+s+" != 'number') || "),i+=" "+P+" == 'number' ? ( ("+_+" = "+s+" === undefined || "+E+" "+y+"= "+s+") ? "+u+" "+g+"= "+E+" : "+u+" "+g+" "+s+" ) : ( ("+_+" = "+E+" === true) ? "+u+" "+g+"= "+s+" : "+u+" "+g+" "+s+" ) || "+u+" !== "+u+") { var op"+n+" = "+_+" ? '"+y+"' : '"+y+"='; ",void 0===a&&(b=f,c=e.errSchemaPath+"/"+f,s=E,h=v)}else{x=y;if((w="number"==typeof m)&&h){var D="'"+x+"'";i+=" if ( ",h&&(i+=" ("+s+" !== undefined && typeof "+s+" != 'number') || "),i+=" ( "+s+" === undefined || "+m+" "+y+"= "+s+" ? "+u+" "+g+"= "+m+" : "+u+" "+g+" "+s+" ) || "+u+" !== "+u+") { "}else{w&&void 0===a?(_=!0,b=f,c=e.errSchemaPath+"/"+f,s=m,g+="="):(w&&(s=Math[p?"min":"max"](m,a)),m===(!w||s)?(_=!0,b=f,c=e.errSchemaPath+"/"+f,g+="="):(_=!1,x+="="));D="'"+x+"'";i+=" if ( ",h&&(i+=" ("+s+" !== undefined && typeof "+s+" != 'number') || "),i+=" "+u+" "+g+" "+s+" || "+u+" !== "+u+") { "}}b=b||t,(C=C||[]).push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(b||"_limit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { comparison: "+D+", limit: "+s+", exclusive: "+_+" } ",!1!==e.opts.messages&&(i+=" , message: 'should be "+x+" ",i+=h?"' + "+s:s+"'"),e.opts.verbose&&(i+=" , schema:  ",i+=h?"validate.schema"+l:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),i+=" } "):i+=" {} ";S=i;return i=C.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+S+"]); ":i+=" validate.errors = ["+S+"]; return false; ":i+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",d&&(i+=" else { "),i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s,i=" ",n=e.level,o=e.dataLevel,a=e.schema[t],l=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,u="data"+(o||""),h=e.opts.$data&&a&&a.$data;h?(i+=" var schema"+n+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; ",s="schema"+n):s=a,i+="if ( ",h&&(i+=" ("+s+" !== undefined && typeof "+s+" != 'number') || "),i+=" "+u+".length "+("maxItems"==t?">":"<")+" "+s+") { ";var p=t,f=f||[];f.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(p||"_limitItems")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+s+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have ",i+="maxItems"==t?"more":"fewer",i+=" than ",i+=h?"' + "+s+" + '":""+a,i+=" items' "),e.opts.verbose&&(i+=" , schema:  ",i+=h?"validate.schema"+l:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),i+=" } "):i+=" {} ";var m=i;return i=f.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+m+"]); ":i+=" validate.errors = ["+m+"]; return false; ":i+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",d&&(i+=" else { "),i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s,i=" ",n=e.level,o=e.dataLevel,a=e.schema[t],l=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,u="data"+(o||""),h=e.opts.$data&&a&&a.$data;h?(i+=" var schema"+n+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; ",s="schema"+n):s=a;var p="maxLength"==t?">":"<";i+="if ( ",h&&(i+=" ("+s+" !== undefined && typeof "+s+" != 'number') || "),!1===e.opts.unicode?i+=" "+u+".length ":i+=" ucs2length("+u+") ",i+=" "+p+" "+s+") { ";var f=t,m=m||[];m.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(f||"_limitLength")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+s+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT be ",i+="maxLength"==t?"longer":"shorter",i+=" than ",i+=h?"' + "+s+" + '":""+a,i+=" characters' "),e.opts.verbose&&(i+=" , schema:  ",i+=h?"validate.schema"+l:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),i+=" } "):i+=" {} ";var v=i;return i=m.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+v+"]); ":i+=" validate.errors = ["+v+"]; return false; ":i+=" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",d&&(i+=" else { "),i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s,i=" ",n=e.level,o=e.dataLevel,a=e.schema[t],l=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,u="data"+(o||""),h=e.opts.$data&&a&&a.$data;h?(i+=" var schema"+n+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; ",s="schema"+n):s=a,i+="if ( ",h&&(i+=" ("+s+" !== undefined && typeof "+s+" != 'number') || "),i+=" Object.keys("+u+").length "+("maxProperties"==t?">":"<")+" "+s+") { ";var p=t,f=f||[];f.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(p||"_limitProperties")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+s+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have ",i+="maxProperties"==t?"more":"fewer",i+=" than ",i+=h?"' + "+s+" + '":""+a,i+=" properties' "),e.opts.verbose&&(i+=" , schema:  ",i+=h?"validate.schema"+l:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),i+=" } "):i+=" {} ";var m=i;return i=f.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+m+"]); ":i+=" validate.errors = ["+m+"]; return false; ":i+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",d&&(i+=" else { "),i}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.mm=0]="mm",e[e.cm=1]="cm",e[e.m=2]="m",e[e.in=3]="in",e[e.ft=4]="ft",e[e.yd=5]="yd"}(t.EUnitType||(t.EUnitType={}))},function(e,t,r){"use strict";var s,i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Model=0]="Model",e[e.Geometry=1]="Geometry",e[e.Image=2]="Image",e[e.Texture=3]="Texture",e[e.Points=4]="Points",e[e.Volume=5]="Volume"}(s=t.EAssetType||(t.EAssetType={})),function(e){e[e.Color=0]="Color",e[e.Normal=1]="Normal",e[e.Occlusion=2]="Occlusion",e[e.Emissive=3]="Emissive",e[e.MetallicRoughness=4]="MetallicRoughness",e[e.Zone=5]="Zone"}(i=t.EMapType||(t.EMapType={}));class n{constructor(e,t){this.uri="",this.mimeType="",this.type=void 0,this.mapType=void 0,this.byteSize=0,this.numFaces=0,this.numVertices=0,this.imageSize=0,void 0===t?this.fromData(e):(this.type=e,this.uri=t)}isValid(){return!!this.uri&&void 0!==this.type}fromData(e){this.uri=e.uri,this.mimeType=e.mimeType||"",this.type=s[e.type],this.mapType=i[e.mapType],this.byteSize=e.byteSize||0,this.numFaces=e.numFaces||0,this.numVertices=e.numVertices||0,this.imageSize=e.imageSize||0,void 0===this.type&&(this.type=this.guessAssetType(),void 0===this.type&&console.warn(`failed to determine asset type from asset: ${this.uri}`))}toData(){const e={uri:this.uri,type:s[this.type]};return this.mimeType&&(e.mimeType=this.mimeType),void 0!==this.mapType&&(e.mapType=i[this.mapType]),this.byteSize>0&&(e.byteSize=this.byteSize),this.type!==s.Model&&this.type!==s.Geometry||(this.numFaces>0&&(e.numFaces=this.numFaces),this.numVertices>0&&(e.numVertices=this.numVertices)),this.type!==s.Image&&this.type!==s.Texture||this.imageSize>0&&(e.imageSize=this.imageSize),e}toString(){return`Asset - type: '${s[this.type]}', uri: '${this.uri}', mime type: '${this.mimeType||"(not set)"}'`}guessAssetType(){if(void 0!==this.type&&s[this.type])return this.type;if(this.mimeType){if(this.mimeType===n.mimeType.gltfJson||this.mimeType===n.mimeType.gltfBinary)return s.Model;if(this.mimeType===n.mimeType.imageJpeg||this.mimeType===n.mimeType.imagePng)return s.Image}const e=this.uri.split(".").pop().toLowerCase();return"gltf"===e||"glb"===e?s.Model:"obj"===e||"ply"===e?s.Geometry:"jpg"===e||"png"===e?s.Image:void 0}}n.mimeType={gltfJson:"model/gltf+json",gltfBinary:"model/gltf-binary",imageJpeg:"image/jpeg",imagePng:"image/png"},t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(19),i=r(37),n=[],o=(e,t,r)=>{const s=e.components.get(i.default).children;for(let e=0,r=s.length;e<r;++e){const r=s[e].node;if(r.is(t))return r}if(r)for(let e=0,r=s.length;e<r;++e){const r=o(s[e].node,t,!0);if(r)return r}return null},a=(e,t,r)=>{const s=e.components.get(i.default).children;let n=[];for(let e=0,r=s.length;e<r;++e){const r=s[e].node;r.is(t)&&n.push(r)}if(r)for(let e=0,r=s.length;e<r;++e)n=n.concat(a(s[e].node,t,!0));return n},l=(e,t,r)=>{const s=e.components.get(i.default).children;for(let e=0,r=s.length;e<r;++e){const r=s[e].node;if(r.name===t)return r}if(r)for(let e=0,r=s.length;e<r;++e){const r=l(s[e].node,t,!0);if(r)return r}return null};class c extends s.default{get hierarchy(){return this.components.get(i.default)}createComponents(){this.createComponent(i.default)}addChild(e){this.hierarchy.addChild(e.hierarchy)}removeChild(e){this.hierarchy.removeChild(e.hierarchy)}getRoot(){let e=this,t=this.hierarchy;for(;t;)e=t.node,t=t.parent;return e}getParent(e,t){let r=this.hierarchy,s=r?r.parent:null;if(!s)return null;if(s.node.is(e))return s.node;if(t)for(s=s.parent;s;)if(s.node.is(e))return s.node;return null}findChild(e,t){return this.hierarchy?l(this,e,t):null}getChild(e,t){return this.hierarchy?o(this,e,t):null}getChildren(e,t){return this.hierarchy?a(this,e,t):n}hasChildren(e,t){return!!this.hierarchy&&!!o(this,e,t)}}c.type="NHierarchy",t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(48),i=r(28);class n extends s.default{set innerRoot(e){if(e.is(i.default)){const t=this.components.get(i.default),r=this.innerRoot,s=e;t&&r&&t.removeObject3D(r.object3D),super.innerRoot=s,t&&s&&t.addObject3D(s.object3D)}}}n.type="CRenderGraph",t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(21),i=r(53),n=r(0),o=r(77),a=r(56),l={dump:n.types.Event("Dump"),download:n.types.Event("Download")};class c extends n.default{constructor(){super(...arguments),this.ins=this.addInputs(l),this.url="",this.assetPath="",this.assetBaseName=""}get urlPath(){return s.default(".",this.url)}get urlName(){return this.url.substr(this.urlPath.length)}setUrl(e,t,r){this.url=e,this.assetPath=t||this.urlPath||"",this.assetBaseName=r||"",this.node.name=this.urlName}get setupNode(){return this.graph.nodes.get(a.default)}get sceneNode(){return this.graph.nodes.get(o.default)}update(){const e=this.ins;return e.dump.changed&&(console.log("CPresentationData - dump"),console.log(JSON.parse(JSON.stringify(this.toData())))),e.download.changed&&i.default.json(this.toData(),this.urlName||"presentation.json"),!1}fromData(e,t){this.sceneNode.fromData(e,t),e.config&&this.setupNode&&this.setupNode.fromData(e.config)}toData(e=!1){const t=this.sceneNode.toData(e);return t.config=this.setupNode.toData(),t.info={type:c.mimeType,copyright:"Copyright Smithsonian Institution",generator:"Voyager Presentation Parser",version:"1.2"},t}}c.type="CVPresentationData",c.mimeType="application/si-dpo-3d.presentation+json",t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(23),i=r(24);class n extends s.default{get scene(){return this.components.get(i.default)}createComponents(){this.createComponent(i.default)}}n.type="NScene",t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(23),i=r(50);t.EProjection=i.EProjection;class n extends s.default{get camera(){return this.components.get(i.default)}createComponents(){super.createComponents(),this.createComponent(i.default)}}n.type="NCamera",t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(55),i=r(103);class n extends s.default{get light(){return this.components.get(i.default)}createComponents(){super.createComponents(),this.createComponent(i.default)}}n.type="NDirectionalLight",t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(3),n=r(41),o={position:i.types.Vector3("Position",[0,1,0]),target:i.types.Vector3("Target")};class a extends n.default{constructor(){super(...arguments),this.ins=this.addInputs(o)}get light(){return this.object3D}create(){super.create(),this.object3D=new s.DirectionalLight}update(){const e=this.light,{color:t,intensity:r,position:s,target:i}=this.ins;return e.color.fromArray(t.value),e.intensity=r.value,e.position.fromArray(s.value),e.target.position.fromArray(i.value),e.updateMatrix(),!0}}a.type="CDirectionalLight",t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(55),i=r(105);class n extends s.default{get light(){return this.components.get(i.default)}createComponents(){super.createComponents(),this.createComponent(i.default)}}n.type="NPointLight",t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(3),n=r(41),o={distance:i.types.Number("Distance"),decay:i.types.Number("Decay",1)};class a extends n.default{constructor(){super(...arguments),this.ins=this.addInputs(o)}get light(){return this.object3D}create(){super.create(),this.object3D=new s.PointLight}update(){const e=this.light,{color:t,intensity:r,distance:s,decay:i}=this.ins;return e.color.fromArray(t.value),e.intensity=r.value,e.distance=s.value,e.decay=i.value,e.updateMatrix(),!0}}a.type="CPointLight",t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(55),i=r(107);class n extends s.default{get light(){return this.components.get(i.default)}createComponents(){super.createComponents(),this.createComponent(i.default)}}n.type="NSpotLight",t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(3),n=r(41),o={distance:i.types.Number("Distance"),decay:i.types.Number("Decay",1),angle:i.types.Number("Angle",45),penumbra:i.types.Number("Penumbra",.5)};class a extends n.default{constructor(){super(...arguments),this.ins=this.addInputs(o)}get light(){return this.object3D}create(){super.create(),this.object3D=new s.SpotLight}update(){const e=this.light,{color:t,intensity:r,distance:s,decay:i,angle:n,penumbra:o}=this.ins;return e.color.fromArray(t.value),e.intensity=r.value,e.distance=s.value,e.decay=i.value,e.angle=n.value,e.penumbra=o.value,e.updateMatrix(),!0}}a.type="CSpotLight",t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(3),n=r(14),o=r(109),a=r(39),l=r(25),c=new s.Vector3,d=(new s.Matrix4).makeRotationX(.5*Math.PI),u=new s.Matrix4,h={visible:i.types.Boolean("Visible",!0),color:i.types.ColorRGB("Color",[.5,.7,.8]),update:i.types.Event("Update")},p={size:i.types.Number("Size"),units:i.types.Enum("Units",a.EUnitType)};class f extends n.default{constructor(){super(...arguments),this.ins=this.addInputs(h),this.outs=this.addOutputs(p),this._lastViewport=null,this._gridProps={size:20,mainDivisions:2,subDivisions:10,mainColor:new s.Color(.5,.7,.8),subColor:new s.Color(.25,.35,.4)}}get grid(){return this.object3D}get scene(){return this.graph.components.safeGet(l.default)}create(){this.scene.on("change",this.onSceneChange,this)}dispose(){this.scene.off("change",this.onSceneChange,this)}update(){const e=this.ins;if(e.color.changed||e.update.changed){const t=this._gridProps;if(e.color.changed){const r=t.mainColor,s=t.subColor;r.fromArray(e.color.value),s.r=.5*r.r,s.g=.5*r.g,s.b=.5*r.b}if(e.update.changed){const e=this.scene.boundingBox,r=this.scene.ins.units.value;e.getSize(c);let s=Math.max(c.x,c.y,c.z);for(s=2*Math.ceil(s),t.size=s,this.outs.size.setValue(s),this.outs.units.setValue(r);s>100;)s*=.1;t.mainDivisions=s,t.subDivisions=10}this.object3D?this.grid.update(t):this.object3D=new o.default(t)}return e.visible.changed&&(this.grid.visible=e.visible.value),!0}beforeRender(e){const t=e.viewport,r=this.object3D;if(t!==this._lastViewport){this._lastViewport=t;const s=e.viewport.viewportCamera;s?r.matrix.extractRotation(s.matrixWorld).multiply(d):r.matrix.extractRotation(u),r.updateMatrixWorld(!0)}}afterRender(e){this.object3D.matrix.extractRotation(u)}fromData(e){this.ins.copyValues({visible:e.visible,color:e.color})}toData(){const e=this.ins;return{visible:e.visible.cloneValue(),color:e.color.cloneValue()}}onSceneChange(e){"boundingBox"===e.what&&this.ins.update.set()}}f.type="CVHomeGrid",t.default=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2);class i extends s.LineSegments{constructor(e){super(i.generate(e),new s.LineBasicMaterial({vertexColors:s.VertexColors}))}update(e){this.geometry&&this.geometry.dispose(),this.geometry=i.generate(e)}static generate(e){const t=new s.Color(e.mainColor),r=new s.Color(e.subColor),i=e.mainDivisions*e.subDivisions,n=e.size/i,o=.5*e.size,a=[],l=[];for(let s=0,c=0,d=-o;s<=i;++s,d+=n){a.push(-o,0,d,o,0,d),a.push(d,0,-o,d,0,o);const i=s%e.subDivisions==0?t:r;i.toArray(l,c),c+=3,i.toArray(l,c),c+=3,i.toArray(l,c),c+=3,i.toArray(l,c),c+=3}const c=new s.BufferGeometry;return c.addAttribute("position",new s.Float32BufferAttribute(a,3)),c.addAttribute("color",new s.Float32BufferAttribute(l,3)),c}}t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(3),i=r(14),n=r(39);t.EBackgroundType=n.EBackgroundType;const o={type:s.types.Enum("Background.Type",n.EBackgroundType),color0:s.types.ColorRGB("Background.Color0",[1,0,0]),color1:s.types.ColorRGB("Background.Color1",[0,1,0])};class a extends i.default{constructor(){super(...arguments),this.ins=this.addInputs(o)}fromData(e){this.ins.copyValues({type:n.EBackgroundType[e.type]||n.EBackgroundType.Solid,color0:e.color0,color1:e.color1})}toData(){const e=this.ins;return{type:n.EBackgroundType[e.type.value],color0:e.color0.cloneValue(),color1:e.color1.cloneValue()}}}a.type="CVBackground",t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(3),i=r(14),n={visible:s.types.Boolean("Visible",!0),offset:s.types.Number("Offset"),color:s.types.ColorRGB("Color",[0,0,1]),shadowVisible:s.types.Boolean("Shadow.Visible"),shadowColor:s.types.ColorRGBA("Shadow.Color")};class o extends i.default{constructor(){super(...arguments),this.ins=this.addInputs(n)}update(){return!0}fromData(e){this.ins.copyValues({visible:e.visible,offset:e.offset,color:e.color,shadowVisible:e.shadowVisible,shadowColor:e.shadowColor})}toData(){const e=this.ins;return{visible:e.visible.cloneValue(),offset:e.offset.cloneValue(),color:e.color.cloneValue(),shadowVisible:e.shadowVisible.cloneValue(),shadowColor:e.shadowColor.cloneValue()}}}o.type="CVGroundPlane",t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(3),i=r(0),n={active:s.types.Boolean("Active"),startPosition:s.types.Vector3("Start.Position"),startDirection:s.types.Vector3("Start.Direction"),endPosition:s.types.Vector3("End.Position"),endDirection:s.types.Vector3("End.Direction")};class o extends i.default{constructor(){super(...arguments),this.ins=this.addInputs(n)}fromData(e){this.ins.copyValues({active:e.active,startPosition:e.startPosition,startDirection:e.startDirection,endPosition:e.endPosition,endDirection:e.endDirection})}toData(){const e=this.ins;return{active:e.active.cloneValue(),startPosition:e.startPosition.cloneValue(),startDirection:e.startDirection.cloneValue(),endPosition:e.endPosition.cloneValue(),endDirection:e.endDirection.cloneValue()}}}o.type="CVTapeTool",t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(3),i=r(0),n={active:s.types.Boolean("Active"),plane:s.types.Vector4("Plane")};class o extends i.default{constructor(){super(...arguments),this.ins=this.addInputs(n)}fromData(e){this.ins.copyValues({active:e.active,plane:e.plane})}toData(){const e=this.ins;return{active:e.active.value,plane:e.plane.cloneValue()}}}o.type="CVSectionTool",t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(23),i=r(115);class n extends s.default{get reference(){return this.components.get(i.default)}createComponents(){super.createComponents(),this.createComponent(i.default),this.name="Reference"}fromData(e){this.reference.fromData(e)}toData(){return this.reference.toData()}}n.type="NVReference",t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i={uri:s.types.String("URI"),mimeType:s.types.String("MIMEType")};class n extends s.default{constructor(){super(...arguments),this.ins=this.addInputs(i)}update(e){return!1}deflate(){const e=this.toData();return e?{data:e}:null}inflate(e){e.data&&this.fromData(e)}toData(){const e=this.ins;return{uri:e.uri.value,mimeType:e.mimeType.value}}fromData(e){this.ins.setValues({uri:e.uri,mimeType:e.mimeType})}}n.type="CVReference",t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(9),i=r(0);class n extends i.default{constructor(){super(...arguments),this.items={}}has(e){return!!this.items[e]}get(e){return this.items[e]}insert(e){return e.id||(e.id=s.default(8)),this.items[e.id]=e,e.id}remove(e){const t=this.items[e];return this.items[e]=void 0,t}count(){return this.getArray().length}findRootCollection(){const e=this.hierarchy;return e?e.getRoot(this):null}getDictionary(){if(!this.items)return{};const e=Object.keys(this.items),t={};return e.forEach(e=>{const r=this.items[e];void 0!==r&&(t[r.id]=r)}),t}getArray(){return this.items?Object.keys(this.items).map(e=>this.items[e]).filter(e=>void 0!==e):[]}toString(){return super.toString()+` - items: ${this.count()}`}}n.type="CVCollection",t.default=n},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1),n=r(42),o=r(78),a=r(83),l=r(222),c=r(231);r(237),n.default.add("video",i.html`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M336.2 64H47.8C21.4 64 0 85.4 0 111.8v288.4C0 426.6 21.4 448 47.8 448h288.4c26.4 0 47.8-21.4 47.8-47.8V111.8c0-26.4-21.4-47.8-47.8-47.8zm189.4 37.7L416 177.3v157.4l109.6 75.5c21.2 14.6 50.4-.3 50.4-25.8V127.5c0-25.4-29.1-40.4-50.4-25.8z"/></svg>`),n.default.add("eye",i.html`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M569.354 231.631C512.969 135.949 407.81 72 288 72 168.14 72 63.004 135.994 6.646 231.631a47.999 47.999 0 0 0 0 48.739C63.031 376.051 168.19 440 288 440c119.86 0 224.996-63.994 281.354-159.631a47.997 47.997 0 0 0 0-48.738zM288 392c-75.162 0-136-60.827-136-136 0-75.162 60.826-136 136-136 75.162 0 136 60.826 136 136 0 75.162-60.826 136-136 136zm104-136c0 57.438-46.562 104-104 104s-104-46.562-104-104c0-17.708 4.431-34.379 12.236-48.973l-.001.032c0 23.651 19.173 42.823 42.824 42.823s42.824-19.173 42.824-42.823c0-23.651-19.173-42.824-42.824-42.824l-.032.001C253.621 156.431 270.292 152 288 152c57.438 0 104 46.562 104 104z"/></svg>`),n.default.add("palette",i.html`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M204.3 5C104.9 24.4 24.8 104.3 5.2 203.4c-37 187 131.7 326.4 258.8 306.7 41.2-6.4 61.4-54.6 42.5-91.7-23.1-45.4 9.9-98.4 60.9-98.4h79.7c35.8 0 64.8-29.6 64.9-65.3C511.5 97.1 368.1-26.9 204.3 5zM96 320c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm32-128c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128-64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128 64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"/></svg>`),n.default.add("comment",i.html`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 32C114.6 32 0 125.1 0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3 0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4 0 256-93.1 256-208S397.4 32 256 32z"/></svg>`),n.default.add("document",i.html`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm64 236c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-64c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-72v8c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12zm96-114.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"/></svg>`),n.default.add("upload",i.html`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M369.83 97.98L285.94 14.1c-9-9-21.2-14.1-33.89-14.1H47.99C21.5.1 0 21.6 0 48.09v415.92C0 490.5 21.5 512 47.99 512h287.94c26.5 0 48.07-21.5 48.07-47.99V131.97c0-12.69-5.17-24.99-14.17-33.99zM255.95 51.99l76.09 76.08h-76.09V51.99zM336 464.01H47.99V48.09h159.97v103.98c0 13.3 10.7 23.99 24 23.99H336v287.95zM182.98 227.79l-72.31 71.77c-7.6 7.54-2.26 20.52 8.45 20.52H168v84c0 6.63 5.37 12 12 12h24c6.63 0 12-5.37 12-12v-84h48.88c10.71 0 16.05-12.97 8.45-20.52l-72.31-71.77c-4.99-4.95-13.05-4.95-18.04 0z"/></svg>`),n.default.add("download",i.html`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M216 236.07c0-6.63-5.37-12-12-12h-24c-6.63 0-12 5.37-12 12v84.01h-48.88c-10.71 0-16.05 12.97-8.45 20.52l72.31 71.77c4.99 4.95 13.04 4.95 18.03 0l72.31-71.77c7.6-7.54 2.26-20.52-8.45-20.52H216v-84.01zM369.83 97.98L285.94 14.1c-9-9-21.2-14.1-33.89-14.1H47.99C21.5.1 0 21.6 0 48.09v415.92C0 490.5 21.5 512 47.99 512h287.94c26.5 0 48.07-21.5 48.07-47.99V131.97c0-12.69-5.17-24.99-14.17-33.99zM255.95 51.99l76.09 76.08h-76.09V51.99zM336 464.01H47.99V48.09h159.97v103.98c0 13.3 10.7 23.99 24 23.99H336v287.95z"/></svg>`),n.default.add("trash",i.html`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M192 188v216c0 6.627-5.373 12-12 12h-24c-6.627 0-12-5.373-12-12V188c0-6.627 5.373-12 12-12h24c6.627 0 12 5.373 12 12zm100-12h-24c-6.627 0-12 5.373-12 12v216c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12V188c0-6.627-5.373-12-12-12zm132-96c13.255 0 24 10.745 24 24v12c0 6.627-5.373 12-12 12h-20v336c0 26.51-21.49 48-48 48H80c-26.51 0-48-21.49-48-48V128H12c-6.627 0-12-5.373-12-12v-12c0-13.255 10.745-24 24-24h74.411l34.018-56.696A48 48 0 0 1 173.589 0h100.823a48 48 0 0 1 41.16 23.304L349.589 80H424zm-269.611 0h139.223L276.16 50.913A6 6 0 0 0 271.015 48h-94.028a6 6 0 0 0-5.145 2.913L154.389 80zM368 128H80v330a6 6 0 0 0 6 6h276a6 6 0 0 0 6-6V128z"/></svg>`);let d=class extends i.default{constructor(e){if(super(),e)this.application=e;else{const e={presentation:this.getAttribute("presentation"),item:this.getAttribute("item"),model:this.getAttribute("model"),geometry:this.getAttribute("geometry"),texture:this.getAttribute("texture"),quality:this.getAttribute("quality"),template:this.getAttribute("template"),base:this.getAttribute("base")};this.application=new a.default(null,e)}}firstConnected(){const e=this.application.system;new l.default(e).appendTo(this),new c.default(e).appendTo(this);const t=document.createElement("div");t.setAttribute("id",o.default.stackId),this.appendChild(t)}};d=s([i.customElement("voyager-explorer")],d),t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(49),i=r(224);var n;!function(e){e[e.Single=0]="Single",e[e.HorizontalSplit=1]="HorizontalSplit",e[e.VerticalSplit=2]="VerticalSplit",e[e.Quad=3]="Quad"}(n=t.EQuadViewLayout||(t.EQuadViewLayout={}));t.default=class extends i.default{constructor(e,t,r){super(e,t,r),this._horizontalSplit=.5,this._verticalSplit=.5,this._layout=n.Quad,this.addEvent("layout"),this.addViewports(4),this.viewports[1].setBuiltInCamera(s.EProjection.Orthographic,s.EViewPreset.Top),this.viewports[1].enableCameraManip(!0).orientationEnabled=!1,this.viewports[2].setBuiltInCamera(s.EProjection.Orthographic,s.EViewPreset.Left),this.viewports[2].enableCameraManip(!0).orientationEnabled=!1,this.viewports[3].setBuiltInCamera(s.EProjection.Orthographic,s.EViewPreset.Front),this.viewports[3].enableCameraManip(!0).orientationEnabled=!1,this.layout=n.Single}set layout(e){this._layout!==e&&(this._layout=e,this.updateConfiguration(),this.emit({type:"layout",layout:e}))}get layout(){return this._layout}set horizontalSplit(e){this._horizontalSplit=e,this.updateSplitPositions()}get horizontalSplit(){return this._horizontalSplit}set verticalSplit(e){this._verticalSplit=e,this.updateSplitPositions()}get verticalSplit(){return this._verticalSplit}updateConfiguration(){switch(this.updateSplitPositions(),this.viewports[0].enabled=!0,this._layout){case n.Single:this.viewports[1].enabled=!1,this.viewports[2].enabled=!1,this.viewports[3].enabled=!1;break;case n.HorizontalSplit:case n.VerticalSplit:this.viewports[1].enabled=!0,this.viewports[2].enabled=!1,this.viewports[3].enabled=!1;break;case n.Quad:this.viewports[1].enabled=!0,this.viewports[2].enabled=!0,this.viewports[3].enabled=!0}}updateSplitPositions(){const e=this._horizontalSplit,t=this._verticalSplit;switch(this._layout){case n.Single:this.viewports[0].setSize(0,0,1,1);break;case n.HorizontalSplit:this.viewports[0].setSize(0,0,e,1),this.viewports[1].setSize(e,0,1-e,1);break;case n.VerticalSplit:this.viewports[0].setSize(0,0,1,t),this.viewports[1].setSize(0,t,1,1-t);break;case n.Quad:this.viewports[0].setSize(0,0,e,t),this.viewports[1].setSize(e,0,1-e,t),this.viewports[2].setSize(0,t,e,1-t),this.viewports[3].setSize(e,t,1-e,1-t)}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(19),i=r(37),n=function(e,t){const r=t.components.get(e);if(r)return r;const s=t.components.get(i.default);if(!s||0===s.children.length)return null;for(let t=0,r=s.children.length;t<r;++t){const r=n(e,s.children[t].node);if(r)return r}return null};t.default=class{constructor(e,t){this._property=null,this._callback=e,this._context=t}get property(){return this._property}set property(e){this.detach(),this._property=e,e.on("value",this.onPropertyValue,this),e.on("dispose",this.onPropertyDispose,this)}getValue(e){return this._property?this._property.value:e}setValue(e){this._property&&this._property.setValue(e)}set(){this._property&&this._property.set()}attachInput(e,t,r){let i=e instanceof s.default?n(t,e):e.components.get(t);if(!i)throw new Error(`component type not found: '${t}'`);this.property=i.ins.getProperty(r)}attachOutput(e,t,r){let i=e instanceof s.default?n(t,e):e.components.get(t);if(!i)throw new Error(`component type not found: '${t}'`);this.property=i.outs.getProperty(r)}detach(){this._property&&(this._property.off("value",this.onPropertyValue,this),this._property.off("dispose",this.onPropertyDispose,this))}isAttached(){return!!this._property}onPropertyValue(e){this._callback&&(this._context?this._callback.call(this._context,e):this._callback(e))}onPropertyDispose(){this._property.off("value",this.onPropertyValue,this),this._property.off("dispose",this.onPropertyDispose,this),this._property=null}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(21),i=r(53),n=r(121),o=r(240),a=r(0),l=r(78),c=r(13),d=r(51),u=r(26),h=r(30),p=r(27),f=r(241),m=r(32),v=[d.EDerivativeQuality.Thumb,d.EDerivativeQuality.Low,d.EDerivativeQuality.Medium,d.EDerivativeQuality.High],y={[d.EDerivativeQuality.Thumb]:[320,320],[d.EDerivativeQuality.Low]:[640,640],[d.EDerivativeQuality.Medium]:[1280,1280],[d.EDerivativeQuality.High]:[2560,2560]};var g;!function(e){e[e.JPEG=0]="JPEG",e[e.PNG=1]="PNG"}(g=t.EFileType||(t.EFileType={}));const b={[g.JPEG]:"image/jpeg",[g.PNG]:"image/png"},E={[g.JPEG]:"jpg",[g.PNG]:"png"},_={take:a.types.Event("Picture.Take"),save:a.types.Event("Picture.Save"),download:a.types.Event("Picture.Download"),remove:a.types.Event("Picture.Remove"),type:a.types.Enum("Picture.Type",g),quality:a.types.Number("Picture.Quality",{min:0,max:1,preset:.85})},P={ready:a.types.Boolean("Picture.Ready")};class w extends m.default{constructor(){super(...arguments),this.ins=this.addInputs(_),this.outs=this.addOutputs(P),this.activeModel=null,this._interfaceVisible=!1,this._gridVisible=!1,this._bracketsVisible=!1,this._imageDataURIs={},this._imageElements={},this._mimeType="",this._extension=""}get interface(){return this.system.components.get(h.default)}get renderer(){return this.system.components.get(c.default)}getImageElement(e=d.EDerivativeQuality.Low){return this._imageElements[e]}arePicturesReady(){return this.outs.ready.value}createView(){return new f.default(this)}activate(){super.activate(),this.selection.selectedComponents.on(u.default,this.onSelectModel,this),this._bracketsVisible=this.selection.ins.bracketsVisible.value,this.selection.ins.bracketsVisible.setValue(!1);const e=this.interface;e&&(this._interfaceVisible=e.ins.visible.value,e.ins.visible.setValue(!1))}deactivate(){super.deactivate(),this.selection.selectedComponents.off(u.default,this.onSelectModel,this),this.selection.ins.bracketsVisible.setValue(this._bracketsVisible);const e=this.interface;e&&e.ins.visible.setValue(this._interfaceVisible)}update(){const e=this.ins;if(e.take.changed){const t=e.type.getValidatedValue();this.takePictures(e.quality.value,b[t],E[t])}return e.save.changed&&this.uploadPictures(),e.download.changed&&this.downloadPicture(),e.remove.changed&&this.removePictures(),!0}takePictures(e,t,r){this._mimeType=t,this._extension=r;const s=this.renderer.views[0];s?(v.forEach(e=>{const r=s.renderImage(y[e][0],y[e][1],t,e);this._imageDataURIs[e]=r;const i=this._imageElements[e]||document.createElement("img");i.src=r,this._imageElements[e]=i}),this.outs.ready.setValue(!0)):console.warn("can't render to image, no view attached")}uploadPictures(){const e=this.activeModel;e&&this.arePicturesReady()&&v.forEach(t=>{const r=this._imageDataURIs[t],s=this.getImageFileName(t,this._extension),i=e.assetPath+s,a=o.default.dataURItoBlob(r),c=new File([a],s);n.default.file(i,"PUT",c).then(()=>{this.updateDerivative(t,this._mimeType,s),new l.default(`Successfully uploaded image to '${i}'`,"info",4e3)}).catch(e=>{new l.default(`Failed to upload image to '${i}'`,"error",8e3)})})}downloadPicture(){if(!this.arePicturesReady())return;const e=this._imageDataURIs[d.EDerivativeQuality.High],t=this.getImageFileName(d.EDerivativeQuality.High,this._extension);i.default.url(e,t)}updateDerivative(e,t,r){if(!this.arePicturesReady())return;const s=this.activeModel.derivatives.getOrCreate(d.EDerivativeUsage.Web2D,e),i=s.findAsset(d.EAssetType.Image)||s.createAsset(d.EAssetType.Image,r);i.uri=r,i.imageSize=Math.max(y[e][0],y[e][1]),i.mimeType=t,i.byteSize=Math.ceil(this._imageDataURIs[e].length/4*3)}getImageFileName(e,t){const r=this.activeModel.assetBaseName,s=`image-${d.EDerivativeQuality[e].toLowerCase()}.${t}`;return r?r+"-"+s:s}removePictures(){console.warn("CCaptureTask.removePictures - not implemented yet")}setActivePresentation(e){const t=this.activePresentation;t&&t.setup.homeGrid.ins.visible.setValue(this._gridVisible),e&&(this._gridVisible=e.setup.homeGrid.ins.visible.value,e.setup.homeGrid.ins.visible.setValue(!1))}setActiveItem(e){e&&e.model?(this.activeModel=e.model,this.selection.selectComponent(this.activeModel),v.forEach(t=>{const r=e.model.derivatives.get(d.EDerivativeUsage.Web2D,t);if(r){const i=r.findAsset(d.EAssetType.Image);if(i){const r=document.createElement("img");r.src=s.default(i.uri,e.model.assetPath),this._imageElements[t]=r}}})):(this.outs.ready.setValue(!1),this.activeModel=null,this._imageElements={},this._imageDataURIs={})}onSelectModel(e){e.add&&e.component.node instanceof p.default&&(this.presentations.activeItem=e.component.node)}}w.type="CVCaptureTask",w.text="Capture",w.icon="camera",t.default=w},function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(i,n){function o(e){try{l(s.next(e))}catch(e){n(e)}}function a(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(o,a)}l((s=s.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.default={json:function(e,t,r){return s(this,void 0,void 0,function*(){let s,i;return r&&"string"!=typeof r&&(r=JSON.stringify(r)),fetch(e,{headers:{Accept:"application/json","Content-Type":"application/json"},method:t,credentials:"include",body:r}).then(r=>(r.ok||console.warn(`fetch (${t} at ${e}) status ${r.status} ${r.statusText}`),s=r.ok,i=r.status,r.json())).then(e=>(e.error&&console.warn(e.error),{ok:s,status:i,json:e})).catch(r=>{throw console.error(`fetch (${t} at ${e}) error: ${r}`),r})})},file:function(e,t,r){return s(this,void 0,void 0,function*(){return fetch(e,{headers:{"Content-Type":r.type},method:t,credentials:"include",body:r}).then(e=>{if(!e.ok)throw new Error(`${e.status}`);return e}).catch(r=>{throw console.error(`fetch (${t} at ${e}), error: ${r.message}`),r})})}}},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(9),n=r(1);t.customElement=n.customElement,t.property=n.property,t.html=n.html,t.TemplateResult=n.TemplateResult;let o=class extends n.default{constructor(e){super(),this.data=null,this.data=e,this._itemById=new Map,this._idByItem=new Map,this._containerId=i.default(4),this.onClickEmpty=this.onClickEmpty.bind(this),this.addEventListener("click",this.onClickEmpty)}setSelected(e,t){const r=this._idByItem.get(e);if(r){const e=document.getElementById(r);void 0===t&&(t=!e.hasAttribute("selected")),t?e.setAttribute("selected",""):e.removeAttribute("selected")}}toggleSelected(e){this.setSelected(e,void 0)}isSelected(e){const t=this._idByItem.get(e);if(t){return document.getElementById(t).hasAttribute("selected")}return!1}firstConnected(){this.setStyle({display:"flex",flexDirection:"column"}),this.classList.add("ff-list")}render(){this._itemById.clear(),this._idByItem.clear();const e=this.data;if(!e)return null;let t;return n.html`${n.repeat(e,e=>t=this.getId(e)+this._containerId,e=>{this._itemById.set(t,e),this._idByItem.set(e,t);const r=this.isItemSelected(e),s=this.isItemExpanded(e),i="ff-list-item "+this.getClass(e);return n.html`<div class=${i} id=${t} ?selected=${r} ?expanded=${s} @click=${this.onClick}>
                    ${this.renderItem(e)}
                </div>`})}`}renderItem(e){return String(e)}getId(e){return e.id||i.default()}getClass(e){return""}isItemSelected(e){return void 0!==e.selected&&e.selected}isItemExpanded(e){return void 0===e.expanded||e.expanded}onClick(e){const t=e.currentTarget,r=this._itemById.get(t.id);r&&this.onClickItem(e,r),e.stopPropagation()}onClickItem(e,t){}onClickEmpty(e){}};s([n.property({attribute:!1})],o.prototype,"data",void 0),o=s([n.customElement("ff-list")],o),t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(244),i=r(32);class n extends i.default{constructor(){super(...arguments),this.activeModel=null}createView(){return new s.default(this)}activate(){super.activate()}deactivate(){super.deactivate()}setActiveItem(e){e&&e.model?(this.activeModel=e.model,this.selection.selectComponent(this.activeModel)):this.activeModel=null}}n.type="CVExploreTask",n.text="Explore",n.icon="eye",t.default=n},function(e,t,r){"use strict";var s,i=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const n=r(20),o=r(61);t.Property=o.default;const a=r(247),l=r(1);let c=s=class extends l.default{constructor(e){super(),this.index=void 0,this.value=void 0,this.isActive=!1,this.isDragging=!1,this.startValue=0,this.startX=0,this.startY=0,this.lastX=0,this.lastY=0,this.editElement=null,this.barElement=null,this.buttonElement=null,this.contentElement=null,this.onFocus=this.onFocus.bind(this),this.onClick=this.onClick.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onSelectOption=this.onSelectOption.bind(this),this.addEventListener("focus",this.onFocus),this.addEventListener("click",this.onClick),this.addEventListener("contextmenu",this.onContextMenu),this.addEventListener("pointerdown",this.onPointerDown),this.addEventListener("pointermove",this.onPointerMove),this.addEventListener("pointerup",this.onPointerUp),this.addEventListener("pointercancel",this.onPointerUp),this.property=e}update(e){this.contentElement&&(this.contentElement.remove(),this.contentElement=null),this.barElement&&(this.barElement.remove(),this.barElement=null),this.buttonElement&&(this.buttonElement.remove(),this.buttonElement=null);const t=this.property,r=t.schema;if(r.event)this.buttonElement=this.appendElement("div"),this.buttonElement.classList.add("ff-off","ff-event-button");else{this.contentElement=this.appendElement("div"),this.contentElement.classList.add("ff-off","ff-content");const{min:e,max:t,bar:s}=r;r.options||void 0===e||void 0===t||void 0===s||(this.barElement=this.appendElement("div"),this.barElement.classList.add("ff-fullsize","ff-off","ff-bar"))}const s=this.classList,i=t.isInput();i?(s.add("ff-input"),s.remove("ff-output")):(s.add("ff-output"),s.remove("ff-input")),(i?t.hasInLinks(this.index):t.hasOutLinks(this.index))?s.add("ff-linked"):s.remove("ff-linked"),r.event?s.add("ff-event"):s.remove("ff-event"),r.options?s.add("ff-option"):s.remove("ff-option"),this.setAttribute("title",t.toString()+(this.index>=0?`[${this.index}]`:"")),this.updateElement()}firstConnected(){if(this.tabIndex=0,this.setStyle({position:"relative",overflow:"hidden"}),this.classList.add("ff-property-field"),!this.property)throw new Error("missing property")}connected(){this.property.on("value",this.onPropertyValue,this),this.property.on("change",this.onPropertyChange,this)}disconnected(){this.property.off("value",this.onPropertyValue,this),this.property.off("change",this.onPropertyChange,this)}onFocus(e){}onClick(e){const t=this.property,r=t.schema;if(r.event)t.set();else if(!this.isDragging){if(r.options){const s=new a.default;return s.options=r.options,s.selectionIndex=t.getValidatedValue(),s.position="anchor",s.anchor=this,s.align="fixed",s.justify="end",s.positionX=e.clientX-10,s.keepVisible=!0,s.addEventListener(a.default.selectEvent,this.onSelectOption),void document.body.appendChild(s)}switch(t.type){case"number":case"string":this.startEditing();break;case"boolean":this.updateProperty(!this.value)}}}onContextMenu(e){this.property.reset(),e.preventDefault()}onPointerDown(e){if(!e.isPrimary||0!==e.button)return;this.isDragging=!1;const t=this.property;"number"!==t.type||t.schema.options||(this.isActive=!0,this.startX=e.clientX,this.startY=e.clientY)}onPointerMove(e){if(e.isPrimary&&this.isActive){if(!this.isDragging){const t=e.clientX-this.startX,r=e.clientY-this.startY;Math.abs(t)+Math.abs(r)>2&&(this.setPointerCapture(e.pointerId),this.isDragging=!0,this.startX=e.clientX,this.startY=e.clientY,this.startValue=this.value)}if(this.isDragging){const t=e.clientX-this.startX-(e.clientY-this.startY),r=this.property.schema;let i=s.defaultSpeed;r.speed?i=r.speed:void 0!==r.min&&void 0!==r.max&&(i=(r.max-r.min)/this.clientWidth),i=e.ctrlKey?.1*i:i,i=e.shiftKey?10*i:i;let n=this.startValue+t*i;n=void 0!==r.step?Math.trunc(n/r.step)*r.step:n,n=void 0!==r.min?Math.max(n,r.min):n,n=void 0!==r.max?Math.min(n,r.max):n,this.updateProperty(n),e.stopPropagation(),e.preventDefault()}this.lastX=e.clientX,this.lastY=e.clientY}}onPointerUp(e){this.isActive&&e.isPrimary&&(this.isActive=!1,this.isDragging&&(e.stopPropagation(),e.preventDefault()))}startEditing(){const e=this.property,t=e.schema;let r=this.value;if("number"===e.type)if(isFinite(r)){const e=void 0!==t.precision?t.precision:s.defaultEditPrecision;r=this.value.toFixed(e)}else r=this.value===-1/0?"-inf":"inf";const i=this.editElement=this.appendElement("input");i.setAttribute("type","text"),i.value=r,i.focus(),i.select(),i.addEventListener("keydown",e=>{"Escape"===e.key?this.stopEditing(!1):"Enter"===e.key&&this.stopEditing(!0)}),i.addEventListener("blur",()=>{this.stopEditing(!0)}),s.setStyle(i,{position:"absolute",zIndex:"1",boxSizing:"border-box",width:"100%",height:"100%"})}stopEditing(e){if(this.editElement){const e=this.editElement;this.editElement=null,this.removeChild(e);const t=this.property.schema,r=e.value;let s=r;if("number"===this.property.type)if(r.toLowerCase().indexOf("inf")>=0)s="-"===r[0]?-1/0:1/0;else{if(s=parseFloat(s)||0,t.precision){const e=Math.pow(10,t.precision);s=Math.round(s*e)/e}s=void 0!==t.min?Math.max(s,t.min):s,s=void 0!==t.max?Math.min(s,t.max):s}this.updateProperty(s)}}onSelectOption(e){const t=e.detail.index;this.updateProperty(t)}onPropertyValue(){this.updateElement()}onPropertyChange(){this.updateElement()}updateElement(){const e=this.property,t=e.schema;if(t.event)return void(e.changed&&(this.buttonElement.classList.remove("ff-event-flash"),setTimeout(()=>this.buttonElement.classList.add("ff-event-flash"),0)));let r=e.value,i="";switch(this.index>=0&&(r=r[this.index]),this.value=r,e.type){case"number":if(t.options)i=e.getOptionText();else if(isFinite(r)){const e=void 0!==t.precision?t.precision:s.defaultPrecision;i=r.toFixed(e),this.barElement&&(this.barElement.style.width=n.default.scaleLimit(r,t.min,t.max,0,100)+"%")}else i=r===-1/0?"-inf":"inf",this.barElement&&(this.barElement.style.width="0");break;case"boolean":i=r?"true":"false";break;case"string":i=r;break;case"object":i=r.toString()}this.contentElement.innerText=i}updateProperty(e){const t=this.property;this.index>=0?(t.value[this.index]=e,t.set()):t.setValue(e)}};c.defaultPrecision=2,c.defaultEditPrecision=5,c.defaultSpeed=.1,i([l.property({attribute:!1})],c.prototype,"property",void 0),i([l.property({attribute:!1})],c.prototype,"index",void 0),c=s=i([l.customElement("ff-property-field")],c),t.default=c},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1),n=r(81),o=r(250),a=r(46);let l=class extends i.default{constructor(){super(),this.activeIndex=0,this.activeHeader=null,this.dropMarker=null,this.dropTarget=null,this.dropZone="none",this.isInit=!1,this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.onDrop=this.onDrop.bind(this),this.addEventListener("dragover",this.onDragOver),this.addEventListener("dragleave",this.onDragLeave),this.addEventListener("drop",this.onDrop)}get size(){return.01*parseFloat(this.style.flexBasis)}set size(e){this.style.flexBasis=`${(100*(e||1)).toFixed(3)}%`}activatePanel(e){this.activeHeader&&this.activeHeader.panel===e||(this.activeHeader&&(this.activeHeader.active=!1),this.activeHeader=e.header,this.activeHeader.active=!0)}insertPanel(e,t){this.init(!1),this.appendChild(e);const r=new o.default(e);t?this.headers.insertBefore(r,t.header):this.headers.appendChild(r)}removePanel(e){const t=e.header;if(this.headers.removeChild(t),this.removeChild(e),0===this.getPanelCount()){this.parentElement.removeDockElement(this)}else if(this.activeHeader===t){const e=this.headers.firstChild;this.activatePanel(e.panel)}}getPanelCount(){return this.headers.childElementCount}setLayout(e,t){this.init(!1);const r=Array.from(this.children);for(let e of r)e!==this.headers&&this.removeChild(e);this.size=e.size,e.panels.forEach(e=>{const r=new n.default;r.setLayout(e,t),this.insertPanel(r)});const s=this.headers.firstElementChild;s&&this.activatePanel(s.panel)}getLayout(){const e=Array.from(this.getElementsByTagName("ff-dock-panel")),t=e.map(e=>e.getLayout());let r=-1;for(let t=0,s=e.length;t<s;++t)if(e[t]===this.activeHeader.panel){r=t;break}return{type:"stack",size:this.size,activePanelIndex:r,panels:t}}onDragOver(e){Array.from(e.dataTransfer.items).find(e=>e.type===n.default.dragDropMimeType)&&(this.updateDropMarker(e),e.stopPropagation(),e.preventDefault())}onDragLeave(e){this.updateDropMarker(),e.stopPropagation()}onDrop(e){e.stopPropagation(),this.updateDropMarker();const t=e.dataTransfer.getData(n.default.dragDropMimeType);this.dropTarget&&"none"!==this.dropZone&&this.dropTarget.movePanel(t,this.dropZone),this.dispatchEvent(new CustomEvent(a.default.changeEvent,{bubbles:!0}))}updateDropMarker(e){let t=this.getElementsByClassName("ff-dock-drop-marker").item(0);if(!e)return void(t&&this.removeChild(t));t||((t=document.createElement("div")).classList.add("ff-dock-drop-marker"),this.appendChild(t),this.dropTarget=null,this.dropZone="none");const r=t.style;r.pointerEvents="none",r.width="25px",r.position="absolute",r.zIndex="1";let s,i=this.dropTarget,n=this.dropZone;if(e.currentTarget===this){const e=this.headers.lastChild;s=e.getBoundingClientRect(),i=e.panel,n="after"}else if(e.currentTarget instanceof o.default){s=e.currentTarget.getBoundingClientRect();const t=(e.clientX-s.left)/s.width;i=e.currentTarget.panel,n=t<.5?"before":"after"}else i=null,n="none";if(i!==this.dropTarget||n!==this.dropZone)if(this.dropTarget=i,this.dropZone=n,i){const e=this.headers.getBoundingClientRect(),t=this.getBoundingClientRect(),i="before"===n?s.left:s.right;r.top=e.top-t.top+"px",r.height=e.height+"px",r.left=i-t.left+"px"}else t.remove()}firstConnected(){this.init(!0)}init(e){if(this.isInit)return;this.isInit=!0,this.setStyle({flex:"1 1 auto",position:"relative",display:"flex",flexDirection:"column",overflow:"hidden"}),this.headers=document.createElement("header");const t=this.headers.style;if(t.flex="1 0 auto",t.flexWrap="wrap",t.display="flex",t.flexDirection="row",t.overflow="hidden",this.insertBefore(this.headers,this.firstChild),e){Array.from(this.children).forEach(e=>{if(e!==this.headers)if(this.removeChild(e),e instanceof n.default)this.insertPanel(e);else{const t=new n.default;t.appendChild(e),this.insertPanel(t)}});const e=this.headers.firstElementChild;e&&this.activatePanel(e.panel)}}};s([i.property({type:Number})],l.prototype,"size",null),s([i.property({type:Number})],l.prototype,"activeIndex",void 0),l=s([i.customElement("ff-dock-stack")],l),t.default=l},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(9),n=r(1);t.customElement=n.customElement,t.property=n.property,t.html=n.html,t.TemplateResult=n.TemplateResult;let o=class extends n.default{constructor(e){super(),this.root=null,this.includeRoot=!1,this._nodeById={},this._idByNode=new Map,this._containerId=i.default(4),this.root=e}toggleSelected(e){this.setSelected(e,void 0)}setSelected(e,t){const r=this._idByNode.get(e);if(r){const e=document.getElementById(r);void 0===t&&(t=!e.hasAttribute("selected")),t?e.setAttribute("selected",""):e.removeAttribute("selected")}}isSelected(e){const t=this._idByNode.get(e);if(t){return document.getElementById(t).hasAttribute("selected")}return!1}toggleExpanded(e){this.setExpanded(e,void 0)}setExpanded(e,t){const r=this._idByNode.get(e);if(r){const e=document.getElementById(r);void 0===t&&(t=!e.hasAttribute("expanded")),t?e.setAttribute("expanded",""):e.removeAttribute("expanded")}}isExpanded(e){const t=this._idByNode.get(e);if(t){return document.getElementById(t).hasAttribute("expanded")}return!1}firstConnected(){this.classList.add("ff-tree")}render(){this._nodeById={},this._idByNode.clear();const e=this.root;if(!e)return n.html``;if(this.includeRoot){const t=this.getId(e)+this._containerId;return this.renderNode(e,t,0)}return this.renderNodeChildren(e,this.getChildren(e),0)}getId(e){return e.id||i.default()}getClasses(e){return""}getChildren(e){return e.children||null}isNodeSelected(e){return!!e.selected}isNodeExpanded(e){return void 0===e.expanded||e.expanded}renderNodeHeader(e){return e.toString()}renderNodeContent(e,t,r){return this.renderNodeChildren(e,t,r)}renderNodeChildren(e,t,r){if(!t||0===t.length)return null;let s;return n.html`
            ${n.repeat(t,e=>s=this.getId(e)+this._containerId,e=>this.renderNode(e,s,r))}
        `}renderNode(e,t,r){this._nodeById[t]=e,this._idByNode.set(e,t);const s=this.getChildren(e),i=this.isNodeSelected(e),o=this.isNodeExpanded(e);let a="ff-tree-node "+(s&&s.length>0?"ff-inner ":"ff-leaf ")+(r%2==0?"ff-even ":"ff-odd ")+this.getClasses(e);const l=this.renderNodeHeader(e),c=this.renderNodeContent(e,s,r+1);return n.html`
            <div class="ff-tree-node-container">
                <div class=${a} id=${t} ?selected=${i} ?expanded=${o}>
                    <div class="ff-header" @click=${this.onClick} @dblclick=${this.onDblClick}>${l}</div>
                    <div class="ff-content">${c}</div>
                </div>
            </div>
        `}onClick(e){const t=this.getNodeFromEvent(e);t&&this.onClickNode(e,t),e.stopPropagation()}onDblClick(e){const t=this.getNodeFromEvent(e);t&&this.onDblClickNode(e,t),e.stopPropagation()}onClickNode(e,t){this.toggleExpanded(t)}onDblClickNode(e,t){}getNodeFromEvent(e){const t=e.currentTarget.parentElement.id;return this._nodeById[t]}};s([n.property({attribute:!1})],o.prototype,"root",void 0),s([n.property({type:Boolean})],o.prototype,"includeRoot",void 0),o=s([n.customElement("ff-tree")],o),t.default=o},function(e,t,r){"use strict";r.r(t);var s=r(5),i=r(8),n=r(4);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const o=133;function a(e,t){const{element:{content:r},parts:s}=e,i=document.createTreeWalker(r,o,null,!1);let n=c(s),a=s[n],l=-1,d=0;const u=[];let h=null;for(;i.nextNode();){l++;const e=i.currentNode;for(e.previousSibling===h&&(h=null),t.has(e)&&(u.push(e),null===h&&(h=e)),null!==h&&d++;void 0!==a&&a.index===l;)a.index=null!==h?-1:a.index-d,a=s[n=c(s,n)]}u.forEach(e=>e.parentNode.removeChild(e))}const l=e=>{let t=11===e.nodeType?0:1;const r=document.createTreeWalker(e,o,null,!1);for(;r.nextNode();)t++;return t},c=(e,t=-1)=>{for(let r=t+1;r<e.length;r++){const t=e[r];if(Object(n.d)(t))return r}return-1};var d=r(18),u=r(16),h=r(35),p=r(15);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const f=(e,t)=>`${e}--${t}`;let m=!0;void 0===window.ShadyCSS?m=!1:void 0===window.ShadyCSS.prepareTemplateDom&&(console.warn("Incompatible ShadyCSS version detected.Please update to at least @webcomponents/webcomponentsjs@2.0.2 and@webcomponents/shadycss@1.3.1."),m=!1);const v=e=>t=>{const r=f(t.type,e);let s=u.a.get(r);void 0===s&&(s={stringsArray:new WeakMap,keyString:new Map},u.a.set(r,s));let i=s.stringsArray.get(t.strings);if(void 0!==i)return i;const o=t.strings.join(n.f);if(void 0===(i=s.keyString.get(o))){const r=t.getTemplateElement();m&&window.ShadyCSS.prepareTemplateDom(r,e),i=new n.a(t,r),s.keyString.set(o,i)}return s.stringsArray.set(t.strings,i),i},y=["html","svg"],g=new Set,b=(e,t,r)=>{g.add(r);const s=e.querySelectorAll("style");if(0===s.length)return void window.ShadyCSS.prepareTemplateStyles(t.element,r);const i=document.createElement("style");for(let e=0;e<s.length;e++){const t=s[e];t.parentNode.removeChild(t),i.textContent+=t.textContent}if((e=>{y.forEach(t=>{const r=u.a.get(f(t,e));void 0!==r&&r.keyString.forEach(e=>{const{element:{content:t}}=e,r=new Set;Array.from(t.querySelectorAll("style")).forEach(e=>{r.add(e)}),a(e,r)})})})(r),function(e,t,r=null){const{element:{content:s},parts:i}=e;if(null==r)return void s.appendChild(t);const n=document.createTreeWalker(s,o,null,!1);let a=c(i),d=0,u=-1;for(;n.nextNode();)for(u++,n.currentNode===r&&(d=l(t),r.parentNode.insertBefore(t,r));-1!==a&&i[a].index===u;){if(d>0){for(;-1!==a;)i[a].index+=d,a=c(i,a);return}a=c(i,a)}}(t,i,t.element.content.firstChild),window.ShadyCSS.prepareTemplateStyles(t.element,r),window.ShadyCSS.nativeShadow){const r=t.element.content.querySelector("style");e.insertBefore(r.cloneNode(!0),e.firstChild)}else{t.element.content.insertBefore(i,t.element.content.firstChild);const e=new Set;e.add(i),a(t,e)}},E=(e,t)=>e,_={toAttribute(e,t){switch(t){case Boolean:return e?"":null;case Object:case Array:return null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){switch(t){case Boolean:return null!==e;case Number:return null===e?null:Number(e);case Object:case Array:return JSON.parse(e)}return e}},P=(e,t)=>t!==e&&(t==t||e==e),w={attribute:!0,type:String,converter:_,reflect:!1,hasChanged:P},x=Promise.resolve(!0),C=1,S=4,D=8,M=16,T=32;class R extends HTMLElement{constructor(){super(),this._updateState=0,this._instanceProperties=void 0,this._updatePromise=x,this._hasConnectedResolver=void 0,this._changedProperties=new Map,this._reflectingProperties=void 0,this.initialize()}static get observedAttributes(){this._finalize();const e=[];return this._classProperties.forEach((t,r)=>{const s=this._attributeNameForProperty(r,t);void 0!==s&&(this._attributeToPropertyMap.set(s,r),e.push(s))}),e}static _ensureClassProperties(){if(!this.hasOwnProperty(E("_classProperties",this))){this._classProperties=new Map;const e=Object.getPrototypeOf(this)._classProperties;void 0!==e&&e.forEach((e,t)=>this._classProperties.set(t,e))}}static createProperty(e,t=w){if(this._ensureClassProperties(),this._classProperties.set(e,t),t.noAccessor||this.prototype.hasOwnProperty(e))return;const r="symbol"==typeof e?Symbol():`__${e}`;Object.defineProperty(this.prototype,e,{get(){return this[r]},set(t){const s=this[e];this[r]=t,this.requestUpdate(e,s)},configurable:!0,enumerable:!0})}static _finalize(){if(this.hasOwnProperty(E("finalized",this))&&this.finalized)return;const e=Object.getPrototypeOf(this);if("function"==typeof e._finalize&&e._finalize(),this.finalized=!0,this._ensureClassProperties(),this._attributeToPropertyMap=new Map,this.hasOwnProperty(E("properties",this))){const e=this.properties,t=[...Object.getOwnPropertyNames(e),..."function"==typeof Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e):[]];for(const r of t)this.createProperty(r,e[r])}}static _attributeNameForProperty(e,t){const r=t.attribute;return!1===r?void 0:"string"==typeof r?r:"string"==typeof e?e.toLowerCase():void 0}static _valueHasChanged(e,t,r=P){return r(e,t)}static _propertyValueFromAttribute(e,t){const r=t.type,s=t.converter||_,i="function"==typeof s?s:s.fromAttribute;return i?i(e,r):e}static _propertyValueToAttribute(e,t){if(void 0===t.reflect)return;const r=t.type,s=t.converter;return(s&&s.toAttribute||_.toAttribute)(e,r)}initialize(){this._saveInstanceProperties()}_saveInstanceProperties(){this.constructor._classProperties.forEach((e,t)=>{if(this.hasOwnProperty(t)){const e=this[t];delete this[t],this._instanceProperties||(this._instanceProperties=new Map),this._instanceProperties.set(t,e)}})}_applyInstanceProperties(){this._instanceProperties.forEach((e,t)=>this[t]=e),this._instanceProperties=void 0}connectedCallback(){this._updateState=this._updateState|T,this._hasConnectedResolver?(this._hasConnectedResolver(),this._hasConnectedResolver=void 0):this.requestUpdate()}disconnectedCallback(){}attributeChangedCallback(e,t,r){t!==r&&this._attributeToProperty(e,r)}_propertyToAttribute(e,t,r=w){const s=this.constructor,i=s._attributeNameForProperty(e,r);if(void 0!==i){const e=s._propertyValueToAttribute(t,r);if(void 0===e)return;this._updateState=this._updateState|D,null==e?this.removeAttribute(i):this.setAttribute(i,e),this._updateState=this._updateState&~D}}_attributeToProperty(e,t){if(this._updateState&D)return;const r=this.constructor,s=r._attributeToPropertyMap.get(e);if(void 0!==s){const e=r._classProperties.get(s)||w;this._updateState=this._updateState|M,this[s]=r._propertyValueFromAttribute(t,e),this._updateState=this._updateState&~M}}requestUpdate(e,t){let r=!0;if(void 0!==e&&!this._changedProperties.has(e)){const s=this.constructor,i=s._classProperties.get(e)||w;s._valueHasChanged(this[e],t,i.hasChanged)?(this._changedProperties.set(e,t),!0!==i.reflect||this._updateState&M||(void 0===this._reflectingProperties&&(this._reflectingProperties=new Map),this._reflectingProperties.set(e,i))):r=!1}return!this._hasRequestedUpdate&&r&&this._enqueueUpdate(),this.updateComplete}async _enqueueUpdate(){let e;this._updateState=this._updateState|S;const t=this._updatePromise;this._updatePromise=new Promise(t=>e=t),await t,this._hasConnected||await new Promise(e=>this._hasConnectedResolver=e);const r=this.performUpdate();null!=r&&"function"==typeof r.then&&await r,e(!this._hasRequestedUpdate)}get _hasConnected(){return this._updateState&T}get _hasRequestedUpdate(){return this._updateState&S}get hasUpdated(){return this._updateState&C}performUpdate(){if(this._instanceProperties&&this._applyInstanceProperties(),this.shouldUpdate(this._changedProperties)){const e=this._changedProperties;this.update(e),this._markUpdated(),this._updateState&C||(this._updateState=this._updateState|C,this.firstUpdated(e)),this.updated(e)}else this._markUpdated()}_markUpdated(){this._changedProperties=new Map,this._updateState=this._updateState&~S}get updateComplete(){return this._updatePromise}shouldUpdate(e){return!0}update(e){void 0!==this._reflectingProperties&&this._reflectingProperties.size>0&&(this._reflectingProperties.forEach((e,t)=>this._propertyToAttribute(t,this[t],e)),this._reflectingProperties=void 0)}updated(e){}firstUpdated(e){}}R.finalized=!0;
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const O=e=>t=>"function"==typeof t?((e,t)=>(window.customElements.define(e,t),t))(e,t):((e,t)=>{const{kind:r,elements:s}=t;return{kind:r,elements:s,finisher(t){window.customElements.define(e,t)}}})(e,t),A=(e,t)=>"method"!==t.kind||!t.descriptor||"value"in t.descriptor?{kind:"field",key:Symbol(),placement:"own",descriptor:{},initializer(){"function"==typeof t.initializer&&(this[t.key]=t.initializer.call(this))},finisher(r){r.createProperty(t.key,e)}}:Object.assign({},t,{finisher(r){r.createProperty(t.key,e)}}),j=(e,t,r)=>{t.constructor.createProperty(r,e)};function k(e){return(t,r)=>void 0!==r?j(e,t,r):A(e,t)}const I=F((e,t)=>e.querySelector(t)),L=F((e,t)=>e.querySelectorAll(t)),V=(e,t,r)=>{Object.defineProperty(t,r,e)},N=(e,t)=>({kind:"method",placement:"prototype",key:t.key,descriptor:e});function F(e){return t=>(r,s)=>{const i={get(){return e(this.renderRoot,t)},enumerable:!0,configurable:!0};return void 0!==s?V(i,r,s):N(i,r)}}const $=e=>(t,r)=>void 0!==r?((e,t,r)=>{Object.assign(t[r],e)})(e,t,r):((e,t)=>Object.assign({},t,{finisher(r){Object.assign(r.prototype[t.key],e)}}))(e,t),z="adoptedStyleSheets"in Document.prototype;class U{constructor(e){this.cssText=e}get styleSheet(){return void 0===this._styleSheet&&(z?(this._styleSheet=new CSSStyleSheet,this._styleSheet.replaceSync(this.cssText)):this._styleSheet=null),this._styleSheet}}const H=(e,...t)=>{const r=t.reduce((t,r,s)=>t+(e=>{if(e instanceof U)return e.cssText;throw new Error(`Value passed to 'css' function must be a 'css' function result: ${e}.`)})(r)+e[s+1],e[0]);return new U(r)};r.d(t,"LitElement",function(){return G}),r.d(t,"JSCompiler_renameProperty",function(){return E}),r.d(t,"defaultConverter",function(){return _}),r.d(t,"notEqual",function(){return P}),r.d(t,"UpdatingElement",function(){return R}),r.d(t,"customElement",function(){return O}),r.d(t,"property",function(){return k}),r.d(t,"query",function(){return I}),r.d(t,"queryAll",function(){return L}),r.d(t,"eventOptions",function(){return $}),r.d(t,"html",function(){return s.html}),r.d(t,"svg",function(){return s.svg}),r.d(t,"TemplateResult",function(){return s.TemplateResult}),r.d(t,"SVGTemplateResult",function(){return s.SVGTemplateResult}),r.d(t,"supportsAdoptingStyleSheets",function(){return z}),r.d(t,"CSSResult",function(){return U}),r.d(t,"css",function(){return H});const B=e=>e.flat?e.flat(1/0):
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
function e(t,r=[]){for(let s=0,i=t.length;s<i;s++){const i=t[s];Array.isArray(i)?e(i,r):r.push(i)}return r}(e);class G extends R{static get _uniqueStyles(){if(!this.hasOwnProperty(E("_styles",this)))if(this.hasOwnProperty(E("styles",this))){const e=this.styles;if(Array.isArray(e)){const t=B(e).reduceRight((e,t)=>(e.add(t),e),new Set);this._styles=[],t.forEach(e=>this._styles.unshift(e))}else this._styles=e?[e]:[]}else this._styles=void 0!==this._styles?this._styles:[];return this._styles}initialize(){super.initialize(),this.renderRoot=this.createRenderRoot(),window.ShadowRoot&&this.renderRoot instanceof window.ShadowRoot&&this.adoptStyles()}createRenderRoot(){return this.attachShadow({mode:"open"})}adoptStyles(){const e=this.constructor._uniqueStyles;0!==e.length&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow?z?this.renderRoot.adoptedStyleSheets=e.map(e=>e.styleSheet):this._needsShimAdoptedStyleSheets=!0:window.ShadyCSS.ScopingShim.prepareAdoptedCssText(e.map(e=>e.cssText),this.localName))}connectedCallback(){super.connectedCallback(),this.hasUpdated&&void 0!==window.ShadyCSS&&window.ShadyCSS.styleElement(this)}update(e){super.update(e);const t=this.render();t instanceof s.TemplateResult&&this.constructor.render(t,this.renderRoot,{scopeName:this.localName,eventContext:this}),this._needsShimAdoptedStyleSheets&&(this._needsShimAdoptedStyleSheets=!1,this.constructor._uniqueStyles.forEach(e=>{const t=document.createElement("style");t.textContent=e.cssText,this.renderRoot.appendChild(t)}))}render(){}}G.finalized=!0,G.render=((e,t,r)=>{const s=r.scopeName,n=d.a.has(t),o=t instanceof ShadowRoot&&m&&e instanceof p.b,a=o&&!g.has(s),l=a?document.createDocumentFragment():t;if(Object(d.b)(e,l,Object.assign({templateFactory:v(s)},r)),a){const e=d.a.get(l);d.a.delete(l),e.value instanceof h.a&&b(l,e.value.template,s),Object(i.b)(t,t.firstChild),t.appendChild(l),d.a.set(t,e)}!n&&o&&window.ShadyCSS.styleElement(t.host)})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(9);class i{constructor(){this.store=window?window.localStorage:null}isReady(){return!!this.store}get(e,t){const r=this.getKey(e,t),s=this.store.getItem(r);return s?JSON.parse(s):null}set(e,t,r){t=t||r.id||s.default();const i=this.getKey(e,t);return this.store.setItem(i,JSON.stringify(r)),t}remove(e,t){const r=this.getKey(e,t);return!!this.store.getItem(r)&&(this.store.removeItem(r),!0)}getKey(e,t){return e+"/"+t}}t.LocalStorage=i;const n=new i;t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(60),i=r(83),n=r(238),o=r(45),a=r(33),l=r(82);class c{constructor(e,t){this.explorer=new i.default(null,t),this.system=this.explorer.system,this.commander=this.explorer.commander,this.system.registry.registerComponentType(n.componentTypes);const r=this.system.graph.createNode("Story");r.createComponent(a.default),r.createComponent(o.default),this.props=this.initFromProps(t),e&&new l.default(this).appendTo(e)}addItemFromURL(e,t){}initFromProps(e){e.referrer=e.referrer||s.default("referrer"),e.mode=e.mode||s.default("mode")||"prep",e.expert=void 0!==e.expert?e.expert:"false"!==s.default("expert");const t=this.system.components.get(o.default);return t.ins.referrer.setValue(e.referrer),t.ins.expertMode.setValue(!!e.expert),e}}t.default=c,window.VoyagerStory=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(131);t.default=class{constructor(e,t){this._args=e,this._props=t,this._args=e,this._state=null}get name(){return this._props.name||s.normalize(this._props.do.name)}do(){if(this._state)throw new Error("undo should be called before execute can be applied again");this._state=this._props.do.apply(this._props.target,this._args)}undo(){if(!this._props.undo)throw new Error("can't undo this command");if(!this._state)throw new Error("execute should be called before undo can be applied");this._props.undo.call(this._props.target,this._state),this._state=null}canDo(){return!this._props.canDo||this._props.canDo()}canUndo(){return!!this._props.undo}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.camelize=function(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,(e,t)=>0==t?e.toLowerCase():e.toUpperCase()).replace(/\s+/g,"")},t.normalize=function(e){return e.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase())}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(10),i=r(47),n=r(62),o=r(63),a=r(85);t.default=class extends s.default{constructor(e){super({knownEvents:!1}),this.registry=e||new a.default,this.nodes=new n.default,this.components=new i.default,this.graph=new o.default(this,null)}deflate(){return this.graph.deflate()}inflate(e){this.graph.inflate(e)}toString(e=!1){const t=this.nodes.getArray(),r=this.components.count(),s=`System - ${t.length} nodes, ${r} components.`;return e?s+"\n"+t.map(e=>e.toString(!0)).join("\n"):s}_addNode(e){this.nodes._add(e)}_removeNode(e){this.nodes._remove(e)}_addComponent(e){if(e.isSystemSingleton&&this.components.has(e))throw new Error(`only one component of type '${e.type}' allowed per system`);this.components._add(e)}_removeComponent(e){this.components._remove(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!e||!t)return!1;let r=e.prototype;for(;r;){if(r===t.prototype)return!0;r=r.prototype}return!1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(86);t.default=class{constructor(e,t,r,i){if(1===e.elementCount&&r>=0)throw new Error("non-array source property; can't link to element");if(1===t.elementCount&&i>=0)throw new Error("non-array destination property; can't link to element");this.source=e,this.destination=t,this.sourceIndex=r,this.destinationIndex=i;const n=void 0===r?-1:r,o=void 0===i?-1:i,a=e.elementCount>1&&n<0&&o<0;this.fnConvert=s.getConversionFunction(e.type,t.type,a);const l=s.getElementCopyFunction(n,o,this.fnConvert);this.fnCopy=s.getMultiCopyFunction(e.isMulti(),t.isMulti(),l)}push(){this.destination.setValue(this.fnCopy(this.source.value,this.destination.value,this.fnConvert))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enumToArray=function(e){return Object.keys(e).filter(e=>isNaN(Number(e)))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(10),i=r(61);t.default=class extends s.default{constructor(e){super(),this.addEvent("property"),this.linkable=e,this.properties=[]}dispose(){this.unlinkAllProperties()}isInputGroup(){return this===this.linkable.ins}isOutputGroup(){return this===this.linkable.outs}createPropertiesFromTemplates(e,t){return Object.keys(e).forEach((r,s)=>{const i=void 0===t?void 0:t+s;this.createPropertyFromTemplate(e[r],r,i)}),this}createPropertyFromTemplate(e,t,r){const s=new i.default(e.path,e.schema);this._addProperty(s,t,r)}getProperty(e){const t=this[e];if(!t)throw new Error(`no property found with key '${e}'`);return t}getKeys(e=!1){const t=[];return this.properties.forEach(r=>{(e||"object"!==r.type)&&t.push(r.key)}),t}getValues(e=!1){const t=[];return this.properties.map(r=>{(e||"object"!==r.type)&&t.push(r.value)}),t}cloneValues(e=!1){const t=[];return this.properties.map(r=>{(e||"object"!==r.type)&&t.push(r.cloneValue())}),t}setValues(e){Object.keys(e).forEach(t=>this.getProperty(t).value=e[t])}copyValues(e){Object.keys(e).forEach(t=>this.getProperty(t).copyValue(e[t]))}unlinkAllProperties(){this.properties.forEach(e=>e.unlink())}deflate(){let e=null;return this.properties.forEach(t=>{const r=t.deflate();r&&((e=e||{})[t.key]=r)}),e}inflate(e){Object.keys(e).forEach(t=>{const r=e[t];r.schema&&new i.default(r.path,r.schema,!0).attach(this,t)})}inflateLinks(e,t){Object.keys(e).forEach(r=>{this[r].inflate(e[r],t)})}_addProperty(e,t,r){if(e.group&&e.detach(),t&&this[t])throw new Error(`key '${t}' already exists in group`);e._group=this,e._key=t,void 0===r?this.properties.push(e):this.properties.splice(r,0,e),t&&(this[t]=e),this.emit({type:"property",add:!0,remove:!1,property:e})}_removeProperty(e){if(e.group===this){if(this[e.key]!==e)throw new Error(`property not found in group: ${e.key}`);this.properties.slice(this.properties.indexOf(e),1),e.key&&delete this[e.key],e._group=null,e._key="",this.emit({type:"property",add:!1,remove:!0,property:e})}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0);t.default=class{constructor(e,t){this._type=t?s.componentTypeName(t):null,this._id=t instanceof s.default?t.id:void 0,this._system=e}get component(){return this._id&&this._system.components.getById(this._id)||null}set component(e){if(e&&this._type&&!(e instanceof this._system.registry.getComponentType(this._type)))throw new Error(`can't assign component of type '${e.type||"unknown"}' to link of type '${this._type}'`);this._id=e?e.id:void 0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.visited={},this.visiting={},this.sorted=[]}sort(e){for(let t=0,r=e.length;t<r;++t)this.visit(e[t]);const t=this.sorted;return this.visited={},this.visiting={},this.sorted=[],t}visit(e){const t=this.visited,r=this.visiting;if(t[e.id]||r[e.id])return;r[e.id]=!0;const s=e.outs.properties;for(let e=0,t=s.length;e<t;++e){const t=s[e].outLinks;for(let e=0,r=t.length;e<r;++e){const r=t[e].destination.group,s=r.properties;for(let e=0,t=s.length;e<t;++e){const t=s[e].outLinks;for(let e=0,r=t.length;e<r;++e){const r=t[e].destination.group;this.visit(r.linkable)}}this.visit(r.linkable)}}r[e.id]=void 0,t[e.id]=!0,this.sorted.unshift(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(66),n=new s.Vector3,o=new s.Matrix4;class a extends s.LineSegments{constructor(e,t){t=Object.assign({},a.defaultProps,t);const r=new s.Box3;r.makeEmpty(),i.computeLocalBoundingBox(e,r);const n=t.length,o=[r.min.x,r.min.y,r.min.z],l=[r.max.x,r.max.y,r.max.z],c=[(l[0]-o[0])*n,(l[1]-o[1])*n,(l[2]-o[2])*n];let d;d=isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])?[o[0],o[1],o[2],o[0]+c[0],o[1],o[2],o[0],o[1],o[2],o[0],o[1]+c[1],o[2],o[0],o[1],o[2],o[0],o[1],o[2]+c[2],l[0],o[1],o[2],l[0]-c[0],o[1],o[2],l[0],o[1],o[2],l[0],o[1]+c[1],o[2],l[0],o[1],o[2],l[0],o[1],o[2]+c[2],o[0],l[1],o[2],o[0]+c[0],l[1],o[2],o[0],l[1],o[2],o[0],l[1]-c[1],o[2],o[0],l[1],o[2],o[0],l[1],o[2]+c[2],o[0],o[1],l[2],o[0]+c[0],o[1],l[2],o[0],o[1],l[2],o[0],o[1]+c[1],l[2],o[0],o[1],l[2],o[0],o[1],l[2]-c[2],o[0],l[1],l[2],o[0]+c[0],l[1],l[2],o[0],l[1],l[2],o[0],l[1]-c[1],l[2],o[0],l[1],l[2],o[0],l[1],l[2]-c[2],l[0],o[1],l[2],l[0]-c[0],o[1],l[2],l[0],o[1],l[2],l[0],o[1]+c[1],l[2],l[0],o[1],l[2],l[0],o[1],l[2]-c[2],l[0],l[1],o[2],l[0]-c[0],l[1],o[2],l[0],l[1],o[2],l[0],l[1]-c[1],o[2],l[0],l[1],o[2],l[0],l[1],o[2]+c[2],l[0],l[1],l[2],l[0]-c[0],l[1],l[2],l[0],l[1],l[2],l[0],l[1]-c[1],l[2],l[0],l[1],l[2],l[0],l[1],l[2]-c[2]]:[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1];const u=new s.BufferGeometry;u.addAttribute("position",new s.Float32BufferAttribute(d,3)),super(u,new s.LineBasicMaterial({color:t.color,depthTest:!1})),this.renderOrder=1,this.onBeforeRender=(()=>{e.updateMatrixWorld(!1),this.matrixWorld.copy(e.matrixWorld)})}dispose(){this.parent&&this.parent.remove(this),this.geometry.dispose()}static expandBoundingBox(e,t,r){const s=e.geometry;if(void 0!==s){let i=e;for(o.identity();i&&i!==t;)o.premultiply(i.matrix),i=i.parent;if(s.isGeometry){const e=s.vertices;for(let t=0,s=e.length;t<s;++t)n.copy(e[t]).applyMatrix4(o),r.expandByPoint(n)}else if(s.isBufferGeometry){const e=s.attributes.position;if(void 0!==e)for(let t=0,s=e.count;t<s;++t)n.fromBufferAttribute(e,t).applyMatrix4(o),r.expandByPoint(n)}}const i=e.children;for(let e=0,s=i.length;e<s;++e)a.expandBoundingBox(i[e],t,r)}}a.defaultProps={color:new s.Color("#ffd633"),length:.25},t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this.loadingManager=e}load(e){return this.loadingManager.itemStart(e),fetch(e,{headers:{Accept:"application/json"}}).then(t=>{if(!t.ok)throw this.loadingManager.itemError(e),new Error(`failed to fetch from '${e}', status: ${t.status} ${t.statusText}`);return this.loadingManager.itemEnd(e),t.json()})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(142),i=r(176),n=r(177),o=r(178),a=r(179),l=r(180),c=r(181),d=r(182),u=r(183),h=r(184),p=r(185);t.default=class{constructor(){this._schemaValidator=new s({schemas:[i,n,o,a,l,c,d,p,u,h],allErrors:!0}),this._validatePresentation=this._schemaValidator.getSchema("https://schemas.3d.si.edu/public_api/presentation.schema.json"),this._validateItem=this._schemaValidator.getSchema("https://schemas.3d.si.edu/public_api/item.schema.json")}validatePresentation(e){return this._validatePresentation(e)?(console.log("JSONValidator.validatePresentation - OK"),!0):(console.warn(this._schemaValidator.errorsText(this._validatePresentation.errors,{separator:", ",dataVar:"presentation"})),!1)}validateItem(e){return this._validateItem(e)?(console.log("JSONValidator.validateItem - OK"),!0):(console.warn(this._schemaValidator.errorsText(this._validateItem.errors,{separator:", ",dataVar:"item"})),!1)}}},function(e,t,r){"use strict";var s=r(143),i=r(67),n=r(147),o=r(88),a=r(89),l=r(148),c=r(149),d=r(170),u=r(29);e.exports=y,y.prototype.validate=function(e,t){var r;if("string"==typeof e){if(!(r=this.getSchema(e)))throw new Error('no schema with key or ref "'+e+'"')}else{var s=this._addSchema(e);r=s.validate||this._compile(s)}var i=r(t);!0!==r.$async&&(this.errors=r.errors);return i},y.prototype.compile=function(e,t){var r=this._addSchema(e,void 0,t);return r.validate||this._compile(r)},y.prototype.addSchema=function(e,t,r,s){if(Array.isArray(e)){for(var n=0;n<e.length;n++)this.addSchema(e[n],void 0,r,s);return this}var o=this._getId(e);if(void 0!==o&&"string"!=typeof o)throw new Error("schema id must be string");return w(this,t=i.normalizeId(t||o)),this._schemas[t]=this._addSchema(e,r,s,!0),this},y.prototype.addMetaSchema=function(e,t,r){return this.addSchema(e,t,r,!0),this},y.prototype.validateSchema=function(e,t){var r=e.$schema;if(void 0!==r&&"string"!=typeof r)throw new Error("$schema must be a string");if(!(r=r||this._opts.defaultMeta||(s=this,i=s._opts.meta,s._opts.defaultMeta="object"==typeof i?s._getId(i)||i:s.getSchema(f)?f:void 0,s._opts.defaultMeta)))return this.logger.warn("meta-schema not available"),this.errors=null,!0;var s,i;var n=this.validate(r,e);if(!n&&t){var o="schema is invalid: "+this.errorsText();if("log"!=this._opts.validateSchema)throw new Error(o);this.logger.error(o)}return n},y.prototype.getSchema=function(e){var t=g(this,e);switch(typeof t){case"object":return t.validate||this._compile(t);case"string":return this.getSchema(t);case"undefined":return function(e,t){var r=i.schema.call(e,{schema:{}},t);if(r){var n=r.schema,a=r.root,l=r.baseId,c=s.call(e,n,a,void 0,l);return e._fragments[t]=new o({ref:t,fragment:!0,schema:n,root:a,baseId:l,validate:c}),c}}(this,e)}},y.prototype.removeSchema=function(e){if(e instanceof RegExp)return b(this,this._schemas,e),b(this,this._refs,e),this;switch(typeof e){case"undefined":return b(this,this._schemas),b(this,this._refs),this._cache.clear(),this;case"string":var t=g(this,e);return t&&this._cache.del(t.cacheKey),delete this._schemas[e],delete this._refs[e],this;case"object":var r=this._opts.serialize,s=r?r(e):e;this._cache.del(s);var n=this._getId(e);n&&(n=i.normalizeId(n),delete this._schemas[n],delete this._refs[n])}return this},y.prototype.addFormat=function(e,t){"string"==typeof t&&(t=new RegExp(t));return this._formats[e]=t,this},y.prototype.errorsText=function(e,t){if(!(e=e||this.errors))return"No errors";for(var r=void 0===(t=t||{}).separator?", ":t.separator,s=void 0===t.dataVar?"data":t.dataVar,i="",n=0;n<e.length;n++){var o=e[n];o&&(i+=s+o.dataPath+" "+o.message+r)}return i.slice(0,-r.length)},y.prototype._addSchema=function(e,t,r,s){if("object"!=typeof e&&"boolean"!=typeof e)throw new Error("schema should be object or boolean");var n=this._opts.serialize,a=n?n(e):e,l=this._cache.get(a);if(l)return l;s=s||!1!==this._opts.addUsedSchema;var c=i.normalizeId(this._getId(e));c&&s&&w(this,c);var d,u=!1!==this._opts.validateSchema&&!t;u&&!(d=c&&c==i.normalizeId(e.$schema))&&this.validateSchema(e,!0);var h=i.ids.call(this,e),p=new o({id:c,schema:e,localRefs:h,cacheKey:a,meta:r});"#"!=c[0]&&s&&(this._refs[c]=p);this._cache.put(a,p),u&&d&&this.validateSchema(e,!0);return p},y.prototype._compile=function(e,t){if(e.compiling)return e.validate=n,n.schema=e.schema,n.errors=null,n.root=t||n,!0===e.schema.$async&&(n.$async=!0),n;var r,i;e.compiling=!0,e.meta&&(r=this._opts,this._opts=this._metaOpts);try{i=s.call(this,e.schema,t,e.localRefs)}catch(t){throw delete e.validate,t}finally{e.compiling=!1,e.meta&&(this._opts=r)}return e.validate=i,e.refs=i.refs,e.refVal=i.refVal,e.root=i.root,i;function n(){var t=e.validate,r=t.apply(this,arguments);return n.errors=t.errors,r}},y.prototype.compileAsync=r(171);var h=r(172);y.prototype.addKeyword=h.add,y.prototype.getKeyword=h.get,y.prototype.removeKeyword=h.remove;var p=r(69);y.ValidationError=p.Validation,y.MissingRefError=p.MissingRef,y.$dataMetaSchema=d;var f="http://json-schema.org/draft-07/schema",m=["removeAdditional","useDefaults","coerceTypes"],v=["/properties"];function y(e){if(!(this instanceof y))return new y(e);e=this._opts=u.copy(e)||{},function(e){var t=e._opts.logger;if(!1===t)e.logger={log:x,warn:x,error:x};else{if(void 0===t&&(t=console),!("object"==typeof t&&t.log&&t.warn&&t.error))throw new Error("logger must implement log, warn and error methods");e.logger=t}}(this),this._schemas={},this._refs={},this._fragments={},this._formats=l(e.format),this._cache=e.cache||new n,this._loadingSchemas={},this._compilations=[],this.RULES=c(),this._getId=function(e){switch(e.schemaId){case"auto":return P;case"id":return E;default:return _}}(e),e.loopRequired=e.loopRequired||1/0,"property"==e.errorDataPath&&(e._errorDataPathProperty=!0),void 0===e.serialize&&(e.serialize=a),this._metaOpts=function(e){for(var t=u.copy(e._opts),r=0;r<m.length;r++)delete t[m[r]];return t}(this),e.formats&&function(e){for(var t in e._opts.formats){var r=e._opts.formats[t];e.addFormat(t,r)}}(this),function(e){var t;e._opts.$data&&(t=r(174),e.addMetaSchema(t,t.$id,!0));if(!1===e._opts.meta)return;var s=r(175);e._opts.$data&&(s=d(s,v));e.addMetaSchema(s,f,!0),e._refs["http://json-schema.org/schema"]=f}(this),"object"==typeof e.meta&&this.addMetaSchema(e.meta),e.nullable&&this.addKeyword("nullable",{metaSchema:{const:!0}}),function(e){var t=e._opts.schemas;if(!t)return;if(Array.isArray(t))e.addSchema(t);else for(var r in t)e.addSchema(t[r],r)}(this)}function g(e,t){return t=i.normalizeId(t),e._schemas[t]||e._refs[t]||e._fragments[t]}function b(e,t,r){for(var s in t){var i=t[s];i.meta||r&&!r.test(s)||(e._cache.del(i.cacheKey),delete t[s])}}function E(e){return e.$id&&this.logger.warn("schema $id ignored",e.$id),e.id}function _(e){return e.id&&this.logger.warn("schema id ignored",e.id),e.$id}function P(e){if(e.$id&&e.id&&e.$id!=e.id)throw new Error("schema $id is different from id");return e.$id||e.id}function w(e,t){if(e._schemas[t]||e._refs[t])throw new Error('schema with key or id "'+t+'" already exists')}function x(){}},function(e,t,r){"use strict";var s=r(67),i=r(29),n=r(69),o=r(89),a=r(90),l=i.ucs2length,c=r(68),d=n.Validation;function u(e,t,r){for(var s=0;s<this._compilations.length;s++){var i=this._compilations[s];if(i.schema==e&&i.root==t&&i.baseId==r)return s}return-1}function h(e,t){return"var pattern"+e+" = new RegExp("+i.toQuotedString(t[e])+");"}function p(e){return"var default"+e+" = defaults["+e+"];"}function f(e,t){return void 0===t[e]?"":"var refVal"+e+" = refVal["+e+"];"}function m(e){return"var customRule"+e+" = customRules["+e+"];"}function v(e,t){if(!e.length)return"";for(var r="",s=0;s<e.length;s++)r+=t(s,e);return r}e.exports=function e(t,r,y,g){var b=this,E=this._opts,_=[void 0],P={},w=[],x={},C=[],S={},D=[];r=r||{schema:t,refVal:_,refs:P};var M=function(e,t,r){var s=u.call(this,e,t,r);return s>=0?{index:s,compiling:!0}:(s=this._compilations.length,this._compilations[s]={schema:e,root:t,baseId:r},{index:s,compiling:!1})}.call(this,t,r,g);var T=this._compilations[M.index];if(M.compiling)return T.callValidate=function e(){var t=T.validate;var r=t.apply(this,arguments);e.errors=t.errors;return r};var R=this._formats;var O=this.RULES;try{var A=k(t,r,y,g);T.validate=A;var j=T.callValidate;return j&&(j.schema=A.schema,j.errors=null,j.refs=A.refs,j.refVal=A.refVal,j.root=A.root,j.$async=A.$async,E.sourceCode&&(j.source=A.source)),A}finally{(function(e,t,r){var s=u.call(this,e,t,r);s>=0&&this._compilations.splice(s,1)}).call(this,t,r,g)}function k(t,o,u,y){var g=!o||o&&o.schema==t;if(o.schema!=r.schema)return e.call(b,t,o,u,y);var x,S=!0===t.$async,M=a({isTop:!0,schema:t,isRoot:g,baseId:y,root:o,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:n.MissingRef,RULES:O,validate:a,util:i,resolve:s,resolveRef:I,usePattern:N,useDefault:F,useCustomRule:$,opts:E,formats:R,logger:b.logger,self:b});M=v(_,f)+v(w,h)+v(C,p)+v(D,m)+M,E.processCode&&(M=E.processCode(M));try{var T=new Function("self","RULES","formats","root","refVal","defaults","customRules","equal","ucs2length","ValidationError",M);x=T(b,O,R,r,_,C,D,c,l,d),_[0]=x}catch(e){throw b.logger.error("Error compiling schema, function code:",M),e}return x.schema=t,x.errors=null,x.refs=P,x.refVal=_,x.root=g?x:o,S&&(x.$async=!0),!0===E.sourceCode&&(x.source={code:M,patterns:w,defaults:C}),x}function I(t,i,n){i=s.url(t,i);var o,a,l=P[i];if(void 0!==l)return V(o=_[l],a="refVal["+l+"]");if(!n&&r.refs){var c=r.refs[i];if(void 0!==c)return o=r.refVal[c],a=L(i,o),V(o,a)}a=L(i);var d=s.call(b,k,r,i);if(void 0===d){var u=y&&y[i];u&&(d=s.inlineRef(u,E.inlineRefs)?u:e.call(b,u,r,y,t))}if(void 0!==d)return function(e,t){var r=P[e];_[r]=t}(i,d),V(d,a);!function(e){delete P[e]}(i)}function L(e,t){var r=_.length;return _[r]=t,P[e]=r,"refVal"+r}function V(e,t){return"object"==typeof e||"boolean"==typeof e?{code:t,schema:e,inline:!0}:{code:t,$async:e&&!!e.$async}}function N(e){var t=x[e];return void 0===t&&(t=x[e]=w.length,w[t]=e),"pattern"+t}function F(e){switch(typeof e){case"boolean":case"number":return""+e;case"string":return i.toQuotedString(e);case"object":if(null===e)return"null";var t=o(e),r=S[t];return void 0===r&&(r=S[t]=C.length,C[r]=e),"default"+r}}function $(e,t,r,s){var i=e.definition.validateSchema;if(i&&!1!==b._opts.validateSchema){var n=i(t);if(!n){var o="keyword schema is invalid: "+b.errorsText(i.errors);if("log"!=b._opts.validateSchema)throw new Error(o);b.logger.error(o)}}var a,l=e.definition.compile,c=e.definition.inline,d=e.definition.macro;if(l)a=l.call(b,t,r,s);else if(d)a=d.call(b,t,r,s),!1!==E.validateSchema&&b.validateSchema(a,!0);else if(c)a=c.call(b,s,e.keyword,t,r);else if(!(a=e.definition.validate))return;if(void 0===a)throw new Error('custom keyword "'+e.keyword+'"failed to compile');var u=D.length;return D[u]=a,{code:"customRule"+u,validate:a}}}},function(e,t,r){
/** @license URI.js v4.2.1 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js */
!function(e){"use strict";function t(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(t.length>1){t[0]=t[0].slice(0,-1);for(var s=t.length-1,i=1;i<s;++i)t[i]=t[i].slice(1,-1);return t[s]=t[s].slice(1),t.join("")}return t[0]}function r(e){return"(?:"+e+")"}function s(e){return void 0===e?"undefined":null===e?"null":Object.prototype.toString.call(e).split(" ").pop().split("]").shift().toLowerCase()}function i(e){return e.toUpperCase()}function n(e){var s=t("[0-9]","[A-Fa-f]"),i=r(r("%[EFef]"+s+"%"+s+s+"%"+s+s)+"|"+r("%[89A-Fa-f]"+s+"%"+s+s)+"|"+r("%"+s+s)),n="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",o=t("[\\:\\/\\?\\#\\[\\]\\@]",n),a=e?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",l=e?"[\\uE000-\\uF8FF]":"[]",c=t("[A-Za-z]","[0-9]","[\\-\\.\\_\\~]",a),d=r("[A-Za-z]"+t("[A-Za-z]","[0-9]","[\\+\\-\\.]")+"*"),u=r(r(i+"|"+t(c,n,"[\\:]"))+"*"),h=(r(r("25[0-5]")+"|"+r("2[0-4][0-9]")+"|"+r("1[0-9][0-9]")+"|"+r("[1-9][0-9]")+"|[0-9]"),r(r("25[0-5]")+"|"+r("2[0-4][0-9]")+"|"+r("1[0-9][0-9]")+"|"+r("0?[1-9][0-9]")+"|0?0?[0-9]")),p=r(h+"\\."+h+"\\."+h+"\\."+h),f=r(s+"{1,4}"),m=r(r(f+"\\:"+f)+"|"+p),v=r(r(f+"\\:")+"{6}"+m),y=r("\\:\\:"+r(f+"\\:")+"{5}"+m),g=r(r(f)+"?\\:\\:"+r(f+"\\:")+"{4}"+m),b=r(r(r(f+"\\:")+"{0,1}"+f)+"?\\:\\:"+r(f+"\\:")+"{3}"+m),E=r(r(r(f+"\\:")+"{0,2}"+f)+"?\\:\\:"+r(f+"\\:")+"{2}"+m),_=r(r(r(f+"\\:")+"{0,3}"+f)+"?\\:\\:"+f+"\\:"+m),P=r(r(r(f+"\\:")+"{0,4}"+f)+"?\\:\\:"+m),w=r(r(r(f+"\\:")+"{0,5}"+f)+"?\\:\\:"+f),x=r(r(r(f+"\\:")+"{0,6}"+f)+"?\\:\\:"),C=r([v,y,g,b,E,_,P,w,x].join("|")),S=r(r(c+"|"+i)+"+"),D=(r(C+"\\%25"+S),r(C+r("\\%25|\\%(?!"+s+"{2})")+S)),M=r("[vV]"+s+"+\\."+t(c,n,"[\\:]")+"+"),T=r("\\["+r(D+"|"+C+"|"+M)+"\\]"),R=r(r(i+"|"+t(c,n))+"*"),O=r(T+"|"+p+"(?!"+R+")|"+R),A=r("[0-9]*"),j=r(r(u+"@")+"?"+O+r("\\:"+A)+"?"),k=r(i+"|"+t(c,n,"[\\:\\@]")),I=r(k+"*"),L=r(k+"+"),V=r(r(i+"|"+t(c,n,"[\\@]"))+"+"),N=r(r("\\/"+I)+"*"),F=r("\\/"+r(L+N)+"?"),$=r(V+N),z=r(L+N),U="(?!"+k+")",H=(r(N+"|"+F+"|"+$+"|"+z+"|"+U),r(r(k+"|"+t("[\\/\\?]",l))+"*")),B=r(r(k+"|[\\/\\?]")+"*"),G=r(r("\\/\\/"+j+N)+"|"+F+"|"+z+"|"+U),q=r(d+"\\:"+G+r("\\?"+H)+"?"+r("\\#"+B)+"?"),Q=r(r("\\/\\/"+j+N)+"|"+F+"|"+$+"|"+U),X=r(Q+r("\\?"+H)+"?"+r("\\#"+B)+"?");return r(q+"|"+X),r(d+"\\:"+G+r("\\?"+H)+"?"),r(r("\\/\\/("+r("("+u+")@")+"?("+O+")"+r("\\:("+A+")")+"?)")+"?("+N+"|"+F+"|"+z+"|"+U+")"),r("\\?("+H+")"),r("\\#("+B+")"),r(r("\\/\\/("+r("("+u+")@")+"?("+O+")"+r("\\:("+A+")")+"?)")+"?("+N+"|"+F+"|"+$+"|"+U+")"),r("\\?("+H+")"),r("\\#("+B+")"),r(r("\\/\\/("+r("("+u+")@")+"?("+O+")"+r("\\:("+A+")")+"?)")+"?("+N+"|"+F+"|"+z+"|"+U+")"),r("\\?("+H+")"),r("\\#("+B+")"),r("("+u+")@"),r("\\:("+A+")"),{NOT_SCHEME:new RegExp(t("[^]","[A-Za-z]","[0-9]","[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(t("[^\\%\\:]",c,n),"g"),NOT_HOST:new RegExp(t("[^\\%\\[\\]\\:]",c,n),"g"),NOT_PATH:new RegExp(t("[^\\%\\/\\:\\@]",c,n),"g"),NOT_PATH_NOSCHEME:new RegExp(t("[^\\%\\/\\@]",c,n),"g"),NOT_QUERY:new RegExp(t("[^\\%]",c,n,"[\\:\\@\\/\\?]",l),"g"),NOT_FRAGMENT:new RegExp(t("[^\\%]",c,n,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(t("[^]",c,n),"g"),UNRESERVED:new RegExp(c,"g"),OTHER_CHARS:new RegExp(t("[^\\%]",c,o),"g"),PCT_ENCODED:new RegExp(i,"g"),IPV4ADDRESS:new RegExp("^("+p+")$"),IPV6ADDRESS:new RegExp("^\\[?("+C+")"+r(r("\\%25|\\%(?!"+s+"{2})")+"("+S+")")+"?\\]?$")}}var o=n(!1),a=n(!0),l=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],s=!0,i=!1,n=void 0;try{for(var o,a=e[Symbol.iterator]();!(s=(o=a.next()).done)&&(r.push(o.value),!t||r.length!==t);s=!0);}catch(e){i=!0,n=e}finally{try{!s&&a.return&&a.return()}finally{if(i)throw n}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},c=2147483647,d=/^xn--/,u=/[^\0-\x7E]/,h=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=Math.floor,m=String.fromCharCode;function v(e){throw new RangeError(p[e])}function y(e,t){var r=e.split("@"),s="";r.length>1&&(s=r[0]+"@",e=r[1]);var i=(e=e.replace(h,".")).split("."),n=function(e,t){for(var r=[],s=e.length;s--;)r[s]=t(e[s]);return r}(i,t).join(".");return s+n}function g(e){for(var t=[],r=0,s=e.length;r<s;){var i=e.charCodeAt(r++);if(i>=55296&&i<=56319&&r<s){var n=e.charCodeAt(r++);56320==(64512&n)?t.push(((1023&i)<<10)+(1023&n)+65536):(t.push(i),r--)}else t.push(i)}return t}var b=function(e,t){return e+22+75*(e<26)-((0!=t)<<5)},E=function(e,t,r){var s=0;for(e=r?f(e/700):e>>1,e+=f(e/t);e>455;s+=36)e=f(e/35);return f(s+36*e/(e+38))},_=function(e){var t,r=[],s=e.length,i=0,n=128,o=72,a=e.lastIndexOf("-");a<0&&(a=0);for(var l=0;l<a;++l)e.charCodeAt(l)>=128&&v("not-basic"),r.push(e.charCodeAt(l));for(var d=a>0?a+1:0;d<s;){for(var u=i,h=1,p=36;;p+=36){d>=s&&v("invalid-input");var m=(t=e.charCodeAt(d++))-48<10?t-22:t-65<26?t-65:t-97<26?t-97:36;(m>=36||m>f((c-i)/h))&&v("overflow"),i+=m*h;var y=p<=o?1:p>=o+26?26:p-o;if(m<y)break;var g=36-y;h>f(c/g)&&v("overflow"),h*=g}var b=r.length+1;o=E(i-u,b,0==u),f(i/b)>c-n&&v("overflow"),n+=f(i/b),i%=b,r.splice(i++,0,n)}return String.fromCodePoint.apply(String,r)},P=function(e){var t=[],r=(e=g(e)).length,s=128,i=0,n=72,o=!0,a=!1,l=void 0;try{for(var d,u=e[Symbol.iterator]();!(o=(d=u.next()).done);o=!0){var h=d.value;h<128&&t.push(m(h))}}catch(e){a=!0,l=e}finally{try{!o&&u.return&&u.return()}finally{if(a)throw l}}var p=t.length,y=p;for(p&&t.push("-");y<r;){var _=c,P=!0,w=!1,x=void 0;try{for(var C,S=e[Symbol.iterator]();!(P=(C=S.next()).done);P=!0){var D=C.value;D>=s&&D<_&&(_=D)}}catch(e){w=!0,x=e}finally{try{!P&&S.return&&S.return()}finally{if(w)throw x}}var M=y+1;_-s>f((c-i)/M)&&v("overflow"),i+=(_-s)*M,s=_;var T=!0,R=!1,O=void 0;try{for(var A,j=e[Symbol.iterator]();!(T=(A=j.next()).done);T=!0){var k=A.value;if(k<s&&++i>c&&v("overflow"),k==s){for(var I=i,L=36;;L+=36){var V=L<=n?1:L>=n+26?26:L-n;if(I<V)break;var N=I-V,F=36-V;t.push(m(b(V+N%F,0))),I=f(N/F)}t.push(m(b(I,0))),n=E(i,M,y==p),i=0,++y}}}catch(e){R=!0,O=e}finally{try{!T&&j.return&&j.return()}finally{if(R)throw O}}++i,++s}return t.join("")},w={version:"2.1.0",ucs2:{decode:g,encode:function(e){return String.fromCodePoint.apply(String,function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(e))}},decode:_,encode:P,toASCII:function(e){return y(e,function(e){return u.test(e)?"xn--"+P(e):e})},toUnicode:function(e){return y(e,function(e){return d.test(e)?_(e.slice(4).toLowerCase()):e})}},x={};function C(e){var t=e.charCodeAt(0);return t<16?"%0"+t.toString(16).toUpperCase():t<128?"%"+t.toString(16).toUpperCase():t<2048?"%"+(t>>6|192).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase():"%"+(t>>12|224).toString(16).toUpperCase()+"%"+(t>>6&63|128).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase()}function S(e){for(var t="",r=0,s=e.length;r<s;){var i=parseInt(e.substr(r+1,2),16);if(i<128)t+=String.fromCharCode(i),r+=3;else if(i>=194&&i<224){if(s-r>=6){var n=parseInt(e.substr(r+4,2),16);t+=String.fromCharCode((31&i)<<6|63&n)}else t+=e.substr(r,6);r+=6}else if(i>=224){if(s-r>=9){var o=parseInt(e.substr(r+4,2),16),a=parseInt(e.substr(r+7,2),16);t+=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a)}else t+=e.substr(r,9);r+=9}else t+=e.substr(r,3),r+=3}return t}function D(e,t){function r(e){var r=S(e);return r.match(t.UNRESERVED)?r:e}return e.scheme&&(e.scheme=String(e.scheme).replace(t.PCT_ENCODED,r).toLowerCase().replace(t.NOT_SCHEME,"")),void 0!==e.userinfo&&(e.userinfo=String(e.userinfo).replace(t.PCT_ENCODED,r).replace(t.NOT_USERINFO,C).replace(t.PCT_ENCODED,i)),void 0!==e.host&&(e.host=String(e.host).replace(t.PCT_ENCODED,r).toLowerCase().replace(t.NOT_HOST,C).replace(t.PCT_ENCODED,i)),void 0!==e.path&&(e.path=String(e.path).replace(t.PCT_ENCODED,r).replace(e.scheme?t.NOT_PATH:t.NOT_PATH_NOSCHEME,C).replace(t.PCT_ENCODED,i)),void 0!==e.query&&(e.query=String(e.query).replace(t.PCT_ENCODED,r).replace(t.NOT_QUERY,C).replace(t.PCT_ENCODED,i)),void 0!==e.fragment&&(e.fragment=String(e.fragment).replace(t.PCT_ENCODED,r).replace(t.NOT_FRAGMENT,C).replace(t.PCT_ENCODED,i)),e}function M(e){return e.replace(/^0*(.*)/,"$1")||"0"}function T(e,t){var r=e.match(t.IPV4ADDRESS)||[],s=l(r,2),i=s[1];return i?i.split(".").map(M).join("."):e}function R(e,t){var r=e.match(t.IPV6ADDRESS)||[],s=l(r,3),i=s[1],n=s[2];if(i){for(var o=i.toLowerCase().split("::").reverse(),a=l(o,2),c=a[0],d=a[1],u=d?d.split(":").map(M):[],h=c.split(":").map(M),p=t.IPV4ADDRESS.test(h[h.length-1]),f=p?7:8,m=h.length-f,v=Array(f),y=0;y<f;++y)v[y]=u[y]||h[m+y]||"";p&&(v[f-1]=T(v[f-1],t));var g=v.reduce(function(e,t,r){if(!t||"0"===t){var s=e[e.length-1];s&&s.index+s.length===r?s.length++:e.push({index:r,length:1})}return e},[]),b=g.sort(function(e,t){return t.length-e.length})[0],E=void 0;if(b&&b.length>1){var _=v.slice(0,b.index),P=v.slice(b.index+b.length);E=_.join(":")+"::"+P.join(":")}else E=v.join(":");return n&&(E+="%"+n),E}return e}var O=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,A=void 0==="".match(/(){0}/)[1];function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={},s=!1!==t.iri?a:o;"suffix"===t.reference&&(e=(t.scheme?t.scheme+":":"")+"//"+e);var i=e.match(O);if(i){A?(r.scheme=i[1],r.userinfo=i[3],r.host=i[4],r.port=parseInt(i[5],10),r.path=i[6]||"",r.query=i[7],r.fragment=i[8],isNaN(r.port)&&(r.port=i[5])):(r.scheme=i[1]||void 0,r.userinfo=-1!==e.indexOf("@")?i[3]:void 0,r.host=-1!==e.indexOf("//")?i[4]:void 0,r.port=parseInt(i[5],10),r.path=i[6]||"",r.query=-1!==e.indexOf("?")?i[7]:void 0,r.fragment=-1!==e.indexOf("#")?i[8]:void 0,isNaN(r.port)&&(r.port=e.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?i[4]:void 0)),r.host&&(r.host=R(T(r.host,s),s)),void 0!==r.scheme||void 0!==r.userinfo||void 0!==r.host||void 0!==r.port||r.path||void 0!==r.query?void 0===r.scheme?r.reference="relative":void 0===r.fragment?r.reference="absolute":r.reference="uri":r.reference="same-document",t.reference&&"suffix"!==t.reference&&t.reference!==r.reference&&(r.error=r.error||"URI is not a "+t.reference+" reference.");var n=x[(t.scheme||r.scheme||"").toLowerCase()];if(t.unicodeSupport||n&&n.unicodeSupport)D(r,s);else{if(r.host&&(t.domainHost||n&&n.domainHost))try{r.host=w.toASCII(r.host.replace(s.PCT_ENCODED,S).toLowerCase())}catch(e){r.error=r.error||"Host's domain name can not be converted to ASCII via punycode: "+e}D(r,o)}n&&n.parse&&n.parse(r,t)}else r.error=r.error||"URI can not be parsed.";return r}var k=/^\.\.?\//,I=/^\/\.(\/|$)/,L=/^\/\.\.(\/|$)/,V=/^\/?(?:.|\n)*?(?=\/|$)/;function N(e){for(var t=[];e.length;)if(e.match(k))e=e.replace(k,"");else if(e.match(I))e=e.replace(I,"/");else if(e.match(L))e=e.replace(L,"/"),t.pop();else if("."===e||".."===e)e="";else{var r=e.match(V);if(!r)throw new Error("Unexpected dot segment condition");var s=r[0];e=e.slice(s.length),t.push(s)}return t.join("")}function F(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.iri?a:o,s=[],i=x[(t.scheme||e.scheme||"").toLowerCase()];if(i&&i.serialize&&i.serialize(e,t),e.host)if(r.IPV6ADDRESS.test(e.host));else if(t.domainHost||i&&i.domainHost)try{e.host=t.iri?w.toUnicode(e.host):w.toASCII(e.host.replace(r.PCT_ENCODED,S).toLowerCase())}catch(r){e.error=e.error||"Host's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+r}D(e,r),"suffix"!==t.reference&&e.scheme&&(s.push(e.scheme),s.push(":"));var n=function(e,t){var r=!1!==t.iri?a:o,s=[];return void 0!==e.userinfo&&(s.push(e.userinfo),s.push("@")),void 0!==e.host&&s.push(R(T(String(e.host),r),r).replace(r.IPV6ADDRESS,function(e,t,r){return"["+t+(r?"%25"+r:"")+"]"})),"number"==typeof e.port&&(s.push(":"),s.push(e.port.toString(10))),s.length?s.join(""):void 0}(e,t);if(void 0!==n&&("suffix"!==t.reference&&s.push("//"),s.push(n),e.path&&"/"!==e.path.charAt(0)&&s.push("/")),void 0!==e.path){var l=e.path;t.absolutePath||i&&i.absolutePath||(l=N(l)),void 0===n&&(l=l.replace(/^\/\//,"/%2F")),s.push(l)}return void 0!==e.query&&(s.push("?"),s.push(e.query)),void 0!==e.fragment&&(s.push("#"),s.push(e.fragment)),s.join("")}function $(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments[3],i={};return s||(e=j(F(e,r),r),t=j(F(t,r),r)),!(r=r||{}).tolerant&&t.scheme?(i.scheme=t.scheme,i.userinfo=t.userinfo,i.host=t.host,i.port=t.port,i.path=N(t.path||""),i.query=t.query):(void 0!==t.userinfo||void 0!==t.host||void 0!==t.port?(i.userinfo=t.userinfo,i.host=t.host,i.port=t.port,i.path=N(t.path||""),i.query=t.query):(t.path?("/"===t.path.charAt(0)?i.path=N(t.path):(void 0===e.userinfo&&void 0===e.host&&void 0===e.port||e.path?e.path?i.path=e.path.slice(0,e.path.lastIndexOf("/")+1)+t.path:i.path=t.path:i.path="/"+t.path,i.path=N(i.path)),i.query=t.query):(i.path=e.path,void 0!==t.query?i.query=t.query:i.query=e.query),i.userinfo=e.userinfo,i.host=e.host,i.port=e.port),i.scheme=e.scheme),i.fragment=t.fragment,i}function z(e,t){return e&&e.toString().replace(t&&t.iri?a.PCT_ENCODED:o.PCT_ENCODED,S)}var U={scheme:"http",domainHost:!0,parse:function(e,t){return e.host||(e.error=e.error||"HTTP URIs must have a host."),e},serialize:function(e,t){return e.port!==("https"!==String(e.scheme).toLowerCase()?80:443)&&""!==e.port||(e.port=void 0),e.path||(e.path="/"),e}},H={scheme:"https",domainHost:U.domainHost,parse:U.parse,serialize:U.serialize},B={},G="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",q="[0-9A-Fa-f]",Q=r(r("%[EFef][0-9A-Fa-f]%"+q+q+"%"+q+q)+"|"+r("%[89A-Fa-f][0-9A-Fa-f]%"+q+q)+"|"+r("%"+q+q)),X=t("[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",'[\\"\\\\]'),Y=new RegExp(G,"g"),K=new RegExp(Q,"g"),W=new RegExp(t("[^]","[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]","[\\.]",'[\\"]',X),"g"),Z=new RegExp(t("[^]",G,"[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]"),"g"),J=Z;function ee(e){var t=S(e);return t.match(Y)?t:e}var te={scheme:"mailto",parse:function(e,t){var r=e,s=r.to=r.path?r.path.split(","):[];if(r.path=void 0,r.query){for(var i=!1,n={},o=r.query.split("&"),a=0,l=o.length;a<l;++a){var c=o[a].split("=");switch(c[0]){case"to":for(var d=c[1].split(","),u=0,h=d.length;u<h;++u)s.push(d[u]);break;case"subject":r.subject=z(c[1],t);break;case"body":r.body=z(c[1],t);break;default:i=!0,n[z(c[0],t)]=z(c[1],t)}}i&&(r.headers=n)}r.query=void 0;for(var p=0,f=s.length;p<f;++p){var m=s[p].split("@");if(m[0]=z(m[0]),t.unicodeSupport)m[1]=z(m[1],t).toLowerCase();else try{m[1]=w.toASCII(z(m[1],t).toLowerCase())}catch(e){r.error=r.error||"Email address's domain name can not be converted to ASCII via punycode: "+e}s[p]=m.join("@")}return r},serialize:function(e,t){var r,s=e,n=null!=(r=e.to)?r instanceof Array?r:"number"!=typeof r.length||r.split||r.setInterval||r.call?[r]:Array.prototype.slice.call(r):[];if(n){for(var o=0,a=n.length;o<a;++o){var l=String(n[o]),c=l.lastIndexOf("@"),d=l.slice(0,c).replace(K,ee).replace(K,i).replace(W,C),u=l.slice(c+1);try{u=t.iri?w.toUnicode(u):w.toASCII(z(u,t).toLowerCase())}catch(e){s.error=s.error||"Email address's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+e}n[o]=d+"@"+u}s.path=n.join(",")}var h=e.headers=e.headers||{};e.subject&&(h.subject=e.subject),e.body&&(h.body=e.body);var p=[];for(var f in h)h[f]!==B[f]&&p.push(f.replace(K,ee).replace(K,i).replace(Z,C)+"="+h[f].replace(K,ee).replace(K,i).replace(J,C));return p.length&&(s.query=p.join("&")),s}},re=/^([^\:]+)\:(.*)/,se={scheme:"urn",parse:function(e,t){var r=e.path&&e.path.match(re),s=e;if(r){var i=t.scheme||s.scheme||"urn",n=r[1].toLowerCase(),o=r[2],a=i+":"+(t.nid||n),l=x[a];s.nid=n,s.nss=o,s.path=void 0,l&&(s=l.parse(s,t))}else s.error=s.error||"URN can not be parsed.";return s},serialize:function(e,t){var r=t.scheme||e.scheme||"urn",s=e.nid,i=r+":"+(t.nid||s),n=x[i];n&&(e=n.serialize(e,t));var o=e,a=e.nss;return o.path=(s||t.nid)+":"+a,o}},ie=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,ne={scheme:"urn:uuid",parse:function(e,t){var r=e;return r.uuid=r.nss,r.nss=void 0,t.tolerant||r.uuid&&r.uuid.match(ie)||(r.error=r.error||"UUID is not valid."),r},serialize:function(e,t){var r=e;return r.nss=(e.uuid||"").toLowerCase(),r}};x[U.scheme]=U,x[H.scheme]=H,x[te.scheme]=te,x[se.scheme]=se,x[ne.scheme]=ne,e.SCHEMES=x,e.pctEncChar=C,e.pctDecChars=S,e.parse=j,e.removeDotSegments=N,e.serialize=F,e.resolveComponents=$,e.resolve=function(e,t,r){var s=function(e,t){var r=e;if(t)for(var s in t)r[s]=t[s];return r}({scheme:"null"},r);return F($(j(e,s),j(t,s),s,!0),s)},e.normalize=function(e,t){return"string"==typeof e?e=F(j(e,t),t):"object"===s(e)&&(e=j(F(e,t),t)),e},e.equal=function(e,t,r){return"string"==typeof e?e=F(j(e,r),r):"object"===s(e)&&(e=F(e,r)),"string"==typeof t?t=F(j(t,r),r):"object"===s(t)&&(t=F(t,r)),e===t},e.escapeComponent=function(e,t){return e&&e.toString().replace(t&&t.iri?a.ESCAPE:o.ESCAPE,C)},e.unescapeComponent=z,Object.defineProperty(e,"__esModule",{value:!0})}(t)},function(e,t,r){"use strict";e.exports=function(e){for(var t,r=0,s=e.length,i=0;i<s;)r++,(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<s&&56320==(64512&(t=e.charCodeAt(i)))&&i++;return r}},function(e,t,r){"use strict";var s=e.exports=function(e,t,r){"function"==typeof t&&(r=t,t={}),function e(t,r,i,n,o,a,l,c,d,u){if(n&&"object"==typeof n&&!Array.isArray(n)){for(var h in r(n,o,a,l,c,d,u),n){var p=n[h];if(Array.isArray(p)){if(h in s.arrayKeywords)for(var f=0;f<p.length;f++)e(t,r,i,p[f],o+"/"+h+"/"+f,a,o,h,n,f)}else if(h in s.propsKeywords){if(p&&"object"==typeof p)for(var m in p)e(t,r,i,p[m],o+"/"+h+"/"+m.replace(/~/g,"~0").replace(/\//g,"~1"),a,o,h,n,m)}else(h in s.keywords||t.allKeys&&!(h in s.skipKeywords))&&e(t,r,i,p,o+"/"+h,a,o,h,n)}i(n,o,a,l,c,d,u)}}(t,"function"==typeof(r=t.cb||r)?r:r.pre||function(){},r.post||function(){},e,"",e)};s.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0},s.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},s.propsKeywords={definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},s.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0}},function(e,t,r){"use strict";var s=e.exports=function(){this._cache={}};s.prototype.put=function(e,t){this._cache[e]=t},s.prototype.get=function(e){return this._cache[e]},s.prototype.del=function(e){delete this._cache[e]},s.prototype.clear=function(){this._cache={}}},function(e,t,r){"use strict";var s=r(29),i=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,n=[0,31,28,31,30,31,30,31,31,30,31,30,31],o=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d:\d\d)?$/i,a=/^[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*$/i,l=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9a-f]{2})*)?$/i,c=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#.\/;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,d=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,u=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,h=/^(?:\/(?:[^~\/]|~0|~1)*)*$/,p=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,f=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~\/]|~0|~1)*)*)$/;function m(e){return e="full"==e?"full":"fast",s.copy(m[e])}function v(e){var t=e.match(i);if(!t)return!1;var r=+t[1],s=+t[2],o=+t[3];return s>=1&&s<=12&&o>=1&&o<=(2==s&&function(e){return e%4==0&&(e%100!=0||e%400==0)}(r)?29:n[s])}function y(e,t){var r=e.match(o);if(!r)return!1;var s=r[1],i=r[2],n=r[3],a=r[5];return(s<=23&&i<=59&&n<=59||23==s&&59==i&&60==n)&&(!t||a)}e.exports=m,m.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d:\d\d)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d:\d\d)$/i,uri:/^(?:[a-z][a-z0-9+-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,"uri-template":c,url:d,email:/^[a-z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:a,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:_,uuid:u,"json-pointer":h,"json-pointer-uri-fragment":p,"relative-json-pointer":f},m.full={date:v,time:y,"date-time":function(e){var t=e.split(g);return 2==t.length&&v(t[0])&&y(t[1],!0)},uri:function(e){return b.test(e)&&l.test(e)},"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@\/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@\/?]|%[0-9a-f]{2})*)?$/i,"uri-template":c,url:d,email:/^[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:function(e){return e.length<=255&&a.test(e)},ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:_,uuid:u,"json-pointer":h,"json-pointer-uri-fragment":p,"relative-json-pointer":f};var g=/t|\s/i;var b=/\/|:/;var E=/[^\\]\\Z/;function _(e){if(E.test(e))return!1;try{return new RegExp(e),!0}catch(e){return!1}}},function(e,t,r){"use strict";var s=r(150),i=r(29).toHash;e.exports=function(){var e=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","items","contains","uniqueItems"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf","if"]}],t=["type","$comment"];return e.all=i(t),e.types=i(["number","integer","string","array","object","boolean","null"]),e.forEach(function(r){r.rules=r.rules.map(function(r){var i;if("object"==typeof r){var n=Object.keys(r)[0];i=r[n],r=n,i.forEach(function(r){t.push(r),e.all[r]=!0})}return t.push(r),e.all[r]={keyword:r,code:s[r],implements:i}}),e.all.$comment={keyword:"$comment",code:s.$comment},r.type&&(e.types[r.type]=r)}),e.keywords=i(t.concat(["$schema","$id","id","$data","title","description","default","definitions","examples","readOnly","writeOnly","contentMediaType","contentEncoding","additionalItems","then","else"])),e.custom={},e}},function(e,t,r){"use strict";e.exports={$ref:r(151),allOf:r(152),anyOf:r(153),$comment:r(154),const:r(155),contains:r(156),dependencies:r(157),enum:r(158),format:r(159),if:r(160),items:r(161),maximum:r(91),minimum:r(91),maxItems:r(92),minItems:r(92),maxLength:r(93),minLength:r(93),maxProperties:r(94),minProperties:r(94),multipleOf:r(162),not:r(163),oneOf:r(164),pattern:r(165),properties:r(166),propertyNames:r(167),required:r(168),uniqueItems:r(169),validate:r(90)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s,i,n=" ",o=e.level,a=e.dataLevel,l=e.schema[t],c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,u="data"+(a||""),h="valid"+o;if("#"==l||"#/"==l)e.isRoot?(s=e.async,i="validate"):(s=!0===e.root.schema.$async,i="root.refVal[0]");else{var p=e.resolveRef(e.baseId,l,e.isRoot);if(void 0===p){var f=e.MissingRefError.message(e.baseId,l);if("fail"==e.opts.missingRefs){e.logger.error(f),(g=g||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { ref: '"+e.util.escapeQuotes(l)+"' } ",!1!==e.opts.messages&&(n+=" , message: 'can\\'t resolve reference "+e.util.escapeQuotes(l)+"' "),e.opts.verbose&&(n+=" , schema: "+e.util.toQuotedString(l)+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),n+=" } "):n+=" {} ";var m=n;n=g.pop(),!e.compositeRule&&d?e.async?n+=" throw new ValidationError(["+m+"]); ":n+=" validate.errors = ["+m+"]; return false; ":n+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",d&&(n+=" if (false) { ")}else{if("ignore"!=e.opts.missingRefs)throw new e.MissingRefError(e.baseId,l,f);e.logger.warn(f),d&&(n+=" if (true) { ")}}else if(p.inline){var v=e.util.copy(e);v.level++;var y="valid"+v.level;v.schema=p.schema,v.schemaPath="",v.errSchemaPath=l,n+=" "+e.validate(v).replace(/validate\.schema/g,p.code)+" ",d&&(n+=" if ("+y+") { ")}else s=!0===p.$async||e.async&&!1!==p.$async,i=p.code}if(i){var g;(g=g||[]).push(n),n="",e.opts.passContext?n+=" "+i+".call(this, ":n+=" "+i+"( ",n+=" "+u+", (dataPath || '')",'""'!=e.errorPath&&(n+=" + "+e.errorPath);var b=n+=" , "+(a?"data"+(a-1||""):"parentData")+" , "+(a?e.dataPathArr[a]:"parentDataProperty")+", rootData)  ";if(n=g.pop(),s){if(!e.async)throw new Error("async schema referenced by sync schema");d&&(n+=" var "+h+"; "),n+=" try { await "+b+"; ",d&&(n+=" "+h+" = true; "),n+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ",d&&(n+=" "+h+" = false; "),n+=" } ",d&&(n+=" if ("+h+") { ")}else n+=" if (!"+b+") { if (vErrors === null) vErrors = "+i+".errors; else vErrors = vErrors.concat("+i+".errors); errors = vErrors.length; } ",d&&(n+=" else { ")}return n}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.schema[t],n=e.schemaPath+e.util.getProperty(t),o=e.errSchemaPath+"/"+t,a=!e.opts.allErrors,l=e.util.copy(e),c="";l.level++;var d="valid"+l.level,u=l.baseId,h=!0,p=i;if(p)for(var f,m=-1,v=p.length-1;m<v;)f=p[m+=1],e.util.schemaHasRules(f,e.RULES.all)&&(h=!1,l.schema=f,l.schemaPath=n+"["+m+"]",l.errSchemaPath=o+"/"+m,s+="  "+e.validate(l)+" ",l.baseId=u,a&&(s+=" if ("+d+") { ",c+="}"));return a&&(s+=h?" if (true) { ":" "+c.slice(0,-1)+" "),s=e.util.cleanUpCode(s)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(n||""),u="valid"+i,h="errs__"+i,p=e.util.copy(e),f="";p.level++;var m="valid"+p.level;if(o.every(function(t){return e.util.schemaHasRules(t,e.RULES.all)})){var v=p.baseId;s+=" var "+h+" = errors; var "+u+" = false;  ";var y=e.compositeRule;e.compositeRule=p.compositeRule=!0;var g=o;if(g)for(var b,E=-1,_=g.length-1;E<_;)b=g[E+=1],p.schema=b,p.schemaPath=a+"["+E+"]",p.errSchemaPath=l+"/"+E,s+="  "+e.validate(p)+" ",p.baseId=v,s+=" "+u+" = "+u+" || "+m+"; if (!"+u+") { ",f+="}";e.compositeRule=p.compositeRule=y,s+=" "+f+" if (!"+u+") {   var err =   ",!1!==e.createErrors?(s+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(s+=" , message: 'should match some schema in anyOf' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),s+=" } "):s+=" {} ",s+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&c&&(e.async?s+=" throw new ValidationError(vErrors); ":s+=" validate.errors = vErrors; return false; "),s+=" } else {  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; } ",e.opts.allErrors&&(s+=" } "),s=e.util.cleanUpCode(s)}else c&&(s+=" if (true) { ");return s}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.schema[t],n=e.errSchemaPath+"/"+t,o=(e.opts.allErrors,e.util.toQuotedString(i));return!0===e.opts.$comment?s+=" console.log("+o+");":"function"==typeof e.opts.$comment&&(s+=" self._opts.$comment("+o+", "+e.util.toQuotedString(n)+", validate.root.schema);"),s}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(n||""),u="valid"+i,h=e.opts.$data&&o&&o.$data;h&&(s+=" var schema"+i+" = "+e.util.getData(o.$data,n,e.dataPathArr)+"; "),h||(s+=" var schema"+i+" = validate.schema"+a+";"),s+="var "+u+" = equal("+d+", schema"+i+"); if (!"+u+") {   ";var p=p||[];p.push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'const' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { allowedValue: schema"+i+" } ",!1!==e.opts.messages&&(s+=" , message: 'should be equal to constant' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),s+=" } "):s+=" {} ";var f=s;return s=p.pop(),!e.compositeRule&&c?e.async?s+=" throw new ValidationError(["+f+"]); ":s+=" validate.errors = ["+f+"]; return false; ":s+=" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" }",c&&(s+=" else { "),s}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(n||""),u="valid"+i,h="errs__"+i,p=e.util.copy(e);p.level++;var f="valid"+p.level,m="i"+i,v=p.dataLevel=e.dataLevel+1,y="data"+v,g=e.baseId,b=e.util.schemaHasRules(o,e.RULES.all);if(s+="var "+h+" = errors;var "+u+";",b){var E=e.compositeRule;e.compositeRule=p.compositeRule=!0,p.schema=o,p.schemaPath=a,p.errSchemaPath=l,s+=" var "+f+" = false; for (var "+m+" = 0; "+m+" < "+d+".length; "+m+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers,!0);var _=d+"["+m+"]";p.dataPathArr[v]=m;var P=e.validate(p);p.baseId=g,e.util.varOccurences(P,y)<2?s+=" "+e.util.varReplace(P,y,_)+" ":s+=" var "+y+" = "+_+"; "+P+" ",s+=" if ("+f+") break; }  ",e.compositeRule=p.compositeRule=E,s+="  if (!"+f+") {"}else s+=" if ("+d+".length == 0) {";var w=w||[];w.push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(s+=" , message: 'should contain a valid item' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),s+=" } "):s+=" {} ";var x=s;return s=w.pop(),!e.compositeRule&&c?e.async?s+=" throw new ValidationError(["+x+"]); ":s+=" validate.errors = ["+x+"]; return false; ":s+=" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" } else { ",b&&(s+="  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; } "),e.opts.allErrors&&(s+=" } "),s=e.util.cleanUpCode(s)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(n||""),u="errs__"+i,h=e.util.copy(e),p="";h.level++;var f="valid"+h.level,m={},v={},y=e.opts.ownProperties;for(_ in o){var g=o[_],b=Array.isArray(g)?v:m;b[_]=g}s+="var "+u+" = errors;";var E=e.errorPath;for(var _ in s+="var missing"+i+";",v)if((b=v[_]).length){if(s+=" if ( "+d+e.util.getProperty(_)+" !== undefined ",y&&(s+=" && Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(_)+"') "),c){s+=" && ( ";var P=b;if(P)for(var w=-1,x=P.length-1;w<x;){R=P[w+=1],w&&(s+=" || "),s+=" ( ( "+(k=d+(j=e.util.getProperty(R)))+" === undefined ",y&&(s+=" || ! Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(R)+"') "),s+=") && (missing"+i+" = "+e.util.toQuotedString(e.opts.jsonPointers?R:j)+") ) "}s+=")) {  ";var C="missing"+i,S="' + "+C+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(E,C,!0):E+" + "+C);var D=D||[];D.push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { property: '"+e.util.escapeQuotes(_)+"', missingProperty: '"+S+"', depsCount: "+b.length+", deps: '"+e.util.escapeQuotes(1==b.length?b[0]:b.join(", "))+"' } ",!1!==e.opts.messages&&(s+=" , message: 'should have ",1==b.length?s+="property "+e.util.escapeQuotes(b[0]):s+="properties "+e.util.escapeQuotes(b.join(", ")),s+=" when property "+e.util.escapeQuotes(_)+" is present' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),s+=" } "):s+=" {} ";var M=s;s=D.pop(),!e.compositeRule&&c?e.async?s+=" throw new ValidationError(["+M+"]); ":s+=" validate.errors = ["+M+"]; return false; ":s+=" var err = "+M+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{s+=" ) { ";var T=b;if(T)for(var R,O=-1,A=T.length-1;O<A;){R=T[O+=1];var j=e.util.getProperty(R),k=(S=e.util.escapeQuotes(R),d+j);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(E,R,e.opts.jsonPointers)),s+=" if ( "+k+" === undefined ",y&&(s+=" || ! Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(R)+"') "),s+=") {  var err =   ",!1!==e.createErrors?(s+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { property: '"+e.util.escapeQuotes(_)+"', missingProperty: '"+S+"', depsCount: "+b.length+", deps: '"+e.util.escapeQuotes(1==b.length?b[0]:b.join(", "))+"' } ",!1!==e.opts.messages&&(s+=" , message: 'should have ",1==b.length?s+="property "+e.util.escapeQuotes(b[0]):s+="properties "+e.util.escapeQuotes(b.join(", ")),s+=" when property "+e.util.escapeQuotes(_)+" is present' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),s+=" } "):s+=" {} ",s+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}s+=" }   ",c&&(p+="}",s+=" else { ")}e.errorPath=E;var I=h.baseId;for(var _ in m){g=m[_];e.util.schemaHasRules(g,e.RULES.all)&&(s+=" "+f+" = true; if ( "+d+e.util.getProperty(_)+" !== undefined ",y&&(s+=" && Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(_)+"') "),s+=") { ",h.schema=g,h.schemaPath=a+e.util.getProperty(_),h.errSchemaPath=l+"/"+e.util.escapeFragment(_),s+="  "+e.validate(h)+" ",h.baseId=I,s+=" }  ",c&&(s+=" if ("+f+") { ",p+="}"))}return c&&(s+="   "+p+" if ("+u+" == errors) {"),s=e.util.cleanUpCode(s)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(n||""),u="valid"+i,h=e.opts.$data&&o&&o.$data;h&&(s+=" var schema"+i+" = "+e.util.getData(o.$data,n,e.dataPathArr)+"; ");var p="i"+i,f="schema"+i;h||(s+=" var "+f+" = validate.schema"+a+";"),s+="var "+u+";",h&&(s+=" if (schema"+i+" === undefined) "+u+" = true; else if (!Array.isArray(schema"+i+")) "+u+" = false; else {"),s+=u+" = false;for (var "+p+"=0; "+p+"<"+f+".length; "+p+"++) if (equal("+d+", "+f+"["+p+"])) { "+u+" = true; break; }",h&&(s+="  }  "),s+=" if (!"+u+") {   ";var m=m||[];m.push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { allowedValues: schema"+i+" } ",!1!==e.opts.messages&&(s+=" , message: 'should be equal to one of the allowed values' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),s+=" } "):s+=" {} ";var v=s;return s=m.pop(),!e.compositeRule&&c?e.async?s+=" throw new ValidationError(["+v+"]); ":s+=" validate.errors = ["+v+"]; return false; ":s+=" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" }",c&&(s+=" else { "),s}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(n||"");if(!1===e.opts.format)return c&&(s+=" if (true) { "),s;var u,h=e.opts.$data&&o&&o.$data;h?(s+=" var schema"+i+" = "+e.util.getData(o.$data,n,e.dataPathArr)+"; ",u="schema"+i):u=o;var p=e.opts.unknownFormats,f=Array.isArray(p);if(h){s+=" var "+(m="format"+i)+" = formats["+u+"]; var "+(v="isObject"+i)+" = typeof "+m+" == 'object' && !("+m+" instanceof RegExp) && "+m+".validate; var "+(y="formatType"+i)+" = "+v+" && "+m+".type || 'string'; if ("+v+") { ",e.async&&(s+=" var async"+i+" = "+m+".async; "),s+=" "+m+" = "+m+".validate; } if (  ",h&&(s+=" ("+u+" !== undefined && typeof "+u+" != 'string') || "),s+=" (","ignore"!=p&&(s+=" ("+u+" && !"+m+" ",f&&(s+=" && self._opts.unknownFormats.indexOf("+u+") == -1 "),s+=") || "),s+=" ("+m+" && "+y+" == '"+r+"' && !(typeof "+m+" == 'function' ? ",e.async?s+=" (async"+i+" ? await "+m+"("+d+") : "+m+"("+d+")) ":s+=" "+m+"("+d+") ",s+=" : "+m+".test("+d+"))))) {"}else{var m;if(!(m=e.formats[o])){if("ignore"==p)return e.logger.warn('unknown format "'+o+'" ignored in schema at path "'+e.errSchemaPath+'"'),c&&(s+=" if (true) { "),s;if(f&&p.indexOf(o)>=0)return c&&(s+=" if (true) { "),s;throw new Error('unknown format "'+o+'" is used in schema at path "'+e.errSchemaPath+'"')}var v,y=(v="object"==typeof m&&!(m instanceof RegExp)&&m.validate)&&m.type||"string";if(v){var g=!0===m.async;m=m.validate}if(y!=r)return c&&(s+=" if (true) { "),s;if(g){if(!e.async)throw new Error("async format in sync schema");s+=" if (!(await "+(b="formats"+e.util.getProperty(o)+".validate")+"("+d+"))) { "}else{s+=" if (! ";var b="formats"+e.util.getProperty(o);v&&(b+=".validate"),s+="function"==typeof m?" "+b+"("+d+") ":" "+b+".test("+d+") ",s+=") { "}}var E=E||[];E.push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'format' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { format:  ",s+=h?""+u:""+e.util.toQuotedString(o),s+="  } ",!1!==e.opts.messages&&(s+=" , message: 'should match format \"",s+=h?"' + "+u+" + '":""+e.util.escapeQuotes(o),s+="\"' "),e.opts.verbose&&(s+=" , schema:  ",s+=h?"validate.schema"+a:""+e.util.toQuotedString(o),s+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),s+=" } "):s+=" {} ";var _=s;return s=E.pop(),!e.compositeRule&&c?e.async?s+=" throw new ValidationError(["+_+"]); ":s+=" validate.errors = ["+_+"]; return false; ":s+=" var err = "+_+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" } ",c&&(s+=" else { "),s}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(n||""),u="valid"+i,h="errs__"+i,p=e.util.copy(e);p.level++;var f="valid"+p.level,m=e.schema.then,v=e.schema.else,y=void 0!==m&&e.util.schemaHasRules(m,e.RULES.all),g=void 0!==v&&e.util.schemaHasRules(v,e.RULES.all),b=p.baseId;if(y||g){var E;p.createErrors=!1,p.schema=o,p.schemaPath=a,p.errSchemaPath=l,s+=" var "+h+" = errors; var "+u+" = true;  ";var _=e.compositeRule;e.compositeRule=p.compositeRule=!0,s+="  "+e.validate(p)+" ",p.baseId=b,p.createErrors=!0,s+="  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; }  ",e.compositeRule=p.compositeRule=_,y?(s+=" if ("+f+") {  ",p.schema=e.schema.then,p.schemaPath=e.schemaPath+".then",p.errSchemaPath=e.errSchemaPath+"/then",s+="  "+e.validate(p)+" ",p.baseId=b,s+=" "+u+" = "+f+"; ",y&&g?s+=" var "+(E="ifClause"+i)+" = 'then'; ":E="'then'",s+=" } ",g&&(s+=" else { ")):s+=" if (!"+f+") { ",g&&(p.schema=e.schema.else,p.schemaPath=e.schemaPath+".else",p.errSchemaPath=e.errSchemaPath+"/else",s+="  "+e.validate(p)+" ",p.baseId=b,s+=" "+u+" = "+f+"; ",y&&g?s+=" var "+(E="ifClause"+i)+" = 'else'; ":E="'else'",s+=" } "),s+=" if (!"+u+") {   var err =   ",!1!==e.createErrors?(s+=" { keyword: 'if' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { failingKeyword: "+E+" } ",!1!==e.opts.messages&&(s+=" , message: 'should match \"' + "+E+" + '\" schema' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),s+=" } "):s+=" {} ",s+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&c&&(e.async?s+=" throw new ValidationError(vErrors); ":s+=" validate.errors = vErrors; return false; "),s+=" }   ",c&&(s+=" else { "),s=e.util.cleanUpCode(s)}else c&&(s+=" if (true) { ");return s}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(n||""),u="valid"+i,h="errs__"+i,p=e.util.copy(e),f="";p.level++;var m="valid"+p.level,v="i"+i,y=p.dataLevel=e.dataLevel+1,g="data"+y,b=e.baseId;if(s+="var "+h+" = errors;var "+u+";",Array.isArray(o)){var E=e.schema.additionalItems;if(!1===E){s+=" "+u+" = "+d+".length <= "+o.length+"; ";var _=l;l=e.errSchemaPath+"/additionalItems",s+="  if (!"+u+") {   ";var P=P||[];P.push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+o.length+" } ",!1!==e.opts.messages&&(s+=" , message: 'should NOT have more than "+o.length+" items' "),e.opts.verbose&&(s+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),s+=" } "):s+=" {} ";var w=s;s=P.pop(),!e.compositeRule&&c?e.async?s+=" throw new ValidationError(["+w+"]); ":s+=" validate.errors = ["+w+"]; return false; ":s+=" var err = "+w+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" } ",l=_,c&&(f+="}",s+=" else { ")}var x=o;if(x)for(var C,S=-1,D=x.length-1;S<D;)if(C=x[S+=1],e.util.schemaHasRules(C,e.RULES.all)){s+=" "+m+" = true; if ("+d+".length > "+S+") { ";var M=d+"["+S+"]";p.schema=C,p.schemaPath=a+"["+S+"]",p.errSchemaPath=l+"/"+S,p.errorPath=e.util.getPathExpr(e.errorPath,S,e.opts.jsonPointers,!0),p.dataPathArr[y]=S;var T=e.validate(p);p.baseId=b,e.util.varOccurences(T,g)<2?s+=" "+e.util.varReplace(T,g,M)+" ":s+=" var "+g+" = "+M+"; "+T+" ",s+=" }  ",c&&(s+=" if ("+m+") { ",f+="}")}if("object"==typeof E&&e.util.schemaHasRules(E,e.RULES.all)){p.schema=E,p.schemaPath=e.schemaPath+".additionalItems",p.errSchemaPath=e.errSchemaPath+"/additionalItems",s+=" "+m+" = true; if ("+d+".length > "+o.length+") {  for (var "+v+" = "+o.length+"; "+v+" < "+d+".length; "+v+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers,!0);M=d+"["+v+"]";p.dataPathArr[y]=v;T=e.validate(p);p.baseId=b,e.util.varOccurences(T,g)<2?s+=" "+e.util.varReplace(T,g,M)+" ":s+=" var "+g+" = "+M+"; "+T+" ",c&&(s+=" if (!"+m+") break; "),s+=" } }  ",c&&(s+=" if ("+m+") { ",f+="}")}}else if(e.util.schemaHasRules(o,e.RULES.all)){p.schema=o,p.schemaPath=a,p.errSchemaPath=l,s+="  for (var "+v+" = 0; "+v+" < "+d+".length; "+v+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers,!0);M=d+"["+v+"]";p.dataPathArr[y]=v;T=e.validate(p);p.baseId=b,e.util.varOccurences(T,g)<2?s+=" "+e.util.varReplace(T,g,M)+" ":s+=" var "+g+" = "+M+"; "+T+" ",c&&(s+=" if (!"+m+") break; "),s+=" }"}return c&&(s+=" "+f+" if ("+h+" == errors) {"),s=e.util.cleanUpCode(s)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s,i=" ",n=e.level,o=e.dataLevel,a=e.schema[t],l=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,u="data"+(o||""),h=e.opts.$data&&a&&a.$data;h?(i+=" var schema"+n+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; ",s="schema"+n):s=a,i+="var division"+n+";if (",h&&(i+=" "+s+" !== undefined && ( typeof "+s+" != 'number' || "),i+=" (division"+n+" = "+u+" / "+s+", ",e.opts.multipleOfPrecision?i+=" Math.abs(Math.round(division"+n+") - division"+n+") > 1e-"+e.opts.multipleOfPrecision+" ":i+=" division"+n+" !== parseInt(division"+n+") ",i+=" ) ",h&&(i+="  )  "),i+=" ) {   ";var p=p||[];p.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { multipleOf: "+s+" } ",!1!==e.opts.messages&&(i+=" , message: 'should be multiple of ",i+=h?"' + "+s:s+"'"),e.opts.verbose&&(i+=" , schema:  ",i+=h?"validate.schema"+l:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),i+=" } "):i+=" {} ";var f=i;return i=p.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+f+"]); ":i+=" validate.errors = ["+f+"]; return false; ":i+=" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",d&&(i+=" else { "),i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(n||""),u="errs__"+i,h=e.util.copy(e);h.level++;var p="valid"+h.level;if(e.util.schemaHasRules(o,e.RULES.all)){h.schema=o,h.schemaPath=a,h.errSchemaPath=l,s+=" var "+u+" = errors;  ";var f,m=e.compositeRule;e.compositeRule=h.compositeRule=!0,h.createErrors=!1,h.opts.allErrors&&(f=h.opts.allErrors,h.opts.allErrors=!1),s+=" "+e.validate(h)+" ",h.createErrors=!0,f&&(h.opts.allErrors=f),e.compositeRule=h.compositeRule=m,s+=" if ("+p+") {   ";var v=v||[];v.push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(s+=" , message: 'should NOT be valid' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),s+=" } "):s+=" {} ";var y=s;s=v.pop(),!e.compositeRule&&c?e.async?s+=" throw new ValidationError(["+y+"]); ":s+=" validate.errors = ["+y+"]; return false; ":s+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" } else {  errors = "+u+"; if (vErrors !== null) { if ("+u+") vErrors.length = "+u+"; else vErrors = null; } ",e.opts.allErrors&&(s+=" } ")}else s+="  var err =   ",!1!==e.createErrors?(s+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(s+=" , message: 'should NOT be valid' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),s+=" } "):s+=" {} ",s+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c&&(s+=" if (false) { ");return s}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(n||""),u="valid"+i,h="errs__"+i,p=e.util.copy(e),f="";p.level++;var m="valid"+p.level,v=p.baseId,y="prevValid"+i,g="passingSchemas"+i;s+="var "+h+" = errors , "+y+" = false , "+u+" = false , "+g+" = null; ";var b=e.compositeRule;e.compositeRule=p.compositeRule=!0;var E=o;if(E)for(var _,P=-1,w=E.length-1;P<w;)_=E[P+=1],e.util.schemaHasRules(_,e.RULES.all)?(p.schema=_,p.schemaPath=a+"["+P+"]",p.errSchemaPath=l+"/"+P,s+="  "+e.validate(p)+" ",p.baseId=v):s+=" var "+m+" = true; ",P&&(s+=" if ("+m+" && "+y+") { "+u+" = false; "+g+" = ["+g+", "+P+"]; } else { ",f+="}"),s+=" if ("+m+") { "+u+" = "+y+" = true; "+g+" = "+P+"; }";return e.compositeRule=p.compositeRule=b,s+=f+"if (!"+u+") {   var err =   ",!1!==e.createErrors?(s+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { passingSchemas: "+g+" } ",!1!==e.opts.messages&&(s+=" , message: 'should match exactly one schema in oneOf' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),s+=" } "):s+=" {} ",s+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&c&&(e.async?s+=" throw new ValidationError(vErrors); ":s+=" validate.errors = vErrors; return false; "),s+="} else {  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; }",e.opts.allErrors&&(s+=" } "),s}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s,i=" ",n=e.level,o=e.dataLevel,a=e.schema[t],l=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,u="data"+(o||""),h=e.opts.$data&&a&&a.$data;h?(i+=" var schema"+n+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; ",s="schema"+n):s=a,i+="if ( ",h&&(i+=" ("+s+" !== undefined && typeof "+s+" != 'string') || "),i+=" !"+(h?"(new RegExp("+s+"))":e.usePattern(a))+".test("+u+") ) {   ";var p=p||[];p.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { pattern:  ",i+=h?""+s:""+e.util.toQuotedString(a),i+="  } ",!1!==e.opts.messages&&(i+=" , message: 'should match pattern \"",i+=h?"' + "+s+" + '":""+e.util.escapeQuotes(a),i+="\"' "),e.opts.verbose&&(i+=" , schema:  ",i+=h?"validate.schema"+l:""+e.util.toQuotedString(a),i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),i+=" } "):i+=" {} ";var f=i;return i=p.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+f+"]); ":i+=" validate.errors = ["+f+"]; return false; ":i+=" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",d&&(i+=" else { "),i}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(n||""),u="errs__"+i,h=e.util.copy(e),p="";h.level++;var f="valid"+h.level,m="key"+i,v="idx"+i,y=h.dataLevel=e.dataLevel+1,g="data"+y,b="dataProperties"+i,E=Object.keys(o||{}),_=e.schema.patternProperties||{},P=Object.keys(_),w=e.schema.additionalProperties,x=E.length||P.length,C=!1===w,S="object"==typeof w&&Object.keys(w).length,D=e.opts.removeAdditional,M=C||S||D,T=e.opts.ownProperties,R=e.baseId,O=e.schema.required;if(O&&(!e.opts.$data||!O.$data)&&O.length<e.opts.loopRequired)var A=e.util.toHash(O);if(s+="var "+u+" = errors;var "+f+" = true;",T&&(s+=" var "+b+" = undefined;"),M){if(s+=T?" "+b+" = "+b+" || Object.keys("+d+"); for (var "+v+"=0; "+v+"<"+b+".length; "+v+"++) { var "+m+" = "+b+"["+v+"]; ":" for (var "+m+" in "+d+") { ",x){if(s+=" var isAdditional"+i+" = !(false ",E.length)if(E.length>8)s+=" || validate.schema"+a+".hasOwnProperty("+m+") ";else{var j=E;if(j)for(var k=-1,I=j.length-1;k<I;)X=j[k+=1],s+=" || "+m+" == "+e.util.toQuotedString(X)+" "}if(P.length){var L=P;if(L)for(var V=-1,N=L.length-1;V<N;)ie=L[V+=1],s+=" || "+e.usePattern(ie)+".test("+m+") "}s+=" ); if (isAdditional"+i+") { "}if("all"==D)s+=" delete "+d+"["+m+"]; ";else{var F=e.errorPath,$="' + "+m+" + '";if(e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers)),C)if(D)s+=" delete "+d+"["+m+"]; ";else{s+=" "+f+" = false; ";var z=l;l=e.errSchemaPath+"/additionalProperties",(te=te||[]).push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { additionalProperty: '"+$+"' } ",!1!==e.opts.messages&&(s+=" , message: '",e.opts._errorDataPathProperty?s+="is an invalid additional property":s+="should NOT have additional properties",s+="' "),e.opts.verbose&&(s+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),s+=" } "):s+=" {} ";var U=s;s=te.pop(),!e.compositeRule&&c?e.async?s+=" throw new ValidationError(["+U+"]); ":s+=" validate.errors = ["+U+"]; return false; ":s+=" var err = "+U+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l=z,c&&(s+=" break; ")}else if(S)if("failing"==D){s+=" var "+u+" = errors;  ";var H=e.compositeRule;e.compositeRule=h.compositeRule=!0,h.schema=w,h.schemaPath=e.schemaPath+".additionalProperties",h.errSchemaPath=e.errSchemaPath+"/additionalProperties",h.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers);var B=d+"["+m+"]";h.dataPathArr[y]=m;var G=e.validate(h);h.baseId=R,e.util.varOccurences(G,g)<2?s+=" "+e.util.varReplace(G,g,B)+" ":s+=" var "+g+" = "+B+"; "+G+" ",s+=" if (!"+f+") { errors = "+u+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+d+"["+m+"]; }  ",e.compositeRule=h.compositeRule=H}else{h.schema=w,h.schemaPath=e.schemaPath+".additionalProperties",h.errSchemaPath=e.errSchemaPath+"/additionalProperties",h.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers);B=d+"["+m+"]";h.dataPathArr[y]=m;G=e.validate(h);h.baseId=R,e.util.varOccurences(G,g)<2?s+=" "+e.util.varReplace(G,g,B)+" ":s+=" var "+g+" = "+B+"; "+G+" ",c&&(s+=" if (!"+f+") break; ")}e.errorPath=F}x&&(s+=" } "),s+=" }  ",c&&(s+=" if ("+f+") { ",p+="}")}var q=e.opts.useDefaults&&!e.compositeRule;if(E.length){var Q=E;if(Q)for(var X,Y=-1,K=Q.length-1;Y<K;){var W=o[X=Q[Y+=1]];if(e.util.schemaHasRules(W,e.RULES.all)){var Z=e.util.getProperty(X),J=(B=d+Z,q&&void 0!==W.default);h.schema=W,h.schemaPath=a+Z,h.errSchemaPath=l+"/"+e.util.escapeFragment(X),h.errorPath=e.util.getPath(e.errorPath,X,e.opts.jsonPointers),h.dataPathArr[y]=e.util.toQuotedString(X);G=e.validate(h);if(h.baseId=R,e.util.varOccurences(G,g)<2){G=e.util.varReplace(G,g,B);var ee=B}else{ee=g;s+=" var "+g+" = "+B+"; "}if(J)s+=" "+G+" ";else{if(A&&A[X]){s+=" if ( "+ee+" === undefined ",T&&(s+=" || ! Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(X)+"') "),s+=") { "+f+" = false; ";F=e.errorPath,z=l;var te,re=e.util.escapeQuotes(X);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(F,X,e.opts.jsonPointers)),l=e.errSchemaPath+"/required",(te=te||[]).push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+re+"' } ",!1!==e.opts.messages&&(s+=" , message: '",e.opts._errorDataPathProperty?s+="is a required property":s+="should have required property \\'"+re+"\\'",s+="' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),s+=" } "):s+=" {} ";U=s;s=te.pop(),!e.compositeRule&&c?e.async?s+=" throw new ValidationError(["+U+"]); ":s+=" validate.errors = ["+U+"]; return false; ":s+=" var err = "+U+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l=z,e.errorPath=F,s+=" } else { "}else c?(s+=" if ( "+ee+" === undefined ",T&&(s+=" || ! Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(X)+"') "),s+=") { "+f+" = true; } else { "):(s+=" if ("+ee+" !== undefined ",T&&(s+=" &&   Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(X)+"') "),s+=" ) { ");s+=" "+G+" } "}}c&&(s+=" if ("+f+") { ",p+="}")}}if(P.length){var se=P;if(se)for(var ie,ne=-1,oe=se.length-1;ne<oe;){W=_[ie=se[ne+=1]];if(e.util.schemaHasRules(W,e.RULES.all)){h.schema=W,h.schemaPath=e.schemaPath+".patternProperties"+e.util.getProperty(ie),h.errSchemaPath=e.errSchemaPath+"/patternProperties/"+e.util.escapeFragment(ie),s+=T?" "+b+" = "+b+" || Object.keys("+d+"); for (var "+v+"=0; "+v+"<"+b+".length; "+v+"++) { var "+m+" = "+b+"["+v+"]; ":" for (var "+m+" in "+d+") { ",s+=" if ("+e.usePattern(ie)+".test("+m+")) { ",h.errorPath=e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers);B=d+"["+m+"]";h.dataPathArr[y]=m;G=e.validate(h);h.baseId=R,e.util.varOccurences(G,g)<2?s+=" "+e.util.varReplace(G,g,B)+" ":s+=" var "+g+" = "+B+"; "+G+" ",c&&(s+=" if (!"+f+") break; "),s+=" } ",c&&(s+=" else "+f+" = true; "),s+=" }  ",c&&(s+=" if ("+f+") { ",p+="}")}}}return c&&(s+=" "+p+" if ("+u+" == errors) {"),s=e.util.cleanUpCode(s)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(n||""),u="errs__"+i,h=e.util.copy(e);h.level++;var p="valid"+h.level;if(s+="var "+u+" = errors;",e.util.schemaHasRules(o,e.RULES.all)){h.schema=o,h.schemaPath=a,h.errSchemaPath=l;var f="key"+i,m="idx"+i,v="i"+i,y="' + "+f+" + '",g="data"+(h.dataLevel=e.dataLevel+1),b="dataProperties"+i,E=e.opts.ownProperties,_=e.baseId;E&&(s+=" var "+b+" = undefined; "),s+=E?" "+b+" = "+b+" || Object.keys("+d+"); for (var "+m+"=0; "+m+"<"+b+".length; "+m+"++) { var "+f+" = "+b+"["+m+"]; ":" for (var "+f+" in "+d+") { ",s+=" var startErrs"+i+" = errors; ";var P=f,w=e.compositeRule;e.compositeRule=h.compositeRule=!0;var x=e.validate(h);h.baseId=_,e.util.varOccurences(x,g)<2?s+=" "+e.util.varReplace(x,g,P)+" ":s+=" var "+g+" = "+P+"; "+x+" ",e.compositeRule=h.compositeRule=w,s+=" if (!"+p+") { for (var "+v+"=startErrs"+i+"; "+v+"<errors; "+v+"++) { vErrors["+v+"].propertyName = "+f+"; }   var err =   ",!1!==e.createErrors?(s+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { propertyName: '"+y+"' } ",!1!==e.opts.messages&&(s+=" , message: 'property name \\'"+y+"\\' is invalid' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),s+=" } "):s+=" {} ",s+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&c&&(e.async?s+=" throw new ValidationError(vErrors); ":s+=" validate.errors = vErrors; return false; "),c&&(s+=" break; "),s+=" } }"}return c&&(s+="  if ("+u+" == errors) {"),s=e.util.cleanUpCode(s)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s=" ",i=e.level,n=e.dataLevel,o=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(n||""),u="valid"+i,h=e.opts.$data&&o&&o.$data;h&&(s+=" var schema"+i+" = "+e.util.getData(o.$data,n,e.dataPathArr)+"; ");var p="schema"+i;if(!h)if(o.length<e.opts.loopRequired&&e.schema.properties&&Object.keys(e.schema.properties).length){var f=[],m=o;if(m)for(var v,y=-1,g=m.length-1;y<g;){v=m[y+=1];var b=e.schema.properties[v];b&&e.util.schemaHasRules(b,e.RULES.all)||(f[f.length]=v)}}else f=o;if(h||f.length){var E=e.errorPath,_=h||f.length>=e.opts.loopRequired,P=e.opts.ownProperties;if(c)if(s+=" var missing"+i+"; ",_){h||(s+=" var "+p+" = validate.schema"+a+"; ");var w="' + "+(T="schema"+i+"["+(S="i"+i)+"]")+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(E,T,e.opts.jsonPointers)),s+=" var "+u+" = true; ",h&&(s+=" if (schema"+i+" === undefined) "+u+" = true; else if (!Array.isArray(schema"+i+")) "+u+" = false; else {"),s+=" for (var "+S+" = 0; "+S+" < "+p+".length; "+S+"++) { "+u+" = "+d+"["+p+"["+S+"]] !== undefined ",P&&(s+=" &&   Object.prototype.hasOwnProperty.call("+d+", "+p+"["+S+"]) "),s+="; if (!"+u+") break; } ",h&&(s+="  }  "),s+="  if (!"+u+") {   ",(M=M||[]).push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+w+"' } ",!1!==e.opts.messages&&(s+=" , message: '",e.opts._errorDataPathProperty?s+="is a required property":s+="should have required property \\'"+w+"\\'",s+="' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),s+=" } "):s+=" {} ";var x=s;s=M.pop(),!e.compositeRule&&c?e.async?s+=" throw new ValidationError(["+x+"]); ":s+=" validate.errors = ["+x+"]; return false; ":s+=" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" } else { "}else{s+=" if ( ";var C=f;if(C)for(var S=-1,D=C.length-1;S<D;){O=C[S+=1],S&&(s+=" || "),s+=" ( ( "+(I=d+(k=e.util.getProperty(O)))+" === undefined ",P&&(s+=" || ! Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(O)+"') "),s+=") && (missing"+i+" = "+e.util.toQuotedString(e.opts.jsonPointers?O:k)+") ) "}s+=") {  ";var M;w="' + "+(T="missing"+i)+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(E,T,!0):E+" + "+T),(M=M||[]).push(s),s="",!1!==e.createErrors?(s+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+w+"' } ",!1!==e.opts.messages&&(s+=" , message: '",e.opts._errorDataPathProperty?s+="is a required property":s+="should have required property \\'"+w+"\\'",s+="' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),s+=" } "):s+=" {} ";x=s;s=M.pop(),!e.compositeRule&&c?e.async?s+=" throw new ValidationError(["+x+"]); ":s+=" validate.errors = ["+x+"]; return false; ":s+=" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" } else { "}else if(_){h||(s+=" var "+p+" = validate.schema"+a+"; ");var T;w="' + "+(T="schema"+i+"["+(S="i"+i)+"]")+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(E,T,e.opts.jsonPointers)),h&&(s+=" if ("+p+" && !Array.isArray("+p+")) {  var err =   ",!1!==e.createErrors?(s+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+w+"' } ",!1!==e.opts.messages&&(s+=" , message: '",e.opts._errorDataPathProperty?s+="is a required property":s+="should have required property \\'"+w+"\\'",s+="' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),s+=" } "):s+=" {} ",s+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+p+" !== undefined) { "),s+=" for (var "+S+" = 0; "+S+" < "+p+".length; "+S+"++) { if ("+d+"["+p+"["+S+"]] === undefined ",P&&(s+=" || ! Object.prototype.hasOwnProperty.call("+d+", "+p+"["+S+"]) "),s+=") {  var err =   ",!1!==e.createErrors?(s+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+w+"' } ",!1!==e.opts.messages&&(s+=" , message: '",e.opts._errorDataPathProperty?s+="is a required property":s+="should have required property \\'"+w+"\\'",s+="' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),s+=" } "):s+=" {} ",s+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",h&&(s+="  }  ")}else{var R=f;if(R)for(var O,A=-1,j=R.length-1;A<j;){O=R[A+=1];var k=e.util.getProperty(O),I=(w=e.util.escapeQuotes(O),d+k);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(E,O,e.opts.jsonPointers)),s+=" if ( "+I+" === undefined ",P&&(s+=" || ! Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(O)+"') "),s+=") {  var err =   ",!1!==e.createErrors?(s+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+w+"' } ",!1!==e.opts.messages&&(s+=" , message: '",e.opts._errorDataPathProperty?s+="is a required property":s+="should have required property \\'"+w+"\\'",s+="' "),e.opts.verbose&&(s+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),s+=" } "):s+=" {} ",s+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}e.errorPath=E}else c&&(s+=" if (true) {");return s}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s,i=" ",n=e.level,o=e.dataLevel,a=e.schema[t],l=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,u="data"+(o||""),h="valid"+n,p=e.opts.$data&&a&&a.$data;if(p?(i+=" var schema"+n+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; ",s="schema"+n):s=a,(a||p)&&!1!==e.opts.uniqueItems){p&&(i+=" var "+h+"; if ("+s+" === false || "+s+" === undefined) "+h+" = true; else if (typeof "+s+" != 'boolean') "+h+" = false; else { "),i+=" var i = "+u+".length , "+h+" = true , j; if (i > 1) { ";var f=e.schema.items&&e.schema.items.type,m=Array.isArray(f);if(!f||"object"==f||"array"==f||m&&(f.indexOf("object")>=0||f.indexOf("array")>=0))i+=" outer: for (;i--;) { for (j = i; j--;) { if (equal("+u+"[i], "+u+"[j])) { "+h+" = false; break outer; } } } ";else{i+=" var itemIndices = {}, item; for (;i--;) { var item = "+u+"[i]; ";var v="checkDataType"+(m?"s":"");i+=" if ("+e.util[v](f,"item",!0)+") continue; ",m&&(i+=" if (typeof item == 'string') item = '\"' + item; "),i+=" if (typeof itemIndices[item] == 'number') { "+h+" = false; j = itemIndices[item]; break; } itemIndices[item] = i; } "}i+=" } ",p&&(i+="  }  "),i+=" if (!"+h+") {   ";var y=y||[];y.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { i: i, j: j } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),e.opts.verbose&&(i+=" , schema:  ",i+=p?"validate.schema"+l:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),i+=" } "):i+=" {} ";var g=i;i=y.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+g+"]); ":i+=" validate.errors = ["+g+"]; return false; ":i+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",d&&(i+=" else { ")}else d&&(i+=" if (true) { ");return i}},function(e,t,r){"use strict";var s=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"];e.exports=function(e,t){for(var r=0;r<t.length;r++){e=JSON.parse(JSON.stringify(e));var i,n=t[r].split("/"),o=e;for(i=1;i<n.length;i++)o=o[n[i]];for(i=0;i<s.length;i++){var a=s[i],l=o[a];l&&(o[a]={anyOf:[l,{$ref:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#"}]})}}return e}},function(e,t,r){"use strict";var s=r(69).MissingRef;e.exports=function e(t,r,i){var n=this;if("function"!=typeof this._opts.loadSchema)throw new Error("options.loadSchema should be a function");"function"==typeof r&&(i=r,r=void 0);var o=a(t).then(function(){var e=n._addSchema(t,void 0,r);return e.validate||function e(t){try{return n._compile(t)}catch(e){if(e instanceof s)return function i(e){var i=e.missingSchema;if(c(i))throw new Error("Schema "+i+" is loaded but "+e.missingRef+" cannot be resolved");var o=n._loadingSchemas[i];o||(o=n._loadingSchemas[i]=n._opts.loadSchema(i)).then(l,l);return o.then(function(e){if(!c(i))return a(e).then(function(){c(i)||n.addSchema(e,i,void 0,r)})}).then(function(){return function e(t){try{return n._compile(t)}catch(e){if(e instanceof s)return i(e);throw e}function i(s){var i=s.missingSchema;if(c(i))throw new Error("Schema "+i+" is loaded but "+s.missingRef+" cannot be resolved");var o=n._loadingSchemas[i];return o||(o=n._loadingSchemas[i]=n._opts.loadSchema(i)).then(l,l),o.then(function(e){if(!c(i))return a(e).then(function(){c(i)||n.addSchema(e,i,void 0,r)})}).then(function(){return e(t)});function l(){delete n._loadingSchemas[i]}function c(e){return n._refs[e]||n._schemas[e]}}}(t)});function l(){delete n._loadingSchemas[i]}function c(e){return n._refs[e]||n._schemas[e]}}(e);throw e}function i(s){var i=s.missingSchema;if(c(i))throw new Error("Schema "+i+" is loaded but "+s.missingRef+" cannot be resolved");var o=n._loadingSchemas[i];return o||(o=n._loadingSchemas[i]=n._opts.loadSchema(i)).then(l,l),o.then(function(e){if(!c(i))return a(e).then(function(){c(i)||n.addSchema(e,i,void 0,r)})}).then(function(){return e(t)});function l(){delete n._loadingSchemas[i]}function c(e){return n._refs[e]||n._schemas[e]}}}(e)});i&&o.then(function(e){i(null,e)},i);return o;function a(t){var r=t.$schema;return r&&!n.getSchema(r)?e.call(n,{$ref:r},!0):Promise.resolve()}}},function(e,t,r){"use strict";var s=/^[a-z_$][a-z0-9_$-]*$/i,i=r(173);e.exports={add:function(e,t){var r=this.RULES;if(r.keywords[e])throw new Error("Keyword "+e+" is already defined");if(!s.test(e))throw new Error("Keyword "+e+" is not a valid identifier");if(t){if(t.macro&&void 0!==t.valid)throw new Error('"valid" option cannot be used with macro keywords');var n=t.type;if(Array.isArray(n)){var o,a=n.length;for(o=0;o<a;o++)u(n[o]);for(o=0;o<a;o++)d(e,n[o],t)}else n&&u(n),d(e,n,t);var l=!0===t.$data&&this._opts.$data;if(l&&!t.validate)throw new Error('$data support: "validate" function is not defined');var c=t.metaSchema;c&&(l&&(c={anyOf:[c,{$ref:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#"}]}),t.validateSchema=this.compile(c,!0))}function d(e,t,s){for(var n,o=0;o<r.length;o++){var a=r[o];if(a.type==t){n=a;break}}n||(n={type:t,rules:[]},r.push(n));var l={keyword:e,definition:s,custom:!0,code:i,implements:s.implements};n.rules.push(l),r.custom[e]=l}function u(e){if(!r.types[e])throw new Error("Unknown type "+e)}return r.keywords[e]=r.all[e]=!0,this},get:function(e){var t=this.RULES.custom[e];return t?t.definition:this.RULES.keywords[e]||!1},remove:function(e){var t=this.RULES;delete t.keywords[e],delete t.all[e],delete t.custom[e];for(var r=0;r<t.length;r++)for(var s=t[r].rules,i=0;i<s.length;i++)if(s[i].keyword==e){s.splice(i,1);break}return this}}},function(e,t,r){"use strict";e.exports=function(e,t,r){var s,i,n=" ",o=e.level,a=e.dataLevel,l=e.schema[t],c=e.schemaPath+e.util.getProperty(t),d=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,h="data"+(a||""),p="valid"+o,f="errs__"+o,m=e.opts.$data&&l&&l.$data;m?(n+=" var schema"+o+" = "+e.util.getData(l.$data,a,e.dataPathArr)+"; ",i="schema"+o):i=l;var v,y,g,b,E,_="definition"+o,P=this.definition,w="";if(m&&P.$data){E="keywordValidate"+o;var x=P.validateSchema;n+=" var "+_+" = RULES.custom['"+t+"'].definition; var "+E+" = "+_+".validate;"}else{if(!(b=e.useCustomRule(this,l,e.schema,e)))return;i="validate.schema"+c,E=b.code,v=P.compile,y=P.inline,g=P.macro}var C=E+".errors",S="i"+o,D="ruleErr"+o,M=P.async;if(M&&!e.async)throw new Error("async keyword in sync schema");if(y||g||(n+=C+" = null;"),n+="var "+f+" = errors;var "+p+";",m&&P.$data&&(w+="}",n+=" if ("+i+" === undefined) { "+p+" = true; } else { ",x&&(w+="}",n+=" "+p+" = "+_+".validateSchema("+i+"); if ("+p+") { ")),y)P.statements?n+=" "+b.validate+" ":n+=" "+p+" = "+b.validate+"; ";else if(g){var T=e.util.copy(e);w="";T.level++;var R="valid"+T.level;T.schema=b.validate,T.schemaPath="";var O=e.compositeRule;e.compositeRule=T.compositeRule=!0;var A=e.validate(T).replace(/validate\.schema/g,E);e.compositeRule=T.compositeRule=O,n+=" "+A}else{(L=L||[]).push(n),n="",n+="  "+E+".call( ",e.opts.passContext?n+="this":n+="self",v||!1===P.schema?n+=" , "+h+" ":n+=" , "+i+" , "+h+" , validate.schema"+e.schemaPath+" ",n+=" , (dataPath || '')",'""'!=e.errorPath&&(n+=" + "+e.errorPath);var j=a?"data"+(a-1||""):"parentData",k=a?e.dataPathArr[a]:"parentDataProperty",I=n+=" , "+j+" , "+k+" , rootData )  ";n=L.pop(),!1===P.errors?(n+=" "+p+" = ",M&&(n+="await "),n+=I+"; "):n+=M?" var "+(C="customErrors"+o)+" = null; try { "+p+" = await "+I+"; } catch (e) { "+p+" = false; if (e instanceof ValidationError) "+C+" = e.errors; else throw e; } ":" "+C+" = null; "+p+" = "+I+"; "}if(P.modifying&&(n+=" if ("+j+") "+h+" = "+j+"["+k+"];"),n+=""+w,P.valid)u&&(n+=" if (true) { ");else{var L;n+=" if ( ",void 0===P.valid?(n+=" !",n+=g?""+R:""+p):n+=" "+!P.valid+" ",n+=") { ",s=this.keyword,(L=L||[]).push(n),n="",(L=L||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: '"+(s||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(d)+" , params: { keyword: '"+this.keyword+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should pass \""+this.keyword+"\" keyword validation' "),e.opts.verbose&&(n+=" , schema: validate.schema"+c+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),n+=" } "):n+=" {} ";var V=n;n=L.pop(),!e.compositeRule&&u?e.async?n+=" throw new ValidationError(["+V+"]); ":n+=" validate.errors = ["+V+"]; return false; ":n+=" var err = "+V+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";var N=n;n=L.pop(),y?P.errors?"full"!=P.errors&&(n+="  for (var "+S+"="+f+"; "+S+"<errors; "+S+"++) { var "+D+" = vErrors["+S+"]; if ("+D+".dataPath === undefined) "+D+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+D+".schemaPath === undefined) { "+D+'.schemaPath = "'+d+'"; } ',e.opts.verbose&&(n+=" "+D+".schema = "+i+"; "+D+".data = "+h+"; "),n+=" } "):!1===P.errors?n+=" "+N+" ":(n+=" if ("+f+" == errors) { "+N+" } else {  for (var "+S+"="+f+"; "+S+"<errors; "+S+"++) { var "+D+" = vErrors["+S+"]; if ("+D+".dataPath === undefined) "+D+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+D+".schemaPath === undefined) { "+D+'.schemaPath = "'+d+'"; } ',e.opts.verbose&&(n+=" "+D+".schema = "+i+"; "+D+".data = "+h+"; "),n+=" } } "):g?(n+="   var err =   ",!1!==e.createErrors?(n+=" { keyword: '"+(s||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(d)+" , params: { keyword: '"+this.keyword+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should pass \""+this.keyword+"\" keyword validation' "),e.opts.verbose&&(n+=" , schema: validate.schema"+c+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(e.async?n+=" throw new ValidationError(vErrors); ":n+=" validate.errors = vErrors; return false; ")):!1===P.errors?n+=" "+N+" ":(n+=" if (Array.isArray("+C+")) { if (vErrors === null) vErrors = "+C+"; else vErrors = vErrors.concat("+C+"); errors = vErrors.length;  for (var "+S+"="+f+"; "+S+"<errors; "+S+"++) { var "+D+" = vErrors["+S+"]; if ("+D+".dataPath === undefined) "+D+".dataPath = (dataPath || '') + "+e.errorPath+";  "+D+'.schemaPath = "'+d+'";  ',e.opts.verbose&&(n+=" "+D+".schema = "+i+"; "+D+".data = "+h+"; "),n+=" } } else { "+N+" } "),n+=" } ",u&&(n+=" else { ")}return n}},function(e){e.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON Schema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}},function(e){e.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}},function(e){e.exports={$id:"https://schemas.3d.si.edu/public_api/math.schema.json",$schema:"http://json-schema.org/draft-07/schema#",title:"Math",description:"Definitions for mathematical compound objects such as vectors and matrices.",definitions:{vector2:{description:"2-component vector.",$id:"#vector2",type:"array",items:{type:"number"},minItems:2,maxItems:2,default:[0,0]},vector3:{description:"3-component vector.",$id:"#vector3",type:"array",items:{type:"number"},minItems:3,maxItems:3,default:[0,0,0]},vector4:{description:"4-component vector.",$id:"#vector4",type:"array",items:{type:"number"},minItems:4,maxItems:4,default:[0,0,0,0]},matrix3:{description:"3 by 3, matrix, storage: column-major.",$id:"#matrix3",type:"array",items:{type:"number"},minItems:9,maxItems:9,default:[1,0,0,0,1,0,0,0,1]},matrix4:{description:"4 by 4 matrix, storage: column-major.",$id:"#matrix4",type:"array",items:{type:"number"},minItems:16,maxItems:16,default:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},boundingBox:{description:"Axis-aligned 3D bounding box.",$id:"#boundingBox",type:"object",properties:{min:{$ref:"#vector3"},max:{$ref:"#vector3"}},required:["min","max"]}}}},function(e){e.exports={$id:"https://schemas.3d.si.edu/public_api/presentation.schema.json",$schema:"http://json-schema.org/draft-07/schema#",title:"Smithsonian 3D Presentation",description:"Describes a 3D scene containing one or multiple 3D items.",definitions:{node:{$id:"#node",type:"object",properties:{children:{type:"array",description:"The indices of this node's children.",items:{type:"integer",minimum:0},uniqueItems:!0,minItems:1},matrix:{description:"A floating-point 4x4 transformation matrix stored in column-major order.",type:"array",items:{type:"number"},minItems:16,maxItems:16,default:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},translation:{description:"The node's translation along the x, y, and z axes.",type:"array",items:{type:"number"},minItems:3,maxItems:3,default:[0,0,0]},rotation:{description:"The node's unit quaternion rotation in the order (x, y, z, w), where w is the scalar.",type:"array",items:{type:"number",minimum:-1,maximum:1},minItems:4,maxItems:4,default:[0,0,0,1]},scale:{description:"The node's non-uniform scale, given as the scaling factors along the x, y, and z axes.",type:"array",items:{type:"number"},minItems:3,maxItems:3,default:[1,1,1]},item:{description:"The index of the item in this node.",type:"integer",minimum:0},reference:{description:"The index of the reference in this node.",type:"integer",minimum:0},camera:{description:"The index of the camera in this node.",type:"integer",minimum:0},light:{description:"The index of the light in this node.",type:"integer",minimum:0}},not:{anyOf:[{required:["matrix","translation"]},{required:["matrix","rotation"]},{required:["matrix","scale"]}]}},reference:{$id:"#reference",type:"object",properties:{mimeType:{type:"string"},uri:{type:"string"}},required:["uri"]},camera:{$id:"#camera",type:"object",properties:{type:{description:"Specifies if the camera uses a perspective or orthographic projection.",type:"string",enum:["perspective","orthographic"]},perspective:{description:"A perspective camera containing properties to create a perspective projection matrix.",type:"object",properties:{yfov:{type:"number",description:"The floating-point vertical field of view in radians.",exclusiveMinimum:0},aspectRatio:{type:"number",description:"The floating-point aspect ratio of the field of view.",exclusiveMinimum:0},znear:{type:"number",description:"The floating-point distance to the near clipping plane.",exclusiveMinimum:0},zfar:{type:"number",description:"The floating-point distance to the far clipping plane.",exclusiveMinimum:0}},required:["yfov","znear"]},orthographic:{description:"An orthographic camera containing properties to create an orthographic projection matrix.",type:"object",properties:{xmag:{type:"number",description:"The floating-point horizontal magnification of the view. Must not be zero."},ymag:{type:"number",description:"The floating-point vertical magnification of the view. Must not be zero."},znear:{type:"number",description:"The floating-point distance to the near clipping plane.",exclusiveMinimum:0},zfar:{type:"number",description:"The floating-point distance to the far clipping plane. `zfar` must be greater than `znear`.",exclusiveMinimum:0}},required:["xmag","ymag","znear","zfar"]}},required:["type"],not:{required:["perspective","orthographic"]}},light:{$id:"#light",type:"object",properties:{type:{description:"Specifies the type of the light source.",type:"string",enum:["ambient","directional","point","spot","hemisphere"]},color:{$ref:"#colorRGB"},intensity:{type:"number",minimum:0,default:1},castShadow:{type:"boolean",default:!1},point:{type:"object",properties:{distance:{type:"number",minimum:0},decay:{type:"number",minimum:0}}},spot:{type:"object",properties:{distance:{type:"number",minimum:0},decay:{type:"number",minimum:0},angle:{type:"number",minimum:0},penumbra:{type:"number",minimum:0}}},hemisphere:{type:"object",properties:{groundColor:{$ref:"#colorRGB"}}}},required:["type"],not:{required:["point","spot","hemisphere"]}},colorRGB:{$id:"#colorRGB",type:"array",items:{type:"number",minimum:0,maximum:1},minItems:3,maxItems:3,default:[1,1,1]}},type:"object",properties:{asset:{type:"object",properties:{copyright:{type:"string",description:"A copyright message to credit the content creator."},generator:{type:"string",description:"Tool that generated this presentation description."},version:{type:"string",description:"Version of this presentation description."}}},scene:{description:"The root nodes of the scene.",type:"object",properties:{nodes:{description:"The indices of each root node.",type:"array",items:{type:"integer",minimum:0},uniqueItems:!0,minItems:1}},minItems:1},nodes:{description:"An array of nodes.",type:"array",items:{$ref:"#node"},minItems:1},items:{description:"An array if items.",type:"array",items:{$ref:"item.schema.json"},minItems:1},references:{description:"An array of references.",type:"array",items:{$ref:"#reference"},minItems:1},cameras:{description:"An array of cameras.",type:"array",items:{$ref:"#camera"},minItems:1},lights:{description:"An array of lights.",type:"array",items:{$ref:"#light"},minItems:1},story:{description:"Presentation-level tours and snapshots",$ref:"story.schema.json"},config:{description:"Voyager explorer global settings.",$ref:"config.schema.json"}},required:["scene","nodes"]}},function(e){e.exports={$id:"https://schemas.3d.si.edu/public_api/config.schema.json",$schema:"http://json-schema.org/draft-07/schema#",title:"Smithsonian 3D Presentation - Voyager Explorer Configuration",description:"contains information about Voyager explorer configuration (scene environment, UI, tools, etc.)",type:"object",properties:{scene:{type:"object",properties:{units:{type:"string",enum:["mm","cm","m","in","ft","yd"]},shader:{type:"string"},exposure:{type:"number"},gamma:{type:"number"}},required:["units","shader","exposure","gamma"]},reader:{type:"object",properties:{visible:{type:"boolean"},position:{type:"string"},documentUri:{description:"URI of the document currently displayed in the reader",type:"string",minLength:1}}},interface:{type:"object",properties:{visible:{type:"boolean"},logo:{type:"boolean"}}},navigation:{type:"object",properties:{type:{type:"string",enum:["orbit","walk"]},enabled:{type:"boolean"},orbit:{$comment:"TODO: Implement",type:"object",properties:{}},walk:{$comment:"TODO: Implement",type:"object",properties:{}}}},background:{type:"object",properties:{type:{type:"string",enum:["Solid","LinearGradient","RadialGradient"]},color0:{$ref:"math.schema.json#/definitions/vector3"},color1:{$ref:"math.schema.json#/definitions/vector3"}}},groundPlane:{type:"object",properties:{visible:{type:"boolean"},offset:{type:"number"},color:{$ref:"math.schema.json#/definitions/vector3"},shadowVisible:{type:"boolean"},shadowColor:{$ref:"math.schema.json#/definitions/vector3"}}},grid:{type:"object",properties:{visible:{type:"boolean"},color:{$ref:"math.schema.json#/definitions/vector3"}}},tapeTool:{type:"object",properties:{active:{type:"boolean"},startPosition:{$ref:"math.schema.json#/definitions/vector3"},startDirection:{$ref:"math.schema.json#/definitions/vector3"},endPosition:{$ref:"math.schema.json#/definitions/vector3"},endDirection:{$ref:"math.schema.json#/definitions/vector3"}}},sectionTool:{type:"object",properties:{active:{type:"boolean"},plane:{$ref:"math.schema.json#/definitions/vector4"}}}}}},function(e){e.exports={$id:"https://schemas.3d.si.edu/public_api/item.schema.json",$schema:"http://json-schema.org/draft-07/schema#",title:"3D Item",description:"Describes a Smithsonian DPO 3D repository item.",definitions:{info:{$id:"#info",type:"object",properties:{type:{type:"string"},copyright:{type:"string"},generator:{type:"string"},version:{type:"string"}},required:["type","version"],additionalProperties:!1}},type:"object",properties:{info:{description:"Information about the type, generator, and version of this data structure.",$ref:"#info"},meta:{description:"Meta data about this item, including title, record info, collection, etc.",$ref:"meta.schema.json"},process:{description:"Information about how this item was digitized and processed.",$ref:"process.schema.json"},model:{description:"Describes the visual representations (models, derivatives).",$ref:"model.schema.json"},documents:{description:"References to external documents (articles, media files) containing additional information.",$ref:"documents.schema.json"},annotations:{description:"Spatial annotations (hot spots, hot zones). Annotations can reference documents.",$ref:"annotations.schema.json"}},required:["info"],additionalProperties:!1}},function(e){e.exports={$id:"https://schemas.3d.si.edu/public_api/meta.schema.json",$schema:"http://json-schema.org/draft-07/schema#",title:"Meta",description:"Meta data about a 3D item, including title, record info, collection, etc.",type:"object",properties:{},required:[]}},function(e){e.exports={$id:"https://schemas.3d.si.edu/public_api/process.schema.json",$schema:"http://json-schema.org/draft-07/schema#",title:"Process",description:"Information about how a 3D item was digitized and processed.",type:"object",properties:{},required:[]}},function(e){e.exports={$id:"https://schemas.3d.si.edu/public_api/model.schema.json",$schema:"http://json-schema.org/draft-07/schema#",title:"Model",description:"Describes the visual representations (models, derivatives) of a 3D item.",definitions:{material:{$id:"#material",type:"object",properties:{}},asset:{description:"an individual resource for a 3D model.",$id:"#asset",type:"object",properties:{uri:{type:"string",minLength:1},type:{type:"string",enum:["Model","Geometry","Image","Points","Volume"]},mimeType:{type:"string",minLength:1},byteSize:{type:"integer",minimum:1},numFaces:{type:"integer",minimum:1},imageSize:{type:"integer",minimum:1},mapType:{type:"string",enum:["Color","Normal","Occlusion","Emissive","MetallicRoughness","Zone"]}},required:["uri","type"]}},type:"object",properties:{units:{type:"string",enum:["mm","cm","m","in","ft","yd"]},translation:{description:"Translation vector. Apply to bring model into a 'neutral' pose.",$ref:"math.schema.json#/definitions/vector3"},rotation:{description:"Rotation quaternion. Apply to bring model into a 'neutral' pose.",$ref:"math.schema.json#/definitions/vector4"},boundingBox:{description:"Bounding box for this model, shared by all derivatives.",$ref:"math.schema.json#/definitions/boundingBox"},material:{description:"Surface properties for this model, shared by all derivatives.",$ref:"#material"},derivatives:{description:"List of visual representations derived from the master model.",type:"array",items:{type:"object",properties:{usage:{description:"usage categories for a derivative.",type:"string",enum:["Web2D","Web3D","Print","Editorial"]},quality:{type:"string",enum:["Thumb","Low","Medium","High","Highest","LOD","Stream"]},assets:{description:"List of individual resources this derivative is composed of.",type:"array",items:{$ref:"#asset"}}}}}},required:["units","derivatives"],additionalProperties:!1}},function(e){e.exports={$id:"https://schemas.3d.si.edu/public_api/annotations.schema.json",$schema:"http://json-schema.org/draft-07/schema#",title:"Annotations",description:"Spatial annotations (hot spots, hot zones) on a 3D item. Annotations can reference documents.",definitions:{annotation:{$id:"#annotation",type:"object",properties:{id:{type:"string",minLength:1},title:{type:"string"},description:{type:"string"},style:{type:"string"},expanded:{description:"Flag indicating whether this annotation is displayed in expanded state.",type:"boolean",default:!1},documents:{description:"Array of document indices, listing documents related to this annotation.",type:"array",items:{type:"integer",minimum:0}},groups:{description:"Array of group indices, listing all groups this annotation belongs to.",type:"array",items:{type:"integer",minimum:0}},position:{description:"Position where the annotation is anchored, in local item coordinates.",$ref:"math.schema.json#/definitions/vector3"},direction:{description:"Direction of the stem of this annotation, usually corresponds to the surface normal.",$ref:"math.schema.json#/definitions/vector3"},zoneIndex:{description:"Index of the zone on the zone texture.",type:"integer",minimum:0}},required:["id"],additionalProperties:!1},group:{$id:"#group",type:"object",properties:{id:{type:"string"},title:{type:"string"},description:{type:"string"},visible:{type:"boolean"}},required:["id"],additionalProperties:!1}},type:"object",properties:{annotations:{type:"array",items:{$ref:"#annotation"}},groups:{type:"array",items:{$ref:"#group"}}},additionalProperties:!1}},function(e){e.exports={$id:"https://schemas.3d.si.edu/public_api/story.schema.json",$schema:"http://json-schema.org/draft-07/schema#",title:"Story",description:"Animated tours and snapshots for a 3D item.",definitions:{snapshot:{$id:"#snapshot",type:"object",properties:{title:{type:"string"},description:{type:"string"},properties:{type:"array",items:{properties:{path:{type:"string",minLength:1}},required:["path","value"]}}}},tourstep:{$id:"#tourstep",type:"object",properties:{snapshot:{type:"integer",minimum:0},transitionTime:{type:"number",minimum:0},transitionCurve:{type:"string"},transitionCutPoint:{type:"number",minimum:0,maximum:1}},required:["snapshot"]}},type:"object",properties:{snapshots:{type:"array",items:{$ref:"#snapshot"}},tours:{type:"array",items:{type:"object",properties:{title:{type:"string"},description:{type:"string"},steps:{type:"array",items:{$ref:"#tourstep"}}}}}},required:[]}},function(e){e.exports={$id:"https://schemas.3d.si.edu/public_api/documents.schema.json",$schema:"http://json-schema.org/draft-07/schema#",title:"Documents",description:"References to external documents, articles or media files.",definitions:{document:{$id:"#document",type:"object",properties:{id:{type:"string",minLength:1},title:{type:"string"},description:{type:"string"},uri:{type:"string"},mimeType:{type:"string"},thumbnailUri:{type:"string"}},required:["id"]}},type:"object",properties:{mainDocumentId:{description:"Id of the main document. This is the default document displayed with the item.",type:"string"},documents:{type:"array",items:{$ref:"#document"}}},additionalProperties:!1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(21),i=r(2);r(187),r(188);const n=i.GLTFLoader,o=i.DRACOLoader,a=s.default("js/draco/",window.location.origin+window.location.pathname);o.setDecoderPath(a),console.log("DRACOLoader.setDracoPath - %s",a);const l=r(70);class c{constructor(e){this.loadingManager=e,this.gltfLoader=new n(e),this.gltfLoader.setDRACOLoader(new o)}canLoad(e){const t=e.split(".").pop().toLowerCase();return c.extensions.indexOf(t)>=0}canLoadMimeType(e){return c.mimeTypes.indexOf(e)>=0}load(e){return new Promise((t,r)=>{this.gltfLoader.load(e,e=>{t(this.createModelGroup(e))},null,t=>{console.error(`failed to load '${e}': ${t}`),r(new Error(t))})})}createModelGroup(e){const t=e.scene;if("Scene"!==t.type)throw new Error("not a valid gltf scene");const r=new i.Group;return t.children.forEach(e=>r.add(e)),r.traverse(e=>{if("Mesh"===e.type){const t=e,r=t.material;r.map&&(r.map.encoding=i.LinearEncoding),t.geometry.computeBoundingBox();const s=new l.default;"MeshStandardMaterial"===r.type&&s.copyStandardMaterial(r),s.roughness=.6,s.metalness=0,s.enableObjectSpaceNormalMap(!1),s.map||s.color.set("#c0c0c0"),t.material=s}}),r}}c.extensions=["gltf","glb"],c.mimeTypes=["model/gltf+json","model/gltf-binary"],t.default=c},function(e,t){THREE.GLTFLoader=function(){function e(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.dracoLoader=null}function t(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype={constructor:e,crossOrigin:"anonymous",load:function(e,t,r,s){var i,n=this;i=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),n.manager.itemStart(e);var o=function(t){s?s(t):console.error(t),n.manager.itemError(e),n.manager.itemEnd(e)},a=new THREE.FileLoader(n.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.load(e,function(r){try{n.parse(r,i,function(r){t(r),n.manager.itemEnd(e)},o)}catch(e){o(e)}},r,o)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setDRACOLoader:function(e){return this.dracoLoader=e,this},parse:function(e,t,a,l){var p,f={};if("string"==typeof e)p=e;else if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===o){try{f[r.KHR_BINARY_GLTF]=new c(e)}catch(e){return void(l&&l(e))}p=f[r.KHR_BINARY_GLTF].content}else p=THREE.LoaderUtils.decodeText(new Uint8Array(e));var m=JSON.parse(p);if(void 0===m.asset||m.asset.version[0]<2)l&&l(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(m.extensionsUsed)for(var v=0;v<m.extensionsUsed.length;++v){var y=m.extensionsUsed[v],g=m.extensionsRequired||[];switch(y){case r.KHR_LIGHTS_PUNCTUAL:f[y]=new i(m);break;case r.KHR_MATERIALS_UNLIT:f[y]=new n(m);break;case r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:f[y]=new h(m);break;case r.KHR_DRACO_MESH_COMPRESSION:f[y]=new d(m,this.dracoLoader);break;case r.MSFT_TEXTURE_DDS:f[r.MSFT_TEXTURE_DDS]=new s(m);break;case r.KHR_TEXTURE_TRANSFORM:f[r.KHR_TEXTURE_TRANSFORM]=new u(m);break;default:g.indexOf(y)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+y+'".')}}var b=new $(m,f,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});b.parse(function(e,t,r,s,i){var n={scene:e,scenes:t,cameras:r,animations:s,asset:i.asset,parser:b,userData:{}};j(f,n,i),a(n)},l)}}};var r={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function s(){if(!THREE.DDSLoader)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=r.MSFT_TEXTURE_DDS,this.ddsLoader=new THREE.DDSLoader}function i(e){this.name=r.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[r.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function n(e){this.name=r.KHR_MATERIALS_UNLIT}i.prototype.loadLight=function(e){var t,r=this.lightDefs[e],s=new THREE.Color(16777215);void 0!==r.color&&s.fromArray(r.color);var i=void 0!==r.range?r.range:0;switch(r.type){case"directional":(t=new THREE.DirectionalLight(s)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new THREE.PointLight(s)).distance=i;break;case"spot":(t=new THREE.SpotLight(s)).distance=i,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,t.angle=r.spot.outerConeAngle,t.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+r.type+'".')}return t.decay=2,void 0!==r.intensity&&(t.intensity=r.intensity),t.name=r.name||"light_"+e,Promise.resolve(t)},n.prototype.getMaterialType=function(e){return THREE.MeshBasicMaterial},n.prototype.extendParams=function(e,t,r){var s=[];e.color=new THREE.Color(1,1,1),e.opacity=1;var i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var n=i.baseColorFactor;e.color.fromArray(n),e.opacity=n[3]}void 0!==i.baseColorTexture&&s.push(r.assignTexture(e,"map",i.baseColorTexture))}return Promise.all(s)};var o="glTF",a=12,l={JSON:1313821514,BIN:5130562};function c(e){this.name=r.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,a);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==o)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var s=new DataView(e,a),i=0;i<s.byteLength;){var n=s.getUint32(i,!0);i+=4;var c=s.getUint32(i,!0);if(i+=4,c===l.JSON){var d=new Uint8Array(e,a+i,n);this.content=THREE.LoaderUtils.decodeText(d)}else if(c===l.BIN){var u=a+i;this.body=e.slice(u,u+n)}i+=n}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function d(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=r.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,THREE.DRACOLoader.getDecoderModule()}function u(e){this.name=r.KHR_TEXTURE_TRANSFORM}function h(){return{name:r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(e,t,r){var s=t.extensions[this.name],i=THREE.ShaderLib.standard,n=THREE.UniformsUtils.clone(i.uniforms),o=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),a=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),c=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),d=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),u=i.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",o).replace("#include <metalnessmap_pars_fragment>",a).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",c).replace("#include <lights_physical_fragment>",d);delete n.roughness,delete n.metalness,delete n.roughnessMap,delete n.metalnessMap,n.specular={value:(new THREE.Color).setHex(1118481)},n.glossiness={value:.5},n.specularMap={value:null},n.glossinessMap={value:null},e.vertexShader=i.vertexShader,e.fragmentShader=u,e.uniforms=n,e.defines={STANDARD:""},e.color=new THREE.Color(1,1,1),e.opacity=1;var h=[];if(Array.isArray(s.diffuseFactor)){var p=s.diffuseFactor;e.color.fromArray(p),e.opacity=p[3]}if(void 0!==s.diffuseTexture&&h.push(r.assignTexture(e,"map",s.diffuseTexture)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==s.glossinessFactor?s.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(s.specularFactor)&&e.specular.fromArray(s.specularFactor),void 0!==s.specularGlossinessTexture){var f=s.specularGlossinessTexture;h.push(r.assignTexture(e,"glossinessMap",f)),h.push(r.assignTexture(e,"specularMap",f))}return Promise.all(h)},createMaterial:function(e){var t=new THREE.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return t.isGLTFSpecularGlossinessMaterial=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t.extensions.derivatives=!0,t},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var r=this.specularGlossinessParams,s=0,i=r.length;s<i;s++)t[r[s]]=e[r[s]];return t},refreshUniforms:function(e,t,r,s,i,n){if(!0===i.isGLTFSpecularGlossinessMaterial){var o,a=i.uniforms,l=i.defines;a.opacity.value=i.opacity,a.diffuse.value.copy(i.color),a.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),a.map.value=i.map,a.specularMap.value=i.specularMap,a.alphaMap.value=i.alphaMap,a.lightMap.value=i.lightMap,a.lightMapIntensity.value=i.lightMapIntensity,a.aoMap.value=i.aoMap,a.aoMapIntensity.value=i.aoMapIntensity,i.map?o=i.map:i.specularMap?o=i.specularMap:i.displacementMap?o=i.displacementMap:i.normalMap?o=i.normalMap:i.bumpMap?o=i.bumpMap:i.glossinessMap?o=i.glossinessMap:i.alphaMap?o=i.alphaMap:i.emissiveMap&&(o=i.emissiveMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),a.uvTransform.value.copy(o.matrix)),i.envMap&&(a.envMap.value=i.envMap,a.envMapIntensity.value=i.envMapIntensity,a.flipEnvMap.value=i.envMap.isCubeTexture?-1:1,a.reflectivity.value=i.reflectivity,a.refractionRatio.value=i.refractionRatio,a.maxMipLevel.value=e.properties.get(i.envMap).__maxMipLevel),a.specular.value.copy(i.specular),a.glossiness.value=i.glossiness,a.glossinessMap.value=i.glossinessMap,a.emissiveMap.value=i.emissiveMap,a.bumpMap.value=i.bumpMap,a.normalMap.value=i.normalMap,a.displacementMap.value=i.displacementMap,a.displacementScale.value=i.displacementScale,a.displacementBias.value=i.displacementBias,null!==a.glossinessMap.value&&void 0===l.USE_GLOSSINESSMAP&&(l.USE_GLOSSINESSMAP="",l.USE_ROUGHNESSMAP=""),null===a.glossinessMap.value&&void 0!==l.USE_GLOSSINESSMAP&&(delete l.USE_GLOSSINESSMAP,delete l.USE_ROUGHNESSMAP)}}}}function p(e,t,r,s){THREE.Interpolant.call(this,e,t,r,s)}d.prototype.decodePrimitive=function(e,t){var r=this.json,s=this.dracoLoader,i=e.extensions[this.name].bufferView,n=e.extensions[this.name].attributes,o={},a={},l={};for(var c in n)c in C&&(o[C[c]]=n[c]);for(c in e.attributes)if(void 0!==C[c]&&void 0!==n[c]){var d=r.accessors[e.attributes[c]],u=_[d.componentType];l[C[c]]=u,a[C[c]]=!0===d.normalized}return t.getDependency("bufferView",i).then(function(e){return new Promise(function(t){s.decodeDracoFile(e,function(e){for(var r in e.attributes){var s=e.attributes[r],i=a[r];void 0!==i&&(s.normalized=i)}t(e)},o,l)})})},u.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},p.prototype=Object.create(THREE.Interpolant.prototype),p.prototype.constructor=p,p.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,s=this.valueSize,i=e*s*3+s,n=0;n!==s;n++)t[n]=r[i+n];return t},p.prototype.beforeStart_=p.prototype.copySampleValue_,p.prototype.afterEnd_=p.prototype.copySampleValue_,p.prototype.interpolate_=function(e,t,r,s){for(var i=this.resultBuffer,n=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,c=s-t,d=(r-t)/c,u=d*d,h=u*d,p=e*l,f=p-l,m=-2*h+3*u,v=h-u,y=1-m,g=v-u+d,b=0;b!==o;b++){var E=n[f+b+o],_=n[f+b+a]*c,P=n[p+b+o],w=n[p+b]*c;i[b]=y*E+g*_+m*P+v*w}return i};var f=0,m=1,v=2,y=3,g=4,b=5,E=6,_=(Number,THREE.Matrix3,THREE.Matrix4,THREE.Vector2,THREE.Vector3,THREE.Vector4,THREE.Texture,{5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}),P={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},w={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},x=(THREE.BackSide,THREE.FrontSide,THREE.NeverDepth,THREE.LessDepth,THREE.EqualDepth,THREE.LessEqualDepth,THREE.GreaterEqualDepth,THREE.NotEqualDepth,THREE.GreaterEqualDepth,THREE.AlwaysDepth,THREE.AddEquation,THREE.SubtractEquation,THREE.ReverseSubtractEquation,THREE.ZeroFactor,THREE.OneFactor,THREE.SrcColorFactor,THREE.OneMinusSrcColorFactor,THREE.SrcAlphaFactor,THREE.OneMinusSrcAlphaFactor,THREE.DstAlphaFactor,THREE.OneMinusDstAlphaFactor,THREE.DstColorFactor,THREE.OneMinusDstColorFactor,THREE.SrcAlphaSaturateFactor,{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),C={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},S={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},D={CUBICSPLINE:THREE.InterpolateSmooth,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},M="OPAQUE",T="MASK",R="BLEND",O={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat};function A(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function j(e,t,r){for(var s in r.extensions)void 0===e[s]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[s]=r.extensions[s])}function k(e,t){void 0!==t.extras&&("object"==typeof t.extras?e.userData=t.extras:console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function I(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var r=0,s=t.weights.length;r<s;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){var i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(r=0,s=i.length;r<s;r++)e.morphTargetDictionary[i[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function L(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r in e)if(e[r]!==t[r])return!1;return!0}function V(e,t){if(e.length!==t.length)return!1;for(var r=0,s=e.length;r<s;r++)if(e[r]!==t[r])return!1;return!0}function N(e,t){for(var s=0,i=e.length;s<i;s++){var n=e[s];if(o=n.primitive,a=t,l=void 0,c=void 0,l=o.extensions?o.extensions[r.KHR_DRACO_MESH_COMPRESSION]:void 0,c=a.extensions?a.extensions[r.KHR_DRACO_MESH_COMPRESSION]:void 0,l&&c?l.bufferView===c.bufferView&&L(l.attributes,c.attributes):o.indices===a.indices&&L(o.attributes,a.attributes))return n.promise}var o,a,l,c;return null}function F(e){if(e.isInterleavedBufferAttribute){for(var t=e.count,r=e.itemSize,s=e.array.slice(0,t*r),i=0,n=0;i<t;++i)s[n++]=e.getX(i),r>=2&&(s[n++]=e.getY(i)),r>=3&&(s[n++]=e.getZ(i)),r>=4&&(s[n++]=e.getW(i));return new THREE.BufferAttribute(s,r,e.normalized)}return e.clone()}function $(e,r,s){this.json=e||{},this.extensions=r||{},this.options=s||{},this.cache=new t,this.primitiveCache=[],this.multiplePrimitivesCache=[],this.multiPassGeometryCache=[],this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function z(e,t,r){var s=t.attributes,i=[];function n(t,s){return r.getDependency("accessor",t).then(function(t){e.addAttribute(s,t)})}for(var o in s){var a=C[o];a&&(a in e.attributes||i.push(n(s[o],a)))}if(void 0!==t.indices&&!e.index){var l=r.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});i.push(l)}return k(e,t),Promise.all(i).then(function(){return void 0!==t.targets?function(e,t,r){for(var s=!1,i=!1,n=0,o=t.length;n<o&&(void 0!==(c=t[n]).POSITION&&(s=!0),void 0!==c.NORMAL&&(i=!0),!s||!i);n++);if(!s&&!i)return Promise.resolve(e);var a=[],l=[];for(n=0,o=t.length;n<o;n++){var c=t[n];if(s){var d=void 0!==c.POSITION?r.getDependency("accessor",c.POSITION).then(function(e){return F(e)}):e.attributes.position;a.push(d)}i&&(d=void 0!==c.NORMAL?r.getDependency("accessor",c.NORMAL).then(function(e){return F(e)}):e.attributes.normal,l.push(d))}return Promise.all([Promise.all(a),Promise.all(l)]).then(function(r){for(var n=r[0],o=r[1],a=0,l=t.length;a<l;a++){var c=t[a],d="morphTarget"+a;if(s&&void 0!==c.POSITION){var u=n[a];u.name=d;for(var h=e.attributes.position,p=0,f=u.count;p<f;p++)u.setXYZ(p,u.getX(p)+h.getX(p),u.getY(p)+h.getY(p),u.getZ(p)+h.getZ(p))}if(i&&void 0!==c.NORMAL){var m=o[a];m.name=d;var v=e.attributes.normal;for(p=0,f=m.count;p<f;p++)m.setXYZ(p,m.getX(p)+v.getX(p),m.getY(p)+v.getY(p),m.getZ(p)+v.getZ(p))}}return s&&(e.morphAttributes.position=n),i&&(e.morphAttributes.normal=o),e})}(e,t.targets,r):e})}return $.prototype.parse=function(e,t){var r=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(t){var s=t.scenes||[],i=s[r.scene||0],n=t.animations||[],o=t.cameras||[];e(i,s,o,n,r)}).catch(t)},$.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],s={},i={},n=0,o=t.length;n<o;n++)for(var a=t[n].joints,l=0,c=a.length;l<c;l++)e[a[l]].isBone=!0;for(var d=0,u=e.length;d<u;d++){var h=e[d];void 0!==h.mesh&&(void 0===s[h.mesh]&&(s[h.mesh]=i[h.mesh]=0),s[h.mesh]++,void 0!==h.skin&&(r[h.mesh].isSkinnedMesh=!0))}this.json.meshReferences=s,this.json.meshUses=i},$.prototype.getDependency=function(e,t){var s=e+":"+t,i=this.cache.get(s);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this.loadMesh(t);break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this.loadBufferView(t);break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this.loadMaterial(t);break;case"texture":i=this.loadTexture(t);break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;case"light":i=this.extensions[r.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,i)}return i},$.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,s=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(s.map(function(t,s){return r.getDependency(e,s)})),this.cache.add(e,t)}return t},$.prototype.getMultiDependencies=function(e){for(var t={},r=[],s=0,i=e.length;s<i;s++){var n=e[s],o=this.getDependencies(n);o=o.then(function(e,r){t[e]=r}.bind(this,n+("mesh"===n?"es":"s"))),r.push(o)}return Promise.all(r).then(function(){return t})},$.prototype.loadBuffer=function(e){var t=this.json.buffers[e],s=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[r.KHR_BINARY_GLTF].body);var i=this.options;return new Promise(function(e,r){s.load(A(t.uri,i.path),e,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},$.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var r=t.byteLength||0,s=t.byteOffset||0;return e.slice(s,s+r)})},$.prototype.loadAccessor=function(e){var t=this,r=this.json,s=this.json.accessors[e];if(void 0===s.bufferView&&void 0===s.sparse)return Promise.resolve(null);var i=[];return void 0!==s.bufferView?i.push(this.getDependency("bufferView",s.bufferView)):i.push(null),void 0!==s.sparse&&(i.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(i).then(function(e){var i,n,o=e[0],a=x[s.type],l=_[s.componentType],c=l.BYTES_PER_ELEMENT,d=c*a,u=s.byteOffset||0,h=void 0!==s.bufferView?r.bufferViews[s.bufferView].byteStride:void 0,p=!0===s.normalized;if(h&&h!==d){var f="InterleavedBuffer:"+s.bufferView+":"+s.componentType,m=t.cache.get(f);m||(i=new l(o),m=new THREE.InterleavedBuffer(i,h/c),t.cache.add(f,m)),n=new THREE.InterleavedBufferAttribute(m,a,u/c,p)}else i=null===o?new l(s.count*a):new l(o,u,s.count*a),n=new THREE.BufferAttribute(i,a,p);if(void 0!==s.sparse){var v=x.SCALAR,y=_[s.sparse.indices.componentType],g=s.sparse.indices.byteOffset||0,b=s.sparse.values.byteOffset||0,E=new y(e[1],g,s.sparse.count*v),P=new l(e[2],b,s.sparse.count*a);null!==o&&n.setArray(n.array.slice());for(var w=0,C=E.length;w<C;w++){var S=E[w];if(n.setX(S,P[w*a]),a>=2&&n.setY(S,P[w*a+1]),a>=3&&n.setZ(S,P[w*a+2]),a>=4&&n.setW(S,P[w*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return n})},$.prototype.loadTexture=function(e){var t,s=this,i=this.json,n=this.options,o=this.textureLoader,a=window.URL||window.webkitURL,l=i.textures[e],c=l.extensions||{},d=(t=c[r.MSFT_TEXTURE_DDS]?i.images[c[r.MSFT_TEXTURE_DDS].source]:i.images[l.source]).uri,u=!1;return void 0!==t.bufferView&&(d=s.getDependency("bufferView",t.bufferView).then(function(e){u=!0;var r=new Blob([e],{type:t.mimeType});return d=a.createObjectURL(r)})),Promise.resolve(d).then(function(e){var t=THREE.Loader.Handlers.get(e);return t||(t=c[r.MSFT_TEXTURE_DDS]?s.extensions[r.MSFT_TEXTURE_DDS].ddsLoader:o),new Promise(function(r,s){t.load(A(e,n.path),r,void 0,s)})}).then(function(e){!0===u&&a.revokeObjectURL(d),e.flipY=!1,void 0!==l.name&&(e.name=l.name),t.mimeType in O&&(e.format=O[t.mimeType]);var r=(i.samplers||{})[l.sampler]||{};return e.magFilter=P[r.magFilter]||THREE.LinearFilter,e.minFilter=P[r.minFilter]||THREE.LinearMipMapLinearFilter,e.wrapS=w[r.wrapS]||THREE.RepeatWrapping,e.wrapT=w[r.wrapT]||THREE.RepeatWrapping,e})},$.prototype.assignTexture=function(e,t,s){var i=this;return this.getDependency("texture",s.index).then(function(n){if(i.extensions[r.KHR_TEXTURE_TRANSFORM]){var o=void 0!==s.extensions?s.extensions[r.KHR_TEXTURE_TRANSFORM]:void 0;o&&(n=i.extensions[r.KHR_TEXTURE_TRANSFORM].extendTexture(n,o))}e[t]=n})},$.prototype.loadMaterial=function(e){var t,s=this.json,i=this.extensions,n=s.materials[e],o={},a=n.extensions||{},l=[];if(a[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var c=i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=c.getMaterialType(n),l.push(c.extendParams(o,n,this))}else if(a[r.KHR_MATERIALS_UNLIT]){var d=i[r.KHR_MATERIALS_UNLIT];t=d.getMaterialType(n),l.push(d.extendParams(o,n,this))}else{t=THREE.MeshStandardMaterial;var u=n.pbrMetallicRoughness||{};if(o.color=new THREE.Color(1,1,1),o.opacity=1,Array.isArray(u.baseColorFactor)){var h=u.baseColorFactor;o.color.fromArray(h),o.opacity=h[3]}void 0!==u.baseColorTexture&&l.push(this.assignTexture(o,"map",u.baseColorTexture)),o.metalness=void 0!==u.metallicFactor?u.metallicFactor:1,o.roughness=void 0!==u.roughnessFactor?u.roughnessFactor:1,void 0!==u.metallicRoughnessTexture&&(l.push(this.assignTexture(o,"metalnessMap",u.metallicRoughnessTexture)),l.push(this.assignTexture(o,"roughnessMap",u.metallicRoughnessTexture)))}!0===n.doubleSided&&(o.side=THREE.DoubleSide);var p=n.alphaMode||M;return p===R?o.transparent=!0:(o.transparent=!1,p===T&&(o.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&t!==THREE.MeshBasicMaterial&&(l.push(this.assignTexture(o,"normalMap",n.normalTexture)),o.normalScale=new THREE.Vector2(1,1),void 0!==n.normalTexture.scale&&o.normalScale.set(n.normalTexture.scale,n.normalTexture.scale)),void 0!==n.occlusionTexture&&t!==THREE.MeshBasicMaterial&&(l.push(this.assignTexture(o,"aoMap",n.occlusionTexture)),void 0!==n.occlusionTexture.strength&&(o.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&t!==THREE.MeshBasicMaterial&&(o.emissive=(new THREE.Color).fromArray(n.emissiveFactor)),void 0!==n.emissiveTexture&&t!==THREE.MeshBasicMaterial&&l.push(this.assignTexture(o,"emissiveMap",n.emissiveTexture)),Promise.all(l).then(function(){var e;return e=t===THREE.ShaderMaterial?i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new t(o),void 0!==n.name&&(e.name=n.name),e.normalScale&&(e.normalScale.y=-e.normalScale.y),e.map&&(e.map.encoding=THREE.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=THREE.sRGBEncoding),e.specularMap&&(e.specularMap.encoding=THREE.sRGBEncoding),k(e,n),n.extensions&&j(i,e,n),e})},$.prototype.loadGeometries=function(e){var t,s=this,i=this.extensions,n=this.primitiveCache,o=function(e){if(e.length<2)return!1;var t=e[0],s=t.targets||[];if(void 0===t.indices)return!1;for(var i=1,n=e.length;i<n;i++){var o=e[i];if(t.mode!==o.mode)return!1;if(void 0===o.indices)return!1;if(o.extensions&&o.extensions[r.KHR_DRACO_MESH_COMPRESSION])return!1;if(!L(t.attributes,o.attributes))return!1;var a=o.targets||[];if(s.length!==a.length)return!1;for(var l=0,c=s.length;l<c;l++)if(!L(s[l],a[l]))return!1}return!0}(e);function a(e){return i[r.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,s).then(function(t){return z(t,e,s)})}o&&(t=e,e=[e[0]]);for(var l=[],c=0,d=e.length;c<d;c++){var u,h=e[c],p=N(n,h);if(p)l.push(p);else u=h.extensions&&h.extensions[r.KHR_DRACO_MESH_COMPRESSION]?a(h):z(new THREE.BufferGeometry,h,s),n.push({primitive:h,promise:u}),l.push(u)}return Promise.all(l).then(function(r){if(o){var i=r[0];if(null!==(h=function(e,t,r){for(var s=0,i=e.length;s<i;s++){var n=e[s];if(t===n.baseGeometry&&V(r,n.primitives))return n.geometry}return null}(u=s.multiPassGeometryCache,i,t)))return[h.geometry];var n=new THREE.BufferGeometry;for(var a in n.name=i.name,n.userData=i.userData,i.attributes)n.addAttribute(a,i.attributes[a]);for(var a in i.morphAttributes)n.morphAttributes[a]=i.morphAttributes[a];for(var l=[],c=0,d=t.length;c<d;c++)l.push(s.getDependency("accessor",t[c].indices));return Promise.all(l).then(function(e){for(var r=[],s=0,o=0,a=t.length;o<a;o++){for(var l=e[o],c=0,d=l.count;c<d;c++)r.push(l.array[c]);n.addGroup(s,l.count,o),s+=l.count}return n.setIndex(r),u.push({geometry:n,baseGeometry:i,primitives:t}),[n]})}if(r.length>1&&void 0!==THREE.BufferGeometryUtils){for(c=1,d=e.length;c<d;c++)if(e[0].mode!==e[c].mode)return r;var u,h;if(h=function(e,t){for(var r=0,s=e.length;r<s;r++){var i=e[r];if(V(t,i.baseGeometries))return i.geometry}return null}(u=s.multiplePrimitivesCache,r)){if(null!==h.geometry)return[h.geometry]}else{n=THREE.BufferGeometryUtils.mergeBufferGeometries(r,!0);if(u.push({geometry:n,baseGeometries:r}),null!==n)return[n]}}return r})},$.prototype.loadMesh=function(e){for(var t=this,s=this.json,i=this.extensions,n=s.meshes[e],o=n.primitives,a=[],l=0,c=o.length;l<c;l++){var d=void 0===o[l].material?new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide}):this.getDependency("material",o[l].material);a.push(d)}return Promise.all(a).then(function(s){return t.loadGeometries(o).then(function(a){for(var l=1===a.length&&a[0].groups.length>0,c=[],d=0,u=a.length;d<u;d++){var h,p=a[d],_=o[d],P=l?s:s[d];if(_.mode===g||_.mode===b||_.mode===E||void 0===_.mode)!0===(h=!0===n.isSkinnedMesh?new THREE.SkinnedMesh(p,P):new THREE.Mesh(p,P)).isSkinnedMesh&&h.normalizeSkinWeights(),_.mode===b?h.drawMode=THREE.TriangleStripDrawMode:_.mode===E&&(h.drawMode=THREE.TriangleFanDrawMode);else if(_.mode===m)h=new THREE.LineSegments(p,P);else if(_.mode===y)h=new THREE.Line(p,P);else if(_.mode===v)h=new THREE.LineLoop(p,P);else{if(_.mode!==f)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+_.mode);h=new THREE.Points(p,P)}Object.keys(h.geometry.morphAttributes).length>0&&I(h,n),h.name=n.name||"mesh_"+e,a.length>1&&(h.name+="_"+d),k(h,n),c.push(h);for(var w=l?h.material:[h.material],x=void 0!==p.attributes.color,C=void 0===p.attributes.normal,S=!0===h.isSkinnedMesh,D=Object.keys(p.morphAttributes).length>0,M=D&&void 0!==p.morphAttributes.normal,T=0,R=w.length;T<R;T++){P=w[T];if(h.isPoints){var O="PointsMaterial:"+P.uuid,A=t.cache.get(O);A||(A=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(A,P),A.color.copy(P.color),A.map=P.map,A.lights=!1,t.cache.add(O,A)),P=A}else if(h.isLine){O="LineBasicMaterial:"+P.uuid;var j=t.cache.get(O);j||(j=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(j,P),j.color.copy(P.color),j.lights=!1,t.cache.add(O,j)),P=j}if(x||C||S||D){O="ClonedMaterial:"+P.uuid+":";P.isGLTFSpecularGlossinessMaterial&&(O+="specular-glossiness:"),S&&(O+="skinning:"),x&&(O+="vertex-colors:"),C&&(O+="flat-shading:"),D&&(O+="morph-targets:"),M&&(O+="morph-normals:");var L=t.cache.get(O);L||(L=P.isGLTFSpecularGlossinessMaterial?i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(P):P.clone(),S&&(L.skinning=!0),x&&(L.vertexColors=THREE.VertexColors),C&&(L.flatShading=!0),D&&(L.morphTargets=!0),M&&(L.morphNormals=!0),t.cache.add(O,L)),P=L}w[T]=P,P.aoMap&&void 0===p.attributes.uv2&&void 0!==p.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),p.addAttribute("uv2",new THREE.BufferAttribute(p.attributes.uv.array,2))),P.isGLTFSpecularGlossinessMaterial&&(h.onBeforeRender=i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms)}h.material=l?w:w[0]}if(1===c.length)return c[0];var V=new THREE.Group;for(d=0,u=c.length;d<u;d++)V.add(c[d]);return V})})},$.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],s=r[r.type];if(s)return"perspective"===r.type?t=new THREE.PerspectiveCamera(THREE.Math.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):"orthographic"===r.type&&(t=new THREE.OrthographicCamera(s.xmag/-2,s.xmag/2,s.ymag/2,s.ymag/-2,s.znear,s.zfar)),void 0!==r.name&&(t.name=r.name),k(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},$.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return r.inverseBindMatrices=e,r})},$.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],r=[],s=[],i=[],n=[],o=[],a=0,l=t.channels.length;a<l;a++){var c=t.channels[a],d=t.samplers[c.sampler],u=c.target,h=void 0!==u.node?u.node:u.id,f=void 0!==t.parameters?t.parameters[d.input]:d.input,m=void 0!==t.parameters?t.parameters[d.output]:d.output;r.push(this.getDependency("node",h)),s.push(this.getDependency("accessor",f)),i.push(this.getDependency("accessor",m)),n.push(d),o.push(u)}return Promise.all([Promise.all(r),Promise.all(s),Promise.all(i),Promise.all(n),Promise.all(o)]).then(function(r){for(var s=r[0],i=r[1],n=r[2],o=r[3],a=r[4],l=[],c=0,d=s.length;c<d;c++){var u=s[c],h=i[c],f=n[c],m=o[c],v=a[c];if(void 0!==u){var y;switch(u.updateMatrix(),u.matrixAutoUpdate=!0,S[v.path]){case S.weights:y=THREE.NumberKeyframeTrack;break;case S.rotation:y=THREE.QuaternionKeyframeTrack;break;case S.position:case S.scale:default:y=THREE.VectorKeyframeTrack}var g=u.name?u.name:u.uuid,b=void 0!==m.interpolation?D[m.interpolation]:THREE.InterpolateLinear,E=[];S[v.path]===S.weights?u.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&E.push(e.name?e.name:e.uuid)}):E.push(g);for(var _=0,P=E.length;_<P;_++){var w=new y(E[_]+"."+S[v.path],THREE.AnimationUtils.arraySlice(h.array,0),THREE.AnimationUtils.arraySlice(f.array,0),b);"CUBICSPLINE"===m.interpolation&&(w.createInterpolant=function(e){return new p(this.times,this.values,this.getValueSize()/3,e)},w.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(w)}}}var x=void 0!==t.name?t.name:"animation_"+e;return new THREE.AnimationClip(x,void 0,l)})},$.prototype.loadNode=function(e){var t=this.json,s=this.extensions,i=this,n=t.meshReferences,o=t.meshUses,a=t.nodes[e];return(!0===a.isBone?Promise.resolve(new THREE.Bone):void 0!==a.mesh?i.getDependency("mesh",a.mesh).then(function(e){var t;if(n[a.mesh]>1){var r=o[a.mesh]++;(t=e.clone()).name+="_instance_"+r,t.onBeforeRender=e.onBeforeRender;for(var s=0,i=t.children.length;s<i;s++)t.children[s].name+="_instance_"+r,t.children[s].onBeforeRender=e.children[s].onBeforeRender}else t=e;return void 0!==a.weights&&t.traverse(function(e){if(e.isMesh)for(var t=0,r=a.weights.length;t<r;t++)e.morphTargetInfluences[t]=a.weights[t]}),t}):void 0!==a.camera?i.getDependency("camera",a.camera):a.extensions&&a.extensions[r.KHR_LIGHTS_PUNCTUAL]&&void 0!==a.extensions[r.KHR_LIGHTS_PUNCTUAL].light?i.getDependency("light",a.extensions[r.KHR_LIGHTS_PUNCTUAL].light):Promise.resolve(new THREE.Object3D)).then(function(e){if(void 0!==a.name&&(e.name=THREE.PropertyBinding.sanitizeNodeName(a.name)),k(e,a),a.extensions&&j(s,e,a),void 0!==a.matrix){var t=new THREE.Matrix4;t.fromArray(a.matrix),e.applyMatrix(t)}else void 0!==a.translation&&e.position.fromArray(a.translation),void 0!==a.rotation&&e.quaternion.fromArray(a.rotation),void 0!==a.scale&&e.scale.fromArray(a.scale);return e})},$.prototype.loadScene=function(){function e(t,r,s,i){var n=s.nodes[t];return i.getDependency("node",t).then(function(e){return void 0===n.skin?e:i.getDependency("skin",n.skin).then(function(e){for(var r=[],s=0,n=(t=e).joints.length;s<n;s++)r.push(i.getDependency("node",t.joints[s]));return Promise.all(r)}).then(function(r){for(var s=!0===e.isGroup?e.children:[e],i=0,n=s.length;i<n;i++){for(var o=s[i],a=[],l=[],c=0,d=r.length;c<d;c++){var u=r[c];if(u){a.push(u);var h=new THREE.Matrix4;void 0!==t.inverseBindMatrices&&h.fromArray(t.inverseBindMatrices.array,16*c),l.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}o.bind(new THREE.Skeleton(a,l),o.matrixWorld)}return e});var t}).then(function(t){r.add(t);var o=[];if(n.children)for(var a=n.children,l=0,c=a.length;l<c;l++){var d=a[l];o.push(e(d,t,s,i))}return Promise.all(o)})}return function(t){var r=this.json,s=this.extensions,i=this.json.scenes[t],n=new THREE.Scene;void 0!==i.name&&(n.name=i.name),k(n,i),i.extensions&&j(s,n,i);for(var o=i.nodes||[],a=[],l=0,c=o.length;l<c;l++)a.push(e(o[l],n,r,this));return Promise.all(a).then(function(){return n})}}(),e}()},function(e,t,r){"use strict";THREE.DRACOLoader=function(e){this.timeLoaded=0,this.manager=e||THREE.DefaultLoadingManager,this.materials=null,this.verbosity=0,this.attributeOptions={},this.drawMode=THREE.TrianglesDrawMode,this.nativeAttributeMap={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"}},THREE.DRACOLoader.prototype={constructor:THREE.DRACOLoader,load:function(e,t,r,s){var i=this,n=new THREE.FileLoader(i.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.load(e,function(e){i.decodeDracoFile(e,t)},r,s)},setPath:function(e){return this.path=e,this},setVerbosity:function(e){return this.verbosity=e,this},setDrawMode:function(e){return this.drawMode=e,this},setSkipDequantization:function(e,t){var r=!0;return void 0!==t&&(r=t),this.getAttributeOptions(e).skipDequantization=r,this},decodeDracoFile:function(e,t,r,s){var i=this;THREE.DRACOLoader.getDecoderModule().then(function(n){i.decodeDracoFileInternal(e,n.decoder,t,r,s)})},decodeDracoFileInternal:function(e,t,r,s,i){var n=new t.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength);var o=new t.Decoder,a=o.GetEncodedGeometryType(n);if(a==t.TRIANGULAR_MESH)this.verbosity>0&&console.log("Loaded a mesh.");else{if(a!=t.POINT_CLOUD){var l="THREE.DRACOLoader: Unknown geometry type.";throw console.error(l),new Error(l)}this.verbosity>0&&console.log("Loaded a point cloud.")}r(this.convertDracoGeometryTo3JS(t,o,a,n,s,i))},addAttributeToGeometry:function(e,t,r,s,i,n,o,a){if(0===n.ptr){var l="THREE.DRACOLoader: No attribute "+s;throw console.error(l),new Error(l)}var c,d,u=n.num_components(),h=r.num_points()*u;switch(i){case Float32Array:c=new e.DracoFloat32Array,t.GetAttributeFloatForAllPoints(r,n,c),a[s]=new Float32Array(h),d=THREE.Float32BufferAttribute;break;case Int8Array:c=new e.DracoInt8Array,t.GetAttributeInt8ForAllPoints(r,n,c),a[s]=new Int8Array(h),d=THREE.Int8BufferAttribute;break;case Int16Array:c=new e.DracoInt16Array,t.GetAttributeInt16ForAllPoints(r,n,c),a[s]=new Int16Array(h),d=THREE.Int16BufferAttribute;break;case Int32Array:c=new e.DracoInt32Array,t.GetAttributeInt32ForAllPoints(r,n,c),a[s]=new Int32Array(h),d=THREE.Int32BufferAttribute;break;case Uint8Array:c=new e.DracoUInt8Array,t.GetAttributeUInt8ForAllPoints(r,n,c),a[s]=new Uint8Array(h),d=THREE.Uint8BufferAttribute;break;case Uint16Array:c=new e.DracoUInt16Array,t.GetAttributeUInt16ForAllPoints(r,n,c),a[s]=new Uint16Array(h),d=THREE.Uint16BufferAttribute;break;case Uint32Array:c=new e.DracoUInt32Array,t.GetAttributeUInt32ForAllPoints(r,n,c),a[s]=new Uint32Array(h),d=THREE.Uint32BufferAttribute;break;default:l="THREE.DRACOLoader: Unexpected attribute type.";throw console.error(l),new Error(l)}for(var p=0;p<h;p++)a[s][p]=c.GetValue(p);o.addAttribute(s,new d(a[s],u)),e.destroy(c)},convertDracoGeometryTo3JS:function(e,t,r,s,i,n){var o,a;!0===this.getAttributeOptions("position").skipDequantization&&t.SkipAttributeTransform(e.POSITION);var l=performance.now();if(r===e.TRIANGULAR_MESH?(o=new e.Mesh,a=t.DecodeBufferToMesh(s,o)):(o=new e.PointCloud,a=t.DecodeBufferToPointCloud(s,o)),!a.ok()||0==o.ptr){var c="THREE.DRACOLoader: Decoding failed: ";throw c+=a.error_msg(),console.error(c),e.destroy(t),e.destroy(o),new Error(c)}var d,u=performance.now();e.destroy(s),r==e.TRIANGULAR_MESH?(d=o.num_faces(),this.verbosity>0&&console.log("Number of faces loaded: "+d.toString())):d=0;var h=o.num_points(),p=o.num_attributes();this.verbosity>0&&(console.log("Number of points loaded: "+h.toString()),console.log("Number of attributes loaded: "+p.toString()));var f=t.GetAttributeId(o,e.POSITION);if(-1==f){c="THREE.DRACOLoader: No position attribute found.";throw console.error(c),e.destroy(t),e.destroy(o),new Error(c)}var m=t.GetAttribute(o,f),v={},y=new THREE.BufferGeometry;if(i)for(var g in i){var b=n[g],E=i[g],_=t.GetAttributeByUniqueId(o,E);this.addAttributeToGeometry(e,t,o,g,b,_,y,v)}else for(var g in this.nativeAttributeMap){var P=t.GetAttributeId(o,e[this.nativeAttributeMap[g]]);if(-1!==P){this.verbosity>0&&console.log("Loaded "+g+" attribute.");_=t.GetAttribute(o,P);this.addAttributeToGeometry(e,t,o,g,Float32Array,_,y,v)}}if(r==e.TRIANGULAR_MESH)if(this.drawMode===THREE.TriangleStripDrawMode){var w=new e.DracoInt32Array;t.GetTriangleStripsFromMesh(o,w);v.indices=new Uint32Array(w.size());for(var x=0;x<w.size();++x)v.indices[x]=w.GetValue(x);e.destroy(w)}else{var C=3*d;v.indices=new Uint32Array(C);var S=new e.DracoInt32Array;for(x=0;x<d;++x){t.GetFaceFromMesh(o,x,S);var D=3*x;v.indices[D]=S.GetValue(0),v.indices[D+1]=S.GetValue(1),v.indices[D+2]=S.GetValue(2)}e.destroy(S)}y.drawMode=this.drawMode,r==e.TRIANGULAR_MESH&&y.setIndex(new(v.indices.length>65535?THREE.Uint32BufferAttribute:THREE.Uint16BufferAttribute)(v.indices,1));var M=new e.AttributeQuantizationTransform;if(M.InitFromAttribute(m)){y.attributes.position.isQuantized=!0,y.attributes.position.maxRange=M.range(),y.attributes.position.numQuantizationBits=M.quantization_bits(),y.attributes.position.minValues=new Float32Array(3);for(x=0;x<3;++x)y.attributes.position.minValues[x]=M.min_value(x)}return e.destroy(M),e.destroy(t),e.destroy(o),this.decode_time=u-l,this.import_time=performance.now()-u,this.verbosity>0&&(console.log("Decode time: "+this.decode_time),console.log("Import time: "+this.import_time)),y},isVersionSupported:function(e,t){THREE.DRACOLoader.getDecoderModule().then(function(r){t(r.decoder.isVersionSupported(e))})},getAttributeOptions:function(e){return void 0===this.attributeOptions[e]&&(this.attributeOptions[e]={}),this.attributeOptions[e]}},THREE.DRACOLoader.decoderPath="./",THREE.DRACOLoader.decoderConfig={},THREE.DRACOLoader.decoderModulePromise=null,THREE.DRACOLoader.setDecoderPath=function(e){THREE.DRACOLoader.decoderPath=e},THREE.DRACOLoader.setDecoderConfig=function(e){var t=THREE.DRACOLoader.decoderConfig.wasmBinary;THREE.DRACOLoader.decoderConfig=e||{},THREE.DRACOLoader.releaseDecoderModule(),t&&(THREE.DRACOLoader.decoderConfig.wasmBinary=t)},THREE.DRACOLoader.releaseDecoderModule=function(){THREE.DRACOLoader.decoderModulePromise=null},THREE.DRACOLoader.getDecoderModule=function(){var e=this,t=THREE.DRACOLoader.decoderPath,r=THREE.DRACOLoader.decoderConfig,s=THREE.DRACOLoader.decoderModulePromise;return s||("undefined"!=typeof DracoDecoderModule?s=Promise.resolve():"object"!=typeof WebAssembly||"js"===r.type?s=THREE.DRACOLoader._loadScript(t+"draco_decoder.js"):(r.wasmBinaryFile=t+"draco_decoder.wasm",s=THREE.DRACOLoader._loadScript(t+"draco_wasm_wrapper.js").then(function(){return THREE.DRACOLoader._loadArrayBuffer(r.wasmBinaryFile)}).then(function(e){r.wasmBinary=e})),s=s.then(function(){return new Promise(function(t){r.onModuleLoaded=function(r){e.timeLoaded=performance.now(),t({decoder:r})},DracoDecoderModule(r)})}),THREE.DRACOLoader.decoderModulePromise=s,s)},THREE.DRACOLoader._loadScript=function(e){var t=document.getElementById("decoder_script");null!==t&&t.parentNode.removeChild(t);var r=document.getElementsByTagName("head")[0],s=document.createElement("script");return s.id="decoder_script",s.type="text/javascript",s.src=e,new Promise(function(e){s.onload=e,r.appendChild(s)})},THREE.DRACOLoader._loadArrayBuffer=function(e){var t=new THREE.FileLoader;return t.setResponseType("arraybuffer"),new Promise(function(r,s){t.load(e,r,void 0,s)})}},function(e,t){e.exports="//#define PHYSICAL\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n\n//#include <uv_pars_fragment>\n//#include <uv2_pars_fragment>\n// REPLACED WITH\n#if defined(USE_MAP) || defined(USE_BUMPMAP) || defined(USE_NORMALMAP) || defined(USE_SPECULARMAP) || defined(USE_ALPHAMAP) || defined(USE_EMISSIVEMAP) || defined(USE_ROUGHNESSMAP) || defined(USE_METALNESSMAP) || defined(USE_LIGHTMAP) || defined(USE_AOMAP)\n\tvarying vec2 vUv;\n#endif\n\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\n#ifdef USE_AOMAP\n    uniform vec3 aoMapMix;\n#endif\n\n#ifdef MODE_XRAY\n    varying float vIntensity;\n#endif\n\n#ifdef CUT_PLANE\n    varying vec3 vWorldPosition;\n    uniform vec4 cutPlaneDirection;\n    uniform vec3 cutPlaneColor;\n#endif\n\nvoid main() {\n    #ifdef CUT_PLANE\n        if (dot(vWorldPosition, cutPlaneDirection.xyz) < cutPlaneDirection.w) {\n            discard;\n        }\n    #endif\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n    #include <normal_fragment_maps>\n\n\t#ifdef CUT_PLANE\n\t    // on the cut surface (back facing fragments revealed), replace normal with cut plane direction\n        if (!gl_FrontFacing) {\n            normal = -cutPlaneDirection.xyz;\n            diffuseColor.rgb = cutPlaneColor.rgb;\n        }\n\t#endif\n\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)\n        vec2 vUv2 = vUv;\n    #endif\n\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t//#include <aomap_fragment>\n\t// REPLACED WITH\n\t#ifdef USE_AOMAP\n\t    // if cut plane is enabled, disable ambient occlusion on back facing fragments\n\t    #ifdef CUT_PLANE\n            if (gl_FrontFacing) {\n\t    #endif\n\n    \t// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n    \tvec3 aoSample = texture2D(aoMap, vUv).rgb;\n    \tvec3 aoFactors = mix(vec3(1.0), aoSample, clamp(aoMapMix * aoMapIntensity, 0.0, 1.0));\n    \tfloat ambientOcclusion = aoFactors.x * aoFactors.y * aoFactors.z;\n    \tfloat ambientOcclusion2 = ambientOcclusion * ambientOcclusion;\n    \treflectedLight.directDiffuse *= ambientOcclusion2;\n    \treflectedLight.directSpecular *= ambientOcclusion;\n    \t//reflectedLight.indirectDiffuse *= ambientOcclusion;\n\n    \t#if defined(USE_ENVMAP) && defined(PHYSICAL)\n    \t\tfloat dotNV = saturate(dot(geometry.normal, geometry.viewDir));\n    \t\treflectedLight.indirectSpecular *= computeSpecularOcclusion(dotNV, ambientOcclusion, material.specularRoughness);\n    \t#endif\n\n    \t#ifdef CUT_PLANE\n    \t    }\n    \t#endif\n    #endif\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\tgl_FragColor = vec4(outgoingLight, diffuseColor.a);\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n    #ifdef MODE_NORMALS\n        gl_FragColor = vec4(vec3(normal * 0.5 + 0.5), 1.0);\n    #endif\n\n    #ifdef MODE_XRAY\n        gl_FragColor = vec4(vec3(0.4, 0.7, 1.0) * vIntensity, 1.0);\n    #endif\n}\n"},function(e,t){e.exports="//#define PHYSICAL\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n\n#include <common>\n\n//#include <uv_pars_vertex>\n//#include <uv2_pars_vertex>\n// REPLACED WITH\n#if defined(USE_MAP) || defined(USE_BUMPMAP) || defined(USE_NORMALMAP) || defined(USE_SPECULARMAP) || defined(USE_ALPHAMAP) || defined(USE_EMISSIVEMAP) || defined(USE_ROUGHNESSMAP) || defined(USE_METALNESSMAP) || defined(USE_LIGHTMAP) || defined(USE_AOMAP)\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n#ifdef MODE_XRAY\n    varying float vIntensity;\n#endif\n\n#ifdef CUT_PLANE\n    varying vec3 vWorldPosition;\n#endif\n\nvoid main() {\n\n//\t#include <uv_vertex>\n//\t#include <uv2_vertex>\n//  REPLACED WITH\n#if defined(USE_MAP) || defined(USE_BUMPMAP) || defined(USE_NORMALMAP) || defined(USE_SPECULARMAP) || defined(USE_ALPHAMAP) || defined(USE_EMISSIVEMAP) || defined(USE_ROUGHNESSMAP) || defined(USE_METALNESSMAP) || defined(USE_LIGHTMAP) || defined(USE_AOMAP)\n\tvUv = (uvTransform * vec3(uv, 1)).xy;\n#endif\n\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\tvNormal = normalize(transformedNormal);\n#endif\n\n#ifdef MODE_XRAY\n    vIntensity = pow(abs(1.0 - abs(dot(vNormal, vec3(0.0, 0.0, 1.0)))), 3.0);\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = -mvPosition.xyz;\n\n\t// #include <worldpos_vertex>\n\t// REPLACED WITH\n\t#if defined(USE_ENVMAP) || defined(DISTANCE) || defined(USE_SHADOWMAP) || defined(CUT_PLANE)\n    \tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n    #endif\n\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n#ifdef CUT_PLANE\n    vWorldPosition = worldPosition.xyz / worldPosition.w;\n#endif\n\n#ifdef MODE_NORMALS\n    vNormal = normal;\n#endif\n}\n"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2);r(192);const i=s.OBJLoader;r(193);const n=s.PLYLoader;class o{constructor(e){this.objLoader=new i(e),this.plyLoader=new n(e)}canLoad(e){const t=e.split(".").pop().toLowerCase();return o.extensions.indexOf(t)>=0}load(e){const t=e.split(".").pop().toLowerCase();return new Promise((r,s)=>{if("obj"===t)this.objLoader.load(e,t=>{const i=t.children[0].geometry;return console.log(i),i&&"Geometry"===i.type||"BufferGeometry"===i.type?r(i):s(new Error(`Can't parse geometry from '${e}'`))});else{if("ply"!==t)throw new Error(`Can't load geometry, unknown extension: '${t}' in '${e}'`);this.plyLoader.load(e,t=>t&&"Geometry"===t.type||"BufferGeometry"===t.type?r(t):s(new Error(`Can't parse geometry from '${e}'`)))}})}}o.extensions=["obj","ply"],t.default=o},function(e,t){THREE.OBJLoader=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,r=/^usemtl /;function s(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var s={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(s),s},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){var s=r.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){var r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){var s=this.vertices,i=this.object.geometry.vertices;i.push(s[e+0],s[e+1],s[e+2]),i.push(s[t+0],s[t+1],s[t+2]),i.push(s[r+0],s[r+1],s[r+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){var s=this.normals,i=this.object.geometry.normals;i.push(s[e+0],s[e+1],s[e+2]),i.push(s[t+0],s[t+1],s[t+2]),i.push(s[r+0],s[r+1],s[r+2])},addColor:function(e,t,r){var s=this.colors,i=this.object.geometry.colors;i.push(s[e+0],s[e+1],s[e+2]),i.push(s[t+0],s[t+1],s[t+2]),i.push(s[r+0],s[r+1],s[r+2])},addUV:function(e,t,r){var s=this.uvs,i=this.object.geometry.uvs;i.push(s[e+0],s[e+1]),i.push(s[t+0],s[t+1]),i.push(s[r+0],s[r+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,s,i,n,o,a,l){var c=this.vertices.length,d=this.parseVertexIndex(e,c),u=this.parseVertexIndex(t,c),h=this.parseVertexIndex(r,c);if(this.addVertex(d,u,h),void 0!==s&&""!==s){var p=this.uvs.length;d=this.parseUVIndex(s,p),u=this.parseUVIndex(i,p),h=this.parseUVIndex(n,p),this.addUV(d,u,h)}if(void 0!==o&&""!==o){var f=this.normals.length;d=this.parseNormalIndex(o,f),u=o===a?d:this.parseNormalIndex(a,f),h=o===l?d:this.parseNormalIndex(l,f),this.addNormal(d,u,h)}this.colors.length>0&&this.addColor(d,u,h)},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,r=0,s=e.length;r<s;r++)this.addVertexPoint(this.parseVertexIndex(e[r],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var r=this.vertices.length,s=this.uvs.length,i=0,n=e.length;i<n;i++)this.addVertexLine(this.parseVertexIndex(e[i],r));var o=0;for(n=t.length;o<n;o++)this.addUVLine(this.parseUVIndex(t[o],s))}};return e.startObject("",!1),e}function i(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null}return i.prototype={constructor:i,load:function(e,t,r,s){var i=this,n=new THREE.FileLoader(i.manager);n.setPath(this.path),n.load(e,function(e){t(i.parse(e))},r,s)},setPath:function(e){return this.path=e,this},setMaterials:function(e){return this.materials=e,this},parse:function(i){console.time("OBJLoader");var n=new s;-1!==i.indexOf("\r\n")&&(i=i.replace(/\r\n/g,"\n")),-1!==i.indexOf("\\\n")&&(i=i.replace(/\\\n/g,""));for(var o=i.split("\n"),a="",l="",c=[],d="function"==typeof"".trimLeft,u=0,h=o.length;u<h;u++)if(a=o[u],0!==(a=d?a.trimLeft():a.trim()).length&&"#"!==(l=a.charAt(0)))if("v"===l){var p=a.split(/\s+/);switch(p[0]){case"v":n.vertices.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])),8===p.length&&n.colors.push(parseFloat(p[4]),parseFloat(p[5]),parseFloat(p[6]));break;case"vn":n.normals.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3]));break;case"vt":n.uvs.push(parseFloat(p[1]),parseFloat(p[2]))}}else if("f"===l){for(var f=a.substr(1).trim().split(/\s+/),m=[],v=0,y=f.length;v<y;v++){var g=f[v];if(g.length>0){var b=g.split("/");m.push(b)}}var E=m[0];for(v=1,y=m.length-1;v<y;v++){var _=m[v],P=m[v+1];n.addFace(E[0],_[0],P[0],E[1],_[1],P[1],E[2],_[2],P[2])}}else if("l"===l){var w=a.substring(1).trim().split(" "),x=[],C=[];if(-1===a.indexOf("/"))x=w;else for(var S=0,D=w.length;S<D;S++){var M=w[S].split("/");""!==M[0]&&x.push(M[0]),""!==M[1]&&C.push(M[1])}n.addLineGeometry(x,C)}else if("p"===l){var T=a.substr(1).trim().split(" ");n.addPointGeometry(T)}else if(null!==(c=e.exec(a))){var R=(" "+c[0].substr(1).trim()).substr(1);n.startObject(R)}else if(r.test(a))n.object.startMaterial(a.substring(7).trim(),n.materialLibraries);else if(t.test(a))n.materialLibraries.push(a.substring(7).trim());else{if("s"!==l){if("\0"===a)continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+a+'"')}if((c=a.split(" ")).length>1){var O=c[1].trim().toLowerCase();n.object.smooth="0"!==O&&"off"!==O}else n.object.smooth=!0;(G=n.object.currentMaterial())&&(G.smooth=n.object.smooth)}n.finalize();var A=new THREE.Group;A.materialLibraries=[].concat(n.materialLibraries);for(u=0,h=n.objects.length;u<h;u++){var j=n.objects[u],k=j.geometry,I=j.materials,L="Line"===k.type,V="Points"===k.type,N=!1;if(0!==k.vertices.length){var F=new THREE.BufferGeometry;F.addAttribute("position",new THREE.Float32BufferAttribute(k.vertices,3)),k.normals.length>0?F.addAttribute("normal",new THREE.Float32BufferAttribute(k.normals,3)):F.computeVertexNormals(),k.colors.length>0&&(N=!0,F.addAttribute("color",new THREE.Float32BufferAttribute(k.colors,3))),k.uvs.length>0&&F.addAttribute("uv",new THREE.Float32BufferAttribute(k.uvs,2));for(var $,z=[],U=0,H=I.length;U<H;U++){var B=I[U],G=void 0;if(null!==this.materials)if(G=this.materials.create(B.name),!L||!G||G instanceof THREE.LineBasicMaterial){if(V&&G&&!(G instanceof THREE.PointsMaterial)){var q=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});THREE.Material.prototype.copy.call(q,G),q.color.copy(G.color),q.map=G.map,q.lights=!1,G=q}}else{var Q=new THREE.LineBasicMaterial;THREE.Material.prototype.copy.call(Q,G),Q.color.copy(G.color),Q.lights=!1,G=Q}G||((G=L?new THREE.LineBasicMaterial:V?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial).name=B.name),G.flatShading=!B.smooth,G.vertexColors=N?THREE.VertexColors:THREE.NoColors,z.push(G)}if(z.length>1){for(U=0,H=I.length;U<H;U++){B=I[U];F.addGroup(B.groupStart,B.groupCount,U)}$=L?new THREE.LineSegments(F,z):V?new THREE.Points(F,z):new THREE.Mesh(F,z)}else $=L?new THREE.LineSegments(F,z[0]):V?new THREE.Points(F,z[0]):new THREE.Mesh(F,z[0]);$.name=j.name,A.add($)}}return console.timeEnd("OBJLoader"),A}},i}()},function(e,t){THREE.PLYLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.propertyNameMapping={}},THREE.PLYLoader.prototype={constructor:THREE.PLYLoader,load:function(e,t,r,s){var i=this,n=new THREE.FileLoader(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.load(e,function(e){t(i.parse(e))},r,s)},setPath:function(e){return this.path=e,this},setPropertyNameMapping:function(e){this.propertyNameMapping=e},parse:function(e){function t(e){var t="",r=0,s=/ply([\s\S]*)end_header\r?\n/.exec(e);null!==s&&(t=s[1],r=s[0].length);var i,n,o,a,l,c,u={comments:[],elements:[],headerLength:r},h=t.split("\n");for(var p=0;p<h.length;p++){var f=h[p];if(""!==(f=f.trim()))switch(n=(o=f.split(/\s+/)).shift(),f=o.join(" "),n){case"format":u.format=o[0],u.version=o[1];break;case"comment":u.comments.push(f);break;case"element":void 0!==i&&u.elements.push(i),(i={}).name=o[0],i.count=parseInt(o[1]),i.properties=[];break;case"property":i.properties.push((a=o,l=d.propertyNameMapping,c=void 0,"list"===(c={type:a[0]}).type?(c.name=a[3],c.countType=a[1],c.itemType=a[2]):c.name=a[1],c.name in l&&(c.name=l[c.name]),c));break;default:console.log("unhandled",n,o)}}return void 0!==i&&u.elements.push(i),u}function r(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function s(e,t){for(var s=t.split(/\s+/),i={},n=0;n<e.length;n++)if("list"===e[n].type){for(var o=[],a=r(s.shift(),e[n].countType),l=0;l<a;l++)o.push(r(s.shift(),e[n].itemType));i[e[n].name]=o}else i[e[n].name]=r(s.shift(),e[n].type);return i}function i(e,t){var r,i={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},a="";null!==(r=/end_header\s([\s\S]*)$/.exec(e))&&(a=r[1]);for(var l=a.split("\n"),c=0,d=0,u=0;u<l.length;u++){var h=l[u];if(""!==(h=h.trim())){d>=t.elements[c].count&&(c++,d=0);var p=s(t.elements[c].properties,h);o(i,t.elements[c].name,p),d++}}return n(i)}function n(e){var t=new THREE.BufferGeometry;return e.indices.length>0&&t.setIndex(e.indices),t.addAttribute("position",new THREE.Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&t.addAttribute("normal",new THREE.Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&t.addAttribute("uv",new THREE.Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&t.addAttribute("color",new THREE.Float32BufferAttribute(e.colors,3)),e.faceVertexUvs.length>0&&(t=t.toNonIndexed()).addAttribute("uv",new THREE.Float32BufferAttribute(e.faceVertexUvs,2)),t.computeBoundingSphere(),t}function o(e,t,r){if("vertex"===t)e.vertices.push(r.x,r.y,r.z),"nx"in r&&"ny"in r&&"nz"in r&&e.normals.push(r.nx,r.ny,r.nz),"s"in r&&"t"in r&&e.uvs.push(r.s,r.t),"red"in r&&"green"in r&&"blue"in r&&e.colors.push(r.red/255,r.green/255,r.blue/255);else if("face"===t){var s=r.vertex_indices||r.vertex_index,i=r.texcoord;3===s.length?(e.indices.push(s[0],s[1],s[2]),i&&6===i.length&&(e.faceVertexUvs.push(i[0],i[1]),e.faceVertexUvs.push(i[2],i[3]),e.faceVertexUvs.push(i[4],i[5]))):4===s.length&&(e.indices.push(s[0],s[1],s[3]),e.indices.push(s[1],s[2],s[3]))}}function a(e,t,r,s){switch(r){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,s),2];case"uint16":case"ushort":return[e.getUint16(t,s),2];case"int32":case"int":return[e.getInt32(t,s),4];case"uint32":case"uint":return[e.getUint32(t,s),4];case"float32":case"float":return[e.getFloat32(t,s),4];case"float64":case"double":return[e.getFloat64(t,s),8]}}function l(e,t,r,s){for(var i,n={},o=0,l=0;l<r.length;l++)if("list"===r[l].type){var c=[],d=(i=a(e,t+o,r[l].countType,s))[0];o+=i[1];for(var u=0;u<d;u++)i=a(e,t+o,r[l].itemType,s),c.push(i[0]),o+=i[1];n[r[l].name]=c}else i=a(e,t+o,r[l].type,s),n[r[l].name]=i[0],o+=i[1];return[n,o]}var c,d=this;if(e instanceof ArrayBuffer){var u=THREE.LoaderUtils.decodeText(new Uint8Array(e)),h=t(u);c="ascii"===h.format?i(u,h):function(e,t){for(var r,s={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},i="binary_little_endian"===t.format,a=new DataView(e,t.headerLength),c=0,d=0;d<t.elements.length;d++)for(var u=0;u<t.elements[d].count;u++){c+=(r=l(a,c,t.elements[d].properties,i))[1];var h=r[0];o(s,t.elements[d].name,h)}return n(s)}(e,h)}else c=i(e,t(e));return c}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2);class i{constructor(e){this.textureLoader=new s.TextureLoader(e)}canLoad(e){const t=e.split(".").pop().toLowerCase();return i.extensions.indexOf(t)>=0}canLoadMimeType(e){return i.mimeTypes.indexOf(e)>=0}load(e){return new Promise((t,r)=>{this.textureLoader.load(e,e=>{t(e)},null,e=>{console.error(e),r(new Error(e.message))})})}loadImmediate(e){return this.textureLoader.load(e,null,null,e=>{console.error(e)})}}i.extensions=["jpg","png"],i.mimeTypes=["image/jpeg","image/png"],t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(20),n=new s.Vector4,o=(new s.Vector4,new s.Vector3),a=new s.Vector3,l=new s.Matrix4,c=new s.Euler,d=new s.Quaternion,u={PI:3.141592653589793,DOUBLE_PI:6.283185307179586,HALF_PI:1.5707963267948966,QUARTER_PI:.7853981633974483,DEG2RAD:.017453292519943295,RAD2DEG:57.29577951308232,composeOrbitMatrix:function(e,t,r){const i=e.x,n=e.y,o=e.z,a=t.x,l=t.y,c=t.z,d=Math.sin(i),u=Math.cos(i),h=Math.sin(n),p=Math.cos(n),f=Math.sin(o),m=Math.cos(o),v=p*m,y=m*h*d-f*u,g=m*h*u+f*d,b=p*f,E=d*h*f+m*u,_=f*h*u-m*d,P=-h,w=p*d,x=p*u,C=(r=r||new s.Matrix4).elements;return C[0]=v,C[1]=b,C[2]=P,C[3]=0,C[4]=y,C[5]=E,C[6]=w,C[7]=0,C[8]=g,C[9]=_,C[10]=x,C[11]=0,C[12]=a*v+l*y+c*g,C[13]=a*b+l*E+c*_,C[14]=a*P+l*w+c*x,C[15]=1,r},decomposeOrbitMatrix:function(e,t,r){c.setFromRotationMatrix(e,"ZYX"),c.toVector3(t),l.getInverse(e),n.set(0,0,0,1),n.applyMatrix4(l),r.x=-n.x,r.y=-n.y,r.z=-n.z},isMatrix4Identity:function(e){const t=e.elements;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]},decomposeTransformMatrix:function(e,t,r,s){l.fromArray(e),l.decompose(o,d,a),c.setFromQuaternion(d,"XYZ"),o.toArray(t),a.toArray(s),c.toVector3(o),n.multiplyScalar(i.default.RAD2DEG),o.toArray(r)}};t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(51),i=r(96),n=[],o=[s.EDerivativeQuality.Thumb,s.EDerivativeQuality.Low,s.EDerivativeQuality.Medium,s.EDerivativeQuality.High,s.EDerivativeQuality.Highest];t.default=class{constructor(){this.derivatives={}}select(e,t){const r=s.EDerivativeUsage[e],i=s.EDerivativeQuality[t],n=o.indexOf(t);if(n<0)return console.warn(`derivative quality not supported: '${i}'`),null;const a=this.get(e,t);if(a)return a;for(let t=n+1;t<o.length;++t){const r=this.get(e,o[t]);if(r)return console.warn(`derivative quality '${i}' not available, using higher quality`),r}for(let t=n-1;t>=0;--t){const r=this.get(e,o[t]);if(r)return console.warn(`derivative quality '${i}' not available, using lower quality`),r}return console.warn(`no suitable derivative found for quality '${i}'`+` and usage '${r}'`),null}getByUsage(e){const t=s.EDerivativeUsage[e];return this.derivatives[t]||n}get(e,t){const r=s.EDerivativeUsage[e],i=this.derivatives[r];if(i)for(let e=0,r=i.length;e<r;++e)if(i[e].quality===t)return i[e];return null}getOrCreate(e,t){const r=this.getOrCreateBin(e);for(let e=0,s=r.length;e<s;++e)if(r[e].quality===t)return r[e];const i=new s.default(e,t);return r.push(i),i}createModelAsset(e,t){const r=this.getOrCreate(s.EDerivativeUsage.Web3D,t);return r.createAsset(i.EAssetType.Model,e),r}createMeshAsset(e,t,r){const n=this.getOrCreate(s.EDerivativeUsage.Web3D,r);return n.createAsset(i.EAssetType.Geometry,e),t&&(n.createAsset(i.EAssetType.Image,t).mapType=i.EMapType.Color),n}clear(){for(let e in this.derivatives)this.derivatives[e].forEach(e=>e.dispose());this.derivatives={}}toData(){const e=[];for(let t in this.derivatives)this.derivatives[t].forEach(t=>e.push(t.toData()));return e}fromData(e){this.clear(),e.forEach(e=>{this.getOrCreateBin(s.EDerivativeUsage[e.usage]).push(new s.default(e))})}toString(e=!1){const t=this.derivatives,r=Object.keys(t);return e?`Derivatives (${r.length}) \n `+r.map(e=>t[e].map(e=>e.toString(!0)).join("\n ")).join("\n "):`Derivatives (${r.length}) `+r.map(e=>`${e} (${t[e].length})`).join(", ")}getOrCreateBin(e){const t=s.EDerivativeUsage[e];return this.derivatives[t]||(this.derivatives[t]=[])}}},function(e){e.exports={info:{type:"application/si-dpo-3d.presentation+json",copyright:"Copyright Smithsonian Institution",generator:"Voyager Presentation Parser",version:"1.2"},scene:{nodes:[0,1,2]},nodes:[{reference:0},{translation:[0,0,15],camera:0},{name:"Lights",children:[3,4,5,6]},{translation:[-3,1,2],name:"Light",light:0},{translation:[2,0,3],name:"Light",light:1},{translation:[0,2,-.5],name:"Light",light:2},{translation:[0,-2,-1.2],name:"Light",light:3}],references:[{mimeType:"application/si-dpo-3d.item+json",uri:"0"}],cameras:[{type:"perspective",perspective:{yfov:45,znear:.1,zfar:1e4}}],lights:[{type:"directional",color:[1,.95,.9],intensity:.8},{type:"directional",color:[1,1,1],intensity:.8},{type:"directional",color:[1,.95,.85],intensity:.5},{type:"directional",color:[.8,.85,1],intensity:1}],setup:{navigation:{type:"Orbit",enabled:!0,orbit:{orbit:[-24,-26,0],offset:[0,0,199.64320696292842],minOrbit:[-90,null,null],maxOrbit:[90,null,null],minOffset:[null,null,.1],maxOffset:[null,null,null]}},interface:{visible:!0,logo:!0},reader:{visible:!1,position:"Overlay",url:""},scene:{units:"cm",shader:"Default",exposure:1,gamma:1},background:{type:"Solid",color0:[1,0,0],color1:[0,1,0]},groundPlane:{visible:!1,offset:0,color:[0,0,1],shadowVisible:!1,shadowColor:[1,1,1,1]},grid:{visible:!1,color:[.5,.7,.8]},tapeTool:{active:!1,startPosition:[0,0,0],startDirection:[0,0,0],endPosition:[0,0,0],endDirection:[0,0,0]},sectionTool:{active:!1,plane:[0,0,0,0]}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(10),i=r(9);t.default=class extends s.default{constructor(e){super(),this.title="New Document",this.description="",this.uri="",this.mimeType="",this.thumbnailUri="",this.addEvent("change"),this.id=e||i.default(6)}update(){this.emit({type:"update",document:this})}deflate(){const e={id:this.id};return this.title&&(e.title=this.title),this.description&&(e.description=this.description),this.uri&&(e.uri=this.uri),this.mimeType&&(e.mimeType=this.mimeType),this.thumbnailUri&&(e.thumbnailUri=this.thumbnailUri),e}inflate(e){return this.title=e.title||"",this.description=e.description||"",this.uri=e.uri||"",this.mimeType=e.mimeType||"",this.thumbnailUri=e.thumbnailUri||"",this}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(9),i=r(10);t.default=class extends i.default{constructor(e){super(),this.title="New Annotation",this.description="",this.style="",this.expanded=!1,this.documents=[],this.groups=[],this.position=null,this.direction=null,this.zoneIndex=-1,this.addEvent("change"),this.id=e||s.default(6)}update(){this.emit({type:"update",annotation:this})}deflate(){const e={id:this.id};return this.title&&(e.title=this.title),this.description&&(e.description=this.description),this.style&&(e.style=this.style),this.expanded&&(e.expanded=this.expanded),this.documents.length>0&&(e.documents=this.documents.slice()),this.groups.length>0&&(e.groups=this.groups.slice()),this.position&&(e.position=this.position.slice()),this.direction&&(e.direction=this.direction.slice()),this.zoneIndex>-1&&(e.zoneIndex=this.zoneIndex),e}inflate(e){return this.title=e.title||"",this.description=e.description||"",this.style=e.style||"",this.expanded=e.expanded||!1,this.documents=e.documents?e.documents.slice():[],this.groups=e.groups?e.groups.slice():[],this.position=e.position.slice(),this.direction=e.direction.slice(),this.zoneIndex=void 0!==e.zoneIndex?e.zoneIndex:-1,this}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(10),i=r(9);t.default=class extends s.default{constructor(e){super(),this.title="New Group",this.description="",this.visible=!0,this.addEvent("change"),this.id=e||i.default(6)}update(){this.emit({type:"update",group:this})}deflate(){const e={id:this.id};return this.title&&(e.title=this.title),this.description&&(e.description=this.description),this.visible&&(e.visible=this.visible),e}inflate(e){return this.title=e.title||"",this.description=e.description||"",this.visible=e.visible||!1,this}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(36);t.CController=s.default;const i=r(48);t.CGraph=i.default;const n=r(37);t.CHierarchy=n.default;const o=r(202);t.COscillator=o.default;const a=r(64);t.CPulse=a.default;const l=r(12);t.CSelection=l.default,t.componentTypes=[i.default,n.default,o.default,a.default,l.default]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(203),i=r(3),n=r(0);var o,a;!function(e){e[e.Relative=0]="Relative",e[e.Absolute=1]="Absolute"}(o=t.ETimeBase||(t.ETimeBase={})),function(e){e[e.Forward=0]="Forward",e[e.Backward=1]="Backward",e[e.Alternate=2]="Alternate"}(a=t.EInterpolationMode||(t.EInterpolationMode={}));const l={run:i.types.Boolean("Control.Run"),start:i.types.Event("Control.Start"),pause:i.types.Event("Control.Pause"),stop:i.types.Event("Control.Stop"),min:i.types.Number("Value.Min"),max:i.types.Number("Value.Max",1),curve:i.types.Enum("Interpolation.Curve",s.EEasingCurve),mode:i.types.Enum("Interpolation.Mode",a),duration:i.types.Number("Time.Duration",1),base:i.types.Enum("Time.Base",o),offset:i.types.Number("Time.Offset",{preset:0,min:0,max:1,bar:!0}),repetitions:i.types.Natural("Time.Repetitions")},c={value:i.types.Number("Value"),repetition:i.types.Natural("Repetition"),repeat:i.types.Event("Repeat")};class d extends n.default{constructor(){super(...arguments),this.ins=this.addInputs(l),this.outs=this.addOutputs(c),this.lastTime=0,this.lastT=0,this.easingFunction=null,this.isAbsolute=!1,this.isBackward=!1,this.isAlternate=!1}update(e){const{ins:t,outs:r}=this;return t.curve.changed&&(this.easingFunction=s.getEasingFunction(t.curve.getValidatedValue())),t.mode.changed&&(this.isBackward=t.mode.value===a.Backward,this.isAlternate=t.mode.value===a.Alternate),t.base.changed&&(this.isAbsolute=t.base.value===o.Absolute),t.start.changed?(this.lastTime=0,t.run.setValue(!0),r.repetition.setValue(0)):t.pause.changed?t.run.value?t.run.setValue(!1):(t.repetitions.value<=0||r.repetition.value<t.repetitions.value)&&t.run.setValue(!0):t.stop.changed&&(this.lastTime=0,t.run.setValue(!1),r.value.setValue(this.isBackward?t.max.value:t.min.value),r.repetition.setValue(0)),t.run.changed&&t.run.value&&(this.lastT=0,t.repetitions.value>0&&r.repetition.value>=t.repetitions.value&&r.repetition.setValue(0)),!1}tick(e){const{ins:t,outs:r}=this;if(t.run.value){const s=t.duration.value;if(0===s)return!1;let i;if((i=(i=this.isAbsolute?e.secondsElapsed/s:this.lastTime=this.lastTime+e.secondsDelta/s)<0?1- -i%1:i%1)<this.lastT){const e=r.repetition.value+1;r.repetition.setValue(e),r.repeat.set(),t.repetitions.value>0&&e>=t.repetitions.value&&(t.run.setValue(!1),i=1)}this.lastT=i,i=(i+=t.offset.value)>1?i%1:i,i=this.isAlternate?2*(i>.5?1-i:i):this.isBackward?1-i:i;const n=t.min.value+this.easingFunction(i)*(t.max.value-t.min.value);return r.value.setValue(n),!0}return!1}}d.type="COscillator",t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=Math.PI,i=.5*s;var n;!function(e){e[e.Linear=0]="Linear",e[e.EaseQuad=1]="EaseQuad",e[e.EaseInQuad=2]="EaseInQuad",e[e.EaseOutQuad=3]="EaseOutQuad",e[e.EaseCubic=4]="EaseCubic",e[e.EaseInCubic=5]="EaseInCubic",e[e.EaseOutCubic=6]="EaseOutCubic",e[e.EaseQuart=7]="EaseQuart",e[e.EaseInQuart=8]="EaseInQuart",e[e.EaseOutQuart=9]="EaseOutQuart",e[e.EaseQuint=10]="EaseQuint",e[e.EaseInQuint=11]="EaseInQuint",e[e.EaseOutQuint=12]="EaseOutQuint",e[e.EaseSine=13]="EaseSine",e[e.EaseInSine=14]="EaseInSine",e[e.EaseOutSine=15]="EaseOutSine"}(n=t.EEasingCurve||(t.EEasingCurve={})),t.getEasingFunction=function(e){return t.easingFunctions[n[e]]},t.easingFunctions={Linear:function(e){return e},EaseQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},EaseInQuad:function(e){return e*e},EaseOutQuad:function(e){return e*(2-e)},EaseCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},EaseInCubic:function(e){return e*e*e},EaseOutCubic:function(e){return--e*e*e+1},EaseQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},EaseInQuart:function(e){return e*e*e*e},EaseOutQuart:function(e){return 1- --e*e*e*e},EaseQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e},EaseInQuint:function(e){return e*e*e*e*e},EaseOutQuint:function(e){return 1+--e*e*e*e*e},EaseSine:function(e){return-.5*(Math.cos(e*s)-1)},EaseInSine:function(e){return 1-Math.cos(e*i)},EaseOutSine:function(e){return Math.sin(e*i)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(205);t.CBasicMaterial=s.default;const i=r(206);t.CBox=i.default;const n=r(50);t.CCamera=n.default;const o=r(103);t.CDirectionalLight=o.default;const a=r(58);t.CGeometry=a.default;const l=r(207);t.CGrid=l.default;const c=r(41);t.CLight=c.default;const d=r(208);t.CMain=d.default;const u=r(57);t.CMaterial=u.default;const h=r(209);t.CMesh=h.default;const p=r(14);t.CObject3D=p.default;const f=r(210);t.COrbitManipulator=f.default;const m=r(211);t.CPhongMaterial=m.default;const v=r(65);t.CPickSelection=v.default;const y=r(105);t.CPointLight=y.default;const g=r(13);t.CRenderer=g.default;const b=r(98);t.CRenderGraph=b.default;const E=r(24);t.CScene=E.default;const _=r(107);t.CSpotLight=_.default;const P=r(212);t.CTorus=P.default;const w=r(28);t.CTransform=w.default,t.componentTypes=[s.default,i.default,n.default,v.default,o.default,l.default,d.default,h.default,f.default,m.default,y.default,g.default,b.default,E.default,_.default,P.default,w.default]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(3),n=r(57),o={color:i.types.ColorRGB("Color")};class a extends n.default{constructor(){super(...arguments),this.ins=this.addInputs(o)}create(){this.material=new s.MeshBasicMaterial}update(){const e=this.material,{color:t}=this.ins;return e.color.setRGB(t.value[0],t.value[1],t.value[2]),!0}}a.type="CBasicMaterial",t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(3),n=r(58),o={size:i.types.Vector3("Size",[10,10,10]),segments:i.types.Vector3("Segments",[1,1,1])};class a extends n.default{constructor(){super(...arguments),this.ins=this.addInputs(o)}create(){super.create(),this.on("pointer",this.onPointer,this)}update(){const{size:e,segments:t}=this.ins;return(e.changed||t.changed)&&(this.geometry=new s.BoxBufferGeometry(e.value[0],e.value[1],e.value[2],t.value[0],t.value[1],t.value[2])),!0}onPointer(e){}}a.type="CBox",t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(20),n=r(3),o=r(14),a=r(109),l=new s.Vector3,c=(new s.Vector3,{position:n.types.Vector3("Transform.Position"),rotation:n.types.Vector3("Transform.Rotation"),scale:n.types.Scale3("Transform.Scale"),size:n.types.Number("Grid.Size",20),mainDivs:n.types.Number("Grid.Main.Divisions",2),mainColor:n.types.ColorRGB("Grid.Main.Color",[1,1,1]),subDivs:n.types.Number("Grid.Sub.Divisions",10),subColor:n.types.ColorRGB("Grid.Sub.Color",[.5,.5,.5])});class d extends o.default{constructor(){super(...arguments),this.ins=this.addInputs(c)}update(){let e=this.object3D;const{size:t,mainDivs:r,mainColor:n,subDivs:o,subColor:c}=this.ins;if(t.changed||r.changed||n.changed||o.changed||c.changed){const i={size:t.value,mainDivisions:r.value,mainColor:(new s.Color).fromArray(n.value),subDivisions:o.value,subColor:(new s.Color).fromArray(c.value)},l=this.object3D=new a.default(i);e&&(l.matrix.copy(e.matrix),l.matrixWorldNeedsUpdate=!0),e=l}const{position:d,rotation:u,scale:h}=this.ins;return(d.changed||u.changed||h.changed)&&(e.position.fromArray(d.value),l.fromArray(u.value).multiplyScalar(i.default.DEG2RAD),e.rotation.setFromVector3(l,"XYZ"),e.scale.fromArray(h.value),e.updateMatrix()),!0}}d.type="CGrid",t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(24),n=r(50),o={scene:s.types.Option("Scene",[]),camera:s.types.Option("Camera",[])};class a extends s.default{constructor(){super(...arguments),this.scenes=[],this.cameras=[],this.selectedScene=null,this.selectedCamera=null,this.ins=this.addInputs(o)}get sceneComponent(){return this.selectedScene}get cameraComponent(){return this.selectedCamera}get scene(){return this.selectedScene?this.selectedScene.scene:null}get camera(){return this.selectedCamera?this.selectedCamera.camera:null}create(){this.scenes=this.system.components.cloneArray(i.default),this.system.components.on(i.default,this.onSceneComponent,this),this.cameras=this.system.components.cloneArray(n.default),this.system.components.on(n.default,this.onCameraComponent,this),this.updateOptions()}update(){const e=this.ins;if(e.scene.changed){const t=e.scene.getValidatedValue();this.selectedScene=t>=0?this.scenes[t]:null}if(e.camera.changed){const t=e.camera.getValidatedValue();this.selectedCamera=t>=0?this.cameras[t]:null}return!0}dispose(){this.system.components.off(i.default,this.onSceneComponent,this),this.system.components.off(n.default,this.onCameraComponent,this)}onSceneComponent(e){const t=this.ins.scene;if(e.add)this.scenes.push(e.component),this.updateOptions();else{const r=this.scenes.indexOf(e.component);this.scenes.splice(r,1),this.updateOptions(),!t.hasInLinks()&&r<=t.value&&t.setValue(Math.max(0,t.value-1))}t.set()}onCameraComponent(e){const t=this.ins.camera;if(e.add)this.cameras.push(e.component),this.updateOptions();else{const r=this.cameras.indexOf(e.component);this.cameras.splice(r,1),this.updateOptions(),!t.hasInLinks()&&r<=t.value&&t.setValue(Math.max(0,t.value-1))}t.set()}updateOptions(){const{scene:e,camera:t}=this.ins;this.scenes.length>0?e.setOptions(this.scenes.map(e=>e.name||e.type)):e.setOptions(["N/A"]),this.cameras.length>0?t.setOptions(this.cameras.map(e=>e.name||e.type)):t.setOptions(["N/A"])}}a.type="CMain",t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(58),n=r(57),o=r(14);class a extends o.default{get mesh(){return this.object3D}create(){super.create(),this.object3D=new s.Mesh,this.object3D.visible=!1,this.geometryTracker=this.trackComponent(i.default,e=>{this.mesh.geometry=e.geometry,e.on("geometry",this.updateGeometry,this)},e=>{this.mesh.geometry=null,e.off("geometry",this.updateGeometry,this)}),this.materialTracker=this.trackComponent(n.default,e=>{this.mesh.material=e.material,e.on("material",this.updateMaterial,this)},e=>{this.mesh.material=null,e.off("material",this.updateMaterial,this)})}toString(){const e=this.mesh.geometry,t=this.mesh.material;return`${this.type} - Geometry: '${e?e.type:"N/A"}', Material: '${t?t.type:"N/A"}'`}updateGeometry(e){this.mesh.geometry=e,this.mesh.visible=!(!e||!this.mesh.material)}updateMaterial(e){this.mesh.material=e,this.mesh.visible=!(!this.mesh.geometry||!e)}}a.type="CMesh",t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(3),i=r(0),n=r(71),o=r(24),a={enabled:s.types.Boolean("Enabled",!0),orbit:s.types.Vector3("Orbit",[0,0,0]),offset:s.types.Vector3("Offset",[0,0,50]),minOrbit:s.types.Vector3("Min.Orbit",[-90,NaN,NaN]),minOffset:s.types.Vector3("Min.Offset",[NaN,NaN,.1]),maxOrbit:s.types.Vector3("Max.Orbit",[90,NaN,NaN]),maxOffset:s.types.Vector3("Max.Offset",[NaN,NaN,100])},l={orbit:s.types.Vector3("Orbit"),offset:s.types.Vector3("Offset"),size:s.types.Number("Size")};class c extends i.default{constructor(){super(...arguments),this.ins=this.addInputs(a),this.outs=this.addOutputs(l),this._manip=new n.default}create(){super.create(),this._manip.cameraMode=!0,this.system.on(["pointer-down","pointer-up","pointer-move"],this.onPointer,this),this.system.on("wheel",this.onTrigger,this),this.trackComponent(o.default,e=>{e.on("active-camera",this.onActiveCamera,this)},e=>{e.off("active-camera",this.onActiveCamera,this)})}dispose(){super.dispose(),this.system.off(["pointer-down","pointer-up","pointer-move"],this.onPointer,this),this.system.off("wheel",this.onTrigger,this)}update(){const e=this._manip,t=this.ins,{minOrbit:r,minOffset:s,maxOrbit:i,maxOffset:n}=t;return(r.changed||s.changed||i.changed||n.changed)&&(e.minOrbit.fromArray(r.value),e.minOffset.fromArray(s.value),e.maxOrbit.fromArray(i.value),e.maxOffset.fromArray(n.value)),t.orbit.changed&&e.orbit.fromArray(t.orbit.value),t.offset.changed&&e.offset.fromArray(t.offset.value),!0}tick(){const e=this._manip,{enabled:t}=this.ins,{orbit:r,offset:s,size:i}=this.outs;if(t.value){e.update(),e.orbit.toArray(r.value),r.set(),e.offset.toArray(s.value),s.set(),i.setValue(e.size);const t=this._activeCameraComponent;if(t){const e=t.transform;return e?this._manip.toObject(e.object3D):this._manip.toObject(t.object3D),t.camera.isOrthographicCamera&&(t.camera.size=this._manip.size),!0}}return!1}onPointer(e){if(this.ins.enabled.value&&this._activeCameraComponent){const t=e.viewport;this._manip.setViewportSize(t.width,t.height),this._manip.onPointer(e),e.stopPropagation=!0}}onTrigger(e){if(this.ins.enabled.value&&this._activeCameraComponent){const t=e.viewport;this._manip.setViewportSize(t.width,t.height),this._manip.onTrigger(e),e.stopPropagation=!0}}onActiveCamera(e){this._activeCameraComponent=e.next}}c.type="COrbitManipulator",t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(3),n=r(57),o={color:i.types.ColorRGB("Color")};class a extends n.default{constructor(){super(...arguments),this.ins=this.addInputs(o)}create(){this.material=new s.MeshPhongMaterial}update(){const e=this.material,{color:t}=this.ins;return e.color.setRGB(t.value[0],t.value[1],t.value[2]),!0}}a.type="CPhongMaterial",t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(3),n=r(58),o={radius:i.types.Number("Radius",10),tube:i.types.Number("Tube",3),angle:i.types.Number("Angle",360),segments:i.types.Vector2("Segments",[24,12])};class a extends n.default{constructor(){super(...arguments),this.ins=this.addInputs(o)}update(){const{radius:e,tube:t,angle:r,segments:i}=this.ins;return this.geometry=new s.TorusBufferGeometry(e.value,t.value,i.value[0],i.value[1],r.value),!0}}a.type="CTorus",t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(38);t.CVLoaders=s.default;const i=r(26);t.CVModel=i.default;const n=r(25);t.CVScene=n.default;const o=r(40);t.CVOrbitNavigation=o.default,t.componentTypes=[s.default,i.default,n.default,o.default]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(54);t.CVAnnotations=s.default;const i=r(110);t.CVBackground=i.default;const n=r(75);t.CVDocuments=n.default;const o=r(111);t.CVGroundPlane=o.default;const a=r(108);t.CVHomeGrid=a.default;const l=r(30);t.CVInterface=l.default;const c=r(72);t.CVItemData=c.default;const d=r(73);t.CVMeta=d.default;const u=r(76);t.CVPresentation=u.default;const h=r(22);t.CVPresentationController=h.default;const p=r(99);t.CVPresentationData=p.default;const f=r(74);t.CVProcess=f.default;const m=r(52);t.CVReader=m.default;const v=r(115);t.CVReference=v.default;const y=r(113);t.CVSectionTool=y.default;const g=r(215);t.CVSnapshots=g.default;const b=r(112);t.CVTapeTool=b.default;const E=r(217);t.CVTours=E.default,t.componentTypes=[s.default,i.default,n.default,o.default,a.default,l.default,c.default,d.default,u.default,h.default,p.default,f.default,m.default,v.default,y.default,g.default,b.default,E.default]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(216),i=r(116);class n extends i.default{addSnapshot(e){const t=this.insert(e);return this.emit("changed"),t}removeSnapshot(e){const t=this.remove(e);return this.emit("changed"),t}fromData(e){return e.map(e=>this.addSnapshot({title:e.title||"",description:e.description||"",properties:e.properties}))}toData(){const e=this.getArray(),t={data:[],ids:{}};return e.forEach((e,r)=>{t.ids[e.id]=r;const i={properties:s.default(e.properties)};e.title&&(i.title=e.title),e.description&&(i.description=e.description),t.data.push(i)}),t}}n.type="CVSnapshots",t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t){if(null===t||"object"!=typeof t)return t;let r;if(Array.isArray(t)){r=[];for(let s=0,i=t.length;s<i;++s)r[s]=e(t[s]);return r}if(void 0!==t.BYTES_PER_ELEMENT)return t.slice();if(t instanceof Date)return new Date(t);if(t.constructor===Object){r={};for(let s in t)t.hasOwnProperty(s)&&(r[s]=e(t[s]));return r}return t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(116);class i extends s.default{constructor(){super(...arguments),this.rootCollection=null}create(){this.rootCollection=this.findRootCollection()}addTour(e){this.insert(e),this.rootCollection&&this.rootCollection.addTour(e),this.emit("changed")}removeTour(e){const t=this.remove(e);return this.rootCollection&&this.rootCollection.removeTour(e),this.emit("changed"),t}fromData(e,t){e.forEach(e=>{this.addTour({title:e.title,description:e.description||"",steps:e.steps.map(e=>({snapshotId:t[e.snapshot],transitionTime:e.transitionTime,transitionCurve:e.transitionCurve,transitionCutPoint:e.transitionCutPoint}))})})}toData(e){return this.getArray().map(t=>{const r={title:t.title,steps:t.steps.map(t=>({snapshot:e[t.snapshotId],transitionTime:t.transitionTime,transitionCurve:t.transitionCurve,transitionCutPoint:t.transitionCutPoint}))};return t.description&&(r.description=t.description),r})}}i.type="CVTours",t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(97);t.NHierarchy=s.default,t.nodeTypes=[s.default]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(101);t.NCamera=s.default;const i=r(102);t.NDirectionalLight=i.default;const n=r(104);t.NPointLight=n.default;const o=r(100);t.NScene=o.default;const a=r(106);t.NSpotLight=a.default;const l=r(23);t.NTransform=l.default,t.nodeTypes=[s.default,i.default,n.default,o.default,a.default,l.default]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(27);t.NVItem=s.default;const i=r(56);t.NVPresentationConfig=i.default;const n=r(77);t.NVPresentationScene=n.default;const o=r(114);t.NVReference=o.default,t.nodeTypes=[s.default,i.default,n.default,o.default]},function(e,t,r){"use strict";r.r(t),r.d(t,"repeat",function(){return u});var s=r(5);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const i=(e,t)=>{const r=e.startNode.parentNode,i=void 0===t?e.endNode:t.startNode,n=r.insertBefore(Object(s.createMarker)(),i);r.insertBefore(Object(s.createMarker)(),i);const o=new s.NodePart(e.options);return o.insertAfterNode(n),o},n=(e,t)=>(e.setValue(t),e.commit(),e),o=(e,t,r)=>{const i=e.startNode.parentNode,n=r?r.startNode:e.endNode,o=t.endNode.nextSibling;o!==n&&Object(s.reparentNodes)(i,t.startNode,o,n)},a=e=>{Object(s.removeNodes)(e.startNode.parentNode,e.startNode,e.endNode.nextSibling)},l=(e,t,r)=>{const s=new Map;for(let i=t;i<=r;i++)s.set(e[i],i);return s},c=new WeakMap,d=new WeakMap,u=Object(s.directive)((e,t,r)=>{let u;return void 0===r?r=t:void 0!==t&&(u=t),t=>{if(!(t instanceof s.NodePart))throw new Error("repeat can only be used in text bindings");const h=c.get(t)||[],p=d.get(t)||[],f=[],m=[],v=[];let y,g,b=0;for(const t of e)v[b]=u?u(t,b):b,m[b]=r(t,b),b++;let E=0,_=h.length-1,P=0,w=m.length-1;for(;E<=_&&P<=w;)if(null===h[E])E++;else if(null===h[_])_--;else if(p[E]===v[P])f[P]=n(h[E],m[P]),E++,P++;else if(p[_]===v[w])f[w]=n(h[_],m[w]),_--,w--;else if(p[E]===v[w])f[w]=n(h[E],m[w]),o(t,h[E],f[w+1]),E++,w--;else if(p[_]===v[P])f[P]=n(h[_],m[P]),o(t,h[_],h[E]),_--,P++;else if(void 0===y&&(y=l(v,P,w),g=l(p,E,_)),y.has(p[E]))if(y.has(p[_])){const e=g.get(v[P]),r=void 0!==e?h[e]:null;if(null===r){const e=i(t,h[E]);n(e,m[P]),f[P]=e}else f[P]=n(r,m[P]),o(t,r,h[E]),h[e]=null;P++}else a(h[_]),_--;else a(h[E]),E++;for(;P<=w;){const e=i(t,f[w+1]);n(e,m[P]),f[P++]=e}for(;E<=_;){const e=h[E++];null!==e&&a(e)}c.set(t,f),d.set(t,v)}})},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(223),n=r(118),o=r(230),a=r(1);let l=class extends a.default{constructor(e){super(),this.view=null,this.canvas=null,this.overlay=null,this.splitter=null,this.onResize=this.onResize.bind(this),this.system=e,this.manipTarget=new i.default,this.addEventListener("pointerdown",this.manipTarget.onPointerDown),this.addEventListener("pointermove",this.manipTarget.onPointerMove),this.addEventListener("pointerup",this.manipTarget.onPointerUpOrCancel),this.addEventListener("pointercancel",this.manipTarget.onPointerUpOrCancel),this.addEventListener("wheel",this.manipTarget.onWheel),this.addEventListener("contextmenu",this.manipTarget.onContextMenu)}firstConnected(){this.setStyle({position:"absolute",top:"0",bottom:"0",left:"0",right:"0"}),this.canvas=this.createElement("canvas",{display:"block",width:"100%",height:"100%"},this),this.overlay=this.createElement("div",{position:"absolute",top:"0",bottom:"0",left:"0",right:"0",overflow:"hidden"},this),this.splitter=this.createElement(o.default,{position:"absolute",top:"0",bottom:"0",left:"0",right:"0",overflow:"hidden"},this),this.splitter.onChange=(e=>{this.view.horizontalSplit=e.horizontalSplit,this.view.verticalSplit=e.verticalSplit}),this.view=new n.default(this.system,this.canvas,this.overlay),this.view.on("layout",e=>this.splitter.layout=e.layout),this.view.layout=o.EQuadViewLayout.Single,this.splitter.layout=o.EQuadViewLayout.Single,this.manipTarget.next=this.view}connected(){this.view.attach(),window.addEventListener("resize",this.onResize),window.dispatchEvent(new CustomEvent("resize"))}disconnected(){this.view.detach(),window.removeEventListener("resize",this.onResize)}onResize(){this.view.resize()}};s([a.property({attribute:!1})],l.prototype,"system",void 0),l=s([a.customElement("sv-content-view")],l),t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUpOrCancel=this.onPointerUpOrCancel.bind(this),this.onDoubleClick=this.onDoubleClick.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),this.next=null,this.activePositions=[],this.activeType="",this.centerX=0,this.centerY=0}onPointerDown(e){if(this.activeType&&e.pointerType!==this.activeType)return;this.activeType=e.pointerType,this.activePositions.push({id:e.pointerId,clientX:e.clientX,clientY:e.clientY}),e.currentTarget.setPointerCapture(e.pointerId);const t=this.createManipPointerEvent(e,"pointer-down");this.sendPointerEvent(t)&&e.stopPropagation(),e.preventDefault()}onPointerMove(e){const t=this.activePositions;for(let r=0,s=t.length;r<s;++r){const s=t[r];e.pointerId===s.id&&(s.clientX=e.clientX,s.clientY=e.clientY)}const r=t.length?"pointer-move":"pointer-hover",s=this.createManipPointerEvent(e,r);this.sendPointerEvent(s)&&e.stopPropagation(),e.preventDefault()}onPointerUpOrCancel(e){const t=this.activePositions;let r=!1;for(let s=0,i=t.length;s<i;++s)if(e.pointerId===t[s].id){t.splice(s,1),r=!0;break}if(!r)return;const s=this.createManipPointerEvent(e,"pointer-up");0===t.length&&(this.activeType=""),this.sendPointerEvent(s)&&e.stopPropagation(),e.preventDefault()}onDoubleClick(e){this.sendTriggerEvent(this.createManipTriggerEvent(e,"double-click"))&&e.preventDefault()}onContextMenu(e){this.sendTriggerEvent(this.createManipTriggerEvent(e,"context-menu")),e.preventDefault()}onWheel(e){this.sendTriggerEvent(this.createManipTriggerEvent(e,"wheel"))&&e.preventDefault()}createManipPointerEvent(e,t){let r=0,s=0,i=0,n=0,o=0,a=0;const l=this.activePositions,c=l.length;if(c>0){for(let e=0;e<c;++e)r+=l[e].clientX,s+=l[e].clientY;r/=c,s/=c,"pointer-move"!==t&&"pointer-hover"!==t||(o=r-this.centerX,a=s-this.centerY),this.centerX=r,this.centerY=s}else r=this.centerX,s=this.centerY;const d=e.currentTarget;if(d instanceof Element){const t=d.getBoundingClientRect();i=e.clientX-t.left,n=e.clientY-t.top}return{originalEvent:e,type:t,source:e.pointerType,isPrimary:e.isPrimary,activePositions:l,pointerCount:c,centerX:r,centerY:s,localX:i,localY:n,movementX:o,movementY:a,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey}}createManipTriggerEvent(e,t){let r=0;"wheel"===t&&(r=e.deltaY);let s=0,i=0;const n=e.currentTarget;if(n instanceof Element){const t=n.getBoundingClientRect();s=e.clientX-t.left,i=e.clientY-t.top}return{originalEvent:e,type:t,wheel:r,centerX:e.clientX,centerY:e.clientY,localX:s,localY:i,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey}}sendPointerEvent(e){return this.next&&this.next.onPointer(e)}sendTriggerEvent(e){return this.next&&this.next.onTrigger(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(10),n=r(225),o=r(229);t.Viewport=o.default;const a=r(13);t.default=class extends i.default{constructor(e,t,r){super(),this.viewports=[],this.rendererComponent=null,this.activeViewport=null,this.activeObject3D=null,this.activeComponent=null,this.shouldResize=!1,this.system=e,this.canvas=t,this.overlay=r,this.renderer=new s.WebGLRenderer({canvas:t,antialias:!0}),this.renderer.autoClear=!1,this.renderer.setClearColor("#0090c0"),this.picker=new n.default(this.renderer)}dispose(){this.renderer.dispose()}get canvasWidth(){return this.canvas.width}get canvasHeight(){return this.canvas.height}attach(){const e=this.canvasWidth,t=this.canvasHeight;this.viewports.forEach(r=>r.setCanvasSize(e,t)),this.renderer.setSize(e,t,!1),this.rendererComponent=this.system.components.safeGet(a.default),this.rendererComponent.attachView(this)}detach(){this.rendererComponent=this.system.components.safeGet(a.default),this.rendererComponent.detachView(this),this.rendererComponent=null}renderImage(e,t,r,s){console.log("RenderView.renderImage - width: %s, height: %s, format: %s, quality: %s",e,t,r,s);const i=this.canvas.width,n=this.canvas.height;this.setRenderSize(e,t),this.render();const o=this.canvas.toDataURL(r,s);return this.setRenderSize(i,n),o}render(){const e=this.rendererComponent.activeSceneComponent;if(!e)return;const t=e.scene,r=e.activeCamera;if(!t||!r)return;const s=this.renderer;this.shouldResize&&(this.shouldResize=!1,this.setRenderSize(this.canvas.clientWidth,this.canvas.clientHeight)),s.clear(),s.__view=this;const i=this.viewports;for(let e=0,n=i.length;e<n;++e){const n=i[e];if(n.enabled){s.__viewport=n;const e=n.updateCamera(r);n.applyViewport(this.renderer),s.render(t,e)}}}setRenderSize(e,t){this.canvas.width=e,this.canvas.height=t,this.viewports.forEach(r=>r.setCanvasSize(e,t)),this.renderer.setSize(e,t,!1)}resize(){this.shouldResize=!0}addViewport(){const e=new o.default;return this.viewports.push(e),e}addViewports(e){for(let t=0;t<e;++t)this.viewports.push(new o.default)}removeViewport(e){const t=this.viewports.indexOf(e);if(t<0)throw new Error("viewport not found");this.viewports.slice(t,1)}enableViewport(e,t){this.viewports[e].enabled=t}getViewportCount(){return this.viewports.length}onPointer(e){if(!this.system)return!1;let t=!1,r=!1;"pointer-hover"===e.type?r=!0:e.isPrimary&&"pointer-down"===e.type&&(r=!0,t=!0);const s=this.routeEvent(e,r,t);return!!s&&(s.component?s.component.propagateUp(s):this.system.emit(s),s.stopPropagation||s.viewport.onPointer(s),!0)}onTrigger(e){if(!this.system)return!1;const t=this.routeEvent(e,!0,!0);return!!t&&(t.component?t.component.propagateUp(t):this.system.emit(t),t.stopPropagation||t.viewport.onTrigger(t),!0)}routeEvent(e,t,r){let s=this.activeViewport,i=this.activeObject3D,n=this.activeComponent;if(t){s=null;const t=this.viewports;for(let r=0,i=t.length;r<i;++r){const i=t[r];if(i.enabled&&i.isPointInside(e.localX,e.localY)){s=i;break}}}if(!s)return null;const o=e;if(o.view=this,o.viewport=s,o.deviceX=s.getDeviceX(e.localX),o.deviceY=s.getDeviceY(e.localY),o.stopPropagation=!1,r){const t=this.rendererComponent.activeSceneComponent,r=t&&t.scene,s=t&&t.activeCamera;if(i=null,n=null,r&&s){let t=this.picker.pickObject(r,s,e);if(void 0===t)console.log("Pick Index - Background");else{for(;t&&!n;)(n=t.userData.component)||(t=t.parent);n?console.log("Pick Index - Component: %s",n.type):console.warn("Pick Index - Object without component")}}}return o.object3D=i,o.component=n,this.activeViewport=s,this.activeObject3D=i,this.activeComponent=n,o}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(226),n=r(227),o=r(228),a=new s.Vector3;t.default=class{constructor(e){this.renderer=e,this.pickTextures=[];for(let e=0;e<3;++e)this.pickTextures[e]=new s.WebGLRenderTarget(1,1,{stencilBuffer:!1});this.pickBuffer=new Uint8Array(4),this.indexShader=new i.default,this.positionShader=new n.default,this.normalShader=new o.default}pickObject(e,t,r){const s=this.pickIndex(e,t,r);if(s>0)return e.getObjectById(s)}pickIndex(e,t,r){const s=r.viewport;t=s.updateCamera(t);const i=e.overrideMaterial;e.overrideMaterial=this.indexShader;const n=this.renderer,o=this.pickTextures[0],a=n.getClearColor().clone();n.setClearColor(0),s.applyPickViewport(o,r),n.render(e,t,o,!0),n.setRenderTarget(),n.setClearColor(a),e.overrideMaterial=i;const l=this.pickBuffer;return n.readRenderTargetPixels(o,0,0,1,1,l),l[0]+256*l[1]+65536*l[2]}pickPosition(e,t,r,i){const n=i.viewport;t=n.updateCamera(t);const o=e.overrideMaterial,l=e.overrideMaterial=this.positionShader,c=this.renderer,d=this.pickTextures,u=c.getClearColor().clone();c.setClearColor(0);for(let s=0;s<3;++s)l.uniforms.index.value=s,l.uniforms.range.value[0]=r.min.getComponent(s),l.uniforms.range.value[1]=r.max.getComponent(s),n.applyPickViewport(d[s],i),c.render(e,t,d[s],!0);c.setRenderTarget(),c.setClearColor(u),e.overrideMaterial=o;const h=this.pickBuffer,p=new s.Vector3;for(let e=0;e<3;++e)c.readRenderTargetPixels(d[e],0,0,1,1,h),p[e]=h[0]/255+h[1]/255/256+h[2]/255/65536+h[3]/255/16777216;return r.getSize(a),p.multiply(a).add(r.min)}pickNormal(e,t,r){const i=r.viewport;t=i.updateCamera(t);const n=e.overrideMaterial;e.overrideMaterial=this.normalShader;const o=this.renderer,a=this.pickTextures[0],l=o.getClearColor().clone();o.setClearColor(0),i.applyPickViewport(a,r),o.render(e,t,a,!0),o.setRenderTarget(),o.setClearColor(l),e.overrideMaterial=n;const c=this.pickBuffer;return o.readRenderTargetPixels(a,0,0,1,1,c),new s.Vector3(c[0]/255*2-1,c[1]/255*2-1,c[2]/255*2-1).normalize()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2);t.default=class extends s.ShaderMaterial{constructor(){super(...arguments),this.isIndexShader=!0,this.uniformsNeedUpdate=!1,this.lights=!1,this.uniforms={index:{value:[0,0,0]}},this.vertexShader=["void main() {","  #include <begin_vertex>","  #include <project_vertex>","}"].join("\n"),this.fragmentShader=["uniform vec3 index;","void main() {","  gl_FragColor = vec4(index, 1.0);","}"].join("\n")}static indexFromPixel(e){return e[0]+e[1]<<8+e[2]<<16}static zoneFromPixel(e){return e[3]}setIndex(e){const t=e>>16,r=(e>>8)-(t<<8),s=e-(t<<16)-(r<<8),i=this.uniforms.index.value;i[0]=s/255,i[1]=r/255,i[2]=t/255,this.uniformsNeedUpdate=!0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2);t.default=class extends s.ShaderMaterial{constructor(){super(...arguments),this.isPositionShader=!0,this.uniforms={index:{value:0},range:{value:[-1,1]}},this.vertexShader=["varying vec3 vLocalPosition;","void main() {","  #include <begin_vertex>","  #include <project_vertex>","  vLocalPosition = vec3(position);","}"].join("\n"),this.fragmentShader=["uniform float index;","uniform float range;","varying vec3 vLocalPosition;","vec4 toVec4(float v) {","  float vn = (v - range.x) / (range.y - range.x);","  float b0 = floor(vn * 255.0) / 255.0; vn = (vn - b0) * 256.0;","  float b1 = floor(vn * 255.0) / 255.0; vn = (vn - b1) * 256.0;","  float b2 = floor(vn * 255.0) / 255.0; vn = (vn - b2) * 256.0;","  float b3 = floor(vn * 255.0) / 255.0;","  return vec4(clamp(b0, 0.0, 1.0), clamp(b1, 0.0, 1.0), clamp(b2, 0.0, 1.0), clamp(b3, 0.0, 1.0));","}","void main() {","  gl_FragColor = (index == 0.0 ? toVec4(vLocalPosition.x)","    : (index == 1.0 ? toVec4(vLocalPosition.y) : toVec4(vLocalPosition.z)));","  }"].join("\n")}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2);t.default=class extends s.ShaderMaterial{constructor(){super(...arguments),this.isNormalShader=!0,this.uniforms={index:{value:0}},this.vertexShader=["varying vec3 vLocalNormal;","void main() {","  #include <beginnormal_vertex>","  #include <begin_vertex>","  #include <project_vertex>","  vLocalNormal = vec3(normal);","}"].join("\n"),this.fragmentShader=["uniform vec3 index;","varying vec3 vLocalNormal;","void main() {","  vec3 normal = normalize(vLocalNormal);","  gl_FragColor = vec4(normal * 0.5 + 0.5, 1.0);","}"].join("\n")}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(49),n=r(71);t.default=class{constructor(e,t,r,s){this.next=null,this.enabled=!0,this.next=null,this._relRect={left:e||0,top:t||0,width:r||1,height:s||1},this._absRect={left:0,top:0,width:1,height:1},this._canvasWidth=1,this._canvasHeight=1,this._sceneCamera=null,this._vpCamera=null,this._manip=null}get left(){return this._absRect.left}get top(){return this._absRect.top}get width(){return this._absRect.width}get height(){return this._absRect.height}get canvasWidth(){return this._canvasWidth}get canvasHeight(){return this._canvasHeight}get camera(){return this._vpCamera||this._sceneCamera}get sceneCamera(){return this._sceneCamera}get viewportCamera(){return this._vpCamera}get manip(){return this._manip}setSize(e,t,r,s){const i=this._relRect;i.left=e,i.top=t,i.width=r,i.height=s,this.updateViewport()}setCanvasSize(e,t){this._canvasWidth=e,this._canvasHeight=t,this.updateViewport(),this._manip&&this._manip.setViewportSize(e,t)}setBuiltInCamera(e,t){this._vpCamera?this._vpCamera.setProjection(e):(this._vpCamera=new i.default(e),this._vpCamera.matrixAutoUpdate=!1),void 0!==t&&this._vpCamera.setPreset(t)}unsetBuiltInCamera(){this._vpCamera=null}enableCameraManip(e){return!e&&this._manip?this._manip=null:e&&this._vpCamera&&(this._manip||(this._manip=new n.default,this._manip.setViewportSize(this.width,this.height),this._manip.setFromCamera(this._vpCamera))),this._manip}moveCameraToView(e){const t=this.viewportCamera,r=this._manip;t&&(t.moveToView(e),r&&r.setFromCamera(t,!0))}isPointInside(e,t){const r=this._absRect;return e>=r.left&&e<r.left+r.width&&t>=r.top&&t<r.top+r.height}getDevicePoint(e,t,r){const i=this._absRect,n=(e-i.left)/i.width*2-1,o=1-(t-i.top)/i.height*2;return r?r.set(n,o):new s.Vector2(n,o)}getDeviceX(e){const t=this._absRect;return(e-t.left)/t.width*2-1}getDeviceY(e){const t=this._absRect;return 1-(e-t.top)/t.height*2}updateCamera(e){let t=e;if(this._vpCamera&&(t=this._vpCamera,this._manip&&(this._manip.update(),this._manip.toCamera(t))),!t)return;const r=this._absRect,s=r.width/r.height;if(s!==t.userData.aspect)if(t.userData.aspect=s,t.isUniversalCamera||t.isPerspectiveCamera)t.aspect=s,t.updateProjectionMatrix();else if(t.isOrthographicCamera){const e=.5*(t.top-t.bottom);t.left=-e*s,t.right=e*s,t.updateProjectionMatrix()}return t}applyViewport(e){const t=this._absRect;e.setViewport(t.left,t.top,t.width,t.height),e.viewport=this}applyPickViewport(e,t){const r=this._absRect,s=t.localX-r.left,i=t.localY-r.top;e.viewport.set(-s,-r.height+i,r.width,r.height)}toViewportEvent(e){const t=e;return t.viewport=this,t.deviceX=this.getDeviceX(e.localX),t.deviceY=this.getDeviceY(e.localY),t}isInside(e){return this.enabled&&this.isPointInside(e.localX,e.localY)}onPointer(e){return!(!this.enabled||!this._manip)&&this._manip.onPointer(e)}onTrigger(e){return!(!this.enabled||!this._manip)&&this._manip.onTrigger(e)}updateViewport(){const e=this._relRect,t=this._absRect,r=this._canvasWidth,s=this._canvasHeight;t.left=Math.round(e.left*r),t.top=Math.round(e.top*s),t.width=Math.round(e.width*r),t.height=Math.round(e.height*s)}}},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0}),r(31);const i=r(1);var n;!function(e){e[e.Single=0]="Single",e[e.HorizontalSplit=1]="HorizontalSplit",e[e.VerticalSplit=2]="VerticalSplit",e[e.Quad=3]="Quad"}(n=t.EQuadViewLayout||(t.EQuadViewLayout={}));let o=class extends i.default{constructor(){super(...arguments),this.layout=n.Single,this.horizontalPosition=.5,this.verticalPosition=.5}render(){const e=this.layout;if(e===n.Single)return i.html``;const t=[];return e!==n.HorizontalSplit&&e!==n.Quad||t.push(i.html`
                <div class="ff-horizontal" style="position:absolute; top:0; bottom:0; left:0; right:0; display:flex;">
                    <div class="ff-left" style="flex:1 1;"></div>
                    <ff-splitter direction="horizontal" position=${this.horizontalPosition} @ff-splitter-change=${this.onSplitterChange}></ff-splitter>
                    <div style="flex:1 1;"></div>
                </div>
            `),e!==n.VerticalSplit&&e!==n.Quad||t.push(i.html`
                <div class="ff-vertical" style="position:absolute; top:0; bottom:0; left:0; right:0; display:flex; flex-direction: column">
                    <div class="ff-top" style="flex:1 1;"></div>
                    <ff-splitter direction="vertical" position=${this.verticalPosition} @ff-splitter-change=${this.onSplitterChange}></ff-splitter>
                    <div style="flex:1 1;"></div>
                </div>
            `),i.html`${t}`}onSplitterChange(e){"horizontal"===e.detail.direction?this.horizontalPosition=e.detail.position:this.verticalPosition=e.detail.position,this.onChange&&this.onChange({layout:this.layout,horizontalSplit:this.horizontalPosition,verticalSplit:this.verticalPosition,isDragging:e.detail.isDragging})}};s([i.property({attribute:!1})],o.prototype,"layout",void 0),s([i.property({attribute:!1})],o.prototype,"horizontalPosition",void 0),s([i.property({attribute:!1})],o.prototype,"verticalPosition",void 0),o=s([i.customElement("ff-quad-splitter")],o),t.default=o},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0}),r(232),r(233);const i=r(30),n=r(234),o=r(236),a=r(1);let l=class extends a.default{constructor(e){super(),this.system=e,this.interface=e.components.safeGet(i.default)}firstConnected(){this.style.pointerEvents="none",this.setAttribute("pointer-events","none")}connected(){const{visible:e,logo:t}=this.interface.ins;e.on("value",this.onInterfaceUpdate,this),t.on("value",this.onInterfaceUpdate,this)}disconnected(){const{visible:e,logo:t}=this.interface.ins;e.off("value",this.onInterfaceUpdate,this),t.off("value",this.onInterfaceUpdate,this)}render(){const{visible:e,logo:t}=this.interface.ins,r=e.value,s=t.value;if(!r)return a.html``;const i=new n.default(this.system);i.portal=this;const l=new o.default(this.system);return l.portal=this,a.html`
            <div class="sv-main-menu">
                <ff-button-group mode="exclusive">
                    <ff-popup-button class="ff-menu-button" icon="eye" .content=${i}>
                    </ff-popup-button>
                    <ff-popup-button class="ff-menu-button" icon="palette" .content=${l}>
                    </ff-popup-button>
                </ff-button-group>
                <ff-button class="ff-menu-button" icon="comment" selectable>
                </ff-button>
                <ff-button class="ff-menu-button" icon="document" selectable>
                </ff-button>
            </div>
            ${s?a.html`
                <div class="sv-logo">
                    <img src="images/si-dpo3d-logo-neg.svg" alt="Smithsonian DPO 3D Logo">
                </div>
            `:null}
        `}onInterfaceUpdate(){this.requestUpdate()}};s([a.property({attribute:!1})],l.prototype,"system",void 0),l=s([a.customElement("sv-chrome-view")],l),t.default=l},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1),n=r(11);let o=class extends i.default{constructor(){super(),this.mode="radio",this.selectionIndex=-1,this.observer=new MutationObserver(this.onObserver),this.selectedButton=null,this.addEventListener("click",e=>this.onClick(e))}connected(){this.observer.observe(this,{childList:!0})}disconnected(){this.observer.disconnect()}firstUpdate(){this.parseChildren()}onObserver(e){e.forEach(e=>{"childList"===e.type&&this.parseChildren()})}onClick(e){let t=e.target;for(;t&&t!==this&&!(t instanceof n.default);)t=t.parentElement;t instanceof n.default&&(t.selected?"exclusive"===this.mode&&(t.selected=!1,this.selectedButton=null,this.selectionIndex=-1):(this.selectedButton&&(this.selectedButton.selected=!1),this.selectedButton=t,this.selectedButton.selected=!0,this.selectionIndex=this.getButtons().indexOf(t)))}parseChildren(){const e=this.getButtons();this.selectedButton&&(this.selectionIndex=e.indexOf(this.selectedButton),this.selectionIndex<0&&(this.selectedButton.selected=!1,this.selectedButton=null)),(this.selectionIndex<0||this.selectionIndex>=e.length)&&(this.selectionIndex="radio"===this.mode?0:-1),this.selectionIndex>=0&&(this.selectedButton=e[this.selectionIndex],this.selectedButton.selected=!0)}getButtons(){return this.getChildrenArray().filter(e=>e instanceof n.default)}};s([i.property({type:String})],o.prototype,"mode",void 0),s([i.property({type:Number})],o.prototype,"selectionIndex",void 0),o=s([i.customElement("ff-button-group")],o),t.default=o},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(11),n=r(59),o=r(1);let a=class extends i.default{constructor(){super(),this.content=null,this.contentParent=this,this.transient=!1,this.addEventListener(n.default.closeEvent,()=>this.selected=!1),this.onPointerDown=this.onPointerDown.bind(this),this.onKeyDown=this.onKeyDown.bind(this)}connected(){document.addEventListener("pointerdown",this.onPointerDown,{capture:!0,passive:!0}),document.addEventListener("keydown",this.onKeyDown,{capture:!0,passive:!0})}disconnected(){document.removeEventListener("pointerdown",this.onPointerDown),document.removeEventListener("keydown",this.onKeyDown)}update(e){super.update(e);const t=this.content;if(t&&e.has("selected")){const e=this.contentParent||this;if(this.selected)e.appendChild(t),setTimeout(()=>t.style.opacity="1.0",0);else if(t.parentElement===e){this.focus(),t.style.opacity="0";const r=parseFloat(window.getComputedStyle(t).transitionDuration)||0;setTimeout(()=>e.removeChild(t),1e3*r)}}}onPointerDown(e){e.target instanceof Node&&!this.contains(e.target)&&(this.selected=!1)}onKeyDown(e){"Escape"===e.key&&(this.selected=!1)}};s([o.property({attribute:!1})],a.prototype,"content",void 0),s([o.property({attribute:!1})],a.prototype,"contentParent",void 0),s([o.property({type:Boolean})],a.prototype,"transient",void 0),a=s([o.customElement("ff-popup-button")],a),t.default=a},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(119);r(235),r(11);const n=r(40),o=r(1),a=r(59);let l=class extends a.default{constructor(e){super(),this.system=e,this.viewPreset=n.EViewPreset.None,this.propProjection=new i.default(this.onPropertyChange,this),this.propPreset=new i.default(this.onPropertyChange,this),this.position="anchor",this.align="center",this.justify="end",this.offsetX=8,this.offsetY=8,this.keepVisible=!0}connected(){super.connected(),this.propProjection.property=this.system.components.get(n.default).ins.projection,this.propPreset.property=this.system.components.get(n.default).ins.preset,this.requestUpdate()}disconnected(){super.disconnected(),this.propProjection.detach(),this.propPreset.detach()}render(){const e=this.propProjection.getValue(),t=this.propPreset.getValue();return o.html`
            <label>Projection</label>
            <div class="ff-flex-row" @click=${this.onClickProjectionType}>
                <ff-button .index=${n.EProjection.Perspective} .selectedIndex=${e}
                  text="Perspective" title="Perspective Projection" icon="video"></ff-button>    
                <ff-button .index=${n.EProjection.Orthographic} .selectedIndex=${e}
                  text="Orthographic" title="Orthographic Projection" icon="video"></ff-button>    
            </div>
            <label>View</label>
            <ff-grid class="sv-cube" justifyContent="center" @click=${this.onClickViewPreset}>
                <ff-button .index=${n.EViewPreset.Top} .selectedIndex=${t}
                  text="T" title="Top View" style="grid-column-start: 2; grid-row-start: 1;"></ff-button>
                <ff-button .index=${n.EViewPreset.Left} .selectedIndex=${t}
                  text="L" title="Left View" style="grid-column-start: 1; grid-row-start: 2;"></ff-button>
                <ff-button .index=${n.EViewPreset.Front} .selectedIndex=${t}
                  text="F" title="Front View" style="grid-column-start: 2; grid-row-start: 2;"></ff-button>
                <ff-button .index=${n.EViewPreset.Right} .selectedIndex=${t}
                  text="R" title="Right View" style="grid-column-start: 3; grid-row-start: 2;"></ff-button>
                <ff-button .index=${n.EViewPreset.Back} .selectedIndex=${t}
                  text="B" title="Back View" style="grid-column-start: 4; grid-row-start: 2;"></ff-button>
                <ff-button .index=${n.EViewPreset.Bottom} .selectedIndex=${t}
                  text="B" title="Bottom View" style="grid-column-start: 2; grid-row-start: 3;"></ff-button>
            </ff-grid>
        `}firstUpdated(){super.firstUpdated(),this.setStyle({display:"flex",flexDirection:"column"}),this.classList.add("sv-popup-menu")}onClickProjectionType(e){this.propProjection.setValue(e.target.index),e.stopPropagation()}onClickViewPreset(e){this.propPreset.setValue(e.target.index),e.stopPropagation()}onPropertyChange(){this.requestUpdate()}};s([o.property({attribute:!1})],l.prototype,"system",void 0),l=s([o.customElement("sv-view-menu")],l),t.default=l},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1);let n=class extends i.default{constructor(){super(...arguments),this.position=void 0,this.columns=void 0,this.rows=void 0,this.autoColumns=void 0,this.autoRows=void 0,this.columnGap=void 0,this.rowGap=void 0,this.justifyItems=void 0,this.alignItems=void 0,this.justifyContent=void 0,this.alignContent=void 0}update(e){const t=this.style;if(e.has("position")&&this.position)switch(this.position){case"fill":t.position="absolute",t.top="0",t.right="0",t.bottom="0",t.left="0";break;case"relative":t.position="relative";break;case"absolute":t.position="absolute"}e.has("columns")&&this.columns&&(t.gridTemplateColumns=this.columns),e.has("rows")&&this.rows&&(t.gridTemplateRows=this.rows),e.has("autoColumns")&&this.autoColumns&&(t.gridAutoColumns=this.autoColumns),e.has("autoRows")&&this.autoRows&&(t.gridAutoRows=this.autoRows),e.has("columnGap")&&this.columnGap&&(t.gridColumnGap=this.columnGap),e.has("rowGap")&&this.rowGap&&(t.gridRowGap=this.rowGap),e.has("justifyItems")&&this.justifyItems&&(t.justifyItems=this.justifyItems),e.has("alignItems")&&this.alignItems&&(t.alignItems=this.alignItems),e.has("justifyContent")&&this.justifyContent&&(t.justifyContent=this.justifyContent),e.has("alignContent")&&this.alignContent&&(t.alignContent=this.alignContent),super.update(e)}firstUpdated(){this.style.display="grid",this.classList.add("ff-grid")}};s([i.property({type:String})],n.prototype,"position",void 0),s([i.property({type:String})],n.prototype,"columns",void 0),s([i.property({type:String})],n.prototype,"rows",void 0),s([i.property({type:String})],n.prototype,"autoColumns",void 0),s([i.property({type:String})],n.prototype,"autoRows",void 0),s([i.property({type:String})],n.prototype,"columnGap",void 0),s([i.property({type:String})],n.prototype,"rowGap",void 0),s([i.property({type:String})],n.prototype,"justifyItems",void 0),s([i.property({type:String})],n.prototype,"alignItems",void 0),s([i.property({type:String})],n.prototype,"justifyContent",void 0),s([i.property({type:String})],n.prototype,"alignContent",void 0),n=s([i.customElement("ff-grid")],n),t.default=n},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(119);r(11);const n=r(25),o=r(1),a=r(59);let l=class extends a.default{constructor(e){super(),this.system=e,this.propShader=new i.default(this.onPropertyChange,this),this.position="anchor",this.justify="end",this.offsetX=8,this.offsetY=8,this.keepVisible=!0}connected(){super.connected(),this.propShader.property=this.system.components.get(n.default).ins.shader}disconnected(){super.disconnected(),this.propShader.detach()}render(){const e=this.propShader.getValue(n.EShaderMode.Default);return o.html`
            <label>Shading</label>
            <div class="ff-flex-column" @click=${this.onClickRenderMode}>
                <ff-button .index=${n.EShaderMode.Default} .selectedIndex=${e}
                  text="Standard" title="Display model in standard mode"></ff-button>
                <ff-button .index=${n.EShaderMode.Clay} .selectedIndex=${e}
                  text="Clay" title="Display model without colors"></ff-button>
                <ff-button .index=${n.EShaderMode.XRay} .selectedIndex=${e}
                  text="X-Ray" title="Display model in X-Ray mode"></ff-button>
                <ff-button .index=${n.EShaderMode.Normals} .selectedIndex=${e}
                  text="Normals" title="Display normals"></ff-button>
                <ff-button .index=${n.EShaderMode.Wireframe} .selectedIndex=${e}
                  text="Wireframe" title="Display model as wireframe"></ff-button>
            </div>
        `}firstUpdated(){super.firstUpdated(),this.setStyle({display:"flex",flexDirection:"column"}),this.classList.add("sv-popup-menu")}onPropertyChange(){this.requestUpdate()}onClickRenderMode(e){this.propShader.setValue(e.target.index),e.stopPropagation()}};s([o.property({attribute:!1})],l.prototype,"system",void 0),l=s([o.customElement("sv-render-menu")],l),t.default=l},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(79);t.CVAnnotationsTask=s.default;const i=r(120);t.CVCaptureTask=i.default;const n=r(242);t.CVDerivativesTask=n.default;const o=r(123);t.CVExploreTask=o.default;const a=r(80);t.CVPoseTask=a.default;const l=r(45);t.CVStoryController=l.default;const c=r(33);t.CVTaskController=c.default,t.componentTypes=[s.default,i.default,n.default,o.default,a.default,l.default,c.default]},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1),n=r(43),o=r(79);let a=class extends n.default{constructor(){super(...arguments),this.activeAnnotations=null}setActiveItem(e){this.activeAnnotations=e?e.annotations:null,this.requestUpdate()}firstConnected(){super.firstConnected(),this.classList.add("sv-annotations-task-view")}connected(){super.connected(),this.task.ins.mode.on("value",this.onModeValue,this)}disconnected(){this.task.ins.mode.off("value",this.onModeValue,this),super.disconnected()}render(){if(!this.activeAnnotations)return i.html`<div class="sv-placeholder">Please select an item to edit its annotations</div>`;const e=this.task.ins.mode;return i.html`<div class="ff-flex-row ff-flex-wrap">
            <ff-button text="Off" index=${o.EAnnotationsTaskMode.Off} selectedIndex=${e.value} @click=${this.onClickMode}></ff-button>       
            <ff-button text="Move" index=${o.EAnnotationsTaskMode.Move} selectedIndex=${e.value} @click=${this.onClickMode}></ff-button>       
            <ff-button text="Create" index=${o.EAnnotationsTaskMode.Create} selectedIndex=${e.value} @click=${this.onClickMode}></ff-button>       
            <ff-button text="Delete" @click=${this.onClickDelete}></ff-button>       
        </div>`}onClickMode(e){this.task.ins.mode.setValue(e.target.index)}onClickDelete(){}onModeValue(){this.requestUpdate()}};a=s([i.customElement("sv-annotations-task-view")],a),t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={dataURItoBlob:function(e){const t=atob(e.split(",")[1]),r=new ArrayBuffer(t.length),s=new Uint8Array(r);for(var i=0;i<t.length;i++)s[i]=t.charCodeAt(i);var n=e.split(",")[0].split(":")[1].split(";")[0];return new Blob([r],{type:n})}}},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1);r(31),r(11),r(44);const n=r(43);let o=class extends n.default{constructor(){super(...arguments),this.activeItem=null}setActiveItem(e){this.activeItem=e,this.requestUpdate()}firstConnected(){super.firstConnected(),this.classList.add("sv-capture-task-view")}connected(){super.connected(),this.task.outs.ready.on("value",this.onPictureTaken,this)}disconnected(){this.task.outs.ready.off("value",this.onPictureTaken,this),super.disconnected()}render(){if(!this.activeItem)return i.html`<div class="sv-placeholder">Please select an item to take a picture</div>`;const e=this.task.ins,t=this.task.outs.ready.value,r=this.task.getImageElement(),s=r?i.html`<div class="sv-property-view"><div class="sv-property-name">Preview</div>
            <div class="sv-image">${r}</div></div>`:null;return i.html`<div class="sv-commands">
                <ff-button text="Take" icon="camera" @click=${this.onClickTake}></ff-button>
                <ff-button text="Save" icon="save" ?disabled=${!t} @click=${this.onClickSave}></ff-button>
                <ff-button text="Download" icon="download" ?disabled=${!t} @click=${this.onClickDownload}></ff-button>
            </div>
            <div class="sv-scrollable">
                <sv-property-view .property=${e.type}></sv-property-view>
                <sv-property-view .property=${e.quality}></sv-property-view>
                ${s}
            </div>`}onClickTake(){this.task.ins.take.set()}onClickSave(){this.task.ins.save.set()}onClickDownload(){this.task.ins.download.set()}onPictureTaken(){this.requestUpdate()}};o=s([i.customElement("sv-capture-task-view")],o),t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(243),i=r(32);class n extends i.default{constructor(){super(...arguments),this.activeModel=null}createView(){return new s.default(this)}activate(){super.activate()}deactivate(){super.deactivate()}setActiveItem(e){e&&e.model?(this.activeModel=e.model,this.selection.selectComponent(this.activeModel)):this.activeModel=null}}n.type="CVDerivativesTask",n.text="Derivatives",n.icon="hierarchy",t.default=n},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1);r(31),r(11),r(44);const n=r(43);let o=class extends n.default{};o=s([i.customElement("sv-derivatives-task-view")],o),t.default=o},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1);r(31),r(11),r(44);const n=r(43);let o=class extends n.default{};o=s([i.customElement("sv-explore-task-view")],o),t.default=o},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1);r(31),r(11);const n=r(80);r(44),r(246);const o=r(43);let a=class extends o.default{constructor(){super(...arguments),this.activeModel=null}setActiveItem(e){this.activeModel=e?e.model:null,this.requestUpdate()}firstConnected(){super.firstConnected(),this.classList.add("sv-pose-task-view")}connected(){super.connected(),this.task.ins.mode.on("value",this.onModeValue,this)}disconnected(){this.task.ins.mode.off("value",this.onModeValue,this),super.disconnected()}render(){const e=this.presentations.activePresentation,t=this.activeModel;if(!e||!t)return i.html`<div class="sv-placeholder">Please select an item to edit its pose</div>`;const r=this.task.ins.mode;r.value===n.EPoseManipMode.Off&&r.setValue(n.EPoseManipMode.Rotate);const s=e.scene.ins.units,o=t.ins.units,a=t.ins.position,l=t.ins.rotation;return i.html`
            <div class="sv-commands">
                <ff-button text="Rotate" index=${n.EPoseManipMode.Rotate} selectedIndex=${r.value} @click=${this.onClickMode}></ff-button>
                <ff-button text="Move" index=${n.EPoseManipMode.Translate} selectedIndex=${r.value} @click=${this.onClickMode}></ff-button>
                <ff-button text="Center" @click=${this.onClickCenter}></ff-button>
                <ff-button text="Zoom Views" @click=${this.onClickZoomViews}></ff-button>
            </div>
            <div class="sv-scrollable">
                <sv-property-view .property=${s} label="Global Units"></sv-property-view>    
                <sv-property-view .property=${o} label="Item Units"></sv-property-view>
                <sv-property-view .property=${a}></sv-property-view>
                <sv-property-view .property=${l}></sv-property-view>
            </div>`}onClickMode(e){this.task.ins.mode.setValue(e.target.index)}onClickCenter(){this.presentations.activeItem.model.ins.center.set()}onClickZoomViews(){this.presentations.activePresentation.scene.ins.zoomExtents.set()}onModeValue(){this.requestUpdate()}};a=s([i.customElement("sv-pose-task-view")],a),t.default=a},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0}),r(124);const i=r(1),n=["X","Y","Z","W"];let o=class extends i.default{constructor(){super(...arguments),this.property=null,this.label=void 0}firstConnected(){if(!this.property)throw new Error("property not set");this.setStyle({display:"flex",flexDirection:"column",overflow:"hidden"}),this.classList.add("sv-property-view")}render(){const e=this.property,t=void 0!==this.label?this.label:e.path.split(".").pop(),r=i.html`<div class="sv-property-name">${t}</div>`;if(e.isArray()){if(e.elementCount>4)return;let t=[];for(let r=0;r<e.elementCount;++r)t.push(this.renderField(r));return i.html`${r}${t}`}return i.html`${r}${this.renderField(-1)}`}renderField(e){const t=this.property,r=t.schema.labels||n,s=i.html`<div class="sv-field-label">${e>=0?r[e]:""}</div>`;return i.html`<div class="ff-flex-row sv-field-row">
            ${s}
            <ff-property-field .property=${t} .index=${e}></ff-property-field>
        </div>`}};s([i.property({attribute:!1})],o.prototype,"property",void 0),s([i.property()],o.prototype,"label",void 0),o=s([i.customElement("sv-property-view")],o),t.default=o},function(e,t,r){"use strict";var s,i=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const n=r(59),o=r(1);let a=s=class extends n.default{constructor(e){super(),this.onClick=this.onClick.bind(this),this.onClose=this.onClose.bind(this),this.addEventListener("click",this.onClick),this.addEventListener(n.default.closeEvent,this.onClose),this.options=e||[],this.selectionIndex=-1}render(){return o.html`
            ${this.options.map((e,t)=>o.html`
                <button>${e}</button>
            `)}
        `}updated(){super.updated();const e=this.selectionIndex>=0?this.selectionIndex:0,t=this.children.item(e);t&&t.focus()}firstUpdated(){super.firstUpdated(),this.classList.add("ff-popup-options"),this.setStyle({display:"flex",flexDirection:"column"})}onClick(e){const t=this.getChildrenArray().indexOf(e.target);t>=0&&t<this.options.length&&this.dispatchEvent(new CustomEvent(s.selectEvent,{detail:{index:t,option:this.options[t]}})),this.remove()}onClose(){this.remove()}};a.selectEvent="ff-select",i([o.property({attribute:!1})],a.prototype,"options",void 0),i([o.property({type:Number})],a.prototype,"selectionIndex",void 0),a=s=i([o.customElement("ff-popup-options")],a),t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(123),i=r(80),n=r(120),o=r(79);!function(e){e[e.QC=0]="QC",e[e.Authoring=1]="Authoring"}(t.EStoryMode||(t.EStoryMode={})),t.default={QC:[s.default,i.default,n.default],Authoring:[s.default,o.default]}},function(e,t,r){"use strict";var s,i=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),o=r(31),a=r(125),l=r(46),c=e=>e instanceof d||e instanceof a.default;let d=s=class extends n.default{constructor(){super(...arguments),this.direction="horizontal",this.isInit=!1}get size(){return.01*parseFloat(this.style.flexBasis)}set size(e){this.style.flexBasis=`${(100*(e||1)).toFixed(3)}%`}insertPanel(e,t,r){const i="left"===r||"right"===r?"horizontal":"vertical",n="left"===r||"top"===r,o=t.size,l=new a.default;l.insertPanel(e),l.activatePanel(e);const c=this.getDockElements();c.length<2&&(this.direction=i);let d=t;if(!n)for(let e=0,r=c.length;e<r;++e)if(c[e]===t){d=c[e+1];break}if(i===this.direction)this.insertDockElement(l,d),l.size=t.size=.5*o;else{const e=new s;this.insertBefore(e,t),e.appendChild(t),e.insertDockElement(l,n?t:null),e.direction=i,e.size=o,t.size=l.size=.5}}insertDockElement(e,t){this.init(!1),this.insertBefore(e,t),this.updateSplitters()}removeDockElement(e){let t=this.getDockElements();if(1!==t.length)if(this.removeChild(e),(t=this.getDockElements()).length<2&&this.parentElement instanceof s){const e=this.parentElement,r=t[0];this.removeChild(r),r.size=this.size,e.insertBefore(r,this),e.removeChild(this),e.updateSplitters()}else this.updateSplitters()}getDockElements(){return Array.from(this.children).filter(c)}setLayout(e,t){for(this.init(!1);this.firstChild;)this.removeChild(this.firstChild);this.size=e.size,this.direction=e.direction,e.elements.forEach((e,r)=>{let i;switch(e.type){case"strip":i=new s;break;case"stack":i=new a.default}i.setLayout(e,t),this.appendChild(i)}),this.updateSplitters()}getLayout(){const e=Array.from(this.children).filter(c).map(e=>e.getLayout());return{type:"strip",size:this.size,direction:this.direction,elements:e}}isHorizontal(){return"horizontal"===this.direction}onSplitterChange(e){e.detail.isDragging||this.dispatchEvent(new CustomEvent(l.default.changeEvent,{bubbles:!0}))}firstConnected(){this.init(!0)}update(e){super.update(e),e.has("direction")&&(this.style.flexDirection=this.isHorizontal()?"row":"column",this.updateSplitters())}updateSplitters(){const e=this.getChildrenArray();if(!this.parentElement)return;const t=this.isHorizontal(),r=[],s=[];let i=0;for(let n=0,a=e.length;n<a;++n){const a=e[n],l=a.nextElementSibling;if(a instanceof o.default){if(0===n||!l||l instanceof o.default){this.removeChild(a);continue}a.direction=this.direction}if(!c(a))continue;const d=a.getBoundingClientRect(),u=t?d.width:d.height;i+=u,r.push(a),s.push(u);const h=a.previousElementSibling;if(h&&!(h instanceof o.default)){const e=new o.default;e.direction=this.direction,e.addEventListener(o.default.changeEvent,this.onSplitterChange),this.insertBefore(e,a)}}for(let e=0,t=r.length;e<t;++e)r[e].style.flexBasis=`${(s[e]/i*100).toFixed(3)}%`}init(e){this.isInit||(this.isInit=!0,this.setStyle({flex:"1 1 auto",display:"flex",alignItems:"stretch",overflow:"hidden"}),e&&Array.from(this.children).forEach(e=>{if(!c(e)){const t=new a.default,r=e.nextSibling;t.appendChild(e),this.insertBefore(t,r)}}))}};i([n.property({type:Number})],d.prototype,"size",null),i([n.property({type:String})],d.prototype,"direction",void 0),d=s=i([n.customElement("ff-dock-strip")],d),t.default=d},function(e,t,r){"use strict";var s,i=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0}),r(42),r(11);const n=r(81),o=r(46),a=r(1);let l=s=class extends a.default{constructor(e){super(),this.active=!1,this.onDragStart=this.onDragStart.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.onDrop=this.onDrop.bind(this),this.addEventListener("click",this.onClick),this.addEventListener("dragstart",this.onDragStart),this.addEventListener("dragover",this.onDragOver),this.addEventListener("dragleave",this.onDragLeave),this.addEventListener("drop",this.onDrop),this.panel=e,e.header=this}update(e){super.update(e),this.panel.movable?this.setAttribute("draggable","true"):this.removeAttribute("draggable"),e.has("active")&&(this.panel.active=this.active)}render(){const{text:e,closable:t,movable:r}=this.panel;let s=t?a.html`<ff-button inline icon="close" @click=${this.onClickButton}></ff-button>`:r?a.html`<ff-icon name="grip"></ff-icon>`:null;return a.html`
            <label class="ff-text">${e}</label>
            ${s}
        `}firstUpdated(){this.setStyle({flex:"0 0 auto",display:"block",userSelect:"none",cursor:"pointer"})}onClick(e){this.panel.activatePanel(),this.dispatchEvent(new CustomEvent(o.default.changeEvent,{bubbles:!0}))}onClickButton(e){this.dispatchEvent(new CustomEvent(s.closeEvent,{detail:{panelId:this.panel.id},bubbles:!0})),this.panel.closePanel(),e.stopPropagation(),this.dispatchEvent(new CustomEvent(o.default.changeEvent,{bubbles:!0}))}onDragStart(e){this.panel.parentElement.activatePanel(this.panel),e.dataTransfer.setData(n.default.dragDropMimeType,this.panel.id),e.dataTransfer.dropEffect="move"}onDragOver(e){this.panel.parentStack.onDragOver(e)}onDragLeave(e){this.panel.parentStack.onDragLeave(e)}onDrop(e){this.panel.parentStack.onDrop(e)}};l.closeEvent="ff-dock-panel-header-close",i([a.property({type:Boolean,reflect:!0})],l.prototype,"active",void 0),l=s=i([a.customElement("ff-dock-panel-header")],l),t.default=l},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(9),n=r(63),o=r(19),a=r(0),l=r(48),c=r(37),d=r(12),u=r(252);r(11);const h=r(126);let p=class extends u.default{constructor(e){super(e),this.tree=null,this.addEventListener("click",this.onClick.bind(this)),this.addEventListener("contextmenu",this.onContextMenu.bind(this))}firstConnected(){super.firstConnected(),this.classList.add("ff-hierarchy-tree-view"),this.tree=new f(this.system)}connected(){super.connected(),this.selection.selectedComponents.on(l.default,this.onSelectGraph,this),this.selection.on("active-graph",this.onActiveGraph,this)}disconnected(){super.disconnected(),this.selection.selectedComponents.off(l.default,this.onSelectGraph,this),this.selection.off("active-graph",this.onActiveGraph,this)}render(){const e=this.selection,t=e.activeGraph&&e.activeGraph.parent,r=t?t.name||t.type:"System",s=e.hasChildGraph()?u.html`<ff-button text="down" @click=${this.onClickDown}></ff-button>`:null,i=e.hasParentGraph()?u.html`<ff-button text="up" @click=${this.onClickUp}></ff-button>`:null;return u.html`<div class="ff-flex-row ff-header"><div class="ff-text">${r}</div>${s}${i}</div>
            <div class="ff-scroll-y">${this.tree}</div>`}onClick(){this.selection.clearSelection()}onClickUp(e){e.stopPropagation(),this.selection.activateParentGraph()}onClickDown(e){e.stopPropagation(),this.selection.activateChildGraph()}onContextMenu(){}onSelectGraph(e){this.requestUpdate()}onActiveGraph(e){this.requestUpdate()}};p=s([u.customElement("ff-hierarchy-tree-view")],p),t.default=p;let f=class extends h.default{constructor(e){super(),this.selection=null,this.rootId=i.default(),this.system=e}firstConnected(){super.firstConnected(),this.classList.add("ff-hierarchy-tree"),this.selection=this.system.components.safeGet(d.default),this.root=this.selection.activeGraph}connected(){super.connected();const e=this.selection;e.selectedNodes.on(o.default,this.onSelectNode,this),e.selectedComponents.on(a.default,this.onSelectComponent,this),e.on("active-graph",this.onActiveGraph,this),e.system.nodes.on(o.default,this.onUpdate,this),e.system.components.on(a.default,this.onUpdate,this),e.system.on("hierarchy",this.onUpdate,this)}disconnected(){super.disconnected();const e=this.selection;e.selectedNodes.off(o.default,this.onSelectNode,this),e.selectedComponents.off(a.default,this.onSelectComponent,this),e.off("active-graph",this.onActiveGraph,this),e.system.nodes.off(o.default,this.onUpdate,this),e.system.components.off(a.default,this.onUpdate,this),e.system.off("hierarchy",this.onUpdate,this)}renderNodeHeader(e){let t;if(e instanceof a.default){const t=e.name,r=e.type.substr(1),s=t?`${t} [${r}]`:r;return e instanceof l.default?u.html`<div class="ff-text ff-ellipsis"><b>${s}</b></div>`:u.html`<div class="ff-text ff-ellipsis">${s}</div>`}if(e instanceof o.default){const r=e.name,s=e.type;return t="Node"===s?r||s:r?`${r} [${s.substr(1)}]`:s.substr(1),u.html`<div class="ff-text">${t}</div>`}{const t=e.parent?e.parent.type:"System";return u.html`<div class="ff-text">${t}</div>`}}isNodeSelected(e){const t=this.selection;return e instanceof a.default?t.selectedComponents.contains(e):e instanceof o.default&&t.selectedNodes.contains(e)}getId(e){return e instanceof n.default?this.rootId:e.id}getClasses(e){return e instanceof o.default?"ff-node":e instanceof a.default?"ff-component":"ff-system"}getChildren(e){if(e instanceof o.default){let t=e.components.getArray();const r=e.components.get(c.default);return r&&(t=t.concat(r.children.map(e=>e.node))),t}return e instanceof n.default?e.nodes.findRoots():null}onClickNode(e,t){const r=e.currentTarget.getBoundingClientRect();e.clientX-r.left<30?this.toggleExpanded(t):t instanceof o.default?this.selection.selectNode(t,e.ctrlKey):t instanceof a.default&&this.selection.selectComponent(t,e.ctrlKey)}onDblClickNode(e,t){t instanceof l.default&&(this.selection.activeGraph=t.innerGraph)}onSelectNode(e){this.setSelected(e.node,e.add)}onSelectComponent(e){this.setSelected(e.component,e.add)}onActiveGraph(e){this.root=this.selection.activeGraph}onUpdate(){this.requestUpdate()}};s([u.property({attribute:!1})],f.prototype,"system",void 0),f=s([u.customElement("ff-hierarchy-tree")],f),t.HierarchyTree=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(12),i=r(253);t.customElement=i.customElement,t.property=i.property,t.html=i.html,t.TemplateResult=i.TemplateResult;t.default=class extends i.default{constructor(){super(...arguments),this.selection=null}firstConnected(){this.selection=this.system.components.safeGet(s.default)}}},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(1);t.customElement=i.customElement,t.property=i.property,t.html=i.html,t.TemplateResult=i.TemplateResult;class n extends i.default{constructor(e){super(),this.system=e}}s([i.property({attribute:!1})],n.prototype,"system",void 0),t.default=n},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0}),r(11);const i=r(11),n=r(45),o=r(33),a=r(22),l=r(34);let c=class extends l.default{constructor(e){super(e),this.story=null,this.tasks=null,this.presentations=null,this.story=e.graph.components.safeGet(n.default),this.tasks=e.graph.components.safeGet(o.default),this.presentations=e.graph.components.safeGet(a.default)}firstConnected(){this.classList.add("sv-task-bar")}connected(){this.story.ins.expertMode.on("value",this.performUpdate,this),this.tasks.on("active-task",this.performUpdate,this),this.presentations.on("active-presentation",this.performUpdate,this),this.presentations.on("active-item",this.performUpdate,this)}disconnected(){this.story.ins.expertMode.off("value",this.performUpdate,this),this.tasks.off("active-task",this.performUpdate,this),this.presentations.off("active-presentation",this.performUpdate,this),this.presentations.off("active-item",this.performUpdate,this)}render(){const e=this.tasks.tasks,t=this.tasks.activeTask,r=this.story.ins.expertMode.value,s=this.story.ins.mode.getOptionText();return l.html`
            <img class="sv-logo" src="images/voyager-75grey.svg" alt="Logo"/>
            <div class="sv-mode ff-text">${s}</div>
            <div class="sv-spacer"></div>
            <div class="sv-divider"></div>
            <div class="ff-flex-row ff-group" @click=${this.onClickTask}>
                ${e.map((e,r)=>l.html`<ff-button text=${e.text} icon=${e.icon} index=${r} ?selected=${e===t}></ff-button>`)}
            </div>
            <div class="sv-divider"></div>
            <div class="sv-spacer"></div>
            <div class="sv-divider"></div>
            <div class="ff-flex-row ff-group">
                <ff-button text="Save" icon="save" @click=${this.onClickSave}></ff-button>
                <ff-button text="Download" icon="download" @click=${this.onClickDownload}></ff-button>
                <ff-button text="Exit" icon="exit" @click=${this.onClickExit}></ff-button>
                <div class="sv-divider"></div>
                <ff-button text="Expert Mode" icon="expert" ?selected=${r} @click=${this.onClickExpertMode}></ff-button>
            </div>
        `}onClickTask(e){const t=this.tasks.tasks;e.target instanceof i.default&&(this.tasks.activeTask=t[e.target.index])}onClickSave(){this.story.ins.save.set()}onClickDownload(){this.story.ins.download.set()}onClickExit(){this.story.ins.exit.set()}onClickExpertMode(){const e=this.story.ins.expertMode;e.setValue(!e.value)}};c=s([l.customElement("sv-task-bar")],c),t.default=c},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(117),n=r(1);let o=class extends n.default{constructor(e){super(),this.application=e}firstConnected(){this.classList.add("sv-panel","sv-explorer-panel"),this.appendElement(new i.default(this.application))}};s([n.property({attribute:!1})],o.prototype,"application",void 0),o=s([n.customElement("sv-explorer-panel")],o),t.default=o},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(34),n=r(33);let o=class extends i.default{constructor(e){if(super(e),this.taskController=null,this.taskController=e.graph.components.safeGet(n.default),!this.taskController)throw new Error("missing task manager")}firstConnected(){this.classList.add("sv-scrollable","sv-panel","sv-task-panel")}connected(){this.taskController.on("active-task",this.onActiveTask,this)}disconnected(){this.taskController.off("active-task",this.onActiveTask,this)}render(){const e=this.taskController.activeTask;if(!e)return i.html``;const t=e.createView();return i.html`
            <div class="sv-panel-header">
                <ff-icon name=${e.icon}></ff-icon>
                <div class="ff-text">${e.text}</div>
            </div>
            <div class="sv-panel-content">
                ${t}
            </div>
        `}onActiveTask(){this.requestUpdate()}};o=s([i.customElement("sv-task-panel")],o),t.default=o},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(34);let n=class extends i.default{firstConnected(){this.classList.add("sv-scrollable","sv-panel","sv-log-panel")}};n=s([i.customElement("sv-log-panel")],n),t.default=n},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(34);let n=class extends i.default{constructor(){super(...arguments),this.entries=[],this.logFunction=null}firstConnected(){this.classList.add("sv-scrollable","sv-panel","sv-console-panel")}connected(){}disconnected(){}render(){return i.html`<div>${this.entries.map(e=>i.html`<div>${e}</div>`)}</div>`}};n=s([i.customElement("sv-console-panel")],n),t.default=n},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(260),n=r(34);let o=class extends n.default{firstConnected(){this.classList.add("sv-scrollable","sv-panel","sv-inspector-panel"),this.appendChild(new i.default(this.system))}};o=s([n.customElement("sv-inspector-panel")],o),t.default=o},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(0),n=r(19),o=r(12);r(261);const a=r(126);let l=class extends a.default{constructor(e){super(),this.selection=null,this.includeRoot=!0,this.system=e,this.selection=e.components.safeGet(o.default)}firstConnected(){super.firstConnected(),this.classList.add("ff-property-tree")}connected(){super.connected();const e=this.selection;e.selectedNodes.on(n.default,this.onSelectNode,this),e.selectedComponents.on(i.default,this.onSelectComponent,this);const t=e.selectedNodes.get();if(t)this.root=this.createNodeTreeNode(t);else{const t=e.selectedComponents.get();this.root=t?this.createComponentTreeNode(t):null}}disconnected(){super.disconnected(),this.selection.selectedNodes.off(n.default,this.onSelectNode,this),this.selection.selectedComponents.off(i.default,this.onSelectComponent,this)}getClasses(e){return e.classes}renderNodeHeader(e){return e.property?a.html`<div class="ff-text ff-label ff-ellipsis">${e.text}</div>
                <ff-property-view .property=${e.property}></ff-property-view>`:a.html`<div class="ff-text ff-ellipsis">${e.text}</div>`}onSelectNode(e){e.add?this.root=this.createNodeTreeNode(e.node):this.root=null}onSelectComponent(e){e.add?this.root=this.createComponentTreeNode(e.component):this.root=null}createNodeTreeNode(e){return{id:e.id,text:e.name||e.type,classes:"ff-node",children:e.components.getArray().map(e=>this.createComponentTreeNode(e))}}createComponentTreeNode(e){const t=e.id,r=t+"i",s=t+"o";return{id:t,text:e.name||e.type,classes:"ff-component",property:null,children:[this.createGroupNode(r,"Inputs",e.ins),this.createGroupNode(s,"Outputs",e.outs)]}}createGroupNode(e,t,r){const s=r.properties,i={id:e,text:t,classes:r.isInputGroup()?"ff-inputs":"ff-outputs",children:[]};return s.forEach(e=>{const t=e.path.split(".");let r=i;const s=t.length,n=s-1;for(let i=0;i<s;++i){const s=t[i];let o=r.children.find(e=>e.text===s);if(!o){o={id:i===n?e.key:s,text:s,classes:"",children:[],property:i===n?e:null},r.children.push(o)}r=o}}),i}};s([a.property({attribute:!1})],l.prototype,"system",void 0),l=s([a.customElement("ff-property-tree")],l),t.default=l},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0}),r(124);const i=r(1),n=["X","Y","Z","W"];let o=class extends i.default{constructor(){super(...arguments),this.property=null}firstConnected(){this.setStyle({display:"flex",overflow:"hidden"}),this.classList.add("ff-property-view")}render(){const e=this.property;if(e.isArray()){if(e.elementCount>4)return;const t=e.schema.labels||n;let r=[];for(let s=0;s<e.elementCount;++s)r.push(i.html`
                    <div class="ff-label">${t[s]}</div>
                    <ff-property-field .property=${e} .index=${s}></ff-property-field>
                `);return i.html`${r}`}return i.html`<ff-property-field .property=${e}></ff-property-field>`}};s([i.property({attribute:!1})],o.prototype,"property",void 0),o=s([i.customElement("ff-property-view")],o),t.default=o},function(e,t,r){},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(13);r(264),r(44);const n=r(45),o=r(34);let a=class extends o.default{get story(){return this.system.components.safeGet(n.default)}get renderer(){return this.system.components.safeGet(i.default)}firstConnected(){this.classList.add("sv-scrollable","sv-panel","sv-navigator-panel")}connected(){this.story.ins.mode.on("value",this.performUpdate,this),this.renderer.on("active-scene",this.performUpdate,this)}disconnected(){this.story.ins.mode.off("value",this.performUpdate,this),this.renderer.off("active-scene",this.performUpdate,this)}render(){const e=this.system,t=this.story.ins.mode.value===n.EStoryMode.Authoring?o.html`<div class="sv-panel-section">
                <div class="sv-panel-header">Presentations</div>
                <sv-presentation-list .system=${e}></sv-presentation-list>
            </div>
            <ff-splitter direction="vertical"></ff-splitter>`:null;return o.html`${t}
            <div class="sv-panel-section">
                <div class="sv-panel-header">Items</div>
                <sv-item-list .system=${e}></sv-item-list>
            </div>`}};a=s([o.customElement("sv-navigator-panel")],a),t.default=a},function(e,t,r){"use strict";var s=this&&this.__decorate||function(e,t,r,s){var i,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n<3?i(o):n>3?i(t,r,o):i(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0});const i=r(12),n=r(1),o=r(122),a=r(76),l=r(22);let c=class extends o.default{constructor(){super(...arguments),this.system=null,this.presentations=null,this.selection=null}firstConnected(){super.firstConnected(),this.classList.add("sv-presentation-list"),this.presentations=this.system.components.safeGet(l.default),this.selection=this.system.components.safeGet(i.default)}connected(){super.connected(),this.selection.selectedComponents.on(a.default,this.onSelectPresentation,this),this.presentations.on("presentation",this.onPresentation,this),this.presentations.on("active-presentation",this.onActivePresentation,this)}disconnected(){this.selection.selectedComponents.off(a.default,this.onSelectPresentation,this),this.presentations.off("presentation",this.onPresentation,this),this.presentations.off("active-presentation",this.onActivePresentation,this),super.disconnected()}update(e){this.data=this.system.components.getArray(a.default),super.update(e)}renderItem(e){const t=e===this.presentations.activePresentation;return n.html`<div class="ff-flex-row"><ff-icon name=${t?"check":"empty"}></ff-icon>
            <ff-text class="ff-ellipsis">${e.displayName}</ff-text></div>`}isItemSelected(e){return this.selection.selectedComponents.contains(e)}onClickItem(e,t){this.presentations.activePresentation=t,this.selection.selectComponent(t)}onClickEmpty(){}onPresentation(e){this.requestUpdate()}onSelectPresentation(e){this.requestUpdate()}onActivePresentation(e){this.requestUpdate()}};s([n.property({attribute:!1})],c.prototype,"system",void 0),c=s([n.customElement("sv-presentation-list")],c)}]);