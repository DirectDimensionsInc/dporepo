{% extends 'default_bootstrap_admin.html.twig' %}

{% block stylesheets %}
  {{ parent() }}
  <link href="//cdn.datatables.net/plug-ins/3cfcc339e89/integration/bootstrap/3/dataTables.bootstrap.css" rel="stylesheet" type="text/css" />
  <link href="{{ asset('lib/javascripts/DataTables-extended/css/bootstrap_datatables.css') }}" rel="stylesheet" type="text/css" />
  <link href="//cdnjs.cloudflare.com/ajax/libs/sweetalert/0.3.2/sweet-alert.min.css" rel="stylesheet" type="text/css">
{% endblock %}

{% block content %}

  <ol class="breadcrumb">
    <li><a href="/admin">Dashboard</a></li>
    <li class="active">Browse Projects</li>
  </ol>

  <table id="browse" class="table table-striped table-bordered" cellspacing="0" width="100%">
    <thead>
      <tr>
        <th class="text-center">Project</th>
        <th class="text-center">Unit (Stakeholder)</th>
        <th class="text-center">Subjects Count</th>
        <th class="text-center">Created</th>
        <th class="text-center">Modified</th>
      </tr>
    </thead>
  </table>

  <!-- <div class="well" style="margin-top: 2.75rem;">
    <h3>Questions</h3>
    <ul>
      <li><strong>Projects:</strong> manually entered</li>
      <li><strong>Subjects:</strong> manually entered</li>
      <li style="color: red;"><strong>Items:</strong> manually entered (???)</li>
      <li style="color: red;"><strong>Datasets:</strong> manually entered (???)</li>
      <li><strong>Dataset</strong> Elements: generated</li>
    </ul>
  </div> -->

{% endblock %}

{% block js_bottom %}
  {{ parent() }}
  <script src="//cdn.datatables.net/1.10.4/js/jquery.dataTables.min.js"></script>
  <script src="//cdn.datatables.net/plug-ins/3cfcc339e89/integration/bootstrap/3/dataTables.bootstrap.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/sweetalert/0.3.2/sweet-alert.min.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $('#browse').dataTable( {
         "columns": [
             { "data": "projects_label" },
             { "data": "stakeholder_guid" },
             { "data": "subjects_count" },
             { "data": "date_created" },
             { "data": "last_modified" }
           ],
         "dom": '<"wrapper"fli><"col-sm-3 col-md-3 datatables_bulk_actions">pt<"bottom"ip><"clear">',
         "pagingType": "simple_numbers",
         "stateSave": true,
         "order": [[0,"asc"]],
         // Show processing throbber.
         "processing": true,
         "serverMethod": "POST",
          // All data management will be done on the server side.
         "serverSide": true,
         // Path to the file that is going to handle the queries.
         "ajax": "/admin/projects/datatables_browse_projects",
         // Method type.
         "serverMethod": "POST",
         // Values in the length dropdown.
         "lengthMenu":[10,50,100,500],
         // Set some widths.
         "aoColumnDefs":[
               {"sWidth":"26%","aTargets":[0]}
               // ,{"bSortable":false,"aTargets":[0]}
         ],
         "fnRowCallback":function(nRow, aData, iDisplayIndex) {
           // // Create the checkboxes.
           // $(nRow).find('td:eq(0)').html(
           //  "<input type='checkbox' name='manage_checkbox' value='" + aData['manage'] + "' />"
           // )
           // .addClass("manage_column");
          }
       });

     // Send to details page when clicked.
     var details_page = "/admin/projects/subjects/";
      $('#browse tbody').on('click','td',function(event){
       if(!$(this).hasClass("manage_column")){
         var projects_id = $(this).closest("tr").attr('id');
         window.location.href = details_page + projects_id;
       }
      });

      // var delete_button = $("<div></div>")
      //   .addClass("delete")
      //   .on("click",function(){

      //     var delete_ids = new Array;
      //     $('#browse [name="manage_checkbox"]:checked').each(function(){
      //       delete_ids.push($(this).val());
      //     });

      //     if(delete_ids.length > 0) {

      //       swal({
       //        title: "Confirm",
       //        text: "Are you sure you want to delete the selected item(s)?",
       //        type: "warning",
       //        showCancelButton: true,
       //        confirmButtonColor: "#DD6B55",
       //        confirmButtonText: "Yes, delete the item(s).",
       //        closeOnConfirm: true
       //      },
       //      function(){
       //        $.ajax({
         //      type:"POST"
         //      ,dateType:"json"
         //      ,url: "{#{{ path_to_this_module }}#}/delete"
         //      ,data: ({id: JSON.stringify(delete_ids), csrf_key: "{#{{ csrf_token }}#}"})
         //      ,success: function(ajax_return){
         //        $('#browse').dataTable().fnDraw();
         //      }
         //    });
      //       });

      //     }
      //   });

      // $(".datatables_bulk_actions").append(delete_button);

    });
  </script>
{% endblock %}